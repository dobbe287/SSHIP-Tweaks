; SS 6.4 Early Era Campaign Script  EDIT 20 Jan 2013 by Ichon - edited by Lifthrasir May 2013 & MWY June 2013
; by gracul Jan-2011
;EDITED BY RAVENANT FOR SSMAP
;===================== CONTENTS =========================
;---- 1)AI STUFF & CAMP PREPARE
;---- Setup AI
;---- Is the AI?
;---- Byzantine Leader Battle Models
;---- G5 Looting Script Compact
;---- Ageing Script
;---- Church Titles
;---- Hanseatic System
;---- Faction Leader Global Traits
;---- Great People Ancillaries
;---- Merchant&Priest&Ship Support Spawn
;---- G5 (MWY) Faction Economy Script
;---- Mongol Money Script
;---- Additional Mongol Scripts
;---- Slave Money Script
;---- AI Reinforcements
;---- AI Ship Support
;---- Scripted Early Sieges
;---- 2)PLAYER PART
;---- Faction Killer Workaround
;---- Besiege Upkeep
;---- City Reveal
;---- Major Events
;---- Player Notification
;---- Interactive Events
;---- Mercs Disband Event
;---- Crusader and Jihad Check
;---- Crusader Support Player
;---- Crusader Support AI
;---- Occupied Capitals Revolt
;---- 3)EMERGENT FACTIONS/NATIONAL UPRISINGS
;---- William Wallace Uprising
;---- Golden Horde Emergent
;---- Printing Press Event
;---- Zengid Evolution
;---- Abbasid Evolution
;---- Fatimid To Ayyubid Transition
;---- Ayyubid To Mamluk Transition
;---- Order Recruitment Requirements
;---- Teutonic Order Founded
;---- Bulgarian Uprising
;---- Timurids Invasion (Not anymore)
;---- 4)G5 BAI STUFF
;---- Civil War Resistance
;---- New Leader Unrest Script
;---- Faction Reemergence Script
;========================================================
;=============== AI STUFF & CAMP PREPARE ================
;========================================================
script
restrict_strat_radar false

;====================== Setup AI ========================
monitor_event PreFactionTurnStart not IsFactionAIControlled
	and CampaignDifficulty = easy

	set_event_counter DifficultyLevel 1

	historic_event difficulty_easy
	
	historic_event SSHIP_difficulty_easy
	
    if not I_IsFactionAIControlled england
		increment_kings_purse england 500
	end_if

	if not I_IsFactionAIControlled france
		increment_kings_purse france 500
	end_if

	if not I_IsFactionAIControlled hre
		increment_kings_purse hre 500
	end_if

	if not I_IsFactionAIControlled spain
		increment_kings_purse spain 500
	end_if

	if not I_IsFactionAIControlled venice
		increment_kings_purse venice 500
	end_if

	if not I_IsFactionAIControlled sicily
		increment_kings_purse sicily 500
	end_if

	if not I_IsFactionAIControlled milan
		increment_kings_purse milan 500
	end_if

	if not I_IsFactionAIControlled pisa
		increment_kings_purse pisa 500
	end_if

	if not I_IsFactionAIControlled scotland
		increment_kings_purse scotland 500
	end_if

	if not I_IsFactionAIControlled denmark
		increment_kings_purse denmark 500
	end_if

	if not I_IsFactionAIControlled portugal
		increment_kings_purse portugal 500
	end_if

	if not I_IsFactionAIControlled poland
		increment_kings_purse poland 500
	end_if

	if not I_IsFactionAIControlled hungary
		increment_kings_purse hungary 500
	end_if

	if not I_IsFactionAIControlled russia
		increment_kings_purse russia 500
	end_if

	if not I_IsFactionAIControlled moors
		increment_kings_purse moors 500
	end_if

	if not I_IsFactionAIControlled turks
		increment_kings_purse turks 500
	end_if

	if not I_IsFactionAIControlled rum
		increment_kings_purse rum 500
	end_if

	if not I_IsFactionAIControlled egypt
		increment_kings_purse egypt 500
	end_if

	if not I_IsFactionAIControlled byzantium
		increment_kings_purse byzantium 500
	end_if

	if not I_IsFactionAIControlled jerusalem
		increment_kings_purse jerusalem 500
	end_if

	if not I_IsFactionAIControlled kievan_rus
		increment_kings_purse kievan_rus 500
	end_if

	if not I_IsFactionAIControlled aragon
		increment_kings_purse aragon 500
	end_if

	if not I_IsFactionAIControlled norway
		increment_kings_purse norway 500
	end_if

	if not I_IsFactionAIControlled lithuania
		increment_kings_purse lithuania 500
	end_if

	if not I_IsFactionAIControlled kwarezm
		increment_kings_purse kwarezm 500
	end_if

	if not I_IsFactionAIControlled cumans
		increment_kings_purse cumans 500
	end_if

	if not I_IsFactionAIControlled timurids
		increment_kings_purse timurids 500
	end_if

	if not I_IsFactionAIControlled teutonic_order
		increment_kings_purse teutonic_order 500
	end_if
	terminate_monitor
end_monitor

monitor_event PreFactionTurnStart not IsFactionAIControlled
	and CampaignDifficulty = medium

	set_event_counter DifficultyLevel 2

	historic_event difficulty_medium
  
	historic_event SSHIP_difficulty_medium
	
	terminate_monitor
end_monitor

monitor_event PreFactionTurnStart not IsFactionAIControlled
	and CampaignDifficulty = hard

	set_event_counter DifficultyLevel 3

	historic_event difficulty_hard
  
  historic_event SSHIP_difficulty_hard
  
	if I_IsFactionAIControlled england
		increment_kings_purse england 1000
	end_if

	if I_IsFactionAIControlled france
		increment_kings_purse france 1000
	end_if

	if I_IsFactionAIControlled hre
		increment_kings_purse hre 1000
	end_if

	if I_IsFactionAIControlled spain
		increment_kings_purse spain 1000
	end_if

	if I_IsFactionAIControlled venice
		increment_kings_purse venice 1000
	end_if

	if I_IsFactionAIControlled sicily
		increment_kings_purse sicily 1000
	end_if

	if I_IsFactionAIControlled milan
		increment_kings_purse milan 1000
	end_if

	if I_IsFactionAIControlled pisa
		increment_kings_purse pisa 1000
	end_if

	if I_IsFactionAIControlled scotland
		increment_kings_purse scotland 1000
	end_if

	if I_IsFactionAIControlled denmark
		increment_kings_purse denmark 1000
	end_if

	if I_IsFactionAIControlled portugal
		increment_kings_purse portugal 1000
	end_if

	if I_IsFactionAIControlled poland
		increment_kings_purse poland 1000
	end_if

	if I_IsFactionAIControlled hungary
		increment_kings_purse hungary 1000
	end_if

	if I_IsFactionAIControlled russia
		increment_kings_purse russia 1000
	end_if

	if I_IsFactionAIControlled moors
		increment_kings_purse moors 1000
	end_if

	if I_IsFactionAIControlled turks
		increment_kings_purse turks 1000
	end_if

	if I_IsFactionAIControlled rum
		increment_kings_purse rum 1000
	end_if

	if I_IsFactionAIControlled egypt
		increment_kings_purse egypt 1000
	end_if

	if I_IsFactionAIControlled byzantium
		increment_kings_purse byzantium 1000
	end_if

	if I_IsFactionAIControlled jerusalem
		increment_kings_purse jerusalem 1000
	end_if

	if I_IsFactionAIControlled kievan_rus
		increment_kings_purse kievan_rus 1000
	end_if

	if I_IsFactionAIControlled aragon
		increment_kings_purse aragon 1000
	end_if

	if I_IsFactionAIControlled norway
		increment_kings_purse norway 1000
	end_if

	if I_IsFactionAIControlled lithuania
		increment_kings_purse lithuania 1000
	end_if

	if I_IsFactionAIControlled kwarezm
		increment_kings_purse kwarezm 1000
	end_if

	if I_IsFactionAIControlled cumans
		increment_kings_purse cumans 1000
	end_if

	if I_IsFactionAIControlled timurids
		increment_kings_purse timurids 1000
	end_if

	if I_IsFactionAIControlled teutonic_order
		increment_kings_purse teutonic_order 1000
	end_if

	increment_kings_purse mongols 15000
	
  if I_IsFactionAIControlled papal_states
		increment_kings_purse papal_states 1000
	end_if
  
    terminate_monitor
end_monitor

monitor_event PreFactionTurnStart not IsFactionAIControlled
	and CampaignDifficulty = very_hard

	set_event_counter DifficultyLevel 4

	historic_event difficulty_very_hard
	
	historic_event SSHIP_difficulty_very_hard

	if I_IsFactionAIControlled england
		increment_kings_purse england 1500
	end_if

	if I_IsFactionAIControlled france
		increment_kings_purse france 1000
	end_if

	if I_IsFactionAIControlled hre
		increment_kings_purse hre 1500
	end_if

	if I_IsFactionAIControlled spain
		increment_kings_purse spain 2000
	end_if

	if I_IsFactionAIControlled venice
		increment_kings_purse venice 1500
	end_if

	if I_IsFactionAIControlled sicily
		increment_kings_purse sicily 1500
	end_if

	if I_IsFactionAIControlled milan
		increment_kings_purse milan 1500
	end_if

	if I_IsFactionAIControlled pisa
		increment_kings_purse pisa 1500
	end_if

	if I_IsFactionAIControlled scotland
		increment_kings_purse scotland 1000
	end_if

	if I_IsFactionAIControlled denmark
		increment_kings_purse denmark 1500
	end_if

	if I_IsFactionAIControlled portugal
		increment_kings_purse portugal 1500
	end_if

	if I_IsFactionAIControlled poland
		increment_kings_purse poland 1500
	end_if

	if I_IsFactionAIControlled hungary
		increment_kings_purse hungary 1500
	end_if

	if I_IsFactionAIControlled russia
		increment_kings_purse russia 1500
	end_if

	if I_IsFactionAIControlled moors
		increment_kings_purse moors 1000
	end_if

	if I_IsFactionAIControlled turks
		increment_kings_purse turks 1500
	end_if

	if I_IsFactionAIControlled rum
		increment_kings_purse rum 2000
	end_if

	if I_IsFactionAIControlled egypt
		increment_kings_purse egypt 1500
	end_if

	if I_IsFactionAIControlled byzantium
		increment_kings_purse byzantium 1000
	end_if

	if I_IsFactionAIControlled jerusalem
		increment_kings_purse jerusalem 1500
	end_if

	if I_IsFactionAIControlled kievan_rus
		increment_kings_purse kievan_rus 1500
	end_if

	if I_IsFactionAIControlled aragon
		increment_kings_purse aragon 1500
	end_if

	if I_IsFactionAIControlled norway
		increment_kings_purse norway 1500
	end_if

	if I_IsFactionAIControlled lithuania
		increment_kings_purse lithuania 1500
	end_if

	if I_IsFactionAIControlled kwarezm
		increment_kings_purse kwarezm 1000
	end_if

	if I_IsFactionAIControlled cumans
		increment_kings_purse cumans 1500
	end_if

	if I_IsFactionAIControlled timurids
		increment_kings_purse timurids 1500
	end_if

	if I_IsFactionAIControlled teutonic_order
		increment_kings_purse teutonic_order 1500
	end_if

	increment_kings_purse mongols 20000
  
  if I_IsFactionAIControlled papal_states
		increment_kings_purse papal_states 1000
	end_if

	terminate_monitor
end_monitor

;===================== Is the AI? =======================
declare_counter ai_ec_id ; used in Faction Economy script, 0=Local player, 1=rebels, 2=venice etc
declare_counter pl_ec_id ; used in Rebellion script, 2=player is venice etc

monitor_event PreFactionTurnStart not IsFactionAIControlled
  set_event_counter freeze_recr_pool 0
  set_event_counter is_the_ai 0
  set_event_counter is_the_player 1

  set_counter ai_ec_id 0
end_monitor 
 
monitor_event PreFactionTurnStart IsFactionAIControlled
  set_event_counter freeze_recr_pool 0
  set_event_counter is_the_player 0
  
  if I_EventCounter DifficultyLevel = 4 
		set_event_counter is_the_ai 4
	end_if
	
	if I_EventCounter DifficultyLevel = 3 
		set_event_counter is_the_ai 3
	end_if
	
	if I_EventCounter DifficultyLevel = 2 
		set_event_counter is_the_ai 2
	end_if
	
	if I_EventCounter DifficultyLevel = 1 
		set_event_counter is_the_ai 1
	end_if   

  set_counter pl_ec_id 0
end_monitor

;========== BYZANTINE LEADER BATTLE MODELS ==============
monitor_event BecomesFactionLeader FactionType byzantium
	change_battle_model byzantium leader byzantine_emperor
end_monitor

monitor_event BecomesFactionHeir FactionType byzantium
	change_battle_model byzantium heir byzantine_heir
end_monitor

;============ G5 LOOTING SCRIPT COMPACT =================
declare_counter small_army
declare_counter medium_army
declare_counter large_army
declare_counter battle_no
set_counter small_army 0
set_counter medium_army 0
set_counter large_army 0
set_counter battle_no 0

monitor_event BattleConflictPhaseCommenced not IsFactionAIControlled

	if I_BattleEnemyArmyNumberOfUnits < 9
	and I_BattleEnemyArmyNumberOfUnits > 2
		set_counter small_army 1
	end_if

	if I_BattleEnemyArmyNumberOfUnits > 8
	and I_BattleEnemyArmyNumberOfUnits < 15
		set_counter medium_army 1
	end_if

	if I_BattleEnemyArmyNumberOfUnits > 14
		set_counter large_army 1
	end_if

	set_counter battle_no 1
end_monitor

monitor_event PostBattle not IsFactionAIControlled
	and WonBattle
	and not I_ConflictType Naval
	and I_CompareCounter battle_no = 1

	if I_CompareCounter small_army = 1
	and RandomPercent > 25
		console_command add_money 50
	end_if

	if I_CompareCounter medium_army = 1
	and RandomPercent > 25
		console_command add_money 100
	end_if

	if I_CompareCounter large_army = 1
	and RandomPercent > 25
		console_command add_money 200
	end_if

;		historic_event sack_ai

	set_counter battle_no 0
end_monitor

monitor_event PostBattle not IsFactionAIControlled
	and not WonBattle
	and not I_ConflictType Naval
	and I_CompareCounter battle_no = 1

	if RandomPercent > 90
		console_command add_money -100
	end_if

	if RandomPercent > 55
		console_command add_money -100
	end_if

	console_command add_money -100

;	historic_event sack_player

	set_counter battle_no 0
end_monitor


;=================== CHURCH TITLES ======================
declare_counter bishop_count
declare_counter holiness_count

monitor_event PreFactionTurnStart TrueCondition
	and not FactionReligion pagan
	and not FactionReligion islam

	set_counter bishop_count 0
	set_counter holiness_count 0
	set_event_counter Patriarch 0
	set_event_counter AppointBishop 0
	set_event_counter StripBishop 0
	set_event_counter Antipope 1
end_monitor

;if you don't have a 5 piety priest when exocommed you won't get an antipope at all!
;can do a monitor_event PreFactionTurnStart FactionExcommunicated check, but let's leave it like this, since it seems more 'real'
monitor_event FactionExcommunicated TrueCondition
	and not FactionType venice
	and not FactionType sicily
	and not FactionType milan
	and not FactionType pisa
	and not FactionType denmark
	and not FactionType scotland
;	and not FactionType france
;	and not FactionType hre
	and not FactionType england
	and not FactionType portugal
	and not FactionType poland
	and not FactionType spain
	and not FactionType hungary
	and not FactionType aragon
	and not FactionType norway
	and not FactionType jerusalem

	set_event_counter Antipope 0
end_monitor

monitor_event CharacterTurnStart AgentType = priest
	and Trait PriestLevel = 4
	and FactionExcommunicated
	and FactionReligion catholic

	set_event_counter Antipope 1

end_monitor

monitor_event CharacterTurnEnd AgentType = priest
	and Attribute Piety > 4
	and FactionReligion catholic

	if I_CompareCounter holiness_count = 1
		set_event_counter Antipope 1
	end_if

	inc_counter holiness_count 1

end_monitor

monitor_event CharacterTurnStart AgentType = priest
	and Trait PriestLevel = 3
	and FactionReligion orthodox

	set_event_counter Patriarch 1

end_monitor

monitor_event CharacterTurnEnd AgentType = priest
	and Attribute Piety > 4
	and FactionReligion orthodox

	if I_CompareCounter holiness_count = 1
		set_event_counter Patriarch 1
	end_if

	inc_counter holiness_count 1

end_monitor

monitor_event CharacterTurnStart AgentType = priest
	and not FactionReligion pagan
	and not FactionReligion islam
	and Trait PriestLevel = 1

	inc_counter bishop_count 1
end_monitor

monitor_event SettlementTurnStart TrueCondition
	and not FactionReligion pagan
	and not FactionReligion islam

	inc_counter bishop_count -1
end_monitor

monitor_event CharacterTurnEnd AgentType = priest
	and not CharacterReligion pagan
	and not CharacterReligion islam
	and Trait PriestLevel = 0

	if I_CompareCounter bishop_count = 0
		set_event_counter AppointBishop 0
	end_if

	if I_CompareCounter bishop_count < 0
		set_event_counter AppointBishop 1
		inc_counter bishop_count 1
	end_if
end_monitor

monitor_event CharacterTurnEnd AgentType = priest
	and not CharacterReligion pagan
	and not CharacterReligion islam
	and Trait PriestLevel = 1

	if I_CompareCounter bishop_count = 0
		set_event_counter StripBishop 0
	end_if

	if I_CompareCounter bishop_count > 0
		set_event_counter StripBishop 1
		inc_counter bishop_count -1
	end_if
end_monitor

;================== HANSEATIC SYSTEM ====================
monitor_event PreFactionTurnStart TrueCondition
	set_event_counter hanseatic_count -1
end_monitor

monitor_event CharacterTurnStart GovernorPlugInExists = hansa
	and I_EventCounter hanseatic_league = 1

	inc_event_counter hanseatic_count 1
end_monitor

monitor_event CharacterTurnStart GovernorPlugInExists = c_hansa
	and I_EventCounter hanseatic_league = 1

	inc_event_counter hanseatic_count 1
end_monitor

set_event_counter hanseatic_constructed 0

monitor_event GuildUpgraded BuildingName = hanseatic_guild
	set_event_counter hanseatic_constructed 1
	reset_guild_standing hanseatic_guild
end_monitor

monitor_event BuildingDestroyed BuildingName = hanseatic_guild
	set_event_counter hanseatic_constructed 0
	reset_guild_standing hanseatic_guild
end_monitor

;=========== FACTION LEADER GLOBAL TRAITS ===============
monitor_event PreFactionTurnStart TrueCondition

	set_event_counter thinks_of_his_people 0
	set_event_counter wise_administrator 0
	set_event_counter strictly_religious 0
	set_event_counter protector 0
	set_event_counter merchant_skills 0
	set_event_counter greedy_ruler 0
	set_event_counter shady_connections 0

end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait ThinksOfHisPeople > 0
	set_event_counter thinks_of_his_people 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait WiseAdministrator > 0
	set_event_counter wise_administrator 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait StrictlyReligious > 0
	and not FactionReligion pagan
	set_event_counter strictly_religious 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait Protector > 0
	set_event_counter protector 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait MerchantSkills > 0
	set_event_counter merchant_skills 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait GreedyRuler > 0
	set_event_counter greedy_ruler 1
end_monitor

monitor_event CharacterTurnStart IsFactionLeader
	and Trait ShadyConnections > 0
	set_event_counter shady_connections 1
end_monitor

;============= GREAT PEOPLE ANCILLARIES =================
set_event_counter joan_of_arc_in 0
set_event_counter peter_the_hermit_in 0
set_event_counter bertrand_du_guesclin_in 0
set_event_counter chevalier_de_bayard_in 0
set_event_counter pierre_abelard_in 0
set_event_counter francesco_petrarca_in 0
set_event_counter roger_bacon_in 0
set_event_counter geoffrey_chaucer_in 0
set_event_counter john_wycliffe_in 0
set_event_counter simon_de_montfort_in 0
set_event_counter amerigo_vespucci_in 0
set_event_counter niels_ebbesen_in 0
set_event_counter vlad_tepes_in 0
set_event_counter meister_eckhart_in 0
set_event_counter arnold_von_winkelried_in 0
set_event_counter john_gutenberg_in 0
set_event_counter hildegard_von_bingen_in 0
set_event_counter martin_luther_in 0
set_event_counter paracelsus_in 0
set_event_counter johannes_faustes_in 0
set_event_counter aldus_manutius_in 0
set_event_counter marco_polo_in 0
set_event_counter donatello_in 0
set_event_counter raphael_in 0
set_event_counter michaelangelo_in 0
set_event_counter machiavelli_in 0
set_event_counter george_of_antioch_in 0
set_event_counter francis_of_assisi_in 0
set_event_counter vasco_de_gama_in 0
set_event_counter anthony_of_padua_in 0
set_event_counter nicolau_copernicus_in 0
set_event_counter ibn_khaldun_in 0
set_event_counter albertus_magnus_in 0
set_event_counter jan_zizka_in 0
set_event_counter zawisza_czarny_in 0
set_event_counter roger_de_moulins_in 0
set_event_counter gerard_de_ridefort_in 0
set_event_counter fastolf_in 0

monitor_event FactionTurnStart FactionType slave

	if I_TurnNumber = 580
		set_event_counter joan_of_arc_in 1
	end_if
	if I_TurnNumber = 598
		set_event_counter joan_of_arc_in 0
	end_if

	if I_TurnNumber = 396
		set_event_counter bertrand_du_guesclin_in 1
	end_if
	if I_TurnNumber = 496
		set_event_counter bertrand_du_guesclin_in 0
	end_if

	if I_TurnNumber = 682
		set_event_counter chevalier_de_bayard_in 1
	end_if
	if I_TurnNumber = 784
		set_event_counter chevalier_de_bayard_in 0
	end_if

	if I_TurnNumber = 0
		set_event_counter pierre_abelard_in 1
	end_if
	if I_TurnNumber = 20
		set_event_counter pierre_abelard_in 0
	end_if

	if I_TurnNumber = 364
		set_event_counter francesco_petrarca_in 1
	end_if
	if I_TurnNumber = 484
		set_event_counter francesco_petrarca_in 0
	end_if

	if I_TurnNumber = 196
		set_event_counter roger_bacon_in 1
	end_if
	if I_TurnNumber = 320
		set_event_counter roger_bacon_in 0
	end_if

	if I_TurnNumber = 442
		set_event_counter geoffrey_chaucer_in 1
	end_if
	if I_TurnNumber = 536
		set_event_counter geoffrey_chaucer_in 0
	end_if

	if I_TurnNumber = 412
		set_event_counter john_wycliffe_in 1
	end_if
	if I_TurnNumber = 504
		set_event_counter john_wycliffe_in 0
	end_if

	if I_TurnNumber = 172
		set_event_counter simon_de_montfort_in 1
	end_if
	if I_TurnNumber = 266
		set_event_counter simon_de_montfort_in 0
	end_if

	if I_TurnNumber = 664
		set_event_counter amerigo_vespucci_in 1
	end_if
	if I_TurnNumber = 760
		set_event_counter amerigo_vespucci_in 0
	end_if

	if I_TurnNumber = 372
		set_event_counter niels_ebbesen_in 1
	end_if
	if I_TurnNumber = 416
		set_event_counter niels_ebbesen_in 0
	end_if

	if I_TurnNumber = 618
		set_event_counter vlad_tepes_in 1
	end_if
	if I_TurnNumber = 688
		set_event_counter vlad_tepes_in 0
	end_if

	if I_TurnNumber = 276
		set_event_counter meister_eckhart_in 1
	end_if
	if I_TurnNumber = 390
		set_event_counter meister_eckhart_in 0
	end_if

	if I_TurnNumber = 436
		set_event_counter arnold_von_winkelried_in 1
	end_if
	if I_TurnNumber = 508
		set_event_counter arnold_von_winkelried_in 0
	end_if

	if I_TurnNumber = 550
		set_event_counter john_gutenberg_in 1
	end_if
	if I_TurnNumber = 672
		set_event_counter john_gutenberg_in 0
	end_if

	if I_TurnNumber = 0
		set_event_counter hildegard_von_bingen_in 1
	end_if
	if I_TurnNumber = 94
		set_event_counter hildegard_von_bingen_in 0
	end_if

	if I_TurnNumber = 722
		set_event_counter martin_luther_in 1
	end_if
	if I_TurnNumber = 828
		set_event_counter martin_luther_in 0
	end_if

	if I_TurnNumber = 742
		set_event_counter paracelsus_in 1
	end_if
	if I_TurnNumber = 818
		set_event_counter paracelsus_in 0
	end_if

	if I_TurnNumber = 716
		set_event_counter johannes_faustes_in 1
	end_if
	if I_TurnNumber = 816
		set_event_counter johannes_faustes_in 0
	end_if

	if I_TurnNumber = 654
		set_event_counter aldus_manutius_in 1
	end_if
	if I_TurnNumber = 766
		set_event_counter aldus_manutius_in 0
	end_if

	if I_TurnNumber = 264
		set_event_counter marco_polo_in 1
	end_if
	if I_TurnNumber = 384
		set_event_counter marco_polo_in 0
	end_if

	if I_TurnNumber = 528
		set_event_counter donatello_in 1
	end_if
	if I_TurnNumber = 668
		set_event_counter donatello_in 0
	end_if

	if I_TurnNumber = 722
		set_event_counter raphael_in 1
	end_if
	if I_TurnNumber = 776
		set_event_counter raphael_in 0
	end_if

	if I_TurnNumber = 706
		set_event_counter michaelangelo_in 1
	end_if
	if I_TurnNumber = 864
		set_event_counter michaelangelo_in 0
	end_if

	if I_TurnNumber = 694
		set_event_counter machiavelli_in 1
	end_if
	if I_TurnNumber = 790
		set_event_counter machiavelli_in 0
	end_if

	if I_TurnNumber = 0
		set_event_counter george_of_antioch_in 1
	end_if
	if I_TurnNumber = 40
		set_event_counter george_of_antioch_in 0
	end_if

	if I_TurnNumber = 118
		set_event_counter francis_of_assisi_in 1
	end_if
	if I_TurnNumber = 188
		set_event_counter francis_of_assisi_in 0
	end_if

	if I_TurnNumber = 676
		set_event_counter vasco_de_gama_in 1
	end_if
	if I_TurnNumber = 784
		set_event_counter vasco_de_gama_in 0
	end_if

	if I_TurnNumber = 146
		set_event_counter anthony_of_padua_in 1
	end_if
	if I_TurnNumber = 198
		set_event_counter anthony_of_padua_in 0
	end_if

	if I_TurnNumber = 702
		set_event_counter nicolau_copernicus_in 1
	end_if
	if I_TurnNumber = 822
		set_event_counter nicolau_copernicus_in 0
	end_if

	if I_TurnNumber = 420
		set_event_counter ibn_khaldun_in 1
	end_if
	if I_TurnNumber = 548
		set_event_counter ibn_khaldun_in 0
	end_if

	if I_TurnNumber = 148
		set_event_counter albertus_magnus_in 1
	end_if
	if I_TurnNumber = 296
		set_event_counter albertus_magnus_in 0
	end_if

	if I_TurnNumber = 476
		set_event_counter jan_zizka_in 1
	end_if
	if I_TurnNumber = 584
		set_event_counter jan_zizka_in 0
	end_if

	if I_TurnNumber = 514
		set_event_counter zawisza_czarny_in 1
	end_if
	if I_TurnNumber = 592
		set_event_counter zawisza_czarny_in 0
	end_if

	if I_TurnNumber = 36
		set_event_counter roger_de_moulins_in 1
	end_if
	if I_TurnNumber = 110
		set_event_counter roger_de_moulins_in 0
	end_if

	if I_TurnNumber = 34
		set_event_counter gerard_de_ridefort_in 1
	end_if
	if I_TurnNumber = 114
		set_event_counter gerard_de_ridefort_in 0
	end_if

	if I_TurnNumber = 512
		set_event_counter fastolf_in 1
	end_if
	if I_TurnNumber = 646
		set_event_counter fastolf_in 0
	end_if

end_monitor


;============= G5 FACTION ECONOMY SCRIPT (MWY FIX) ================
;===================== CONTENTS =========================
;Part 0 -- Is the AI?
;Part 1 -- Declare_counters and set ai_ec_id
;Part 2 -- Check if FactionIncome < 1500 for non-slave AI factions ----------
;Part 3a - Slaves are rich
;Part 3b - Slaves are really poor
;Part 4 -- Debt levels common for ranked AI factions and rebels
;Part 5a -- Slave_faction, Small Debt
;Part 5b -- Slaves are not rich
;Part 6 -- Small Debt levels, non-rebel AI factions
;Part 7 -- 0 < Treasury < 10000 AI non-rebels
;Bonus: Additional Mongol Scripts ;gsthoed's note: Mongol Money Script unchanged

;Part 1 -- Declare_counters and set ai_ec_id
declare_counter freeze_venice
declare_counter freeze_sicily
declare_counter freeze_milan
declare_counter freeze_papal_states
declare_counter freeze_denmark
declare_counter freeze_egypt
declare_counter freeze_scotland
declare_counter freeze_cumans
declare_counter freeze_mongols
declare_counter freeze_turks
declare_counter freeze_france
declare_counter freeze_hre
declare_counter freeze_england
declare_counter freeze_portugal
declare_counter freeze_poland
declare_counter freeze_byzantium
declare_counter freeze_moors
declare_counter freeze_russia
declare_counter freeze_spain
declare_counter freeze_hungary
declare_counter freeze_aragon
declare_counter freeze_lithuania
declare_counter freeze_kievan_rus
declare_counter freeze_teutonic_order
declare_counter freeze_timurids
declare_counter freeze_norway
declare_counter freeze_jerusalem
declare_counter freeze_kwarezm
declare_counter freeze_pisa
declare_counter freeze_rum

;------------ WHICH AI FACTIONS CURRENT TURN IS IT ------------------

; it's slave 's turn
monitor_event PreFactionTurnStart FactionType slave
	and IsFactionAIControlled 
	set_counter ai_ec_id 1
end_monitor

; it's venice 's turn
monitor_event PreFactionTurnStart FactionType venice
	and IsFactionAIControlled 
	set_counter ai_ec_id 2
end_monitor

; it's sicily 's turn
monitor_event PreFactionTurnStart FactionType sicily
	and IsFactionAIControlled

	set_counter ai_ec_id 3
end_monitor

; it's milan 's turn
monitor_event PreFactionTurnStart FactionType milan
	and IsFactionAIControlled

	set_counter ai_ec_id 4
end_monitor

; it's papal_states 's turn
monitor_event PreFactionTurnStart FactionType papal_states
	and IsFactionAIControlled ;this faction is unplayable

	set_counter ai_ec_id 5
end_monitor

; it's denmark 's turn
monitor_event PreFactionTurnStart FactionType denmark
	and IsFactionAIControlled

	set_counter ai_ec_id 6
end_monitor

; it's egypt 's turn
monitor_event PreFactionTurnStart FactionType egypt
	and IsFactionAIControlled

	set_counter ai_ec_id 7
end_monitor

; it's scotland 's turn
monitor_event PreFactionTurnStart FactionType scotland
	and IsFactionAIControlled

	set_counter ai_ec_id 8
end_monitor

; it's cumans 's turn
monitor_event PreFactionTurnStart FactionType cumans
	and IsFactionAIControlled

	set_counter ai_ec_id 9
end_monitor

; it's mongols 's turn
monitor_event PreFactionTurnStart FactionType mongols
	and IsFactionAIControlled

	set_counter ai_ec_id 10
end_monitor

; it's turks 's turn
monitor_event PreFactionTurnStart FactionType turks
	and IsFactionAIControlled

	set_counter ai_ec_id 11
end_monitor

; it's france 's turn
monitor_event PreFactionTurnStart FactionType france
	and IsFactionAIControlled

	set_counter ai_ec_id 12
end_monitor

; it's hre 's turn
monitor_event PreFactionTurnStart FactionType hre
	and IsFactionAIControlled

	set_counter ai_ec_id 13
end_monitor

; it's england 's turn
monitor_event PreFactionTurnStart FactionType england
	and IsFactionAIControlled

	set_counter ai_ec_id 14
end_monitor

; it's portugal 's turn
monitor_event PreFactionTurnStart FactionType portugal
	and IsFactionAIControlled

	set_counter ai_ec_id 15
end_monitor

; it's poland 's turn
monitor_event PreFactionTurnStart FactionType poland
	and IsFactionAIControlled

	set_counter ai_ec_id 16
end_monitor

; it's byzantium 's turn
monitor_event PreFactionTurnStart FactionType byzantium
	and IsFactionAIControlled

	set_counter ai_ec_id 17
end_monitor

; it's moors 's turn
monitor_event PreFactionTurnStart FactionType moors
	and IsFactionAIControlled

	set_counter ai_ec_id 18
end_monitor

; it's russia 's turn
monitor_event PreFactionTurnStart FactionType russia
	and IsFactionAIControlled

	set_counter ai_ec_id 19
end_monitor

; it's spain 's turn
monitor_event PreFactionTurnStart FactionType spain
	and IsFactionAIControlled

	set_counter ai_ec_id 20
end_monitor

; it's hungary 's turn
monitor_event PreFactionTurnStart FactionType hungary
	and IsFactionAIControlled

	set_counter ai_ec_id 21
end_monitor

; it's aragon 's turn
monitor_event PreFactionTurnStart FactionType aragon
	and IsFactionAIControlled

	set_counter ai_ec_id 22
end_monitor

; it's lithuania 's turn
monitor_event PreFactionTurnStart FactionType lithuania
	and IsFactionAIControlled

	set_counter ai_ec_id 23
end_monitor

; it's kievan_rus 's turn
monitor_event PreFactionTurnStart FactionType kievan_rus
	and IsFactionAIControlled

	set_counter ai_ec_id 24
end_monitor

; it's teutonic_order 's turn
monitor_event PreFactionTurnStart FactionType teutonic_order
	and IsFactionAIControlled

	set_counter ai_ec_id 25
end_monitor

; it's timurids 's turn
monitor_event PreFactionTurnStart FactionType timurids
	and IsFactionAIControlled

	set_counter ai_ec_id 26
end_monitor

; it's norway 's turn
monitor_event PreFactionTurnStart FactionType norway
	and IsFactionAIControlled

	set_counter ai_ec_id 27
end_monitor

; it's jerusalem 's turn
monitor_event PreFactionTurnStart FactionType jerusalem
	and IsFactionAIControlled

	set_counter ai_ec_id 28
end_monitor

; it's kwarezm 's turn
monitor_event PreFactionTurnStart FactionType kwarezm
	and IsFactionAIControlled

	set_counter ai_ec_id 29
end_monitor

; it's pisa 's turn
monitor_event PreFactionTurnStart FactionType pisa
	and IsFactionAIControlled

	set_counter ai_ec_id 30
end_monitor

; it's rum 's turn
monitor_event PreFactionTurnStart FactionType rum
	and IsFactionAIControlled

	set_counter ai_ec_id 31
end_monitor



;------------ WHICH PLAYER FACTIONS CURRENT TURN IS IT ------------------

; it's venice 's turn
monitor_event PreFactionTurnStart FactionType venice
	and not IsFactionAIControlled 
	set_counter pl_ec_id 2
end_monitor

; it's sicily 's turn
monitor_event PreFactionTurnStart FactionType sicily
	and not IsFactionAIControlled

	set_counter pl_ec_id 3
end_monitor

; it's milan 's turn
monitor_event PreFactionTurnStart FactionType milan
	and not IsFactionAIControlled

	set_counter pl_ec_id 4
end_monitor

; it's papal_states 's turn
monitor_event PreFactionTurnStart FactionType papal_states
	and not IsFactionAIControlled ;this faction is unplayable

	set_counter pl_ec_id 5
end_monitor

; it's denmark 's turn
monitor_event PreFactionTurnStart FactionType denmark
	and not IsFactionAIControlled

	set_counter pl_ec_id 6
end_monitor

; it's egypt 's turn
monitor_event PreFactionTurnStart FactionType egypt
	and not IsFactionAIControlled

	set_counter pl_ec_id 7
end_monitor

; it's scotland 's turn
monitor_event PreFactionTurnStart FactionType scotland
	and not IsFactionAIControlled

	set_counter pl_ec_id 8
end_monitor

; it's cumans 's turn
monitor_event PreFactionTurnStart FactionType cumans
	and not IsFactionAIControlled

	set_counter pl_ec_id 9
end_monitor

; it's mongols 's turn
monitor_event PreFactionTurnStart FactionType mongols
	and not IsFactionAIControlled

	set_counter pl_ec_id 10
end_monitor

; it's turks 's turn
monitor_event PreFactionTurnStart FactionType turks
	and not IsFactionAIControlled

	set_counter pl_ec_id 11
end_monitor

; it's france 's turn
monitor_event PreFactionTurnStart FactionType france
	and not IsFactionAIControlled

	set_counter pl_ec_id 12
end_monitor

; it's hre 's turn
monitor_event PreFactionTurnStart FactionType hre
	and not IsFactionAIControlled

	set_counter pl_ec_id 13
end_monitor

; it's england 's turn
monitor_event PreFactionTurnStart FactionType england
	and not IsFactionAIControlled

	set_counter pl_ec_id 14
end_monitor

; it's portugal 's turn
monitor_event PreFactionTurnStart FactionType portugal
	and not IsFactionAIControlled

	set_counter pl_ec_id 15
end_monitor

; it's poland 's turn
monitor_event PreFactionTurnStart FactionType poland
	and not IsFactionAIControlled

	set_counter pl_ec_id 16
end_monitor

; it's byzantium 's turn
monitor_event PreFactionTurnStart FactionType byzantium
	and not IsFactionAIControlled

	set_counter pl_ec_id 17
end_monitor

; it's moors 's turn
monitor_event PreFactionTurnStart FactionType moors
	and not IsFactionAIControlled

	set_counter pl_ec_id 18
end_monitor

; it's russia 's turn
monitor_event PreFactionTurnStart FactionType russia
	and not IsFactionAIControlled

	set_counter pl_ec_id 19
end_monitor

; it's spain 's turn
monitor_event PreFactionTurnStart FactionType spain
	and not IsFactionAIControlled

	set_counter pl_ec_id 20
end_monitor

; it's hungary 's turn
monitor_event PreFactionTurnStart FactionType hungary
	and not IsFactionAIControlled

	set_counter pl_ec_id 21
end_monitor

; it's aragon 's turn
monitor_event PreFactionTurnStart FactionType aragon
	and not IsFactionAIControlled

	set_counter pl_ec_id 22
end_monitor

; it's lithuania 's turn
monitor_event PreFactionTurnStart FactionType lithuania
	and not IsFactionAIControlled

	set_counter pl_ec_id 23
end_monitor

; it's kievan_rus 's turn
monitor_event PreFactionTurnStart FactionType kievan_rus
	and not IsFactionAIControlled

	set_counter pl_ec_id 24
end_monitor

; it's teutonic_order 's turn
monitor_event PreFactionTurnStart FactionType teutonic_order
	and not IsFactionAIControlled

	set_counter pl_ec_id 25
end_monitor

; it's timurids 's turn
monitor_event PreFactionTurnStart FactionType timurids
	and not IsFactionAIControlled

	set_counter pl_ec_id 26
end_monitor

; it's norway 's turn
monitor_event PreFactionTurnStart FactionType norway
	and not IsFactionAIControlled

	set_counter pl_ec_id 27
end_monitor

; it's jerusalem 's turn
monitor_event PreFactionTurnStart FactionType jerusalem
	and not IsFactionAIControlled

	set_counter pl_ec_id 28
end_monitor

; it's kwarezm 's turn
monitor_event PreFactionTurnStart FactionType kwarezm
	and not IsFactionAIControlled

	set_counter pl_ec_id 29
end_monitor

; it's pisa 's turn
monitor_event PreFactionTurnStart FactionType pisa
	and not IsFactionAIControlled

	set_counter pl_ec_id 30
end_monitor

; it's rum 's turn
monitor_event PreFactionTurnStart FactionType rum
	and not IsFactionAIControlled

	set_counter pl_ec_id 31
end_monitor




;Part 2 -- Check if FactionIncome < 3000 for non-slave AI factions ----------
monitor_event FactionTurnStart I_CompareCounter ai_ec_id > 1
	and FactionIncome < 3000

	if I_CompareCounter ai_ec_id = 2
		set_counter freeze_venice 1
	end_if
	if I_CompareCounter ai_ec_id = 3
		set_counter freeze_sicily 1
	end_if
	if I_CompareCounter ai_ec_id = 4
		set_counter freeze_milan 1
	end_if
	if I_CompareCounter ai_ec_id = 5
		set_counter freeze_papal_states 1
	end_if
	if I_CompareCounter ai_ec_id = 6
		set_counter freeze_denmark 1
	end_if
	if I_CompareCounter ai_ec_id = 7
		set_counter freeze_egypt 1
	end_if
	if I_CompareCounter ai_ec_id = 8
		set_counter freeze_scotland 1
	end_if
	if I_CompareCounter ai_ec_id = 9
		set_counter freeze_cumans 1
	end_if
	if I_CompareCounter ai_ec_id = 10
		set_counter freeze_mongols 1
	end_if
	if I_CompareCounter ai_ec_id = 11
		set_counter freeze_turks 1
	end_if
	if I_CompareCounter ai_ec_id = 12
		set_counter freeze_france 1
	end_if
	if I_CompareCounter ai_ec_id = 13
		set_counter freeze_hre 1
	end_if
	if I_CompareCounter ai_ec_id = 14
		set_counter freeze_england 1
	end_if
	if I_CompareCounter ai_ec_id = 15
		set_counter freeze_portugal 1
	end_if
	if I_CompareCounter ai_ec_id = 16
		set_counter freeze_poland 1
	end_if
	if I_CompareCounter ai_ec_id = 17
		set_counter freeze_byzantium 1
	end_if
	if I_CompareCounter ai_ec_id = 18
		set_counter freeze_moors 1
	end_if
	if I_CompareCounter ai_ec_id = 19
		set_counter freeze_russia 1
	end_if
	if I_CompareCounter ai_ec_id = 20
		set_counter freeze_spain 1
	end_if
	if I_CompareCounter ai_ec_id = 21
		set_counter freeze_hungary 1
	end_if
	if I_CompareCounter ai_ec_id = 22
		set_counter freeze_aragon 1
	end_if
	if I_CompareCounter ai_ec_id = 23
		set_counter freeze_lithuania 1
	end_if
	if I_CompareCounter ai_ec_id = 24
		set_counter freeze_kievan_rus 1
	end_if
	if I_CompareCounter ai_ec_id = 25
		set_counter freeze_teutonic_order 1
	end_if
	if I_CompareCounter ai_ec_id = 26
		set_counter freeze_timurids 1
	end_if
	if I_CompareCounter ai_ec_id = 27
		set_counter freeze_norway 1
	end_if
	if I_CompareCounter ai_ec_id = 28
		set_counter freeze_jerusalem 1
	end_if
	if I_CompareCounter ai_ec_id = 29
		set_counter freeze_kwarezm 1
	end_if
	if I_CompareCounter ai_ec_id = 30
		set_counter freeze_pisa 1
	end_if
	if I_CompareCounter ai_ec_id = 31
		set_counter freeze_rum 1
	end_if

end_monitor


;Part 3a -- Slaves are rich
monitor_event PreFactionTurnStart I_CompareCounter ai_ec_id = 1 ;so FactionType slave and IsFactionAIControlled
	and Treasury > 60000
	
	set_counter ai_ec_id 0 ;gsthoed's note --  to stop subsequent monitors when checking their first condition. 
;Do not apply the same for "ranked" factions, as we need the correct ai_ec_id later in FactionTurnStart (previous monitor) 
    set_event_counter freeze_recr_pool 0
    set_event_counter freeze_units 0
    set_event_counter freeze_ships 0

  	set_kings_purse slave 3000

  if I_NumberOfSettlements slave >= 3
	set_kings_purse slave 10000
  if I_NumberOfSettlements slave >= 20
	set_kings_purse slave 50000
  if I_NumberOfSettlements slave >= 30
	set_kings_purse slave 80000
  if I_NumberOfSettlements slave >= 40
	set_kings_purse slave 120000
  if I_NumberOfSettlements slave >= 50
	set_kings_purse slave 140000
  if I_NumberOfSettlements slave >= 60
	set_kings_purse slave 150000
  end_if
  end_if
  end_if
  end_if
  end_if
  end_if

end_monitor

monitor_event PreFactionTurnStart I_CompareCounter ai_ec_id > 0
	and Treasury < -5000

	if I_CompareCounter ai_ec_id = 1
		add_money slave 2147483647
    add_money slave 2147483647
    add_money slave -2147483647 
    add_money slave -5000 
	end_if

	if I_CompareCounter ai_ec_id = 2
		destroy_units venice, mercenary_unit
		set_counter freeze_venice 0
		add_money venice 2147483647
    add_money venice 2147483647
    add_money venice -2147483647 
    add_money venice -5000 
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 3
		destroy_units sicily, mercenary_unit
		set_counter freeze_sicily 0
		add_money sicily 2147483647
    add_money sicily 2147483647
    add_money sicily -2147483647 
    add_money sicily -5000 
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 4
		destroy_units milan, mercenary_unit
		set_counter freeze_milan 0
		add_money milan 2147483647
    add_money milan 2147483647
    add_money milan -2147483647 
    add_money milan -5000 
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 5
		destroy_units papal_states, mercenary_unit
		set_counter freeze_papal_states 0
		add_money papal_states 2147483647
    add_money papal_states 2147483647
    add_money papal_states -2147483647 
    add_money papal_states -5000 
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 6
		destroy_units denmark, mercenary_unit
		set_counter freeze_denmark 0
		add_money denmark 2147483647
    add_money denmark 2147483647
    add_money denmark -2147483647 
    add_money denmark -5000 
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 7
		destroy_units egypt, mercenary_unit
		set_counter freeze_egypt 0
		add_money egypt 2147483647
    add_money egypt 2147483647
    add_money egypt -2147483647 
    add_money egypt -5000 
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 8
		destroy_units scotland, mercenary_unit
		set_counter freeze_scotland 0
    add_money scotland 2147483647
    add_money scotland 2147483647
    add_money scotland -2147483647 
    add_money scotland -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 9
		destroy_units cumans, mercenary_unit
		set_counter freeze_cumans 0
    add_money cumans 2147483647
    add_money cumans 2147483647
    add_money cumans -2147483647 
    add_money cumans -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 10
		destroy_units mongols, mercenary_unit
		set_counter freeze_mongols 0
    add_money mongols 2147483647
    add_money mongols 2147483647
    add_money mongols -2147483647 
    add_money mongols -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 11
		destroy_units turks, mercenary_unit
		set_counter freeze_turks 0
    add_money turks 2147483647
    add_money turks 2147483647
    add_money turks -2147483647 
    add_money turks -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 12
		destroy_units france, mercenary_unit
		set_counter freeze_france 0
    add_money france 2147483647
    add_money france 2147483647
    add_money france -2147483647 
    add_money france -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 13
		destroy_units hre, mercenary_unit
		set_counter freeze_hre 0
    add_money hre 2147483647
    add_money hre 2147483647
    add_money hre -2147483647 
    add_money hre -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 14
		destroy_units england, mercenary_unit
		set_counter freeze_england 0
    add_money england 2147483647
    add_money england 2147483647
    add_money england -2147483647 
    add_money england -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 15
		destroy_units portugal, mercenary_unit
		set_counter freeze_portugal 0
    add_money portugal 2147483647
    add_money portugal 2147483647
    add_money portugal -2147483647 
    add_money portugal -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 16
		destroy_units poland, mercenary_unit
		set_counter freeze_poland 0
    add_money poland 2147483647
    add_money poland 2147483647
    add_money poland -2147483647 
    add_money poland -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 17
		destroy_units byzantium, mercenary_unit
		set_counter freeze_byzantium 0
    add_money byzantium 2147483647
    add_money byzantium 2147483647
    add_money byzantium -2147483647 
    add_money byzantium -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 18
		destroy_units moors, mercenary_unit
		set_counter freeze_moors 0
    add_money moors 2147483647
    add_money moors 2147483647
    add_money moors -2147483647 
    add_money moors -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 19
		destroy_units russia, mercenary_unit
		set_counter freeze_russia 0
    add_money russia 2147483647
    add_money russia 2147483647
    add_money russia -2147483647 
    add_money russia -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 20
		destroy_units spain, mercenary_unit
		set_counter freeze_spain 0
    add_money spain 2147483647
    add_money spain 2147483647
    add_money spain -2147483647 
    add_money spain -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 21
		destroy_units hungary, mercenary_unit
		set_counter freeze_hungary 0
    add_money hungary 2147483647
    add_money hungary 2147483647
    add_money hungary -2147483647 
    add_money hungary -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 22
		destroy_units aragon, mercenary_unit
		set_counter freeze_aragon 0
    add_money aragon 2147483647
    add_money aragon 2147483647
    add_money aragon -2147483647 
    add_money aragon -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 23
		destroy_units lithuania, mercenary_unit
		set_counter freeze_lithuania 0
    add_money lithuania 2147483647
    add_money lithuania 2147483647
    add_money lithuania -2147483647 
    add_money lithuania -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 24
		destroy_units kievan_rus, mercenary_unit
		set_counter freeze_kievan_rus 0
    add_money kievan_rus 2147483647
    add_money kievan_rus 2147483647
    add_money kievan_rus -2147483647 
    add_money kievan_rus -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 25
		destroy_units teutonic_order, mercenary_unit
		set_counter freeze_teutonic_order 0
    add_money teutonic_order 2147483647
    add_money teutonic_order 2147483647
    add_money teutonic_order -2147483647 
    add_money teutonic_order -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 26
		destroy_units timurids, mercenary_unit
		set_counter freeze_timurids 0
    add_money timurids 2147483647
    add_money timurids 2147483647
    add_money timurids -2147483647 
    add_money timurids -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 27
		destroy_units norway, mercenary_unit
		set_counter freeze_norway 0
    add_money norway 2147483647
    add_money norway 2147483647
    add_money norway -2147483647 
    add_money norway -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 28
		destroy_units jerusalem, mercenary_unit
		set_counter freeze_jerusalem 0
    add_money jerusalem 2147483647
    add_money jerusalem 2147483647
    add_money jerusalem -2147483647 
    add_money jerusalem -5000
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 29
		destroy_units kwarezm, mercenary_unit
		set_counter freeze_kwarezm 0
    add_money kwarezm 2147483647
    add_money kwarezm 2147483647
    add_money kwarezm -2147483647 
    add_money kwarezm -5000 
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 30
		destroy_units pisa, mercenary_unit
		set_counter freeze_pisa 0
		add_money pisa 2147483647
    add_money pisa 2147483647
    add_money pisa -2147483647 
    add_money pisa -5000 
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 31
		destroy_units rum, mercenary_unit
		set_counter freeze_rum 0
		add_money rum 2147483647
    add_money rum 2147483647
    add_money rum -2147483647 
    add_money rum -5000 
		set_event_counter freeze_recr_pool 1
	end_if

end_monitor


;Part 5a -- Slave_faction, Small Debt

monitor_event PreFactionTurnStart I_CompareCounter ai_ec_id = 1 ;so FactionType slave, IsFactionAIControlled and not Treasury > 60000
	and Treasury < 0
	and Treasury > -5001

	add_money slave 5100

end_monitor

;Part 5b -- Slaves are not rich
monitor_event PreFactionTurnStart I_CompareCounter ai_ec_id = 1 ;so FactionType slave, IsFactionAIControlled and not Treasury > 60000
	and Treasury < 40000

    set_event_counter freeze_recr_pool 1
    set_event_counter freeze_units 1
    set_event_counter freeze_ships 1

	set_kings_purse slave 8000

  if I_NumberOfSettlements slave >= 3
	set_kings_purse slave 40000
  if I_NumberOfSettlements slave >= 20
	set_kings_purse slave 80000
  if I_NumberOfSettlements slave >= 30
	set_kings_purse slave 140000
  if I_NumberOfSettlements slave >= 40
	set_kings_purse slave 160000
  if I_NumberOfSettlements slave >= 50
	set_kings_purse slave 175000
  if I_NumberOfSettlements slave >= 60
	set_kings_purse slave 200000
  end_if
  end_if
  end_if
  end_if
  end_if
  end_if

end_monitor


;Part 6 -- Small Debt levels, non-rebel AI factions
monitor_event PreFactionTurnStart I_CompareCounter ai_ec_id > 1
	and Treasury < -2500
	and Treasury > -5001

	if I_CompareCounter ai_ec_id = 2
		set_counter freeze_venice 0
		add_money venice 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 3
		set_counter freeze_sicily 0
		add_money sicily 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 4
		set_counter freeze_milan 0
		add_money milan 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 5
		set_counter freeze_papal_states 0
		add_money papal_states 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 6
		set_counter freeze_denmark 0
		add_money denmark 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 7
		set_counter freeze_egypt 0
		add_money egypt 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 8
		set_counter freeze_scotland 0
		add_money scotland 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 9
		set_counter freeze_cumans 0
		add_money cumans 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 10
		set_counter freeze_mongols 0
		add_money mongols 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 11
		set_counter freeze_turks 0
		add_money turks 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 12
		set_counter freeze_france 0
		add_money france 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 13
		set_counter freeze_hre 0
		add_money hre 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 14
		set_counter freeze_england 0
		add_money england 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 15
		set_counter freeze_portugal 0
		add_money portugal 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 16
		set_counter freeze_poland 0
		add_money poland 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 17
		set_counter freeze_byzantium 0
		add_money byzantium 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 18
		set_counter freeze_moors 0
		add_money moors 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 19
		set_counter freeze_russia 0
		add_money russia 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 20
		set_counter freeze_spain 0
		add_money spain 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 21
		set_counter freeze_hungary 0
		add_money hungary 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 22
		set_counter freeze_aragon 0
		add_money aragon 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 23
		set_counter freeze_lithuania 0
		add_money lithuania 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 24
		set_counter freeze_kievan_rus 0
		add_money kievan_rus 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 25
		set_counter freeze_teutonic_order 0
		add_money teutonic_order 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 26
		set_counter freeze_timurids 0
		add_money timurids 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 27
		set_counter freeze_norway 0
		add_money norway 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 28
		set_counter freeze_jerusalem 0
		add_money jerusalem 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 29
		set_counter freeze_kwarezm 0
		add_money kwarezm 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 30
		set_counter freeze_pisa 0
		add_money pisa 5100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 31
		set_counter freeze_rum 0
		add_money rum 5100
		set_event_counter freeze_recr_pool 1
	end_if
end_monitor


monitor_event PreFactionTurnStart I_CompareCounter ai_ec_id > 1
	and Treasury < -1000
	and Treasury > -2501

	if I_CompareCounter ai_ec_id = 2
		set_counter freeze_venice 0
		add_money venice 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 3
		set_counter freeze_sicily 0
		add_money sicily 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 4
		set_counter freeze_milan 0
		add_money milan 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 5
		set_counter freeze_papal_states 0
		add_money papal_states 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 6
		set_counter freeze_denmark 0
		add_money denmark 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 7
		set_counter freeze_egypt 0
		add_money egypt 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 8
		set_counter freeze_scotland 0
		add_money scotland 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 9
		set_counter freeze_cumans 0
		add_money cumans 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 10
		set_counter freeze_mongols 0
		add_money mongols 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 11
		set_counter freeze_turks 0
		add_money turks 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 12
		set_counter freeze_france 0
		add_money france 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 13
		set_counter freeze_hre 0
		add_money hre 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 14
		set_counter freeze_england 0
		add_money england 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 15
		set_counter freeze_portugal 0
		add_money portugal 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 16
		set_counter freeze_poland 0
		add_money poland 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 17
		set_counter freeze_byzantium 0
		add_money byzantium 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 18
		set_counter freeze_moors 0
		add_money moors 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 19
		set_counter freeze_russia 0
		add_money russia 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 20
		set_counter freeze_spain 0
		add_money spain 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 21
		set_counter freeze_hungary 0
		add_money hungary 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 22
		set_counter freeze_aragon 0
		add_money aragon 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 23
		set_counter freeze_lithuania 0
		add_money lithuania 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 24
		set_counter freeze_kievan_rus 0
		add_money kievan_rus 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 25
		set_counter freeze_teutonic_order 0
		add_money teutonic_order 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 26
		set_counter freeze_timurids 0
		add_money timurids 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 27
		set_counter freeze_norway 0
		add_money norway 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 28
		set_counter freeze_jerusalem 0
		add_money jerusalem 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 29
		set_counter freeze_kwarezm 0
		add_money kwarezm 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 30
		set_counter freeze_pisa 0
		add_money pisa 2600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 31
		set_counter freeze_rum 0
		add_money rum 2600
		set_event_counter freeze_recr_pool 1
	end_if
end_monitor

monitor_event PreFactionTurnStart I_CompareCounter ai_ec_id > 1
	and Treasury < -500
	and Treasury > -1001

	if I_CompareCounter ai_ec_id = 2
		set_counter freeze_venice 0
		add_money venice 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 3
		set_counter freeze_sicily 0
		add_money sicily 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 4
		set_counter freeze_milan 0
		add_money milan 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 5
		set_counter freeze_papal_states 0
		add_money papal_states 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 6
		set_counter freeze_denmark 0
		add_money denmark 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 7
		set_counter freeze_egypt 0
		add_money egypt 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 8
		set_counter freeze_scotland 0
		add_money scotland 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 9
		set_counter freeze_cumans 0
		add_money cumans 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 10
		set_counter freeze_mongols 0
		add_money mongols 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 11
		set_counter freeze_turks 0
		add_money turks 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 12
		set_counter freeze_france 0
		add_money france 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 13
		set_counter freeze_hre 0
		add_money hre 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 14
		set_counter freeze_england 0
		add_money england 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 15
		set_counter freeze_portugal 0
		add_money portugal 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 16
		set_counter freeze_poland 0
		add_money poland 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 17
		set_counter freeze_byzantium 0
		add_money byzantium 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 18
		set_counter freeze_moors 0
		add_money moors 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 19
		set_counter freeze_russia 0
		add_money russia 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 20
		set_counter freeze_spain 0
		add_money spain 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 21
		set_counter freeze_hungary 0
		add_money hungary 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 22
		set_counter freeze_aragon 0
		add_money aragon 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 23
		set_counter freeze_lithuania 0
		add_money lithuania 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 24
		set_counter freeze_kievan_rus 0
		add_money kievan_rus 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 25
		set_counter freeze_teutonic_order 0
		add_money teutonic_order 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 26
		set_counter freeze_timurids 0
		add_money timurids 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 27
		set_counter freeze_norway 0
		add_money norway 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 28
		set_counter freeze_jerusalem 0
		add_money jerusalem 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 29
		set_counter freeze_kwarezm 0
		add_money kwarezm 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 30
		set_counter freeze_pisa 0
		add_money pisa 1100
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 31
		set_counter freeze_rum 0
		add_money rum 1100
		set_event_counter freeze_recr_pool 1
	end_if

end_monitor

monitor_event PreFactionTurnStart I_CompareCounter ai_ec_id > 1
	and Treasury < 0
	and Treasury > -501

	if I_CompareCounter ai_ec_id = 2
		set_counter freeze_venice 0
		add_money venice 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 3
		set_counter freeze_sicily 0
		add_money sicily 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 4
		set_counter freeze_milan 0
		add_money milan 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 5
		set_counter freeze_papal_states 0
		add_money papal_states 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 6
		set_counter freeze_denmark 0
		add_money denmark 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 7
		set_counter freeze_egypt 0
		add_money egypt 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 8
		set_counter freeze_scotland 0
		add_money scotland 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 9
		set_counter freeze_cumans 0
		add_money cumans 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 10
		set_counter freeze_mongols 0
		add_money mongols 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 11
		set_counter freeze_turks 0
		add_money turks 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 12
		set_counter freeze_france 0
		add_money france 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 13
		set_counter freeze_hre 0
		add_money hre 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 14
		set_counter freeze_england 0
		add_money england 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 15
		set_counter freeze_portugal 0
		add_money portugal 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 16
		set_counter freeze_poland 0
		add_money poland 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 17
		set_counter freeze_byzantium 0
		add_money byzantium 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 18
		set_counter freeze_moors 0
		add_money moors 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 19
		set_counter freeze_russia 0
		add_money russia 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 20
		set_counter freeze_spain 0
		add_money spain 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 21
		set_counter freeze_hungary 0
		add_money hungary 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 22
		set_counter freeze_aragon 0
		add_money aragon 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 23
		set_counter freeze_lithuania 0
		add_money lithuania 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 24
		set_counter freeze_kievan_rus 0
		add_money kievan_rus 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 25
		set_counter freeze_teutonic_order 0
		add_money teutonic_order 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 26
		set_counter freeze_timurids 0
		add_money timurids 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 27
		set_counter freeze_norway 0
		add_money norway 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 28
		set_counter freeze_jerusalem 0
		add_money jerusalem 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 29
		set_counter freeze_kwarezm 0
		add_money kwarezm 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 30
		set_counter freeze_pisa 0
		add_money pisa 600
		set_event_counter freeze_recr_pool 1
	end_if
	if I_CompareCounter ai_ec_id = 31
		set_counter freeze_rum 0
		add_money rum 600
		set_event_counter freeze_recr_pool 1
	end_if

end_monitor

;Part 7 -- 0 < Treasury < 10000 AI non-rebels
monitor_event PreFactionTurnStart I_CompareCounter ai_ec_id > 1
	and Treasury < 15000
	and I_EventCounter freeze_recr_pool = 0 ; I could use "Treasury >= 0", but see next note

;gsthoed's note -- If Treasury was negative before the Economy script, then by now both freeze_recr_pool and freeze_<faction> have been set to 1 and 0 respectively.
;Also, Treasury is most cases is positive by now (and below 10000 if previously in debt). 
;If I didn't add the third condition or put "and Treasury >= 0", this monitor would have fired up without anything useful to do.

	if I_CompareCounter ai_ec_id = 2
	and I_CompareCounter freeze_venice = 1
		if not I_FactionBesieged venice
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_venice 0
	end_if

	if I_CompareCounter ai_ec_id = 3
	and I_CompareCounter freeze_sicily = 1
		if not I_FactionBesieged sicily
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_sicily 0
	end_if

	if I_CompareCounter ai_ec_id = 4
	and I_CompareCounter freeze_milan = 1
		if not I_FactionBesieged milan
		set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_milan 0
	end_if

	if I_CompareCounter ai_ec_id = 5
	and I_CompareCounter freeze_papal_states = 1
		if not I_FactionBesieged papal_states
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_papal_states 0
	end_if

	if I_CompareCounter ai_ec_id = 6
	and I_CompareCounter freeze_denmark = 1
		if not I_FactionBesieged denmark
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_denmark 0
	end_if

	if I_CompareCounter ai_ec_id = 7
	and I_CompareCounter freeze_egypt = 1
		if not I_FactionBesieged egypt
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_egypt 0
	end_if

	if I_CompareCounter ai_ec_id = 8
	and I_CompareCounter freeze_scotland = 1
		if not I_FactionBesieged scotland
		set_event_counter freeze_recr_pool 1
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_scotland 0
	end_if

	if I_CompareCounter ai_ec_id = 9
	and I_CompareCounter freeze_cumans = 1
		if not I_FactionBesieged cumans
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_cumans 0
	end_if

	if I_CompareCounter ai_ec_id = 10
	and I_CompareCounter freeze_mongols = 1
		if not I_FactionBesieged mongols
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_mongols 0
	end_if

	if I_CompareCounter ai_ec_id = 11
	and I_CompareCounter freeze_turks = 1
		if not I_FactionBesieged turks
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_turks 0
	end_if

	if I_CompareCounter ai_ec_id = 12
	and I_CompareCounter freeze_france = 1
		if not I_FactionBesieged france
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_france 0
	end_if

	if I_CompareCounter ai_ec_id = 13
	and I_CompareCounter freeze_hre = 1
		if not I_FactionBesieged hre
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_hre 0
	end_if

	if I_CompareCounter ai_ec_id = 14
	and I_CompareCounter freeze_england = 1
		if not I_FactionBesieged england
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_england 0
	end_if

	if I_CompareCounter ai_ec_id = 15
	and I_CompareCounter freeze_portugal = 1
		if not I_FactionBesieged portugal
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_portugal 0
	end_if

	if I_CompareCounter ai_ec_id = 16
	and I_CompareCounter freeze_poland = 1
		if not I_FactionBesieged poland
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_poland 0
	end_if

	if I_CompareCounter ai_ec_id = 17
	and I_CompareCounter freeze_byzantium = 1
		if not I_FactionBesieged byzantium
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_byzantium 0
	end_if

	if I_CompareCounter ai_ec_id = 18
	and I_CompareCounter freeze_moors = 1
		if not I_FactionBesieged moors
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_moors 0
	end_if

	if I_CompareCounter ai_ec_id = 19
	and I_CompareCounter freeze_russia = 1
		if not I_FactionBesieged russia
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_russia 0
	end_if

	if I_CompareCounter ai_ec_id = 20
	and I_CompareCounter freeze_spain = 1
		if not I_FactionBesieged spain
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_spain 0
	end_if

	if I_CompareCounter ai_ec_id = 21
	and I_CompareCounter freeze_hungary = 1
		if not I_FactionBesieged hungary
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_hungary 0
	end_if

	if I_CompareCounter ai_ec_id = 22
	and I_CompareCounter freeze_aragon = 1
		if not I_FactionBesieged aragon
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_aragon 0
	end_if

	if I_CompareCounter ai_ec_id = 23
	and I_CompareCounter freeze_lithuania = 1
		if not I_FactionBesieged lithuania
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_lithuania 0
	end_if

	if I_CompareCounter ai_ec_id = 24
	and I_CompareCounter freeze_kievan_rus = 1
		if not I_FactionBesieged kievan_rus
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_kievan_rus 0
	end_if

	if I_CompareCounter ai_ec_id = 25
	and I_CompareCounter freeze_teutonic_order = 1
		if not I_FactionBesieged teutonic_order
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_teutonic_order 0
	end_if

	if I_CompareCounter ai_ec_id = 26
	and I_CompareCounter freeze_timurids = 1
		if not I_FactionBesieged timurids
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_timurids 0
	end_if

	if I_CompareCounter ai_ec_id = 27
	and I_CompareCounter freeze_norway = 1
		if not I_FactionBesieged norway
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_norway 0
	end_if

	if I_CompareCounter ai_ec_id = 28
	and I_CompareCounter freeze_jerusalem = 1
		if not I_FactionBesieged jerusalem
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_jerusalem 0
	end_if

	if I_CompareCounter ai_ec_id = 29
	and I_CompareCounter freeze_kwarezm = 1
		if not I_FactionBesieged kwarezm
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_kwarezm 0
	end_if

	if I_CompareCounter ai_ec_id = 30
	and I_CompareCounter freeze_pisa = 1
		if not I_FactionBesieged pisa
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_pisa 0
	end_if

	if I_CompareCounter ai_ec_id = 31
	and I_CompareCounter freeze_rum = 1
		if not I_FactionBesieged rum
			set_event_counter freeze_recr_pool 1
		end_if
		set_counter freeze_rum 0
	end_if

end_monitor

;--------------- Additional Mongol Scripts -----------------    
   
monitor_event EventCounter EventCounterType mongols_invasion
	and EventCounter = 2

  if I_IsFactionAIControlled turks
  and I_IsFactionAIControlled milan
  and I_NumberOfSettlements turks > 0
  and I_NumberOfSettlements milan > 0   
          console_command diplomatic_stance milan turks allied
          set_faction_standing milan turks 0.4
          set_faction_standing turks milan 0.4
  end_if

  if I_IsFactionAIControlled kievan_rus
  and I_IsFactionAIControlled cumans
  and I_NumberOfSettlements kievan_rus > 0
  and I_NumberOfSettlements cumans > 0   
          console_command diplomatic_stance kievan_rus cumans allied
          set_faction_standing cumans kievan_rus 0.4
          set_faction_standing kievan_rus cumans 0.4
  end_if
    
  terminate_monitor
end_monitor  

monitor_event GeneralCaptureSettlement FactionType mongols

  destroy_buildings mongols market true
  destroy_buildings mongols education_university true
  destroy_buildings mongols health true

end_monitor  

;================== Mongol Money Script ===================

monitor_event EventCounter EventCounterType mongols_invasion
	and EventCounter = 1 ;After 7 years
  
    set_kings_purse mongols 150000        
  terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType mongols_invasion
	and EventCounter = 2 ;After 11 years
  
    set_kings_purse mongols 200000        
  terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType mongols_invasion
	and EventCounter = 3 ;After 20 years
  
    set_kings_purse mongols 150000        
  terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType mongols_invasion
	and EventCounter = 5 ;After 56 years
  
    set_kings_purse mongols 50000        
  terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType mongols_invasion
	and EventCounter = 6 ;After 107 years
  
    set_kings_purse mongols 0        
  terminate_monitor
end_monitor

monitor_event FactionTurnEnd FactionType mongols
  and Treasury > 250000
  and IsFactionAIControlled
  
    add_money mongols 2147483647
    add_money mongols -2147483647
    add_money mongols 250000
            
end_monitor

;================== AI Reinforcements ===================
;--- Startup Reinforcement Navy (for Naval Factions)
monitor_event PreFactionTurnStart not IsFactionAIControlled

  if I_IsFactionAIControlled england
	 if I_EventCounter DifficultyLevel > 2
			spawn_army
			faction england
			character random_name, admiral, age 20, x 47, y 206
			unit	cog		exp 2 armour 0 weapon_lvl 0
	    end
	 end_if
  end_if
  
  if I_IsFactionAIControlled moors
	 if I_EventCounter DifficultyLevel > 2
			spawn_army
			faction moors
			character random_name, admiral, age 22, x 27, y 94
			unit	dhow		exp 2 armour 0 weapon_lvl 0
	    end

    end_if
	end_if
  
  terminate_monitor
end_monitor
;--- Startup Reinforcement Ground Force
monitor_event PreFactionTurnStart not IsFactionAIControlled

	if I_IsFactionAIControlled england
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction england
				character	David Plantagenet, named character, age 20, x 83, y 214, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_English 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
	end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction england
				character	David Plantagenet, named character, age 30, x 76, y 189, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_English 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Fyrd Spearmen		exp 1 armour 0 weapon_lvl 0
				unit	Fyrd Spearmen		exp 0 armour 0 weapon_lvl 0				
			end
		end_if
	end_if

	if I_IsFactionAIControlled france
		if I_EventCounter DifficultyLevel <= 2
			spawn_army 
			faction france
			character	Amaury Capet, named character, age 20, x 92, y 200, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_French 1 , BiologicalSon 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction france
				character	Amaury Capet, named character, age 30, x 97, y 185, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_French 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Spear Militia		exp 1 armour 0 weapon_lvl 0
				unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled hre
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction hre
				character	Arnoldt von_Hohenstaufen, named character, age 20, x 144, y 204, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_HRE 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction hre
				character	Arnoldt von_Hohenstaufen, named character, age 30, x 124, y 212, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_HRE 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Sergeant Spearmen		exp 0 armour 0 weapon_lvl 0
				unit	Crossbow Militia	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled spain
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction spain
				character	Enrique de_Castilla, named character, age 20, x 46, y 150, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Spanish 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction spain
				character	Enrique de_Castilla, named character, age 30, x 47, y 136, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Spanish 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Spear Militia		exp 1 armour 0 weapon_lvl 0
				unit	Peasant Archers		exp 1 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled teutonic_order
		if I_EventCounter DifficultyLevel <= 2
			spawn_army 
				faction teutonic_order
				character	Belos, named character, age 20, x 221, y 157, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Serbian 1 , BiologicalSon 1
				unit	EE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction teutonic_order
				character	Belos, named character, age 30, x 221, y 157, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Serbian 1 , BiologicalSon 1
				unit	EE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Slav Levies		exp 1 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled venice
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction venice
				character	Barbus Selvo, named character, age 20, x 165, y 175, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Venetian 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction venice
				character	Barbus Selvo, named character, age 30, x 165, y 175, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Venetian 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 1 armour 1 weapon_lvl 0
			unit	Urban Spear Militia	exp 0 armour 0 weapon_lvl 0
			unit	Urban Crossbow Militia	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled sicily
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction sicily
				character	Ettore d_Altavilla, named character, age 20, x 170, y 119, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Sicilian 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction sicily
				character	Ettore d_Altavilla, named character, age 30, x 196, y 138, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Sicilian 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 1 armour 1 weapon_lvl 0
			unit	Urban Spear Militia	exp 0 armour 0 weapon_lvl 0
			unit	Urban Crossbow Militia	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled milan
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction milan
				character	random_name, named character, age 20, x 404, y 82, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Milanese 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction milan
				character	random_name, named character, age 30, x 412, y 77, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 3 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Milanese 1 , BiologicalSon 1
				unit		ME Bodyguard				exp 2 armour 0 weapon_lvl 0
        unit		Dismounted Fari Lancers				exp 0 armour 0 weapon_lvl 0
        unit		Dismounted Fari Lancers				exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled pisa
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction pisa
				character	Evio Visconti, named character, age 20, x 155, y 157, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Pisan 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction pisa
				character	Evio Visconti, named character, age 30, x 155, y 157, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 3 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Pisan 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 1 armour 1 weapon_lvl 0
			unit	Urban Spear Militia	exp 1 armour 0 weapon_lvl 0
			unit	Urban Spear Militia	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled scotland
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction scotland
				character	Comgell mac_Donnchada, named character, age 20, x 64, y 244, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Scottish 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction scotland
				character	Comgell mac_Donnchada, named character, age 30, x 55, y 252, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 3 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Scottish 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Spear Militia		exp 1 armour 0 weapon_lvl 0
				unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
				unit	Spear Militia		exp 1 armour 0 weapon_lvl 0
				unit	Highlanders		exp 0 armour 0 weapon_lvl 0
				unit	Scots Skirmisher		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled cumans
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction cumans
				character	Balamir of_the_Oghuz, named character, age 20, x 252, y 165, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Cumans 1 , BiologicalSon 1
				unit	Cuman Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction cumans
				character	Balamir of_the_Oghuz, named character, age 30, x 374, y 185, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Cumans 1 , BiologicalSon 1
				unit	Cuman Bodyguard		exp 2 armour 1 weapon_lvl 0
				unit	Cuman Horse Militia	exp 1 armour 0 weapon_lvl 0
				unit	Kasogi Senior Militia	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled byzantium
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction byzantium
				character	Areovindos Komnenos, named character, age 20, x 279, y 144, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Greek 1 , BiologicalSon 1
				unit	Greek Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction byzantium
				character	Areovindos Komnenos, named character, age 30, x 279, y 144, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 3 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Greek 1 , BiologicalSon 1
				unit	Greek Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Contaratoi		exp 0 armour 0 weapon_lvl 0
				unit	Contaratoi	exp 1 armour 0 weapon_lvl 0
				unit	Contaratoi	exp 0 armour 0 weapon_lvl 0
				unit	Mourtatoi	exp 1 armour 0 weapon_lvl 0
				unit	Toxotae		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled russia
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction russia
				character	Domazhir Novgorodskii, named character, age 20, x 301, y 253, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Russian 1 , BiologicalSon 1
				unit	EE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction russia
				character	Domazhir Novgorodskii, named character, age 30, x 300, y 262, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Russian 1 , BiologicalSon 1
				unit	EE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Junior Militia	exp 0 armour 0 weapon_lvl 0
				unit	Junior Militia	exp 0 armour 0 weapon_lvl 0
				unit	Junior Militia	exp 1 armour 0 weapon_lvl 0
				unit	Woodsmen	exp 1 armour 0 weapon_lvl 0
				unit	Woodsmen	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled poland
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction poland
				character	Dobromir Piast, named character, age 20, x 226, y 210, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Polish 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction poland
				character	Dobromir Piast, named character, age 30, x 209, y 231, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 3 , ReligionStarter 1 , Royal_Blood_Polish 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	EE Spear Militia	exp 0 armour 0 weapon_lvl 0
        unit	EE Spear Militia	exp 0 armour 0 weapon_lvl 0
				unit	Woodsmen	exp 0 armour 0 weapon_lvl 0
        unit	Woodsmen	exp 0 armour 0 weapon_lvl 0
				unit	Woodsmen	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled moors
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction moors
				character	Ayyub al_Andalusi, named character, age 20, x 18, y 80, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Moorish 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction moors
				character	Ayyub al_Andalusi, named character, age 30, x 18, y 80, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 3 , ReligionStarter 1 , Royal_Blood_Moorish 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Ahdath Militia	exp 0 armour 0 weapon_lvl 0
				unit	Ahdath Militia		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled turks
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction turks
				character	Bahadir Celaluddevle, named character, age 20, x 453, y 78, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Turkish 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction turks
				character	Bahadir Celaluddevle, named character, age 30, x 460, y 92, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Turkish 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Ahdath Militia	exp 0 armour 0 weapon_lvl 0
        unit	Ahdath Militia	exp 0 armour 0 weapon_lvl 0
				unit	Turkish Archers		exp 0 armour 0 weapon_lvl 0
				unit	Turkish Archers		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled rum
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction rum
				character	Beyhan Arslan, named character, age 20, x 314, y 120, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Rum_Turkish 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction rum
				character	Beyhan Arslan, named character, age 30, x 307, y 123, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Rum_Turkish 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Ahdath Militia	exp 0 armour 0 weapon_lvl 0
				unit	Turkish Archers		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled egypt
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction egypt
				character	Abdul-Malik al-Fatimiyyun, named character, age 20, x 309, y 60, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Egyptian 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction egypt
				character	Abdul-Malik al-Fatimiyyun, named character, age 30, x 306, y 61, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Egyptian 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Ahdath Militia	exp 0 armour 0 weapon_lvl 0
        unit	Ahdath Militia	exp 0 armour 0 weapon_lvl 0
				unit	African Archers		exp 0 armour 0 weapon_lvl 0
				unit	African Archers		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled denmark
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction denmark
				character	Birger Svendsen, named character, age 20, x 174, y 246, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Danish 1 , BiologicalSon 1
				unit	Royal Hirdsmen		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction denmark
				character	Birger Svendsen, named character, age 30, x 159, y 240, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Danish 1 , BiologicalSon 1
        unit	Royal Hirdsmen		exp 2 armour 0 weapon_lvl 0                        
				unit	Viking Raiders		exp 1 armour 0 weapon_lvl 0
				unit	Norse Archers		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled portugal
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction portugal
				character	Claudio de_Portugal, named character, age 20, x 17, y 135, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Portuguese 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction portugal
				character	Claudio de_Portugal, named character, age 30, x 15, y 133, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Portuguese 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
        unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
        unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
				unit	Crossbow Militia	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled hungary
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction hungary
				character	Bod Arpadhazi, named character, age 20, x 212, y 177, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Hungarian 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction hungary
				character	Bod Arpadhazi, named character, age 30, x 215, y 185, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Hungarian 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Magyar Cavalry		exp 1 armour 0 weapon_lvl 0
				unit	EE Spear Militia	exp 0 armour 0 weapon_lvl 0
				unit	EE Spear Militia	exp 0 armour 0 weapon_lvl 0
				unit	EE Spear Militia	exp 0 armour 0 weapon_lvl 0
				unit	Vlach Archers	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled jerusalem
		if I_EventCounter DifficultyLevel <= 2
			spawn_army 
				faction jerusalem
				character	Colin de_Boulogne, named character, age 20, x 329, y 72, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Jerusalem 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army 
				faction jerusalem
				character	Colin de_Boulogne, named character, age 30, x 329, y 72, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Jerusalem 1 , BiologicalSon 1
				unit	NE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Mounted Sergeants	exp 1 armour 0 weapon_lvl 0
				unit	Sergeant Spearmen	exp 0 armour 0 weapon_lvl 0
				unit	Sergeant Spearmen	exp 1 armour 0 weapon_lvl 0
				unit	Sergeant Spearmen	exp 0 armour 0 weapon_lvl 0
				unit	Sergeant Spearmen	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled lithuania
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction lithuania
				character	Kestutis, named character, age 20, x 243, y 243, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Lithuanian 1 , BiologicalSon 1
				unit	Lith Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction lithuania
				character	Kestutis, named character, age 30, x 243, y 243, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Lithuanian 1 , BiologicalSon 1
				unit	Lith Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Baltic Spearmen		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled kievan_rus
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction kievan_rus
				character	Dobroslav Yaroslavich, named character, age 20, x 294, y 207, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kievan 1 , BiologicalSon 1
				unit	EE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction kievan_rus
				character	Dobroslav Yaroslavich, named character, age 30, x 272, y 209, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kievan 1 , BiologicalSon 1
				unit	EE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Junior Militia	exp 0 armour 0 weapon_lvl 0
				unit	Junior Militia	exp 1 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled aragon
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction aragon
				character	Alvar Ramirez, named character, age 20, x 85, y 142, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Aragonese 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction aragon
				character	Alvar Ramirez, named character, age 30, x 68, y 142, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Aragonese 1 , BiologicalSon 1
				unit	SE Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
				unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
				unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
				unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
				unit	Peasant Archers		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled norway
		if I_EventCounter DifficultyLevel <= 2	;updated by Lifthrasir May 2013
			spawn_army
				faction norway
				character	Erik Haakonsson, named character, age 20, x 114, y 280, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Norwegian 1 , BiologicalSon 1
				unit	Royal Hirdsmen		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3	;updated by Lifthrasir May 2013
			spawn_army
				faction norway
				character	Erik Haakonsson, named character, age 30, x 114, y 280, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Norwegian 1 , BiologicalSon 1
				unit	Royal Hirdsmen		exp 1 armour 1 weapon_lvl 0
				unit	Viking Raiders		exp 1 armour 0 weapon_lvl 0
				unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if

	if I_IsFactionAIControlled kwarezm
		if I_EventCounter DifficultyLevel <= 2
			spawn_army
				faction kwarezm
				character	Batu Mohammed, named character, age 20, x 399, y 103, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kwarezm 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
			end
		end_if

		if I_EventCounter DifficultyLevel >= 3
			spawn_army
				faction kwarezm
				character	Batu Mohammed, named character, age 30, x 357, y 107, family
				traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Kwarezm 1 , BiologicalSon 1
				unit	ME Bodyguard		exp 1 armour 1 weapon_lvl 0
				unit	Turkomans		exp 1 armour 0 weapon_lvl 0
				unit	Ahdath Militia	exp 0 armour 0 weapon_lvl 0
				unit	Ahdath Militia	exp 1 armour 0 weapon_lvl 0
				unit	Afghan Javelinmen	exp 1 armour 0 weapon_lvl 0
				unit	Daylami Light Infantry	exp 0 armour 0 weapon_lvl 0
			end
		end_if
	end_if
	terminate_monitor
end_monitor



;-------------- AI SHIP SUPPORT ---------------------

set_event_counter SupportCounter 0

monitor_event FactionTurnEnd FactionType slave

  inc_event_counter SupportCounter 1
  
  if I_EventCounter SupportCounter  > 75
			set_event_counter SupportCounter 0
		end_if

  if I_IsFactionAIControlled england
  and I_NumberOfSettlements england > 0
  and I_EventCounter SupportCounter = 5
			spawn_army
			faction england
			character random_name, admiral, age 20, x 94, y 239
			unit	cog		exp 2 armour 0 weapon_lvl 0
      unit	cog		exp 2 armour 0 weapon_lvl 0
      unit	cog		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled france
  and I_NumberOfSettlements france > 0
  and I_EventCounter SupportCounter = 10
			spawn_army
			faction france
			character random_name, admiral, age 20, x 112, y 245
			unit	cog		exp 2 armour 0 weapon_lvl 0
      unit	cog		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled scotland
  and I_NumberOfSettlements scotland > 0
  and I_EventCounter SupportCounter = 15
			spawn_army
			faction scotland
			character random_name, admiral, age 20, x 76, y 270
			unit	cog		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled norway
  and I_NumberOfSettlements norway > 0
  and I_EventCounter SupportCounter = 20
			spawn_army
			faction norway
			character random_name, admiral, age 20, x 85, y 282
			unit	longboat		exp 2 armour 0 weapon_lvl 0
      unit	longboat		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled denmark
  and I_NumberOfSettlements denmark > 0
  and I_EventCounter SupportCounter = 25
			spawn_army
			faction denmark
			character random_name, admiral, age 20, x 199, y 246
			unit	longboat		exp 2 armour 0 weapon_lvl 0
      unit	longboat		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled portugal
  and I_NumberOfSettlements portugal > 0
  and I_EventCounter SupportCounter = 30
			spawn_army
			faction portugal
			character random_name, admiral, age 20, x 2, y 137
			unit	cog		exp 2 armour 0 weapon_lvl 0
      unit	cog		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled spain
  and I_NumberOfSettlements spain > 0
  and I_EventCounter SupportCounter = 35
			spawn_army
			faction spain
			character random_name, admiral, age 20, x 28, y 175
			unit	cog		exp 2 armour 0 weapon_lvl 0
      unit	cog		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled aragon
  and I_NumberOfSettlements aragon > 0
  and I_EventCounter SupportCounter = 40
			spawn_army
			faction aragon
			character random_name, admiral, age 20, x 117, y 140
			unit	cog		exp 2 armour 0 weapon_lvl 0
      unit	cog		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled russia
  and I_NumberOfSettlements russia > 0
  and I_EventCounter SupportCounter = 45
			spawn_army
			faction russia
			character random_name, admiral, age 20, x 219, y 284
			unit	ladya		exp 2 armour 0 weapon_lvl 0
      unit	ladya		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled venice
  and I_NumberOfSettlements venice > 0
  and I_EventCounter SupportCounter = 50
			spawn_army
			faction venice
			character random_name, admiral, age 20, x 187, y 155
			unit	galley		exp 2 armour 0 weapon_lvl 0
      unit	galley		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled sicily
  and I_NumberOfSettlements sicily > 0
  and I_EventCounter SupportCounter = 55
			spawn_army
			faction sicily
			character random_name, admiral, age 20, x 159, y 130
			unit	galley		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled pisa
  and I_NumberOfSettlements pisa > 0
  and I_EventCounter SupportCounter = 60
			spawn_army
			faction pisa
			character random_name, admiral, age 20, x 132, y 149
			unit	galley		exp 2 armour 0 weapon_lvl 0
      unit	galley		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled byzantium
  and I_NumberOfSettlements byzantium > 0
  and I_EventCounter SupportCounter = 65
			spawn_army
			faction byzantium
			character random_name, admiral, age 20, x 256, y 106
			unit	dromon		exp 2 armour 0 weapon_lvl 0
      unit	dromon		exp 2 armour 0 weapon_lvl 0
      unit	dromon		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled egypt
  and I_NumberOfSettlements egypt > 0
  and I_EventCounter SupportCounter = 70
			spawn_army
			faction egypt
			character random_name, admiral, age 20, x 310, y 81
			unit	dhow		exp 2 armour 0 weapon_lvl 0
      unit	dhow		exp 2 armour 0 weapon_lvl 0
      unit	dhow		exp 2 armour 0 weapon_lvl 0
	    end
  end_if
  
  if I_IsFactionAIControlled moors
  and I_NumberOfSettlements moors > 0
  and I_EventCounter SupportCounter = 75
			spawn_army
			faction moors
			character random_name, admiral, age 20, x 6, y 92
			unit	dhow		exp 2 armour 0 weapon_lvl 0
      unit	dhow		exp 2 armour 0 weapon_lvl 0
      unit	dhow		exp 2 armour 0 weapon_lvl 0
	    end
  end_if

end_monitor






;============== Scripted Early Sieges ===============

monitor_event FactionTurnStart FactionType teutonic_order
	and I_TurnNumber = 1

	if I_IsFactionAIControlled teutonic_order
		spawn_army
			faction teutonic_order
			character	Gojko Petrovic, named character, age 30, x 217, y 148, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
      unit		EE Bodyguard 		exp 2 armour 0 weapon_lvl 0
      unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0
      unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0
      unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0
      unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0
      unit		Dismounted Vlastelcici 		exp 1 armour 0 weapon_lvl 0
      unit		Dismounted Vlastelcici 		exp 1 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType teutonic_order
	and IsFactionAIControlled
	and I_CharacterExists Gojko Petrovic

	if not I_SettlementOwner Skadar = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Skadar
	and I_TurnNumber = 1 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile teutonic_order, named_character, 0, 217, 148 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 2
	console_command auto_win attacker
		siege_settlement Gojko Petrovic, Skadar, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 1
		siege_settlement Gojko Petrovic, Skadar, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType spain
	and I_TurnNumber = 1

	if I_IsFactionAIControlled spain
		spawn_army
			faction spain
			character	Pedro Bragado, named character, age 30, x 28, y 127, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
      unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
      unit		Jinetes					exp 2 armour 0 weapon_lvl 0
      unit		Jinetes					exp 2 armour 0 weapon_lvl 0
      unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
      unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Javelinmen				exp 0 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType spain
	and IsFactionAIControlled
	and I_CharacterExists Pedro Bragado

	if not I_SettlementOwner Badajoz = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Badajoz
	and I_TurnNumber = 1 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile spain, named_character, 1, 28, 126 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 2
	console_command auto_win attacker
		siege_settlement Pedro Bragado, Badajoz, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 1
		siege_settlement Pedro Bragado, Badajoz, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType lithuania
	and I_TurnNumber = 2

	if I_IsFactionAIControlled lithuania
		spawn_army
			faction lithuania
			character	Margiris of_Hrodna, named character, age 30, x 250, y 254, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
      unit		Lith Bodyguard				exp 1 armour 0 weapon_lvl 0
      unit		Lithuanian Axemen				exp 0 armour 0 weapon_lvl 0
      unit		Lithuanian Axemen				exp 0 armour 0 weapon_lvl 0
      unit		Lithuanian Axemen				exp 0 armour 0 weapon_lvl 0
      unit		Baltic Spearmen				exp 0 armour 0 weapon_lvl 0 
      unit		Baltic Spearmen				exp 0 armour 0 weapon_lvl 0 
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType lithuania
	and IsFactionAIControlled
	and I_CharacterExists Margiris of_Hrodna

	if not I_SettlementOwner Riga = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Riga
	and I_TurnNumber = 2 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile lithuania, named_character, 1, 250, 255 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 2
	console_command auto_win attacker
		siege_settlement Margiris of_Hrodna, Riga, attack
		terminate_monitor
	end_if
end_monitor


monitor_event FactionTurnStart FactionType denmark
	and I_TurnNumber = 3

	if I_IsFactionAIControlled denmark
		spawn_army
			faction denmark
			character	Toke Arneborg, named character, age 30, x 142, y 245, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
			unit		Royal Hirdsmen				exp 1 armour 0 weapon_lvl 0   
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
      unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
      unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
      unit		Norse Archers				exp 1 armour 0 weapon_lvl 0
      unit		Norse Archers				exp 1 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType denmark
	and IsFactionAIControlled
	and I_CharacterExists Toke Arneborg

	if not I_SettlementOwner Ribe = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Ribe
	and I_TurnNumber = 3 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile denmark, named_character, 0, 142, 245 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 4
	console_command auto_win attacker
		siege_settlement Toke Arneborg, Ribe, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 3
		siege_settlement Toke Arneborg, Ribe, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType pisa
	and I_TurnNumber = 2

	if I_IsFactionAIControlled pisa
		spawn_army
			faction pisa
			character	Matteo Gariboldi, named character, age 30, x 142, y 130, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
      unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
			unit		Italian Cavalry Militia			exp 0 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType pisa
	and IsFactionAIControlled
	and I_CharacterExists Matteo Gariboldi

	if not I_SettlementOwner Ragusa = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Cagliari
	and I_TurnNumber = 2 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile pisa, named_character, 1, 142, 129 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 3
	console_command auto_win attacker
		siege_settlement Matteo Gariboldi, Cagliari, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 2
		siege_settlement Matteo Gariboldi, Cagliari, maintain
	end_if  
end_monitor

monitor_event FactionTurnStart FactionType kwarezm
	and I_TurnNumber = 6

	if I_IsFactionAIControlled kwarezm   
		spawn_army
			faction kwarezm
			character	Bekir el_Aziz, named character, age 30, x 343, y 90, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
      unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
      unit		Fari Horse Archers				exp 1 armour 0 weapon_lvl 0
      unit		Fari Horse Archers				exp 1 armour 0 weapon_lvl 0
      unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
      unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
      unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
      unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
      unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
      unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
		end    
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType kwarezm
	and IsFactionAIControlled
	and I_CharacterExists Bekir el_Aziz 

	if not I_SettlementOwner Damascus = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Damascus
	and I_TurnNumber = 6 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile kwarezm, named_character, 2, 343, 90 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if     

	if I_TurnNumber = 7
	console_command auto_win attacker
		siege_settlement Bekir el_Aziz, Damascus, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 6
		siege_settlement Bekir el_Aziz, Damascus, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType sicily
	and I_TurnNumber = 3

	if I_IsFactionAIControlled sicily
		spawn_army
			faction sicily
			character	Matteo Vallano, named character, age 30, x 182, y 140, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Sicilian 1 , BiologicalSon 1
			unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0      
      unit		Mounted Sergeants			exp 1 armour 0 weapon_lvl 0
      unit		Dismounted Norman Knights		exp 1 armour 0 weapon_lvl 0
      unit		Dismounted Norman Knights		exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0    
      unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType sicily
	and IsFactionAIControlled
	and I_CharacterExists Matteo Vallano

	if not I_SettlementOwner Naples = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Naples
	and I_TurnNumber = 3 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile sicily, named_character, 1, 182, 139 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 4
	console_command auto_win attacker
		siege_settlement Matteo Vallano, Naples, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 3
		siege_settlement Matteo Vallano, Naples, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType norway
	and I_TurnNumber = 3

	if I_IsFactionAIControlled norway
		spawn_army
			faction norway
			character	Gunnar Guddrodson, named character, age 30, x 175, y 266, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 1 , GoodCommander 2 , ReligionStarter 1
      unit		Royal Hirdsmen				exp 1 armour 0 weapon_lvl 0
      unit		Drengjar				exp 0 armour 0 weapon_lvl 0
      unit		Drengjar				exp 0 armour 0 weapon_lvl 0
      unit		Drengjar				exp 0 armour 0 weapon_lvl 0
      unit		Drengjar				exp 0 armour 0 weapon_lvl 0
      unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
      unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
      unit	Spear Militia		exp 0 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType norway
	and IsFactionAIControlled
	and I_CharacterExists Gunnar Guddrodson

	if not I_SettlementOwner Skara = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Skara
	and I_TurnNumber = 3 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile norway, named_character, 0, 175, 266 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 4
	console_command auto_win attacker
		siege_settlement Gunnar Guddrodson, Skara, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 3
		siege_settlement Gunnar Guddrodson, Skara, maintain
	end_if  
end_monitor 


monitor_event FactionTurnStart FactionType cumans
	and I_TurnNumber = 3

	if I_IsFactionAIControlled cumans
		spawn_army
			faction cumans
			character	Ilteris of_the_Oghuz, named character, age 30, x 424, y 177, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 1 , GoodCommander 2 , ReligionStarter 1
      unit		Cuman Bodyguard				exp 2 armour 0 weapon_lvl 0
      unit		Behk Druzhina			exp 1 armour 0 weapon_lvl 0
      unit		Behk Druzhina			exp 1 armour 0 weapon_lvl 0
      unit		Cuman Horse Militia		exp 1 armour 0 weapon_lvl 0
      unit		Cuman Horse Militia		exp 1 armour 0 weapon_lvl 0
      unit		Steppe Alans		exp 1 armour 0 weapon_lvl 0
      unit		Dismounted Cuman Militia					exp 0 armour 0 weapon_lvl 0
      unit		Dismounted Cuman Militia					exp 0 armour 0 weapon_lvl 0
      unit		Dismounted Cuman Militia					exp 0 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType cumans
	and IsFactionAIControlled
	and I_CharacterExists Ilteris of_the_Oghuz

	if not I_SettlementOwner Saqsin = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Saqsin
	and I_TurnNumber = 3 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile cumans, named_character, 0, 424, 177 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 4
	console_command auto_win attacker
		siege_settlement Ilteris of_the_Oghuz, Saqsin, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 3
		siege_settlement Ilteris of_the_Oghuz, Saqsin, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType venice
	and I_TurnNumber = 3

	if I_IsFactionAIControlled venice
		spawn_army
			faction venice
			character	Tusco Zorzi, named character, age 30, x 158, y 172, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
      unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
			unit		Italian Cavalry Militia			exp 0 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
      unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType venice
	and IsFactionAIControlled
	and I_CharacterExists Tusco Zorzi

	if not I_SettlementOwner Verona = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Verona
	and I_TurnNumber = 3 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile venice, named_character, 0, 158, 172 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 4
	console_command auto_win attacker
		siege_settlement Tusco Zorzi, Verona, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 3
		siege_settlement Tusco Zorzi, Verona, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType timurids
	and I_TurnNumber = 3

	if I_IsFactionAIControlled timurids
		spawn_army
			faction timurids
			character	Guaram Mikeladze, named character, age 30, x 392, y 136, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
      unit	bodyguard georgia		exp 1 armour 0 weapon_lvl 0
      unit	georgian heavy lancers	exp 1 armour 0 weapon_lvl 0
			unit	georgian medium swordsmen	exp 2 armour 0 weapon_lvl 0
      unit	georgian medium swordsmen	exp 2 armour 0 weapon_lvl 0
      unit	georgian light spearmen	exp 2 armour 0 weapon_lvl 0   
      unit	georgian light spearmen	exp 1 armour 0 weapon_lvl 0
      unit	georgian light spearmen	exp 1 armour 0 weapon_lvl 0
      unit	georgian light spearmen	exp 1 armour 0 weapon_lvl 0
      unit	georgian light spearmen	exp 1 armour 0 weapon_lvl 0
      unit	aor trasc javelin	exp 1 armour 0 weapon_lvl 0
      unit	aor trasc javelin	exp 1 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType timurids
	and IsFactionAIControlled
	and I_CharacterExists Guaram Mikeladze

	if not I_SettlementOwner Ani = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Ani
	and I_TurnNumber = 3 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile timurids, named_character, 0, 392, 136 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 4
	console_command auto_win attacker
		siege_settlement Guaram Mikeladze, Ani, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 3
		siege_settlement Guaram Mikeladze, Ani, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType milan
	and I_TurnNumber = 3

	if I_IsFactionAIControlled milan
		spawn_army
			faction milan
			character	Abdun al-Hassan, named character, age 30, x 435, y 30, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1
        unit		ME Bodyguard				exp 2 armour 0 weapon_lvl 0
        unit		Ghulams				exp 1 armour 0 weapon_lvl 0
        unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
        unit		Dismounted Fari Lancers				exp 0 armour 0 weapon_lvl 0
        unit		Dismounted Fari Lancers				exp 0 armour 0 weapon_lvl 0 
        unit		Dismounted Fari Lancers				exp 0 armour 0 weapon_lvl 0
        unit		Dismounted Fari Lancers				exp 0 armour 0 weapon_lvl 0        
        unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
        unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
        unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
        unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0        
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType milan
	and IsFactionAIControlled
	and I_CharacterExists Abdun al-Hassan

	if not I_SettlementOwner Al_Ahsa = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Al_Ahsa
	and I_TurnNumber = 3 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile milan, named_character, 1, 435, 29 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 4
	console_command auto_win attacker
		siege_settlement Abdun al-Hassan, Al_Ahsa, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 3
		siege_settlement Abdun al-Hassan, Al_Ahsa, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType france
	and I_TurnNumber = 4

	if I_IsFactionAIControlled france
		spawn_army
			faction france
			character	Aubert Tristan, named character, age 30, x 114, y 186, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_French 1 , BiologicalSon 1
      unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
      unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Sergeant Spearmen			exp 1 armour 0 weapon_lvl 0
      unit		Sergeant Spearmen			exp 1 armour 0 weapon_lvl 0
      unit		Sergeant Spearmen			exp 1 armour 0 weapon_lvl 0
      unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
      unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType france
	and IsFactionAIControlled
	and I_CharacterExists Aubert Tristan

	if not I_SettlementOwner Dijon = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Dijon
	and I_TurnNumber = 4 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile france, named_character, 1, 114, 186 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 5
	console_command auto_win attacker
		siege_settlement Aubert Tristan, Dijon, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 4
		siege_settlement Aubert Tristan, Dijon, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType england
	and I_TurnNumber = 4

	if I_IsFactionAIControlled england
		spawn_army
			faction england
			character	Giles Blacke, named character, age 30, x 80, y 181, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_English 1 , BiologicalSon 1
      unit		NE Bodyguard				exp 2 armour 0 weapon_lvl 0
      unit		Dismounted Norman Cavalry				exp 2 armour 0 weapon_lvl 0
      unit		Dismounted Norman Cavalry				exp 2 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
      unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType england
	and IsFactionAIControlled
	and I_CharacterExists Giles Blacke

	if not I_SettlementOwner Poitiers = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Poitiers
	and I_TurnNumber = 4 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile england, named_character, 1, 80, 180 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 5
	console_command auto_win attacker
		siege_settlement Giles Blacke, Poitiers, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 4
		siege_settlement Giles Blacke, Poitiers, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType rum
	and I_TurnNumber = 4

	if I_IsFactionAIControlled rum
		spawn_army
			faction rum
			character	Mes_ud Muzaffer, named character, age 30, x 334, y 124, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_Rum_Turkish 1 , BiologicalSon 1
      unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
			unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
      unit		Turkomans				exp 1 armour 0 weapon_lvl 0
      unit		Turkomans				exp 1 armour 0 weapon_lvl 0
      unit		Turkomans				exp 1 armour 0 weapon_lvl 0
      unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
      unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
      unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
      unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
      unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType rum
	and IsFactionAIControlled
	and I_CharacterExists Mes_ud Muzaffer

	if not I_SettlementOwner Caesarea = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Caesarea
	and I_TurnNumber = 4 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile rum, named_character, 0, 334, 124 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 5
	console_command auto_win attacker
		siege_settlement Mes_ud Muzaffer, Caesarea, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 4
		siege_settlement Mes_ud Muzaffer, Caesarea, maintain
	end_if  
end_monitor


monitor_event FactionTurnStart FactionType hre
	and I_TurnNumber = 6

	if I_IsFactionAIControlled hre
		spawn_army
			faction hre
			character	Casper von_Karnten, named character, age 30, x 145, y 175, family
			traits LoyaltyStarter 1 , MilitaryInclination 1 , Military_Edu 2 , GoodCommander 2 , ReligionStarter 1 , Royal_Blood_HRE 1 , BiologicalSon 1
      unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
      unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
      unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
      unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
      unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
      unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      unit		Sergeant Spearmen			exp 1 armour 0 weapon_lvl 0
      unit		Sergeant Spearmen			exp 1 armour 0 weapon_lvl 0
      unit		Sergeant Spearmen			exp 1 armour 0 weapon_lvl 0
      unit		Sergeant Spearmen			exp 1 armour 0 weapon_lvl 0
      unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
      unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
      unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
		end
	end_if
	
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType hre
	and IsFactionAIControlled
	and I_CharacterExists Casper von_Karnten

	if not I_SettlementOwner Milan = slave
		terminate_monitor
	end_if

	if I_SettlementUnderSiege Milan
	and I_TurnNumber = 6 ;if settlement under siege already, avoid ctd.
		terminate_monitor
	end_if

	if not I_CharacterTypeNearTile hre, named_character, 1, 145, 175 ;if character not standing where it should, avoid ctd
		terminate_monitor
	end_if

	if I_TurnNumber = 7
	console_command auto_win attacker
		siege_settlement Casper von_Karnten, Milan, attack
		terminate_monitor
	end_if

  if I_TurnNumber = 6
		siege_settlement Casper von_Karnten, Milan, maintain
	end_if  
end_monitor


;--- No Heir Reinforcement
declare_counter heir_venice
set_counter heir_venice 0
declare_counter heir_sicily
set_counter heir_sicily 0
declare_counter heir_milan
set_counter heir_milan 0
declare_counter heir_pisa
set_counter heir_pisa 0
declare_counter heir_papal_states
set_counter heir_papal_states 0
declare_counter heir_denmark
set_counter heir_denmark 0
declare_counter heir_egypt
set_counter heir_egypt 0
declare_counter heir_scotland
set_counter heir_scotland 0
declare_counter heir_cumans
set_counter heir_cumans 0
declare_counter heir_mongols
set_counter heir_mongols 0
declare_counter heir_turks
set_counter heir_turks 0
declare_counter heir_rum
set_counter heir_rum 0
declare_counter heir_france
set_counter heir_france 0
declare_counter heir_hre
set_counter heir_hre 0
declare_counter heir_england
set_counter heir_england 0
declare_counter heir_portugal
set_counter heir_portugal 0
declare_counter heir_poland
set_counter heir_poland 0
declare_counter heir_byzantium
set_counter heir_byzantium 0
declare_counter heir_moors
set_counter heir_moors 0
declare_counter heir_russia
set_counter heir_russia 0
declare_counter heir_spain
set_counter heir_spain 0
declare_counter heir_hungary
set_counter heir_hungary 0
declare_counter heir_aragon
set_counter heir_aragon 0
declare_counter heir_lithuania
set_counter heir_lithuania 0
declare_counter heir_kievan_rus
set_counter heir_kievan_rus 0
declare_counter heir_teutonic_order
set_counter heir_teutonic_order 0
declare_counter heir_timurids
set_counter heir_timurids 0
declare_counter heir_norway
set_counter heir_norway 0
declare_counter heir_jerusalem
set_counter heir_jerusalem 0
declare_counter heir_kwarezm
set_counter heir_kwarezm 0
declare_counter heir_reset
set_counter heir_reset 0

monitor_event FactionTurnStart FactionType slave

  inc_counter heir_reset 1
  
  if I_CompareCounter heir_reset > 39
    set_counter heir_venice 0
    set_counter heir_sicily 0
    set_counter heir_milan 0
    set_counter heir_pisa 0
    set_counter heir_papal_states 0
    set_counter heir_denmark 0
    set_counter heir_egypt 0
    set_counter heir_scotland 0
    set_counter heir_cumans 0
    set_counter heir_mongols 0
    set_counter heir_turks 0
    set_counter heir_rum 0
    set_counter heir_france 0
    set_counter heir_hre 0
    set_counter heir_england 0
    set_counter heir_portugal 0
    set_counter heir_poland 0
    set_counter heir_byzantium 0
    set_counter heir_moors 0
    set_counter heir_russia 0
    set_counter heir_spain 0
    set_counter heir_hungary 0
    set_counter heir_aragon 0
    set_counter heir_lithuania 0
    set_counter heir_kievan_rus 0
    set_counter heir_teutonic_order 0
    set_counter heir_timurids 0
    set_counter heir_norway 0
    set_counter heir_jerusalem 0
    set_counter heir_kwarezm 0
    inc_counter heir_reset 0
  end_if
    
	if I_IsFactionAIControlled england
	and I_NumberOfHeirs england < 4
	and I_CompareCounter heir_england < 2
  and I_NumberOfSettlements england > 0
		spawn_army
			faction england
			character	random_name, named character, age 20, x 68, y 215, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_england 1
	end_if

	if I_IsFactionAIControlled scotland
	and I_NumberOfHeirs scotland < 4
	and I_CompareCounter heir_scotland < 2
  and I_NumberOfSettlements scotland > 0
		spawn_army
			faction scotland
			character	random_name, named character, age 20, x 44, y 248, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_scotland 1
	end_if

	if I_IsFactionAIControlled denmark
	and I_NumberOfHeirs denmark < 4
	and I_CompareCounter heir_denmark < 2
  and I_NumberOfSettlements denmark > 0
		spawn_army
			faction denmark
			character	random_name, named character, age 20, x 176, y 248, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_denmark 1
	end_if

	if I_IsFactionAIControlled norway	;updated by Lifthrasir May 2013
	and I_NumberOfHeirs norway < 4
	and I_CompareCounter heir_norway < 2
  and I_NumberOfSettlements norway > 0
		spawn_army
			faction norway
			character	random_name, named character, age 20, x 139, y 276, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Royal Hirdsmen		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_norway 1
	end_if

	if I_IsFactionAIControlled france
	and I_NumberOfHeirs france < 4
	and I_CompareCounter heir_france < 2
  and I_NumberOfSettlements france > 0
		spawn_army
			faction france
			character	random_name, named character, age 20, x 95, y 191, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_france 1
	end_if

	if I_IsFactionAIControlled hre
	and I_NumberOfHeirs hre < 4
	and I_CompareCounter heir_hre < 2
  and I_NumberOfSettlements hre > 0
		spawn_army
			faction hre
			character	random_name, named character, age 20, x 144, y 208, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_hre 1
	end_if

	if I_IsFactionAIControlled milan
	and I_NumberOfHeirs milan < 4
	and I_CompareCounter heir_milan < 2
  and I_NumberOfSettlements milan > 0
		spawn_army
			faction milan
			character	random_name, named character, age 20, x 405, y 62, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_milan 1
	end_if

	if I_IsFactionAIControlled pisa
	and I_NumberOfHeirs pisa < 4
	and I_CompareCounter heir_pisa < 2
  and I_NumberOfSettlements pisa > 0
		spawn_army
			faction pisa
			character	random_name, named character, age 20, x 157, y 156, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_pisa 1
	end_if

	if I_IsFactionAIControlled aragon
	and I_NumberOfHeirs aragon < 4
	and I_CompareCounter heir_aragon < 2
  and I_NumberOfSettlements aragon > 0
		spawn_army
			faction aragon
			character	random_name, named character, age 20, x 59, y 155, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_aragon 1
	end_if

	if I_IsFactionAIControlled spain
	and I_NumberOfHeirs spain < 4
	and I_CompareCounter heir_spain < 2
  and I_NumberOfSettlements spain > 0
		spawn_army
			faction spain
			character	random_name, named character, age 20, x 46, y 152, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_spain 1
	end_if

	if I_IsFactionAIControlled portugal
	and I_NumberOfHeirs portugal < 4
	and I_CompareCounter heir_portugal < 2
  and I_NumberOfSettlements portugal > 0
		spawn_army
			faction portugal
			character	random_name, named character, age 20, x 26, y 145, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_portugal 1
	end_if

	if I_IsFactionAIControlled venice
	and I_NumberOfHeirs venice < 4
	and I_CompareCounter heir_venice < 2
  and I_NumberOfSettlements venice > 0
		spawn_army
			faction venice
			character	random_name, named character, age 20, x 178, y 171, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_venice 1
	end_if

	if I_IsFactionAIControlled sicily
	and I_NumberOfHeirs sicily < 4
	and I_CompareCounter heir_sicily < 2
  and I_NumberOfSettlements sicily > 0
		spawn_army
			faction sicily
			character	random_name, named character, age 20, x 183, y 112, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	SE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_sicily 1
	end_if

	if I_IsFactionAIControlled poland
	and I_NumberOfHeirs poland < 4
	and I_CompareCounter heir_poland < 2
  and I_NumberOfSettlements poland > 0
		spawn_army
			faction poland
			character	random_name, named character, age 20, x 216, y 219, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_poland 1
	end_if

	if I_IsFactionAIControlled hungary
	and I_NumberOfHeirs hungary < 4
	and I_CompareCounter heir_hungary < 2
  and I_NumberOfSettlements hungary > 0
		spawn_army
			faction hungary
			character	random_name, named character, age 20, x 213, y 180, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_hungary 1
	end_if

	if I_IsFactionAIControlled kievan_rus
	and I_NumberOfHeirs kievan_rus < 4
	and I_CompareCounter heir_kievan_rus < 2
  and I_NumberOfSettlements kievan_rus > 0
		spawn_army
			faction kievan_rus
			character	random_name, named character, age 20, x 308, y 210, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	EE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_kievan_rus 1
	end_if

	if I_IsFactionAIControlled russia
	and I_NumberOfHeirs russia < 4
	and I_CompareCounter heir_russia < 2
  and I_NumberOfSettlements russia > 0
		spawn_army
			faction russia
			character	random_name, named character, age 20, x 304, y 273, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	EE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_russia 1
	end_if

	if I_IsFactionAIControlled byzantium
	and I_NumberOfHeirs byzantium < 4
	and I_CompareCounter heir_byzantium < 2
  and I_NumberOfSettlements byzantium > 0
		spawn_army
			faction byzantium
			character	random_name, named character, age 20, x 236, y 115, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Greek Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_byzantium 1
	end_if

	if I_IsFactionAIControlled lithuania
	and I_NumberOfHeirs lithuania < 4
	and I_CompareCounter heir_lithuania < 2
  and I_NumberOfSettlements lithuania > 0
		spawn_army
			faction lithuania
			character	random_name, named character, age 20, x 251, y 247, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Lith Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_lithuania 1
	end_if

	if I_IsFactionAIControlled teutonic_order
	and I_NumberOfHeirs teutonic_order < 4
	and I_CompareCounter heir_teutonic_order < 2
  and I_NumberOfSettlements teutonic_order > 0
		spawn_army
			faction teutonic_order
			character	random_name, named character, age 20, x 220, y 159, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	EE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_teutonic_order 1
	end_if

	if I_IsFactionAIControlled jerusalem
	and I_NumberOfHeirs jerusalem < 4
	and I_CompareCounter heir_jerusalem < 2
  and I_NumberOfSettlements jerusalem > 0
		spawn_army
			faction jerusalem
			character	random_name, named character, age 20, x 339, y 78, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	NE Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_jerusalem 1
	end_if

	if I_IsFactionAIControlled turks
	and I_NumberOfHeirs turks < 4
	and I_CompareCounter heir_turks < 2
  and I_NumberOfSettlements turks > 0
		spawn_army
			faction turks
			character	random_name, named character, age 20, x 460, y 92, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_turks 1
	end_if

	if I_IsFactionAIControlled rum
	and I_NumberOfHeirs rum < 4
	and I_CompareCounter heir_rum < 2 
  and I_NumberOfSettlements rum > 0                        
		spawn_army
			faction rum
			character	random_name, named character, age 20, x 317, y 115, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_turks 1
	end_if

	if I_IsFactionAIControlled egypt
	and I_NumberOfHeirs egypt < 4
	and I_CompareCounter heir_egypt < 2
  and I_NumberOfSettlements egypt > 0
		spawn_army
			faction egypt
			character	random_name, named character, age 20, x 307, y 43, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_egypt 1
	end_if

	if I_IsFactionAIControlled moors
	and I_NumberOfHeirs moors < 4
	and I_CompareCounter heir_moors < 2
  and I_NumberOfSettlements moors > 0
		spawn_army
			faction moors
			character	random_name, named character, age 20, x 24, y 79, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_moors 1
	end_if

	if I_IsFactionAIControlled kwarezm
	and I_NumberOfHeirs kwarezm < 4
	and I_CompareCounter heir_kwarezm < 2
  and I_NumberOfSettlements kwarezm > 0
		spawn_army
			faction kwarezm
			character	random_name, named character, age 20, x 374, y 95, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	ME Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_kwarezm 1
	end_if

	if I_IsFactionAIControlled cumans
	and I_NumberOfHeirs cumans < 4
	and I_CompareCounter heir_cumans < 2
  and I_NumberOfSettlements cumans > 0
		spawn_army
			faction cumans
			character	random_name, named character, age 20, x 399, y 183, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Cuman Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_cumans 1
	end_if

	if I_IsFactionAIControlled mongols
	and I_NumberOfHeirs mongols < 4
	and I_CompareCounter heir_mongols < 2
	and I_EventCounter mongols_invasion > 0
  and I_NumberOfSettlements mongols > 0
		spawn_army
			faction mongols
			character	random_name, named character, age 20, x 502, y 160, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	Keshikten Bodyguard		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_mongols 1
	end_if

	if I_IsFactionAIControlled timurids
	and I_NumberOfHeirs timurids < 4
	and I_CompareCounter heir_timurids < 2
  and I_NumberOfSettlements timurids > 0
		spawn_army
			faction timurids
			character	random_name, named character, age 20, x 392, y 165, family
			traits MilitaryInclination 2 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , Loyal 2 , ReligionStarter 1
			unit	bodyguard georgia		exp 2 armour 0 weapon_lvl 0
		end
		inc_counter heir_timurids 1
	end_if

end_monitor

;---- Constantinople JIHAD garrison script
monitor_event SettlementTurnStart SettlementName Constantinople
	and IsFactionAIControlled
	and I_SettlementUnderSiege Constantinople
	and IsJihadTarget Constantinople
	and I_SettlementOwner Constantinople = byzantium

	create_unit Constantinople, Contaratoi, num 3, exp 0, arm 0, wep 0
	create_unit Constantinople, Toxotae, num 2, exp 0, arm 1, wep 0
	create_unit Constantinople, Toxotae, num 2, exp 0, arm 1, wep 0
end_monitor

;========================================================
;==================== PLAYER PART =======================
;========================================================

;============== FACTION KILLER WORKAROUND ===============
monitor_event PreFactionTurnStart TrueCondition
	set_event_counter Ceased_venice 0
	set_event_counter Ceased_sicily 0
	set_event_counter Ceased_milan 0
	set_event_counter Ceased_pisa 0
	set_event_counter Ceased_papal_states 0
	set_event_counter Ceased_denmark 0
	set_event_counter Ceased_egypt 0
	set_event_counter Ceased_scotland 0
	set_event_counter Ceased_cumans 0
	set_event_counter Ceased_mongols 0
	set_event_counter Ceased_turks 0
	set_event_counter Ceased_rum 0
	set_event_counter Ceased_france 0
	set_event_counter Ceased_hre 0
	set_event_counter Ceased_england 0
	set_event_counter Ceased_portugal 0
	set_event_counter Ceased_poland 0
	set_event_counter Ceased_byzantium 0
	set_event_counter Ceased_moors 0
	set_event_counter Ceased_russia 0
	set_event_counter Ceased_spain 0
	set_event_counter Ceased_hungary 0
	set_event_counter Ceased_aragon 0
	set_event_counter Ceased_lithuania 0
	set_event_counter Ceased_kievan_rus 0
	set_event_counter Ceased_teutonic_order 0
	set_event_counter Ceased_timurids 0
	set_event_counter Ceased_norway 0
	set_event_counter Ceased_jerusalem 0
	set_event_counter Ceased_kwarezm 0
end_monitor

monitor_event CeasedFactionLeader FactionType venice
	set_event_counter Ceased_venice 1
end_monitor

monitor_event BecomesFactionLeader FactionType venice
	set_event_counter Ceased_venice 0
end_monitor

monitor_event CeasedFactionLeader FactionType sicily
	set_event_counter Ceased_sicily 1
end_monitor

monitor_event BecomesFactionLeader FactionType sicily
	set_event_counter Ceased_sicily 0
	
end_monitor

monitor_event CeasedFactionLeader FactionType milan
	set_event_counter Ceased_milan 1
end_monitor

monitor_event CeasedFactionLeader FactionType pisa
	set_event_counter Ceased_pisa 1
end_monitor

monitor_event BecomesFactionLeader FactionType milan
	set_event_counter Ceased_milan 0
end_monitor

monitor_event BecomesFactionLeader FactionType pisa
	set_event_counter Ceased_pisa 0
end_monitor

monitor_event CeasedFactionLeader FactionType papal_states
	set_event_counter Ceased_papal_states 1
end_monitor

monitor_event BecomesFactionLeader FactionType papal_states
	set_event_counter Ceased_papal_states 0
end_monitor

monitor_event CeasedFactionLeader FactionType denmark
	set_event_counter Ceased_denmark 1
end_monitor

monitor_event BecomesFactionLeader FactionType denmark
	set_event_counter Ceased_denmark 0
end_monitor

monitor_event CeasedFactionLeader FactionType egypt
	set_event_counter Ceased_egypt 1
end_monitor

monitor_event BecomesFactionLeader FactionType egypt
	set_event_counter Ceased_egypt 0
end_monitor

monitor_event CeasedFactionLeader FactionType scotland
	set_event_counter Ceased_scotland 1
end_monitor

monitor_event BecomesFactionLeader FactionType scotland
	set_event_counter Ceased_scotland 0
end_monitor

monitor_event CeasedFactionLeader FactionType cumans
	set_event_counter Ceased_cumans 1
end_monitor

monitor_event BecomesFactionLeader FactionType cumans
	set_event_counter Ceased_cumans 0
end_monitor

monitor_event CeasedFactionLeader FactionType mongols
	set_event_counter Ceased_mongols 1
end_monitor

monitor_event BecomesFactionLeader FactionType mongols
	set_event_counter Ceased_mongols 0
end_monitor

monitor_event CeasedFactionLeader FactionType turks
	set_event_counter Ceased_turks 1
end_monitor

monitor_event BecomesFactionLeader FactionType turks
	set_event_counter Ceased_turks 0
end_monitor

monitor_event CeasedFactionLeader FactionType rum
	set_event_counter Ceased_rum 1
end_monitor

monitor_event BecomesFactionLeader FactionType rum
	set_event_counter Ceased_rum 0
end_monitor

monitor_event CeasedFactionLeader FactionType france
	set_event_counter Ceased_france 1
end_monitor

monitor_event BecomesFactionLeader FactionType france
	set_event_counter Ceased_france 0
end_monitor

monitor_event CeasedFactionLeader FactionType hre
	set_event_counter Ceased_hre 1
end_monitor

monitor_event BecomesFactionLeader FactionType hre
	set_event_counter Ceased_hre 0
end_monitor

monitor_event CeasedFactionLeader FactionType england
	set_event_counter Ceased_england 1
end_monitor

monitor_event BecomesFactionLeader FactionType england
	set_event_counter Ceased_england 0
end_monitor

monitor_event CeasedFactionLeader FactionType portugal
	set_event_counter Ceased_portugal 1
end_monitor

monitor_event BecomesFactionLeader FactionType portugal
	set_event_counter Ceased_portugal 0
end_monitor

monitor_event CeasedFactionLeader FactionType poland
	set_event_counter Ceased_poland 1
end_monitor

monitor_event BecomesFactionLeader FactionType poland
	set_event_counter Ceased_poland 0
end_monitor

monitor_event CeasedFactionLeader FactionType byzantium
	set_event_counter Ceased_byzantium 1
end_monitor

monitor_event BecomesFactionLeader FactionType byzantium
	set_event_counter Ceased_byzantium 0
end_monitor

monitor_event CeasedFactionLeader FactionType moors
	set_event_counter Ceased_moors 1
end_monitor

monitor_event BecomesFactionLeader FactionType moors
	set_event_counter Ceased_moors 0
end_monitor

monitor_event CeasedFactionLeader FactionType russia
	set_event_counter Ceased_russia 1
end_monitor

monitor_event BecomesFactionLeader FactionType russia
	set_event_counter Ceased_russia 0
end_monitor

monitor_event CeasedFactionLeader FactionType spain
	set_event_counter Ceased_spain 1
end_monitor

monitor_event BecomesFactionLeader FactionType spain
	set_event_counter Ceased_spain 0
end_monitor

monitor_event CeasedFactionLeader FactionType hungary
	set_event_counter Ceased_hungary 1
end_monitor

monitor_event BecomesFactionLeader FactionType hungary
	set_event_counter Ceased_hungary 0
end_monitor

monitor_event CeasedFactionLeader FactionType aragon
	set_event_counter Ceased_aragon 1
end_monitor

monitor_event BecomesFactionLeader FactionType aragon
	set_event_counter Ceased_aragon 0
end_monitor

monitor_event CeasedFactionLeader FactionType lithuania
	set_event_counter Ceased_lithuania 1
end_monitor

monitor_event BecomesFactionLeader FactionType lithuania
	set_event_counter Ceased_lithuania 0
end_monitor

monitor_event CeasedFactionLeader FactionType kievan_rus
	set_event_counter Ceased_kievan_rus 1
end_monitor

monitor_event BecomesFactionLeader FactionType kievan_rus
	set_event_counter Ceased_kievan_rus 0
end_monitor

monitor_event CeasedFactionLeader FactionType teutonic_order
	set_event_counter Ceased_teutonic_order 1
end_monitor

monitor_event BecomesFactionLeader FactionType teutonic_order
	set_event_counter Ceased_teutonic_order 0
end_monitor

monitor_event CeasedFactionLeader FactionType timurids
	set_event_counter Ceased_timurids 1
end_monitor

monitor_event BecomesFactionLeader FactionType timurids
	set_event_counter Ceased_timurids 0
end_monitor

monitor_event CeasedFactionLeader FactionType norway
	set_event_counter Ceased_norway 1
end_monitor

monitor_event BecomesFactionLeader FactionType norway
	set_event_counter Ceased_norway 0
end_monitor

monitor_event CeasedFactionLeader FactionType jerusalem
	set_event_counter Ceased_jerusalem 1
end_monitor

monitor_event BecomesFactionLeader FactionType jerusalem
	set_event_counter Ceased_jerusalem 0
end_monitor

monitor_event CeasedFactionLeader FactionType kwarezm
	set_event_counter Ceased_kwarezm 1
end_monitor

monitor_event BecomesFactionLeader FactionType kwarezm
	set_event_counter Ceased_kwarezm 0
end_monitor

;================== BESIEGE UPKEEP ======================
monitor_event CharacterTurnStart CharacterIsLocal
	and Trait ArmyCost > 0

	console_command add_money -1000

end_monitor

;==================== City Reveal =======================
monitor_event FactionTurnStart FactionReligion catholic

	reveal_tile 330,74	;Jerusalem
	reveal_tile 169,146	;Rome 
	reveal_tile 37,152	;Leon - Santiago
	hide_all_revealed_tiles
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionReligion orthodox

	reveal_tile 330,74	;Jerusalem
	reveal_tile 284,142	;Constantinople
	hide_all_revealed_tiles
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionReligion islam

	reveal_tile 330,74	;Jerusalem
	reveal_tile 416,94	;Baghdad
	reveal_tile 359,23	;Al_Wasit
	hide_all_revealed_tiles
terminate_monitor
end_monitor

;==================== Major Events ====================== 
;--- Jerusalem Captured
declare_counter Jerusalem_christian
declare_counter Jerusalem_islam
declare_counter Jerusalem_pagan
set_counter Jerusalem_christian 0
set_counter Jerusalem_islam 0
set_counter Jerusalem_pagan 0

monitor_event GeneralCaptureSettlement SettlementName Jerusalem
	and CharacterReligion catholic
	and I_CompareCounter Jerusalem_christian = 0

  change_settlement_name Jerusalem Jerusalem
	historic_event jerusalem_christian event/Christians_Capture_Jerusalem.bik
	set_counter Jerusalem_christian 1

end_monitor

monitor_event GeneralCaptureSettlement SettlementName Jerusalem
	and CharacterReligion orthodox
	and I_CompareCounter Jerusalem_christian = 0
                             
	change_settlement_name Jerusalem Hierosolyma
  historic_event jerusalem_christian event/Christians_Capture_Jerusalem.bik
	set_counter Jerusalem_christian 1

end_monitor

monitor_event GeneralCaptureSettlement SettlementName Jerusalem
	and CharacterReligion islam
	and I_CompareCounter Jerusalem_islam = 0

  change_settlement_name Jerusalem al_Quds
	historic_event jerusalem_muslim event/Muslims_Capture_Jerusalem.bik
	set_counter Jerusalem_islam 1

end_monitor

monitor_event GeneralCaptureSettlement SettlementName Jerusalem
	and CharacterReligion pagan
	and IsFactionAIControlled
	and I_CompareCounter Jerusalem_pagan = 0

	historic_event jerusalem_pagan
	set_counter Jerusalem_pagan 1

end_monitor

;--- City Name Changes

;--- Lisbon
monitor_event GeneralCaptureSettlement SettlementName Lisbon
	and CharacterReligion catholic

  change_settlement_name Lisbon Lisbon
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Lisbon
	and CharacterReligion islam

  change_settlement_name Lisbon al_Ushbuna
end_monitor

;--- Toledo
monitor_event GeneralCaptureSettlement SettlementName Toledo
	and CharacterReligion catholic

  change_settlement_name Toledo Toledo
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Toledo
	and CharacterReligion islam

  change_settlement_name Toledo Tulaytula
end_monitor

;--- Valencia
monitor_event GeneralCaptureSettlement SettlementName Valencia
	and CharacterReligion catholic

  change_settlement_name Valencia Valencia
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Valencia
	and CharacterReligion islam

  change_settlement_name Valencia Balansiyya
end_monitor

;--- Badajoz
monitor_event GeneralCaptureSettlement SettlementName Badajoz
	and CharacterReligion catholic

  change_settlement_name Badajoz Badajoz
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Badajoz
	and CharacterReligion islam

  change_settlement_name Badajoz Batalyaus
end_monitor

;--- Cordoba
monitor_event GeneralCaptureSettlement SettlementName Cordoba
	and CharacterReligion catholic

  change_settlement_name Cordoba Cordoba
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Cordoba
	and CharacterReligion islam

  change_settlement_name Cordoba Qurtuba
end_monitor

;--- Silves
monitor_event GeneralCaptureSettlement SettlementName Silves
	and CharacterReligion catholic

  change_settlement_name Silves Silves
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Silves
	and CharacterReligion islam

  change_settlement_name Silves Shilb
end_monitor

;--- Murcia
monitor_event GeneralCaptureSettlement SettlementName Murcia
	and CharacterReligion catholic

  change_settlement_name Murcia Murcia
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Murcia
	and CharacterReligion islam

  change_settlement_name Murcia Mursiyah
end_monitor

;--- Granada
monitor_event GeneralCaptureSettlement SettlementName Granada
	and CharacterReligion catholic

  change_settlement_name Granada Granada
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Granada
	and CharacterReligion islam

  change_settlement_name Granada Garnata
end_monitor

;--- Sevilla
monitor_event GeneralCaptureSettlement SettlementName Sevilla
	and CharacterReligion catholic

  change_settlement_name Sevilla Sevilla
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Sevilla
	and CharacterReligion islam

  change_settlement_name Sevilla Isbiliyya
end_monitor

;--- Zaragoza
monitor_event GeneralCaptureSettlement SettlementName Zaragoza
	and CharacterReligion catholic

  change_settlement_name Zaragoza Zaragoza
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Zaragoza
	and CharacterReligion islam

  change_settlement_name Zaragoza Saraqusta
end_monitor

;--- Palma
monitor_event GeneralCaptureSettlement SettlementName Palma
	and CharacterReligion catholic

  change_settlement_name Palma Palma
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Palma
	and CharacterReligion islam

  change_settlement_name Palma Medina_Mayurqa
end_monitor

;--- Al_Aqaba
monitor_event GeneralCaptureSettlement SettlementName Al_Aqaba
	and CharacterReligion catholic

  change_settlement_name Al_Aqaba Aqaba
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Al_Aqaba
	and CharacterReligion islam

  change_settlement_name Al_Aqaba Al_Aqaba
end_monitor

;--- Acre
monitor_event GeneralCaptureSettlement SettlementName Acre
	and CharacterReligion catholic

  change_settlement_name Acre Acre
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Acre
	and CharacterReligion islam

  change_settlement_name Acre Akka
end_monitor

;--- Tripoli
monitor_event GeneralCaptureSettlement SettlementName Tripoli
	and CharacterReligion catholic

  change_settlement_name Tripoli Tripoli
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Tripoli
	and CharacterReligion islam

  change_settlement_name Tripoli Tarabulus
end_monitor

;--- Antioch
monitor_event GeneralCaptureSettlement SettlementName Antioch
	and CharacterReligion catholic

  change_settlement_name Antioch Antioch
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Antioch
	and CharacterReligion islam

  change_settlement_name Antioch Antakiyyah
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Antioch
	and CharacterReligion orthodox

  change_settlement_name Antioch Antiocheia
end_monitor

;--- Edessa
monitor_event GeneralCaptureSettlement SettlementName Edessa
	and CharacterReligion catholic

  change_settlement_name Edessa Edessa
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Edessa
	and CharacterReligion islam

  change_settlement_name Edessa Urfa
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Edessa
	and CharacterReligion orthodox

  change_settlement_name Edessa Justinopolis
end_monitor

;--- Ascalon
monitor_event GeneralCaptureSettlement SettlementName Ascalon
	and CharacterReligion catholic

  change_settlement_name Ascalon Ascalon
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Ascalon
	and CharacterReligion islam

  change_settlement_name Ascalon Asqalan
end_monitor

;--- Angora
monitor_event GeneralCaptureSettlement SettlementName Angora
	and CharacterReligion islam

  change_settlement_name Angora Angora
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Angora
	and CharacterReligion orthodox

  change_settlement_name Angora Ankyra
end_monitor

;--- Angora
monitor_event GeneralCaptureSettlement SettlementName Konya
	and CharacterReligion islam

  change_settlement_name Konya Konya
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Konya
	and CharacterReligion orthodox

  change_settlement_name Konya Ikonion
end_monitor

;--- Nicaea
monitor_event GeneralCaptureSettlement SettlementName Nicaea
	and CharacterReligion islam

  change_settlement_name Nicaea Iznik
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Nicaea
	and CharacterReligion orthodox

  change_settlement_name Nicaea Nicaea
end_monitor

;--- Smyrna
monitor_event GeneralCaptureSettlement SettlementName Smyrna
	and CharacterReligion islam

  change_settlement_name Smyrna Izmir
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Smyrna
	and CharacterReligion orthodox

  change_settlement_name Smyrna Smyrna
end_monitor

;--- Attaleia
monitor_event GeneralCaptureSettlement SettlementName Attaleia
	and CharacterReligion islam

  change_settlement_name Attaleia Antalya
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Attaleia
	and CharacterReligion orthodox

  change_settlement_name Attaleia Attaleia
end_monitor

;--- Sives
monitor_event GeneralCaptureSettlement SettlementName Sives
	and CharacterReligion islam

  change_settlement_name Sives Sives
end_monitor

monitor_event GeneralCaptureSettlement SettlementName Sives
	and CharacterReligion orthodox

  change_settlement_name Sives Sebasteia
end_monitor



;--- World is round 
monitor_event EventCounter EventCounterType world_is_round
	and EventCounter > 0

	historic_event america_discovered event/america_discovered.bik
terminate_monitor
end_monitor

;-- Player built first great temple
monitor_event BuildingCompleted not IsFactionAIControlled
	and SettlementBuildingFinished = huge_cathedral

	historic_event player_first_huge_cathedral event/huge_cathedral_built.bik
terminate_monitor
end_monitor

monitor_event BuildingCompleted not IsFactionAIControlled
	and SettlementBuildingFinished = great_jama

	historic_event player_first_great_jama event/great_mosque_created.bik
terminate_monitor
end_monitor

;-- Can notre_dame be built?
monitor_event FactionTurnStart FactionType slave
	and I_TurnNumber = 46

	set_event_counter notre_dame 1
terminate_monitor
end_monitor

;-- Capital Change
monitor_event FactionNewCapital not IsFactionAIControlled
	and I_EventCounter DifficultyLevel > 2

	if not I_HotseatEnabled
	historic_event capital_change
	end_if
	console_command add_money -5000

end_monitor

monitor_event FactionNewCapital not IsFactionAIControlled
	and I_EventCounter DifficultyLevel = 2

	if not I_HotseatEnabled
	historic_event capital_change
	end_if
	console_command add_money -2000

end_monitor

;================= Player Notification ==================
;--- Death of Leaders
monitor_event BecomesFactionLeader FactionType scotland
  and IsFactionAIControlled

  if I_FactionLeaderTrait scotland Factionleader > 1 
	 historic_event scotland_king_event
  end_if
  
  if I_FactionLeaderTrait scotland FactionRegent > 0 
	 historic_event scotland_regent_event
  end_if

  if I_NumberOfSettlements scotland < 4
  and I_NumberOfSettlements scotland > 0
  and I_TurnNumber > 25
  and RandomPercent > 50
    console_command diplomatic_stance scotland england neutral
    console_command diplomatic_stance scotland spain neutral
    console_command diplomatic_stance scotland portugal neutral
    console_command diplomatic_stance scotland aragon neutral
    console_command diplomatic_stance scotland france neutral
    console_command diplomatic_stance scotland hre neutral
    console_command diplomatic_stance scotland denmark neutral
    console_command diplomatic_stance scotland norway neutral
    console_command diplomatic_stance scotland pisa neutral
    console_command diplomatic_stance scotland venice neutral
    console_command diplomatic_stance scotland papal_states neutral
    console_command diplomatic_stance scotland sicily neutral
    console_command diplomatic_stance scotland poland neutral
    console_command diplomatic_stance scotland hungary neutral
    console_command diplomatic_stance scotland teutonic_order neutral
    console_command diplomatic_stance scotland lithuania neutral  
    console_command diplomatic_stance scotland russia neutral
    console_command diplomatic_stance scotland kievan_rus neutral
    console_command diplomatic_stance scotland cumans neutral
    console_command diplomatic_stance scotland byzantium neutral
    console_command diplomatic_stance scotland rum neutral
    console_command diplomatic_stance scotland timurids neutral
    console_command diplomatic_stance scotland turks neutral
    console_command diplomatic_stance scotland milan neutral
    console_command diplomatic_stance scotland kwarezm neutral
    console_command diplomatic_stance scotland jerusalem neutral
    console_command diplomatic_stance scotland egypt neutral
    console_command diplomatic_stance scotland moors neutral
    console_command diplomatic_stance scotland mongols neutral
    
    historic_event New_Mindset_scotland
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType england
  and IsFactionAIControlled

  if I_FactionLeaderTrait england Factionleader > 1 
	 historic_event england_king_event
  end_if
  
  if I_FactionLeaderTrait england FactionRegent > 0 
	 historic_event england_regent_event
  end_if

  if I_NumberOfSettlements england < 4
  and I_NumberOfSettlements england > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance england scotland neutral
    console_command diplomatic_stance england spain neutral
    console_command diplomatic_stance england portugal neutral
    console_command diplomatic_stance england aragon neutral
    console_command diplomatic_stance england france neutral
    console_command diplomatic_stance england hre neutral
    console_command diplomatic_stance england denmark neutral
    console_command diplomatic_stance england norway neutral
    console_command diplomatic_stance england pisa neutral
    console_command diplomatic_stance england venice neutral
    console_command diplomatic_stance england papal_states neutral
    console_command diplomatic_stance england sicily neutral
    console_command diplomatic_stance england poland neutral
    console_command diplomatic_stance england hungary neutral
    console_command diplomatic_stance england teutonic_order neutral
    console_command diplomatic_stance england lithuania neutral  
    console_command diplomatic_stance england russia neutral
    console_command diplomatic_stance england kievan_rus neutral
    console_command diplomatic_stance england cumans neutral
    console_command diplomatic_stance england byzantium neutral
    console_command diplomatic_stance england rum neutral
    console_command diplomatic_stance england timurids neutral
    console_command diplomatic_stance england turks neutral
    console_command diplomatic_stance england milan neutral
    console_command diplomatic_stance england kwarezm neutral
    console_command diplomatic_stance england jerusalem neutral
    console_command diplomatic_stance england egypt neutral
    console_command diplomatic_stance england moors neutral
    console_command diplomatic_stance england mongols neutral
    
    historic_event New_Mindset_england
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType portugal
  and IsFactionAIControlled

  if I_FactionLeaderTrait portugal Factionleader > 1 
	 historic_event portugal_king_event
  end_if
  
  if I_FactionLeaderTrait portugal FactionRegent > 0 
	 historic_event portugal_regent_event
  end_if

  if I_NumberOfSettlements portugal < 4
  and I_NumberOfSettlements portugal > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance portugal scotland neutral
    console_command diplomatic_stance portugal spain neutral
    console_command diplomatic_stance portugal england neutral
    console_command diplomatic_stance portugal aragon neutral
    console_command diplomatic_stance portugal france neutral
    console_command diplomatic_stance portugal hre neutral
    console_command diplomatic_stance portugal denmark neutral
    console_command diplomatic_stance portugal norway neutral
    console_command diplomatic_stance portugal pisa neutral
    console_command diplomatic_stance portugal venice neutral
    console_command diplomatic_stance portugal papal_states neutral
    console_command diplomatic_stance portugal sicily neutral
    console_command diplomatic_stance portugal poland neutral
    console_command diplomatic_stance portugal hungary neutral
    console_command diplomatic_stance portugal teutonic_order neutral
    console_command diplomatic_stance portugal lithuania neutral  
    console_command diplomatic_stance portugal russia neutral
    console_command diplomatic_stance portugal kievan_rus neutral
    console_command diplomatic_stance portugal cumans neutral
    console_command diplomatic_stance portugal byzantium neutral
    console_command diplomatic_stance portugal rum neutral
    console_command diplomatic_stance portugal timurids neutral
    console_command diplomatic_stance portugal turks neutral
    console_command diplomatic_stance portugal milan neutral
    console_command diplomatic_stance portugal kwarezm neutral
    console_command diplomatic_stance portugal jerusalem neutral
    console_command diplomatic_stance portugal egypt neutral
    console_command diplomatic_stance portugal moors neutral
    console_command diplomatic_stance portugal mongols neutral
    
    historic_event New_Mindset_portugal
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType spain
  and IsFactionAIControlled

  if I_FactionLeaderTrait spain Factionleader > 1 
	 historic_event spain_king_event
  end_if
  
  if I_FactionLeaderTrait spain FactionRegent > 0 
	 historic_event spain_regent_event
  end_if

  if I_NumberOfSettlements spain < 4
  and I_NumberOfSettlements spain > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance spain scotland neutral
    console_command diplomatic_stance spain portugal neutral
    console_command diplomatic_stance spain england neutral
    console_command diplomatic_stance spain aragon neutral
    console_command diplomatic_stance spain france neutral
    console_command diplomatic_stance spain hre neutral
    console_command diplomatic_stance spain denmark neutral
    console_command diplomatic_stance spain norway neutral
    console_command diplomatic_stance spain pisa neutral
    console_command diplomatic_stance spain venice neutral
    console_command diplomatic_stance spain papal_states neutral
    console_command diplomatic_stance spain sicily neutral
    console_command diplomatic_stance spain poland neutral
    console_command diplomatic_stance spain hungary neutral
    console_command diplomatic_stance spain teutonic_order neutral
    console_command diplomatic_stance spain lithuania neutral  
    console_command diplomatic_stance spain russia neutral
    console_command diplomatic_stance spain kievan_rus neutral
    console_command diplomatic_stance spain cumans neutral
    console_command diplomatic_stance spain byzantium neutral
    console_command diplomatic_stance spain rum neutral
    console_command diplomatic_stance spain timurids neutral
    console_command diplomatic_stance spain turks neutral
    console_command diplomatic_stance spain milan neutral
    console_command diplomatic_stance spain kwarezm neutral
    console_command diplomatic_stance spain jerusalem neutral
    console_command diplomatic_stance spain egypt neutral
    console_command diplomatic_stance spain moors neutral
    console_command diplomatic_stance spain mongols neutral
    
    historic_event New_Mindset_spain
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType aragon
  and IsFactionAIControlled

  if I_FactionLeaderTrait aragon Factionleader > 1 
	 historic_event aragon_king_event
  end_if
  
  if I_FactionLeaderTrait aragon FactionRegent > 0 
	 historic_event aragon_regent_event
  end_if

  if I_NumberOfSettlements aragon < 4
  and I_NumberOfSettlements aragon > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance aragon scotland neutral
    console_command diplomatic_stance aragon portugal neutral
    console_command diplomatic_stance aragon england neutral
    console_command diplomatic_stance aragon spain neutral
    console_command diplomatic_stance aragon france neutral
    console_command diplomatic_stance aragon hre neutral
    console_command diplomatic_stance aragon denmark neutral
    console_command diplomatic_stance aragon norway neutral
    console_command diplomatic_stance aragon pisa neutral
    console_command diplomatic_stance aragon venice neutral
    console_command diplomatic_stance aragon papal_states neutral
    console_command diplomatic_stance aragon sicily neutral
    console_command diplomatic_stance aragon poland neutral
    console_command diplomatic_stance aragon hungary neutral
    console_command diplomatic_stance aragon teutonic_order neutral
    console_command diplomatic_stance aragon lithuania neutral  
    console_command diplomatic_stance aragon russia neutral
    console_command diplomatic_stance aragon kievan_rus neutral
    console_command diplomatic_stance aragon cumans neutral
    console_command diplomatic_stance aragon byzantium neutral
    console_command diplomatic_stance aragon rum neutral
    console_command diplomatic_stance aragon timurids neutral
    console_command diplomatic_stance aragon turks neutral
    console_command diplomatic_stance aragon milan neutral
    console_command diplomatic_stance aragon kwarezm neutral
    console_command diplomatic_stance aragon jerusalem neutral
    console_command diplomatic_stance aragon egypt neutral
    console_command diplomatic_stance aragon moors neutral
    console_command diplomatic_stance aragon mongols neutral
    
    historic_event New_Mindset_aragon
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType france
  and IsFactionAIControlled

  if I_FactionLeaderTrait france Factionleader > 1 
	 historic_event france_king_event
  end_if
  
  if I_FactionLeaderTrait france FactionRegent > 0 
	 historic_event france_regent_event
  end_if

  if I_NumberOfSettlements france < 4
  and I_NumberOfSettlements france > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance france scotland neutral
    console_command diplomatic_stance france portugal neutral
    console_command diplomatic_stance france england neutral
    console_command diplomatic_stance france spain neutral
    console_command diplomatic_stance france aragon neutral
    console_command diplomatic_stance france hre neutral
    console_command diplomatic_stance france denmark neutral
    console_command diplomatic_stance france norway neutral
    console_command diplomatic_stance france pisa neutral
    console_command diplomatic_stance france venice neutral
    console_command diplomatic_stance france papal_states neutral
    console_command diplomatic_stance france sicily neutral
    console_command diplomatic_stance france poland neutral
    console_command diplomatic_stance france hungary neutral
    console_command diplomatic_stance france teutonic_order neutral
    console_command diplomatic_stance france lithuania neutral  
    console_command diplomatic_stance france russia neutral
    console_command diplomatic_stance france kievan_rus neutral
    console_command diplomatic_stance france cumans neutral
    console_command diplomatic_stance france byzantium neutral
    console_command diplomatic_stance france rum neutral
    console_command diplomatic_stance france timurids neutral
    console_command diplomatic_stance france turks neutral
    console_command diplomatic_stance france milan neutral
    console_command diplomatic_stance france kwarezm neutral
    console_command diplomatic_stance france jerusalem neutral
    console_command diplomatic_stance france egypt neutral
    console_command diplomatic_stance france moors neutral
    console_command diplomatic_stance france mongols neutral
    
    historic_event New_Mindset_france
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType hre
  and IsFactionAIControlled

  if I_FactionLeaderTrait hre Factionleader > 1 
	 historic_event hre_king_event
  end_if
  
  if I_FactionLeaderTrait hre FactionRegent > 0 
	 historic_event hre_regent_event
  end_if

  if I_NumberOfSettlements hre < 4
  and I_NumberOfSettlements hre > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance hre scotland neutral
    console_command diplomatic_stance hre portugal neutral
    console_command diplomatic_stance hre england neutral
    console_command diplomatic_stance hre spain neutral
    console_command diplomatic_stance hre aragon neutral
    console_command diplomatic_stance hre france neutral
    console_command diplomatic_stance hre denmark neutral
    console_command diplomatic_stance hre norway neutral
    console_command diplomatic_stance hre pisa neutral
    console_command diplomatic_stance hre venice neutral
    console_command diplomatic_stance hre papal_states neutral
    console_command diplomatic_stance hre sicily neutral
    console_command diplomatic_stance hre poland neutral
    console_command diplomatic_stance hre hungary neutral
    console_command diplomatic_stance hre teutonic_order neutral
    console_command diplomatic_stance hre lithuania neutral  
    console_command diplomatic_stance hre russia neutral
    console_command diplomatic_stance hre kievan_rus neutral
    console_command diplomatic_stance hre cumans neutral
    console_command diplomatic_stance hre byzantium neutral
    console_command diplomatic_stance hre rum neutral
    console_command diplomatic_stance hre timurids neutral
    console_command diplomatic_stance hre turks neutral
    console_command diplomatic_stance hre milan neutral
    console_command diplomatic_stance hre kwarezm neutral
    console_command diplomatic_stance hre jerusalem neutral
    console_command diplomatic_stance hre egypt neutral
    console_command diplomatic_stance hre moors neutral
    console_command diplomatic_stance hre mongols neutral
    
    historic_event New_Mindset_hre
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType denmark
  and IsFactionAIControlled

  if I_FactionLeaderTrait denmark Factionleader > 1 
	 historic_event denmark_king_event
  end_if
  
  if I_FactionLeaderTrait denmark FactionRegent > 0 
	 historic_event denmark_regent_event
  end_if

  if I_NumberOfSettlements denmark < 4
  and I_NumberOfSettlements denmark > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance denmark scotland neutral
    console_command diplomatic_stance denmark portugal neutral
    console_command diplomatic_stance denmark england neutral
    console_command diplomatic_stance denmark spain neutral
    console_command diplomatic_stance denmark aragon neutral
    console_command diplomatic_stance denmark france neutral
    console_command diplomatic_stance denmark hre neutral
    console_command diplomatic_stance denmark norway neutral
    console_command diplomatic_stance denmark pisa neutral
    console_command diplomatic_stance denmark venice neutral
    console_command diplomatic_stance denmark papal_states neutral
    console_command diplomatic_stance denmark sicily neutral
    console_command diplomatic_stance denmark poland neutral
    console_command diplomatic_stance denmark hungary neutral
    console_command diplomatic_stance denmark teutonic_order neutral
    console_command diplomatic_stance denmark lithuania neutral  
    console_command diplomatic_stance denmark russia neutral
    console_command diplomatic_stance denmark kievan_rus neutral
    console_command diplomatic_stance denmark cumans neutral
    console_command diplomatic_stance denmark byzantium neutral
    console_command diplomatic_stance denmark rum neutral
    console_command diplomatic_stance denmark timurids neutral
    console_command diplomatic_stance denmark turks neutral
    console_command diplomatic_stance denmark milan neutral
    console_command diplomatic_stance denmark kwarezm neutral
    console_command diplomatic_stance denmark jerusalem neutral
    console_command diplomatic_stance denmark egypt neutral
    console_command diplomatic_stance denmark moors neutral
    console_command diplomatic_stance denmark mongols neutral
    
    historic_event New_Mindset_denmark
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType norway
  and IsFactionAIControlled

  if I_FactionLeaderTrait norway Factionleader > 1 
	 historic_event norway_king_event
  end_if
  
  if I_FactionLeaderTrait norway FactionRegent > 0 
	 historic_event norway_regent_event
  end_if

  if I_NumberOfSettlements norway < 4
  and I_NumberOfSettlements norway > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance norway scotland neutral
    console_command diplomatic_stance norway portugal neutral
    console_command diplomatic_stance norway england neutral
    console_command diplomatic_stance norway spain neutral
    console_command diplomatic_stance norway aragon neutral
    console_command diplomatic_stance norway france neutral
    console_command diplomatic_stance norway hre neutral
    console_command diplomatic_stance norway denmark neutral
    console_command diplomatic_stance norway pisa neutral
    console_command diplomatic_stance norway venice neutral
    console_command diplomatic_stance norway papal_states neutral
    console_command diplomatic_stance norway sicily neutral
    console_command diplomatic_stance norway poland neutral
    console_command diplomatic_stance norway hungary neutral
    console_command diplomatic_stance norway teutonic_order neutral
    console_command diplomatic_stance norway lithuania neutral  
    console_command diplomatic_stance norway russia neutral
    console_command diplomatic_stance norway kievan_rus neutral
    console_command diplomatic_stance norway cumans neutral
    console_command diplomatic_stance norway byzantium neutral
    console_command diplomatic_stance norway rum neutral
    console_command diplomatic_stance norway timurids neutral
    console_command diplomatic_stance norway turks neutral
    console_command diplomatic_stance norway milan neutral
    console_command diplomatic_stance norway kwarezm neutral
    console_command diplomatic_stance norway jerusalem neutral
    console_command diplomatic_stance norway egypt neutral
    console_command diplomatic_stance norway moors neutral
    console_command diplomatic_stance norway mongols neutral
    
    historic_event New_Mindset_norway
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType pisa
  and IsFactionAIControlled

  if I_FactionLeaderTrait pisa Factionleader > 1 
	 historic_event pisa_king_event
  end_if
  
  if I_FactionLeaderTrait pisa FactionRegent > 0 
	 historic_event pisa_regent_event
  end_if

  if I_NumberOfSettlements pisa < 4
  and I_NumberOfSettlements pisa > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance pisa scotland neutral
    console_command diplomatic_stance pisa portugal neutral
    console_command diplomatic_stance pisa england neutral
    console_command diplomatic_stance pisa spain neutral
    console_command diplomatic_stance pisa aragon neutral
    console_command diplomatic_stance pisa france neutral
    console_command diplomatic_stance pisa hre neutral
    console_command diplomatic_stance pisa denmark neutral
    console_command diplomatic_stance pisa norway neutral
    console_command diplomatic_stance pisa venice neutral
    console_command diplomatic_stance pisa papal_states neutral
    console_command diplomatic_stance pisa sicily neutral
    console_command diplomatic_stance pisa poland neutral
    console_command diplomatic_stance pisa hungary neutral
    console_command diplomatic_stance pisa teutonic_order neutral
    console_command diplomatic_stance pisa lithuania neutral  
    console_command diplomatic_stance pisa russia neutral
    console_command diplomatic_stance pisa kievan_rus neutral
    console_command diplomatic_stance pisa cumans neutral
    console_command diplomatic_stance pisa byzantium neutral
    console_command diplomatic_stance pisa rum neutral
    console_command diplomatic_stance pisa timurids neutral
    console_command diplomatic_stance pisa turks neutral
    console_command diplomatic_stance pisa milan neutral
    console_command diplomatic_stance pisa kwarezm neutral
    console_command diplomatic_stance pisa jerusalem neutral
    console_command diplomatic_stance pisa egypt neutral
    console_command diplomatic_stance pisa moors neutral
    console_command diplomatic_stance pisa mongols neutral
    
    historic_event New_Mindset_pisa
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType venice
  and IsFactionAIControlled

  if I_FactionLeaderTrait venice Factionleader > 1 
	 historic_event venice_king_event
  end_if
  
  if I_FactionLeaderTrait venice FactionRegent > 0 
	 historic_event venice_regent_event
  end_if

  if I_NumberOfSettlements venice < 4
  and I_NumberOfSettlements venice > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance venice scotland neutral
    console_command diplomatic_stance venice portugal neutral
    console_command diplomatic_stance venice england neutral
    console_command diplomatic_stance venice spain neutral
    console_command diplomatic_stance venice aragon neutral
    console_command diplomatic_stance venice france neutral
    console_command diplomatic_stance venice hre neutral
    console_command diplomatic_stance venice denmark neutral
    console_command diplomatic_stance venice norway neutral
    console_command diplomatic_stance venice pisa neutral
    console_command diplomatic_stance venice papal_states neutral
    console_command diplomatic_stance venice sicily neutral
    console_command diplomatic_stance venice poland neutral
    console_command diplomatic_stance venice hungary neutral
    console_command diplomatic_stance venice teutonic_order neutral
    console_command diplomatic_stance venice lithuania neutral  
    console_command diplomatic_stance venice russia neutral
    console_command diplomatic_stance venice kievan_rus neutral
    console_command diplomatic_stance venice cumans neutral
    console_command diplomatic_stance venice byzantium neutral
    console_command diplomatic_stance venice rum neutral
    console_command diplomatic_stance venice timurids neutral
    console_command diplomatic_stance venice turks neutral
    console_command diplomatic_stance venice milan neutral
    console_command diplomatic_stance venice kwarezm neutral
    console_command diplomatic_stance venice jerusalem neutral
    console_command diplomatic_stance venice egypt neutral
    console_command diplomatic_stance venice moors neutral
    console_command diplomatic_stance venice mongols neutral
    
    historic_event New_Mindset_venice
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType papal_states
  and IsFactionAIControlled

  if I_NumberOfSettlements papal_states < 4
  and I_NumberOfSettlements papal_states > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance papal_states scotland neutral
    console_command diplomatic_stance papal_states portugal neutral
    console_command diplomatic_stance papal_states england neutral
    console_command diplomatic_stance papal_states spain neutral
    console_command diplomatic_stance papal_states aragon neutral
    console_command diplomatic_stance papal_states france neutral
    console_command diplomatic_stance papal_states hre neutral
    console_command diplomatic_stance papal_states denmark neutral
    console_command diplomatic_stance papal_states norway neutral
    console_command diplomatic_stance papal_states pisa neutral
    console_command diplomatic_stance papal_states venice neutral
    console_command diplomatic_stance papal_states sicily neutral
    console_command diplomatic_stance papal_states poland neutral
    console_command diplomatic_stance papal_states hungary neutral
    console_command diplomatic_stance papal_states teutonic_order neutral
    console_command diplomatic_stance papal_states lithuania neutral  
    console_command diplomatic_stance papal_states russia neutral
    console_command diplomatic_stance papal_states kievan_rus neutral
    console_command diplomatic_stance papal_states cumans neutral
    console_command diplomatic_stance papal_states byzantium neutral
    console_command diplomatic_stance papal_states rum neutral
    console_command diplomatic_stance papal_states timurids neutral
    console_command diplomatic_stance papal_states turks neutral
    console_command diplomatic_stance papal_states milan neutral
    console_command diplomatic_stance papal_states kwarezm neutral
    console_command diplomatic_stance papal_states jerusalem neutral
    console_command diplomatic_stance papal_states egypt neutral
    console_command diplomatic_stance papal_states moors neutral
    console_command diplomatic_stance papal_states mongols neutral
    
    historic_event New_Mindset_papal_states
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType sicily
  and IsFactionAIControlled

  if I_FactionLeaderTrait sicily Factionleader > 1 
	 historic_event sicily_king_event
  end_if
  
  if I_FactionLeaderTrait sicily FactionRegent > 0 
	 historic_event sicily_regent_event
  end_if

  if I_NumberOfSettlements sicily < 4
  and I_NumberOfSettlements sicily > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance sicily scotland neutral
    console_command diplomatic_stance sicily portugal neutral
    console_command diplomatic_stance sicily england neutral
    console_command diplomatic_stance sicily spain neutral
    console_command diplomatic_stance sicily aragon neutral
    console_command diplomatic_stance sicily france neutral
    console_command diplomatic_stance sicily hre neutral
    console_command diplomatic_stance sicily denmark neutral
    console_command diplomatic_stance sicily norway neutral
    console_command diplomatic_stance sicily pisa neutral
    console_command diplomatic_stance sicily venice neutral
    console_command diplomatic_stance sicily papal_states neutral
    console_command diplomatic_stance sicily poland neutral
    console_command diplomatic_stance sicily hungary neutral
    console_command diplomatic_stance sicily teutonic_order neutral
    console_command diplomatic_stance sicily lithuania neutral  
    console_command diplomatic_stance sicily russia neutral
    console_command diplomatic_stance sicily kievan_rus neutral
    console_command diplomatic_stance sicily cumans neutral
    console_command diplomatic_stance sicily byzantium neutral
    console_command diplomatic_stance sicily rum neutral
    console_command diplomatic_stance sicily timurids neutral
    console_command diplomatic_stance sicily turks neutral
    console_command diplomatic_stance sicily milan neutral
    console_command diplomatic_stance sicily kwarezm neutral
    console_command diplomatic_stance sicily jerusalem neutral
    console_command diplomatic_stance sicily egypt neutral
    console_command diplomatic_stance sicily moors neutral
    console_command diplomatic_stance sicily mongols neutral
    
    historic_event New_Mindset_sicily
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType poland
  and IsFactionAIControlled

  if I_FactionLeaderTrait poland Factionleader > 1 
	 historic_event poland_king_event
  end_if
  
  if I_FactionLeaderTrait poland FactionRegent > 0 
	 historic_event poland_regent_event
  end_if

  if I_NumberOfSettlements poland < 4
  and I_NumberOfSettlements poland > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance poland scotland neutral
    console_command diplomatic_stance poland portugal neutral
    console_command diplomatic_stance poland england neutral
    console_command diplomatic_stance poland spain neutral
    console_command diplomatic_stance poland aragon neutral
    console_command diplomatic_stance poland france neutral
    console_command diplomatic_stance poland hre neutral
    console_command diplomatic_stance poland denmark neutral
    console_command diplomatic_stance poland norway neutral
    console_command diplomatic_stance poland pisa neutral
    console_command diplomatic_stance poland venice neutral
    console_command diplomatic_stance poland papal_states neutral
    console_command diplomatic_stance poland sicily neutral
    console_command diplomatic_stance poland hungary neutral
    console_command diplomatic_stance poland teutonic_order neutral
    console_command diplomatic_stance poland lithuania neutral  
    console_command diplomatic_stance poland russia neutral
    console_command diplomatic_stance poland kievan_rus neutral
    console_command diplomatic_stance poland cumans neutral
    console_command diplomatic_stance poland byzantium neutral
    console_command diplomatic_stance poland rum neutral
    console_command diplomatic_stance poland timurids neutral
    console_command diplomatic_stance poland turks neutral
    console_command diplomatic_stance poland milan neutral
    console_command diplomatic_stance poland kwarezm neutral
    console_command diplomatic_stance poland jerusalem neutral
    console_command diplomatic_stance poland egypt neutral
    console_command diplomatic_stance poland moors neutral
    console_command diplomatic_stance poland mongols neutral
    
    historic_event New_Mindset_poland
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType hungary
  and IsFactionAIControlled

  if I_FactionLeaderTrait hungary Factionleader > 1 
	 historic_event hungary_king_event
  end_if
  
  if I_FactionLeaderTrait hungary FactionRegent > 0 
	 historic_event hungary_regent_event
  end_if

  if I_NumberOfSettlements hungary < 4
  and I_NumberOfSettlements hungary > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance hungary scotland neutral
    console_command diplomatic_stance hungary portugal neutral
    console_command diplomatic_stance hungary england neutral
    console_command diplomatic_stance hungary spain neutral
    console_command diplomatic_stance hungary aragon neutral
    console_command diplomatic_stance hungary france neutral
    console_command diplomatic_stance hungary hre neutral
    console_command diplomatic_stance hungary denmark neutral
    console_command diplomatic_stance hungary norway neutral
    console_command diplomatic_stance hungary pisa neutral
    console_command diplomatic_stance hungary venice neutral
    console_command diplomatic_stance hungary papal_states neutral
    console_command diplomatic_stance hungary sicily neutral
    console_command diplomatic_stance hungary poland neutral
    console_command diplomatic_stance hungary teutonic_order neutral
    console_command diplomatic_stance hungary lithuania neutral  
    console_command diplomatic_stance hungary russia neutral
    console_command diplomatic_stance hungary kievan_rus neutral
    console_command diplomatic_stance hungary cumans neutral
    console_command diplomatic_stance hungary byzantium neutral
    console_command diplomatic_stance hungary rum neutral
    console_command diplomatic_stance hungary timurids neutral
    console_command diplomatic_stance hungary turks neutral
    console_command diplomatic_stance hungary milan neutral
    console_command diplomatic_stance hungary kwarezm neutral
    console_command diplomatic_stance hungary jerusalem neutral
    console_command diplomatic_stance hungary egypt neutral
    console_command diplomatic_stance hungary moors neutral
    console_command diplomatic_stance hungary mongols neutral
    
    historic_event New_Mindset_hungary
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType teutonic_order
  and IsFactionAIControlled

  if I_FactionLeaderTrait teutonic_order Factionleader > 1 
	 historic_event teutonic_order_king_event
  end_if
  
  if I_FactionLeaderTrait teutonic_order FactionRegent > 0 
	 historic_event teutonic_order_regent_event
  end_if

  if I_NumberOfSettlements teutonic_order < 4
  and I_NumberOfSettlements teutonic_order > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance teutonic_order scotland neutral
    console_command diplomatic_stance teutonic_order portugal neutral
    console_command diplomatic_stance teutonic_order england neutral
    console_command diplomatic_stance teutonic_order spain neutral
    console_command diplomatic_stance teutonic_order aragon neutral
    console_command diplomatic_stance teutonic_order france neutral
    console_command diplomatic_stance teutonic_order hre neutral
    console_command diplomatic_stance teutonic_order denmark neutral
    console_command diplomatic_stance teutonic_order norway neutral
    console_command diplomatic_stance teutonic_order pisa neutral
    console_command diplomatic_stance teutonic_order venice neutral
    console_command diplomatic_stance teutonic_order papal_states neutral
    console_command diplomatic_stance teutonic_order sicily neutral
    console_command diplomatic_stance teutonic_order poland neutral
    console_command diplomatic_stance teutonic_order hungary neutral
    console_command diplomatic_stance teutonic_order lithuania neutral  
    console_command diplomatic_stance teutonic_order russia neutral
    console_command diplomatic_stance teutonic_order kievan_rus neutral
    console_command diplomatic_stance teutonic_order cumans neutral
    console_command diplomatic_stance teutonic_order byzantium neutral
    console_command diplomatic_stance teutonic_order rum neutral
    console_command diplomatic_stance teutonic_order timurids neutral
    console_command diplomatic_stance teutonic_order turks neutral
    console_command diplomatic_stance teutonic_order milan neutral
    console_command diplomatic_stance teutonic_order kwarezm neutral
    console_command diplomatic_stance teutonic_order jerusalem neutral
    console_command diplomatic_stance teutonic_order egypt neutral
    console_command diplomatic_stance teutonic_order moors neutral
    console_command diplomatic_stance teutonic_order mongols neutral
    
    historic_event New_Mindset_teutonic_order
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType lithuania
  and IsFactionAIControlled

  if I_FactionLeaderTrait lithuania Factionleader > 1 
	 historic_event lithuania_king_event
  end_if
  
  if I_FactionLeaderTrait lithuania FactionRegent > 0 
	 historic_event lithuania_regent_event
  end_if

  if I_NumberOfSettlements lithuania < 4
  and I_NumberOfSettlements lithuania > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance lithuania scotland neutral
    console_command diplomatic_stance lithuania portugal neutral
    console_command diplomatic_stance lithuania england neutral
    console_command diplomatic_stance lithuania spain neutral
    console_command diplomatic_stance lithuania aragon neutral
    console_command diplomatic_stance lithuania france neutral
    console_command diplomatic_stance lithuania hre neutral
    console_command diplomatic_stance lithuania denmark neutral
    console_command diplomatic_stance lithuania norway neutral
    console_command diplomatic_stance lithuania pisa neutral
    console_command diplomatic_stance lithuania venice neutral
    console_command diplomatic_stance lithuania papal_states neutral
    console_command diplomatic_stance lithuania sicily neutral
    console_command diplomatic_stance lithuania poland neutral
    console_command diplomatic_stance lithuania hungary neutral
    console_command diplomatic_stance lithuania teutonic_order neutral  
    console_command diplomatic_stance lithuania russia neutral
    console_command diplomatic_stance lithuania kievan_rus neutral
    console_command diplomatic_stance lithuania cumans neutral
    console_command diplomatic_stance lithuania byzantium neutral
    console_command diplomatic_stance lithuania rum neutral
    console_command diplomatic_stance lithuania timurids neutral
    console_command diplomatic_stance lithuania turks neutral
    console_command diplomatic_stance lithuania milan neutral
    console_command diplomatic_stance lithuania kwarezm neutral
    console_command diplomatic_stance lithuania jerusalem neutral
    console_command diplomatic_stance lithuania egypt neutral
    console_command diplomatic_stance lithuania moors neutral
    console_command diplomatic_stance lithuania mongols neutral
    
    historic_event New_Mindset_lithuania
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType russia
  and IsFactionAIControlled

  if I_FactionLeaderTrait russia Factionleader > 1 
	 historic_event russia_king_event
  end_if
  
  if I_FactionLeaderTrait russia FactionRegent > 0 
	 historic_event russia_regent_event
  end_if

  if I_NumberOfSettlements russia < 4
  and I_NumberOfSettlements russia > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance russia scotland neutral
    console_command diplomatic_stance russia portugal neutral
    console_command diplomatic_stance russia england neutral
    console_command diplomatic_stance russia spain neutral
    console_command diplomatic_stance russia aragon neutral
    console_command diplomatic_stance russia france neutral
    console_command diplomatic_stance russia hre neutral
    console_command diplomatic_stance russia denmark neutral
    console_command diplomatic_stance russia norway neutral
    console_command diplomatic_stance russia pisa neutral
    console_command diplomatic_stance russia venice neutral
    console_command diplomatic_stance russia papal_states neutral
    console_command diplomatic_stance russia sicily neutral
    console_command diplomatic_stance russia poland neutral
    console_command diplomatic_stance russia hungary neutral
    console_command diplomatic_stance russia teutonic_order neutral  
    console_command diplomatic_stance russia lithuania neutral
    console_command diplomatic_stance russia kievan_rus neutral
    console_command diplomatic_stance russia cumans neutral
    console_command diplomatic_stance russia byzantium neutral
    console_command diplomatic_stance russia rum neutral
    console_command diplomatic_stance russia timurids neutral
    console_command diplomatic_stance russia turks neutral
    console_command diplomatic_stance russia milan neutral
    console_command diplomatic_stance russia kwarezm neutral
    console_command diplomatic_stance russia jerusalem neutral
    console_command diplomatic_stance russia egypt neutral
    console_command diplomatic_stance russia moors neutral
    console_command diplomatic_stance russia mongols neutral
    
    historic_event New_Mindset_russia
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType kievan_rus
  and IsFactionAIControlled

  if I_FactionLeaderTrait kievan_rus Factionleader > 1 
	 historic_event kievan_rus_king_event
  end_if
  
  if I_FactionLeaderTrait kievan_rus FactionRegent > 0 
	 historic_event kievan_rus_regent_event
  end_if

  if I_NumberOfSettlements kievan_rus < 4
  and I_NumberOfSettlements kievan_rus > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance kievan_rus scotland neutral
    console_command diplomatic_stance kievan_rus portugal neutral
    console_command diplomatic_stance kievan_rus england neutral
    console_command diplomatic_stance kievan_rus spain neutral
    console_command diplomatic_stance kievan_rus aragon neutral
    console_command diplomatic_stance kievan_rus france neutral
    console_command diplomatic_stance kievan_rus hre neutral
    console_command diplomatic_stance kievan_rus denmark neutral
    console_command diplomatic_stance kievan_rus norway neutral
    console_command diplomatic_stance kievan_rus pisa neutral
    console_command diplomatic_stance kievan_rus venice neutral
    console_command diplomatic_stance kievan_rus papal_states neutral
    console_command diplomatic_stance kievan_rus sicily neutral
    console_command diplomatic_stance kievan_rus poland neutral
    console_command diplomatic_stance kievan_rus hungary neutral
    console_command diplomatic_stance kievan_rus teutonic_order neutral  
    console_command diplomatic_stance kievan_rus lithuania neutral
    console_command diplomatic_stance kievan_rus russia neutral
    console_command diplomatic_stance kievan_rus cumans neutral
    console_command diplomatic_stance kievan_rus byzantium neutral
    console_command diplomatic_stance kievan_rus rum neutral
    console_command diplomatic_stance kievan_rus timurids neutral
    console_command diplomatic_stance kievan_rus turks neutral
    console_command diplomatic_stance kievan_rus milan neutral
    console_command diplomatic_stance kievan_rus kwarezm neutral
    console_command diplomatic_stance kievan_rus jerusalem neutral
    console_command diplomatic_stance kievan_rus egypt neutral
    console_command diplomatic_stance kievan_rus moors neutral
    console_command diplomatic_stance kievan_rus mongols neutral
    
    historic_event New_Mindset_kievan_rus
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType cumans
  and IsFactionAIControlled

  if I_FactionLeaderTrait cumans Factionleader > 1 
	 historic_event cumans_king_event
  end_if
  
  if I_FactionLeaderTrait cumans FactionRegent > 0 
	 historic_event cumans_regent_event
  end_if

  if I_NumberOfSettlements cumans < 4
  and I_NumberOfSettlements cumans > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance cumans scotland neutral
    console_command diplomatic_stance cumans portugal neutral
    console_command diplomatic_stance cumans england neutral
    console_command diplomatic_stance cumans spain neutral
    console_command diplomatic_stance cumans aragon neutral
    console_command diplomatic_stance cumans france neutral
    console_command diplomatic_stance cumans hre neutral
    console_command diplomatic_stance cumans denmark neutral
    console_command diplomatic_stance cumans norway neutral
    console_command diplomatic_stance cumans pisa neutral
    console_command diplomatic_stance cumans venice neutral
    console_command diplomatic_stance cumans papal_states neutral
    console_command diplomatic_stance cumans sicily neutral
    console_command diplomatic_stance cumans poland neutral
    console_command diplomatic_stance cumans hungary neutral
    console_command diplomatic_stance cumans teutonic_order neutral  
    console_command diplomatic_stance cumans lithuania neutral
    console_command diplomatic_stance cumans russia neutral
    console_command diplomatic_stance cumans kievan_rus neutral
    console_command diplomatic_stance cumans byzantium neutral
    console_command diplomatic_stance cumans rum neutral
    console_command diplomatic_stance cumans timurids neutral
    console_command diplomatic_stance cumans turks neutral
    console_command diplomatic_stance cumans milan neutral
    console_command diplomatic_stance cumans kwarezm neutral
    console_command diplomatic_stance cumans jerusalem neutral
    console_command diplomatic_stance cumans egypt neutral
    console_command diplomatic_stance cumans moors neutral
    console_command diplomatic_stance cumans mongols neutral
    
    historic_event New_Mindset_cumans
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType byzantium
  and IsFactionAIControlled

  if I_FactionLeaderTrait byzantium Factionleader > 1 
	 historic_event byzantium_king_event
  end_if
  
  if I_FactionLeaderTrait byzantium FactionRegent > 0 
	 historic_event byzantium_regent_event
  end_if

  if I_NumberOfSettlements byzantium < 4
  and I_NumberOfSettlements byzantium > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance byzantium scotland neutral
    console_command diplomatic_stance byzantium portugal neutral
    console_command diplomatic_stance byzantium england neutral
    console_command diplomatic_stance byzantium spain neutral
    console_command diplomatic_stance byzantium aragon neutral
    console_command diplomatic_stance byzantium france neutral
    console_command diplomatic_stance byzantium hre neutral
    console_command diplomatic_stance byzantium denmark neutral
    console_command diplomatic_stance byzantium norway neutral
    console_command diplomatic_stance byzantium pisa neutral
    console_command diplomatic_stance byzantium venice neutral
    console_command diplomatic_stance byzantium papal_states neutral
    console_command diplomatic_stance byzantium sicily neutral
    console_command diplomatic_stance byzantium poland neutral
    console_command diplomatic_stance byzantium hungary neutral
    console_command diplomatic_stance byzantium teutonic_order neutral  
    console_command diplomatic_stance byzantium lithuania neutral
    console_command diplomatic_stance byzantium russia neutral
    console_command diplomatic_stance byzantium kievan_rus neutral
    console_command diplomatic_stance byzantium cumans neutral
    console_command diplomatic_stance byzantium rum neutral
    console_command diplomatic_stance byzantium timurids neutral
    console_command diplomatic_stance byzantium turks neutral
    console_command diplomatic_stance byzantium milan neutral
    console_command diplomatic_stance byzantium kwarezm neutral
    console_command diplomatic_stance byzantium jerusalem neutral
    console_command diplomatic_stance byzantium egypt neutral
    console_command diplomatic_stance byzantium moors neutral
    console_command diplomatic_stance byzantium mongols neutral
    
    historic_event New_Mindset_byzantium
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType rum
  and IsFactionAIControlled

  if I_FactionLeaderTrait rum Factionleader > 1 
	 historic_event rum_king_event
  end_if
  
  if I_FactionLeaderTrait rum FactionRegent > 0 
	 historic_event rum_regent_event
  end_if

  if I_NumberOfSettlements rum < 4
  and I_NumberOfSettlements rum > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance rum scotland neutral
    console_command diplomatic_stance rum portugal neutral
    console_command diplomatic_stance rum england neutral
    console_command diplomatic_stance rum spain neutral
    console_command diplomatic_stance rum aragon neutral
    console_command diplomatic_stance rum france neutral
    console_command diplomatic_stance rum hre neutral
    console_command diplomatic_stance rum denmark neutral
    console_command diplomatic_stance rum norway neutral
    console_command diplomatic_stance rum pisa neutral
    console_command diplomatic_stance rum venice neutral
    console_command diplomatic_stance rum papal_states neutral
    console_command diplomatic_stance rum sicily neutral
    console_command diplomatic_stance rum poland neutral
    console_command diplomatic_stance rum hungary neutral
    console_command diplomatic_stance rum teutonic_order neutral  
    console_command diplomatic_stance rum lithuania neutral
    console_command diplomatic_stance rum russia neutral
    console_command diplomatic_stance rum kievan_rus neutral
    console_command diplomatic_stance rum cumans neutral
    console_command diplomatic_stance rum byzantium neutral
    console_command diplomatic_stance rum timurids neutral
    console_command diplomatic_stance rum turks neutral
    console_command diplomatic_stance rum milan neutral
    console_command diplomatic_stance rum kwarezm neutral
    console_command diplomatic_stance rum jerusalem neutral
    console_command diplomatic_stance rum egypt neutral
    console_command diplomatic_stance rum moors neutral
    console_command diplomatic_stance rum mongols neutral
    
    historic_event New_Mindset_rum
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType turks
  and IsFactionAIControlled

  if I_FactionLeaderTrait turks Factionleader > 1 
	 historic_event turks_king_event
  end_if
  
  if I_FactionLeaderTrait turks FactionRegent > 0 
	 historic_event turks_regent_event
  end_if

  if I_NumberOfSettlements turks < 4
  and I_NumberOfSettlements turks > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance turks scotland neutral
    console_command diplomatic_stance turks portugal neutral
    console_command diplomatic_stance turks england neutral
    console_command diplomatic_stance turks spain neutral
    console_command diplomatic_stance turks aragon neutral
    console_command diplomatic_stance turks france neutral
    console_command diplomatic_stance turks hre neutral
    console_command diplomatic_stance turks denmark neutral
    console_command diplomatic_stance turks norway neutral
    console_command diplomatic_stance turks pisa neutral
    console_command diplomatic_stance turks venice neutral
    console_command diplomatic_stance turks papal_states neutral
    console_command diplomatic_stance turks sicily neutral
    console_command diplomatic_stance turks poland neutral
    console_command diplomatic_stance turks hungary neutral
    console_command diplomatic_stance turks teutonic_order neutral  
    console_command diplomatic_stance turks lithuania neutral
    console_command diplomatic_stance turks russia neutral
    console_command diplomatic_stance turks kievan_rus neutral
    console_command diplomatic_stance turks cumans neutral
    console_command diplomatic_stance turks byzantium neutral
    console_command diplomatic_stance turks timurids neutral
    console_command diplomatic_stance turks rum neutral
    console_command diplomatic_stance turks milan neutral
    console_command diplomatic_stance turks kwarezm neutral
    console_command diplomatic_stance turks jerusalem neutral
    console_command diplomatic_stance turks egypt neutral
    console_command diplomatic_stance turks moors neutral
    console_command diplomatic_stance turks mongols neutral
    
    historic_event New_Mindset_turks
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType timurids
  and IsFactionAIControlled

  if I_FactionLeaderTrait timurids Factionleader > 1 
	 historic_event timurids_king_event
  end_if
  
  if I_FactionLeaderTrait timurids FactionRegent > 0 
	 historic_event timurids_regent_event
  end_if

  if I_NumberOfSettlements timurids < 4
  and I_NumberOfSettlements timurids > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance timurids scotland neutral
    console_command diplomatic_stance timurids portugal neutral
    console_command diplomatic_stance timurids england neutral
    console_command diplomatic_stance timurids spain neutral
    console_command diplomatic_stance timurids aragon neutral
    console_command diplomatic_stance timurids france neutral
    console_command diplomatic_stance timurids hre neutral
    console_command diplomatic_stance timurids denmark neutral
    console_command diplomatic_stance timurids norway neutral
    console_command diplomatic_stance timurids pisa neutral
    console_command diplomatic_stance timurids venice neutral
    console_command diplomatic_stance timurids papal_states neutral
    console_command diplomatic_stance timurids sicily neutral
    console_command diplomatic_stance timurids poland neutral
    console_command diplomatic_stance timurids hungary neutral
    console_command diplomatic_stance timurids teutonic_order neutral  
    console_command diplomatic_stance timurids lithuania neutral
    console_command diplomatic_stance timurids russia neutral
    console_command diplomatic_stance timurids kievan_rus neutral
    console_command diplomatic_stance timurids cumans neutral
    console_command diplomatic_stance timurids byzantium neutral
    console_command diplomatic_stance timurids turks neutral
    console_command diplomatic_stance timurids rum neutral
    console_command diplomatic_stance timurids milan neutral
    console_command diplomatic_stance timurids kwarezm neutral
    console_command diplomatic_stance timurids jerusalem neutral
    console_command diplomatic_stance timurids egypt neutral
    console_command diplomatic_stance timurids moors neutral
    console_command diplomatic_stance timurids mongols neutral
    
    historic_event New_Mindset_timurids
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType milan
  and IsFactionAIControlled

  if I_FactionLeaderTrait milan Factionleader > 1 
	 historic_event milan_king_event
  end_if
  
  if I_FactionLeaderTrait milan FactionRegent > 0 
	 historic_event milan_regent_event
  end_if

  if I_NumberOfSettlements milan < 4
  and I_NumberOfSettlements milan > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance milan scotland neutral
    console_command diplomatic_stance milan portugal neutral
    console_command diplomatic_stance milan england neutral
    console_command diplomatic_stance milan spain neutral
    console_command diplomatic_stance milan aragon neutral
    console_command diplomatic_stance milan france neutral
    console_command diplomatic_stance milan hre neutral
    console_command diplomatic_stance milan denmark neutral
    console_command diplomatic_stance milan norway neutral
    console_command diplomatic_stance milan pisa neutral
    console_command diplomatic_stance milan venice neutral
    console_command diplomatic_stance milan papal_states neutral
    console_command diplomatic_stance milan sicily neutral
    console_command diplomatic_stance milan poland neutral
    console_command diplomatic_stance milan hungary neutral
    console_command diplomatic_stance milan teutonic_order neutral  
    console_command diplomatic_stance milan lithuania neutral
    console_command diplomatic_stance milan russia neutral
    console_command diplomatic_stance milan kievan_rus neutral
    console_command diplomatic_stance milan cumans neutral
    console_command diplomatic_stance milan byzantium neutral
    console_command diplomatic_stance milan turks neutral
    console_command diplomatic_stance milan rum neutral
    console_command diplomatic_stance milan timurids neutral
    console_command diplomatic_stance milan kwarezm neutral
    console_command diplomatic_stance milan jerusalem neutral
    console_command diplomatic_stance milan egypt neutral
    console_command diplomatic_stance milan moors neutral
    console_command diplomatic_stance milan mongols neutral
    
    historic_event New_Mindset_milan
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType kwarezm
  and IsFactionAIControlled

  if I_FactionLeaderTrait kwarezm Factionleader > 1 
	 historic_event kwarezm_king_event
  end_if
  
  if I_FactionLeaderTrait kwarezm FactionRegent > 0 
	 historic_event kwarezm_regent_event
  end_if

  if I_NumberOfSettlements kwarezm < 4
  and I_NumberOfSettlements kwarezm > 0
  and RandomPercent > 50
  and I_TurnNumber > 25
    console_command diplomatic_stance kwarezm scotland neutral
    console_command diplomatic_stance kwarezm portugal neutral
    console_command diplomatic_stance kwarezm england neutral
    console_command diplomatic_stance kwarezm spain neutral
    console_command diplomatic_stance kwarezm aragon neutral
    console_command diplomatic_stance kwarezm france neutral
    console_command diplomatic_stance kwarezm hre neutral
    console_command diplomatic_stance kwarezm denmark neutral
    console_command diplomatic_stance kwarezm norway neutral
    console_command diplomatic_stance kwarezm pisa neutral
    console_command diplomatic_stance kwarezm venice neutral
    console_command diplomatic_stance kwarezm papal_states neutral
    console_command diplomatic_stance kwarezm sicily neutral
    console_command diplomatic_stance kwarezm poland neutral
    console_command diplomatic_stance kwarezm hungary neutral
    console_command diplomatic_stance kwarezm teutonic_order neutral  
    console_command diplomatic_stance kwarezm lithuania neutral
    console_command diplomatic_stance kwarezm russia neutral
    console_command diplomatic_stance kwarezm kievan_rus neutral
    console_command diplomatic_stance kwarezm cumans neutral
    console_command diplomatic_stance kwarezm byzantium neutral
    console_command diplomatic_stance kwarezm turks neutral
    console_command diplomatic_stance kwarezm rum neutral
    console_command diplomatic_stance kwarezm timurids neutral
    console_command diplomatic_stance kwarezm milan neutral
    console_command diplomatic_stance kwarezm jerusalem neutral
    console_command diplomatic_stance kwarezm egypt neutral
    console_command diplomatic_stance kwarezm moors neutral
    console_command diplomatic_stance kwarezm mongols neutral
    
    historic_event New_Mindset_kwarezm
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType jerusalem
  and IsFactionAIControlled

  if I_FactionLeaderTrait jerusalem Factionleader > 1 
	 historic_event jerusalem_king_event
  end_if
  
  if I_FactionLeaderTrait jerusalem FactionRegent > 0 
	 historic_event jerusalem_regent_event
  end_if

  if I_NumberOfSettlements jerusalem < 4
  and I_NumberOfSettlements jerusalem > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance jerusalem scotland neutral
    console_command diplomatic_stance jerusalem portugal neutral
    console_command diplomatic_stance jerusalem england neutral
    console_command diplomatic_stance jerusalem spain neutral
    console_command diplomatic_stance jerusalem aragon neutral
    console_command diplomatic_stance jerusalem france neutral
    console_command diplomatic_stance jerusalem hre neutral
    console_command diplomatic_stance jerusalem denmark neutral
    console_command diplomatic_stance jerusalem norway neutral
    console_command diplomatic_stance jerusalem pisa neutral
    console_command diplomatic_stance jerusalem venice neutral
    console_command diplomatic_stance jerusalem papal_states neutral
    console_command diplomatic_stance jerusalem sicily neutral
    console_command diplomatic_stance jerusalem poland neutral
    console_command diplomatic_stance jerusalem hungary neutral
    console_command diplomatic_stance jerusalem teutonic_order neutral  
    console_command diplomatic_stance jerusalem lithuania neutral
    console_command diplomatic_stance jerusalem russia neutral
    console_command diplomatic_stance jerusalem kievan_rus neutral
    console_command diplomatic_stance jerusalem cumans neutral
    console_command diplomatic_stance jerusalem byzantium neutral
    console_command diplomatic_stance jerusalem turks neutral
    console_command diplomatic_stance jerusalem rum neutral
    console_command diplomatic_stance jerusalem timurids neutral
    console_command diplomatic_stance jerusalem milan neutral
    console_command diplomatic_stance jerusalem kwarezm neutral
    console_command diplomatic_stance jerusalem egypt neutral
    console_command diplomatic_stance jerusalem moors neutral
    console_command diplomatic_stance jerusalem mongols neutral
    
    historic_event New_Mindset_jerusalem
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType egypt
  and IsFactionAIControlled

  if I_FactionLeaderTrait egypt Factionleader > 1 
	 historic_event egypt_king_event
  end_if
  
  if I_FactionLeaderTrait egypt FactionRegent > 0 
	 historic_event egypt_regent_event
  end_if

  if I_NumberOfSettlements egypt < 4
  and I_NumberOfSettlements egypt > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance egypt scotland neutral
    console_command diplomatic_stance egypt portugal neutral
    console_command diplomatic_stance egypt england neutral
    console_command diplomatic_stance egypt spain neutral
    console_command diplomatic_stance egypt aragon neutral
    console_command diplomatic_stance egypt france neutral
    console_command diplomatic_stance egypt hre neutral
    console_command diplomatic_stance egypt denmark neutral
    console_command diplomatic_stance egypt norway neutral
    console_command diplomatic_stance egypt pisa neutral
    console_command diplomatic_stance egypt venice neutral
    console_command diplomatic_stance egypt papal_states neutral
    console_command diplomatic_stance egypt sicily neutral
    console_command diplomatic_stance egypt poland neutral
    console_command diplomatic_stance egypt hungary neutral
    console_command diplomatic_stance egypt teutonic_order neutral  
    console_command diplomatic_stance egypt lithuania neutral
    console_command diplomatic_stance egypt russia neutral
    console_command diplomatic_stance egypt kievan_rus neutral
    console_command diplomatic_stance egypt cumans neutral
    console_command diplomatic_stance egypt byzantium neutral
    console_command diplomatic_stance egypt turks neutral
    console_command diplomatic_stance egypt rum neutral
    console_command diplomatic_stance egypt timurids neutral
    console_command diplomatic_stance egypt milan neutral
    console_command diplomatic_stance egypt kwarezm neutral
    console_command diplomatic_stance egypt jerusalem neutral
    console_command diplomatic_stance egypt moors neutral
    console_command diplomatic_stance egypt mongols neutral
    
    historic_event New_Mindset_egypt
  end_if
  
end_monitor


monitor_event BecomesFactionLeader FactionType moors
  and IsFactionAIControlled

  if I_FactionLeaderTrait moors Factionleader > 1 
	 historic_event moors_king_event
  end_if
  
  if I_FactionLeaderTrait moors FactionRegent > 0 
	 historic_event moors_regent_event
  end_if

  if I_NumberOfSettlements moors < 4
  and I_NumberOfSettlements moors > 0
  and RandomPercent > 75
  and I_TurnNumber > 25
    console_command diplomatic_stance moors scotland neutral
    console_command diplomatic_stance moors portugal neutral
    console_command diplomatic_stance moors england neutral
    console_command diplomatic_stance moors spain neutral
    console_command diplomatic_stance moors aragon neutral
    console_command diplomatic_stance moors france neutral
    console_command diplomatic_stance moors hre neutral
    console_command diplomatic_stance moors denmark neutral
    console_command diplomatic_stance moors norway neutral
    console_command diplomatic_stance moors pisa neutral
    console_command diplomatic_stance moors venice neutral
    console_command diplomatic_stance moors papal_states neutral
    console_command diplomatic_stance moors sicily neutral
    console_command diplomatic_stance moors poland neutral
    console_command diplomatic_stance moors hungary neutral
    console_command diplomatic_stance moors teutonic_order neutral  
    console_command diplomatic_stance moors lithuania neutral
    console_command diplomatic_stance moors russia neutral
    console_command diplomatic_stance moors kievan_rus neutral
    console_command diplomatic_stance moors cumans neutral
    console_command diplomatic_stance moors byzantium neutral
    console_command diplomatic_stance moors turks neutral
    console_command diplomatic_stance moors rum neutral
    console_command diplomatic_stance moors timurids neutral
    console_command diplomatic_stance moors milan neutral
    console_command diplomatic_stance moors kwarezm neutral
    console_command diplomatic_stance moors jerusalem neutral
    console_command diplomatic_stance moors egypt neutral
    console_command diplomatic_stance moors mongols neutral
    
    historic_event New_Mindset_moors
  end_if
  
end_monitor



;================= Interactive Events ===================
;--- Great Trade Fair 
monitor_event FactionTurnStart not IsFactionAIControlled
	and FactionBuildingExists > fairground
	and RandomPercent < 9
  and Treasury > 5000

	historic_event great_fair true

end_monitor

monitor_event EventCounter EventCounterType great_fair_accepted
	and EventCounter = 1
  
  console_command add_money -2500
  
  set_event_counter great_fair_true 1 
	set_event_counter great_fair_accepted 0
end_monitor       

monitor_event EventCounter EventCounterType great_fair_declined
	and EventCounter = 1
    
  set_event_counter great_fair_false 1 
	set_event_counter great_fair_declined 0
end_monitor       

monitor_event PreFactionTurnStart not IsFactionAIControlled

  if I_EventCounter great_fair_true 1  
    set_event_counter great_fair_true 0
  end_if
  
  if I_EventCounter great_fair_false 1  
    set_event_counter great_fair_false 0
  end_if
end_monitor

;--- Great Tourney 
monitor_event FactionTurnStart not IsFactionAIControlled
	and FactionBuildingExists > jousting_lists
	and RandomPercent < 7

	historic_event great_tourney true

end_monitor

monitor_event EventCounter EventCounterType great_tourney_accepted
	and EventCounter = 1
  
  console_command add_money -3000
  
	set_event_counter great_tourney_true 1
	set_event_counter great_tourney_accepted 0
end_monitor       

monitor_event EventCounter EventCounterType great_tourney_declined
	and EventCounter = 1
    
  set_event_counter great_tourney_false 1 
	set_event_counter great_tourney_declined 0
end_monitor       

monitor_event PreFactionTurnStart not IsFactionAIControlled

  if I_EventCounter great_tourney_true = 1  
    set_event_counter great_tourney_true 0
  end_if
  
  if I_EventCounter great_tourney_false = 1  
    set_event_counter great_tourney_false 0
  end_if  
end_monitor

;--- Troubadours
monitor_event FactionTurnStart not IsFactionAIControlled
	and FactionBuildingExists > town_hall
	and RandomPercent < 5
	and I_TurnNumber > 100

	historic_event troubadours_event true

end_monitor

monitor_event EventCounter EventCounterType troubadours_event_accepted
	and EventCounter = 1
  
  console_command add_money -1000
  
	set_event_counter troubadours_event_true 1
	set_event_counter troubadours_event_accepted 0
end_monitor       

monitor_event EventCounter EventCounterType troubadours_event_declined
	and EventCounter = 1
    
  set_event_counter troubadours_event_false 1 
	set_event_counter troubadours_event_declined 0
end_monitor       

monitor_event PreFactionTurnStart not IsFactionAIControlled

  if I_EventCounter troubadours_event_true = 1  
    set_event_counter troubadours_event_true 0
  end_if
  
  if I_EventCounter troubadours_event_false = 1  
    set_event_counter troubadours_event_false 0
  end_if  
end_monitor

;--- Great Councils
declare_counter had_council
set_counter had_council 0

monitor_event EventCounter EventCounterType council_of_clermont
	and EventCounter > 0
	set_counter had_council  1
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType lateran_council1
	and EventCounter > 0
	set_counter had_council  1
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType lateran_council2
	and EventCounter > 0
	set_counter had_council  1
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType lateran_council3
	and EventCounter > 0
	set_counter had_council  1
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType lateran_council4
	and EventCounter > 0
	set_counter had_council  1
terminate_monitor
end_monitor

monitor_event FactionTurnStart not IsFactionAIControlled
	and not FactionReligion islam
	and not FactionReligion pagan
	and I_CompareCounter had_council  1

	historic_event great_council true
	set_counter had_council  0

end_monitor

monitor_event EventCounter EventCounterType great_council_accepted
	and EventCounter = 1
  
  console_command add_money -1500
  
	set_event_counter great_council_true 1
	set_event_counter great_council_accepted 0
end_monitor       

monitor_event EventCounter EventCounterType great_council_declined
	and EventCounter = 1
    
  set_event_counter great_council_false 1 
	set_event_counter great_council_declined 0
end_monitor       

monitor_event PreFactionTurnStart not IsFactionAIControlled

  if I_EventCounter great_council_true = 1  
    set_event_counter great_council_true 0
  end_if
  
  if I_EventCounter great_council_false = 1  
    set_event_counter great_council_false 0
  end_if  
end_monitor

;--- Pirates
monitor_event FactionTurnStart not IsFactionAIControlled
	and Treasury > 25000
	and RandomPercent < 10
	and FactionBuildingExists >= port
	and I_TurnNumber > 20

	historic_event pirates true

end_monitor

monitor_event EventCounter EventCounterType pirates_accepted
	and EventCounter = 1
  
  console_command add_money -5000
  
	set_event_counter pirates_accepted 0
end_monitor       

monitor_event EventCounter EventCounterType pirates_declined
	and EventCounter = 1
  
    if RandomPercent < 51
  		console_command add_money -12000
  	end_if
    
	set_event_counter pirates_declined 0
end_monitor       
;================= Mercs Disband Event ===================
monitor_event PreFactionTurnStart not IsFactionAIControlled
  and Treasury < -2500

  if I_CompareCounter pl_ec_id = 2
    destroy_units venice, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 3
    destroy_units sicily, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 4
    destroy_units milan, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 5
    destroy_units papal_states, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 6
    destroy_units denmark, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 7
    destroy_units egypt, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 8
    destroy_units scotland, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 9
    destroy_units cumans, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 10
    destroy_units mongols, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 11
    destroy_units turks, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 12
    destroy_units france, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 13
    destroy_units hre, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 14
    destroy_units england, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 15
    destroy_units portugal, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 16
    destroy_units poland, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 17
    destroy_units byzantium, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 18
    destroy_units moors, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 19
    destroy_units russia, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 20
    destroy_units spain, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 21
    destroy_units hungary, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 22
    destroy_units aragon, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 23
    destroy_units lithuania, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 24
    destroy_units kievan_rus, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 25
    destroy_units teutonic_order, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 26
    destroy_units timurids, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 27
    destroy_units norway, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 28
    destroy_units jerusalem, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 29
    destroy_units kwarezm, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 30
    destroy_units pisa, mercenary_unit
	end_if
	if I_CompareCounter pl_ec_id = 31
    destroy_units rum, mercenary_unit
	end_if
  
  historic_event mercenaries_disband
  
end_monitor
;================= Crusade and Jihad Check ===================
set_event_counter crusade_ongoing 0
set_event_counter jihad_ongoing 0

monitor_event FactionTurnStart FactionType slave
	and I_CrusadeInProgress 
  and I_EventCounter crusade_ongoing = 0

	set_event_counter crusade_ongoing 1
end_monitor

monitor_event FactionTurnStart FactionType slave
	and not I_CrusadeInProgress 
  and I_EventCounter crusade_ongoing = 1

	set_event_counter crusade_ongoing 0
end_monitor


monitor_event FactionTurnStart FactionType slave
	and I_JihadInProgress  
  and I_EventCounter jihad_ongoing = 0

	set_event_counter jihad_ongoing 1
end_monitor

monitor_event FactionTurnStart FactionType slave
	and not I_JihadInProgress 
  and I_EventCounter jihad_ongoing = 1

	set_event_counter jihad_ongoing 0
end_monitor

;================= Crusader Support Player ===================

monitor_event FactionTurnStart not IsFactionAIControlled
	and I_NumberOfSettlements jerusalem > 0
  and I_NumberOfSettlements jerusalem < 10
	and RandomPercent < 4
	and I_TurnNumber > 10
	and FactionReligion catholic

	historic_event crusader_support true

end_monitor

monitor_event EventCounter EventCounterType crusader_support_accepted
	and EventCounter = 1
  
  console_command add_money -3000
	console_command add_money jerusalem, 3000
  
	set_event_counter crusader_support_accepted 0
end_monitor       

monitor_event EventCounter EventCounterType crusader_support_declined
	and EventCounter = 1
    
	set_event_counter crusader_support_declined 0
end_monitor       


;================= Crusader Support AI ===================

monitor_event FactionTurnStart FactionType hre
	and I_IsFactionAIControlled hre
	and I_NumberOfSettlements jerusalem > 0
  and I_NumberOfSettlements jerusalem < 10
  and I_NumberOfSettlements hre > 8
	and RandomPercent < 6
	and FactionReligion catholic
  

	console_command add_money hre, -3000
	console_command add_money jerusalem, 3000
  
  if not I_IsFactionAIControlled jerusalem  
    and not I_HotseatEnabled
      
      historic_event crusaders_supported
end_if
  

end_monitor

monitor_event FactionTurnStart FactionType france
	and I_IsFactionAIControlled france
	and I_NumberOfSettlements jerusalem > 0
  and I_NumberOfSettlements jerusalem < 10
  and I_NumberOfSettlements france > 5
	and RandomPercent < 6
	and FactionReligion catholic       

	console_command add_money france, -3000
	console_command add_money jerusalem, 3000
  
  if not I_IsFactionAIControlled jerusalem  
    and not I_HotseatEnabled
      
      historic_event crusaders_supported
end_if

end_monitor

monitor_event FactionTurnStart FactionType england
	and I_IsFactionAIControlled england
	and I_NumberOfSettlements jerusalem > 0
  and I_NumberOfSettlements jerusalem < 10
  and I_NumberOfSettlements england > 5
	and RandomPercent < 6
	and FactionReligion catholic

	console_command add_money england, -3000
	console_command add_money jerusalem, 3000
  
if not I_IsFactionAIControlled jerusalem  
    and not I_HotseatEnabled
      
      historic_event crusaders_supported
end_if

end_monitor


monitor_event FactionTurnStart FactionType venice
	and I_IsFactionAIControlled venice
	and I_NumberOfSettlements jerusalem > 0
  and I_NumberOfSettlements jerusalem < 10
  and I_NumberOfSettlements venice > 1
	and RandomPercent < 4
	and FactionReligion catholic

	console_command add_money venice, -3000
	console_command add_money jerusalem, 3000
  
if not I_IsFactionAIControlled jerusalem  
    and not I_HotseatEnabled
      
      historic_event crusaders_supported
end_if

end_monitor

monitor_event FactionTurnStart FactionType pisa
	and I_IsFactionAIControlled pisa
	and I_NumberOfSettlements jerusalem > 0
  and I_NumberOfSettlements jerusalem < 10
  and I_NumberOfSettlements pisa > 1
	and RandomPercent < 4
	and FactionReligion catholic

	console_command add_money pisa, -3000
	console_command add_money jerusalem, 3000
  
if not I_IsFactionAIControlled jerusalem  
    and not I_HotseatEnabled
      
      historic_event crusaders_supported
end_if

end_monitor

monitor_event FactionTurnStart FactionType sicily
	and I_IsFactionAIControlled sicily
	and I_NumberOfSettlements jerusalem > 0
  and I_NumberOfSettlements jerusalem < 10
  and I_NumberOfSettlements sicily > 2
	and RandomPercent < 4
	and FactionReligion catholic

	console_command add_money sicily, -3000
	console_command add_money jerusalem, 3000
  
if not I_IsFactionAIControlled jerusalem  
    and not I_HotseatEnabled
      
      historic_event crusaders_supported
end_if

end_monitor

monitor_event FactionTurnStart FactionType hungary
	and I_IsFactionAIControlled hungary
	and I_NumberOfSettlements jerusalem > 0
  and I_NumberOfSettlements jerusalem < 10
  and I_NumberOfSettlements hungary > 4
	and RandomPercent < 5
	and FactionReligion catholic

	console_command add_money hungary, -3000
	console_command add_money jerusalem, 3000
  
if not I_IsFactionAIControlled jerusalem  
    and not I_HotseatEnabled
      
      historic_event crusaders_supported
end_if

end_monitor

monitor_event FactionTurnStart FactionType poland
	and I_IsFactionAIControlled poland
	and I_NumberOfSettlements jerusalem > 0        
  and I_NumberOfSettlements jerusalem < 10
  and I_NumberOfSettlements poland > 4
	and RandomPercent < 5
	and FactionReligion catholic

	console_command add_money poland, -3000
	console_command add_money jerusalem, 3000
  
if not I_IsFactionAIControlled jerusalem  
    and not I_HotseatEnabled
      
      historic_event crusaders_supported
end_if

end_monitor

monitor_event FactionTurnStart FactionType denmark
	and I_IsFactionAIControlled denmark
	and I_NumberOfSettlements jerusalem > 0
  and I_NumberOfSettlements jerusalem < 10
  and I_NumberOfSettlements denmark > 2
	and RandomPercent < 3
	and FactionReligion catholic

	console_command add_money denmark, -3000
	console_command add_money jerusalem, 3000
  
if not I_IsFactionAIControlled jerusalem  
    and not I_HotseatEnabled
      
      historic_event crusaders_supported
end_if

end_monitor


;==================== Occupied Capitals Revolt ====================== 

;-------------------- Early Game Buff, other things now in descr_rebel_faction.txt ----------------------

declare_counter paris_occupied
set_counter paris_occupied 1
declare_counter london_occupied
set_counter london_occupied 1
declare_counter edinburgh_occupied
set_counter edinburgh_occupied 1
declare_counter frankfurt_occupied
set_counter frankfurt_occupied 1
declare_counter lund_occupied
set_counter lund_occupied 1
declare_counter bergen_occupied
set_counter bergen_occupied 1
declare_counter pisa_occupied
set_counter pisa_occupied 1
declare_counter zaragoza_occupied
set_counter zaragoza_occupied 1
declare_counter leon_occupied
set_counter leon_occupied 1
declare_counter coimbra_occupied
set_counter coimbra_occupied 1
declare_counter marrakesh_occupied
set_counter marrakesh_occupied 1
declare_counter venice_occupied
set_counter venice_occupied 1
declare_counter rome_occupied
set_counter rome_occupied 1
declare_counter palermo_occupied
set_counter palermo_occupied 1
declare_counter esztergom_occupied
set_counter esztergom_occupied 1
declare_counter krakow_occupied
set_counter krakow_occupied 1
declare_counter ras_occupied
set_counter ras_occupied 1
declare_counter kernave_occupied
set_counter kernave_occupied 1
declare_counter novgorod_occupied
set_counter novgorod_occupied 1
declare_counter kiev_occupied
set_counter kiev_occupied 1
declare_counter tbilisi_occupied
set_counter tbilisi_occupied 1
declare_counter constantinople_occupied
set_counter constantinople_occupied 1
declare_counter konya_occupied
set_counter konya_occupied 1
declare_counter isfahan_occupied
set_counter isfahan_occupied 1
declare_counter jerusalem_occupied
set_counter jerusalem_occupied 1
declare_counter mosul_occupied
set_counter mosul_occupied 1
declare_counter cairo_occupied
set_counter cairo_occupied 1
declare_counter baghdad_occupied
set_counter baghdad_occupied 1

declare_counter genoa_occupied
set_counter genoa_occupied 1
declare_counter kalmar_occupied
set_counter kalmar_occupied 1
declare_counter sis_occupied
set_counter sis_occupied 1
declare_counter tarnovo_occupied
set_counter tarnovo_occupied 1  
declare_counter prague_occupied
set_counter prague_occupied 1
declare_counter bulgar_occupied
set_counter bulgar_occupied 1

declare_counter milan_occupied
set_counter milan_occupied 0
declare_counter sives_occupied
set_counter sives_occupied 0
declare_counter damascus_occupied
set_counter damascus_occupied 0





;------- If the faction leader of the human player dies, a bad heir gets the thrones, reset the occupied counter and trigger the revolt again ------- 

monitor_event BecomesFactionLeader Attribute Authority < 4
	and Attribute Command < 6
  and not IsFactionAIControlled

    set_counter paris_occupied 0
    set_counter london_occupied 0
    set_counter edinburgh_occupied 0
    set_counter frankfurt_occupied 0
    set_counter lund_occupied 0
    set_counter bergen_occupied 0
    set_counter pisa_occupied 0
    set_counter zaragoza_occupied 0
    set_counter leon_occupied 0
    set_counter coimbra_occupied 0
    set_counter marrakesh_occupied 0
    set_counter venice_occupied 0
    set_counter rome_occupied 0
    set_counter palermo_occupied 0
    set_counter esztergom_occupied 0
    set_counter krakow_occupied 0
    set_counter ras_occupied 0
    set_counter kernave_occupied 0
    set_counter novgorod_occupied 0
    set_counter kiev_occupied 0
    set_counter tbilisi_occupied 0
    set_counter constantinople_occupied 0
    set_counter konya_occupied 0
    set_counter isfahan_occupied 0
    set_counter jerusalem_occupied 0
    set_counter mosul_occupied 0
    set_counter cairo_occupied 0
    set_counter baghdad_occupied 0
    set_counter genoa_occupied 0
    set_counter kalmar_occupied 0
    set_counter sis_occupied 0
    set_counter tarnovo_occupied 0
    set_counter prague_occupied 0
    set_counter bulgar_occupied 0
    set_counter milan_occupied 0
    set_counter sives_occupied 0
    set_counter damascus_occupied 0
end_monitor   

monitor_event BecomesFactionLeader Attribute Command < 3
	and Attribute Authority < 6
  and not IsFactionAIControlled

    set_counter paris_occupied 0
    set_counter london_occupied 0
    set_counter edinburgh_occupied 0
    set_counter frankfurt_occupied 0
    set_counter lund_occupied 0
    set_counter bergen_occupied 0
    set_counter pisa_occupied 0
    set_counter zaragoza_occupied 0
    set_counter leon_occupied 0
    set_counter coimbra_occupied 0
    set_counter marrakesh_occupied 0
    set_counter venice_occupied 0
    set_counter rome_occupied 0
    set_counter palermo_occupied 0
    set_counter esztergom_occupied 0
    set_counter krakow_occupied 0
    set_counter ras_occupied 0
    set_counter kernave_occupied 0
    set_counter novgorod_occupied 0
    set_counter kiev_occupied 0
    set_counter tbilisi_occupied 0
    set_counter constantinople_occupied 0
    set_counter konya_occupied 0
    set_counter isfahan_occupied 0
    set_counter jerusalem_occupied 0
    set_counter mosul_occupied 0
    set_counter cairo_occupied 0
    set_counter baghdad_occupied 0
    set_counter genoa_occupied 0
    set_counter kalmar_occupied 0
    set_counter sis_occupied 0
    set_counter tarnovo_occupied 0
    set_counter prague_occupied 0
    set_counter bulgar_occupied 0
    set_counter milan_occupied 0
    set_counter sives_occupied 0
    set_counter damascus_occupied 0
end_monitor
 
;------- If the settlement gets captured by a new faction, reset the occupied counter and trigger the revolt again -------

monitor_event GeneralCaptureSettlement SettlementName Paris 
  set_counter paris_occupied 0  
end_monitor
monitor_event GeneralCaptureSettlement SettlementName Edinburgh 
  set_counter edinburgh_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Frankfurt 
  set_counter frankfurt_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Lund 
  set_counter lund_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Bergen 
  set_counter bergen_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Pisa 
  set_counter pisa_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Zaragoza 
  set_counter zaragoza_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Leon 
  set_counter leon_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Coimbra 
  set_counter coimbra_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Marrakesh 
  set_counter marrakesh_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Venice
  set_counter venice_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Rome
  set_counter rome_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Palermo
  set_counter palermo_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Esztergom
  set_counter esztergom_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Krakow
  set_counter krakow_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Ras
  set_counter ras_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Kernave
  set_counter kernave_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Novgorod
  set_counter novgorod_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Kiev
  set_counter kiev_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Tbilisi
  set_counter tbilisi_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Constantinople
  set_counter constantinople_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Konya
  set_counter konya_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Isfahan
  set_counter isfahan_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Jerusalem
  set_counter jerusalem_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Mosul
  set_counter mosul_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Cairo
  set_counter cairo_occupied 0  
end_monitor
monitor_event GeneralCaptureSettlement SettlementName Baghdad
  set_counter baghdad_occupied 0  
end_monitor
monitor_event GeneralCaptureSettlement SettlementName Kalmar
  set_counter kalmar_occupied 0  
end_monitor
monitor_event GeneralCaptureSettlement SettlementName Genoa
  set_counter genoa_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Milan
  set_counter milan_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Prague
  set_counter prague_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Sives
  set_counter sives_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Damascus
  set_counter damascus_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Sis
  set_counter sis_occupied 0  
end_monitor 
monitor_event GeneralCaptureSettlement SettlementName Bulgar
  set_counter bulgar_occupied 0  
end_monitor 


;------- Invoke Rebellions -------
monitor_event SettlementTurnStart SettlementName Paris
  and not FactionType france

  if I_CompareCounter paris_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Paris 8
      set_counter paris_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Paris 4
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName London
  and not FactionType england

  if I_CompareCounter london_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil London 8
      set_counter london_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0                     
      add_settlement_turmoil London 4
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Edinburgh
  and not FactionType scotland

  if I_CompareCounter edinburgh_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Edinburgh 13
      set_counter edinburgh_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Edinburgh 9
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Frankfurt
  and not FactionType hre

  if I_CompareCounter frankfurt_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Frankfurt 9
      set_counter frankfurt_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0  
    add_settlement_turmoil Frankfurt 5
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Lund
  and not FactionType denmark

  if I_CompareCounter lund_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Lund 10
      set_counter lund_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Lund 6
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Bergen
  and not FactionType norway

  if I_CompareCounter bergen_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Bergen 9
      set_counter bergen_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Bergen 5
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Pisa
  and not FactionType pisa

  if I_CompareCounter pisa_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Pisa 7
      set_counter pisa_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Pisa 3 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Zaragoza
  and not FactionType aragon

  if I_CompareCounter zaragoza_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Zaragoza 7
      set_counter zaragoza_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Zaragoza 3
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Leon
  and not FactionType spain

  if I_CompareCounter leon_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Leon 7
      set_counter leon_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Leon 3
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Coimbra
  and not FactionType portugal

  if I_CompareCounter coimbra_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Coimbra 8
      set_counter coimbra_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Coimbra 4 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Marrakesh
  and not FactionType moors

  if I_CompareCounter marrakesh_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Marrakesh 5
      set_counter marrakesh_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Marrakesh 1 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Venice
  and not FactionType venice

  if I_CompareCounter venice_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Venice 5
      set_counter venice_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Venice 1 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Rome
  and not FactionType papal_states

  if I_CompareCounter rome_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Rome 10
      set_counter rome_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Rome 6 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Palermo
  and not FactionType sicily

  if I_CompareCounter palermo_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Palermo 5
      set_counter palermo_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
;      add_settlement_turmoil Palermo 1
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Esztergom
  and not FactionType hungary

  if I_CompareCounter esztergom_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Esztergom 8
      set_counter esztergom_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Esztergom 4 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Krakow
  and not FactionType poland

  if I_CompareCounter krakow_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Krakow 7
      set_counter krakow_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Krakow 3
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Ras
  and not FactionType teutonic_order

  if I_CompareCounter ras_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Ras 12
      set_counter ras_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Ras 8 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Kernave
  and not FactionType lithuania

  if I_CompareCounter kernave_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Kernave 6
      set_counter kernave_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Kernave 2
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Novgorod
  and not FactionType russia

  if I_CompareCounter novgorod_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Novgorod 7
      set_counter novgorod_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Novgorod 3 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Kiev
  and not FactionType kievan_rus

  if I_CompareCounter kiev_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Kiev 6
      set_counter kiev_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Kiev 2
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Tbilisi
  and not FactionType timurids

  if I_CompareCounter tbilisi_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Tbilisi 9
      set_counter tbilisi_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Tbilisi 5
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Constantinople
  and not FactionType byzantium

  if I_CompareCounter constantinople_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Constantinople 4
      set_counter constantinople_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
;      add_settlement_turmoil Constantinople 1  
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Konya
  and not FactionType rum

  if I_CompareCounter konya_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Konya 5
      set_counter konya_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Konya 1 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Isfahan
  and not FactionType turks

  if I_CompareCounter isfahan_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Isfahan 4
      set_counter isfahan_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
;      add_settlement_turmoil Isfahan 1 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Jerusalem
  and not FactionType jerusalem

  if I_CompareCounter jerusalem_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Jerusalem 9
      set_counter jerusalem_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Jerusalem 5 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Mosul
  and not FactionType kwarezm

  if I_CompareCounter mosul_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Mosul 4
      set_counter mosul_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
;      add_settlement_turmoil Mosul 1
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Cairo
  and not FactionType egypt

  if I_CompareCounter cairo_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Cairo 4
      set_counter cairo_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
;      add_settlement_turmoil Cairo 1  
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Baghdad
  and not FactionType milan

  if I_CompareCounter baghdad_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Baghdad 4
      set_counter baghdad_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
;      add_settlement_turmoil Baghdad 1  
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Kalmar
  and not FactionType slave

  if I_CompareCounter kalmar_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Kalmar 8
      set_counter kalmar_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Kalmar 4 
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Genoa
  and not FactionType slave

  if I_CompareCounter genoa_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Genoa 7
      set_counter genoa_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Genoa 3
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Prague
  and not FactionType slave

  if I_CompareCounter prague_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Prague 7
      set_counter prague_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Prague 3  
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Sis
  and not FactionType slave

  if I_CompareCounter sis_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Sis 7
      set_counter sis_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Sis 3
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Bulgar
  and not FactionType slave

  if I_CompareCounter bulgar_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Bulgar 7
      set_counter bulgar_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Bulgar 3
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Sives
  and not FactionType slave

  if I_CompareCounter sives_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Sives 5
      set_counter sives_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Sives 1
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Milan
  and not FactionType slave

  if I_CompareCounter milan_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Milan 5
      set_counter milan_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Milan 1
  end_if
end_monitor

monitor_event SettlementTurnStart SettlementName Damascus
  and not FactionType slave

  if I_CompareCounter damascus_occupied = 0
  and I_EventCounter is_the_ai = 0
      add_settlement_turmoil Damascus 5
      set_counter damascus_occupied 1  
  end_if

  if I_EventCounter is_the_ai > 0
      add_settlement_turmoil Damascus 1
  end_if
end_monitor


;========================================================
;======= EMERGENT FACTIONS/NATIONAL UPRISINGS ===========


;============== William Wallace Uprising ================

declare_counter wallace_spawned
set_counter wallace_spawned 0

monitor_event FactionTurnStart FactionType scotland	
	and I_TurnNumber > 100
	and I_NumberOfSettlements scotland < 2
	and I_CompareCounter wallace_spawned = 0

	set_counter wallace_spawned 1

terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType scotland
	and I_CompareCounter wallace_spawned = 1

	spawn_army 
		faction scotland
		character	William Wallace, named character, age 20, x 55, y 253, direction SE, battle_model Wallace_General, portrait wallace, label scotland4wallace
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 1 , ScotlandHero 1 , LoyaltyStarter 1, BattleChivalry 2 , Loyal 2 , Just 2 , Rabblerouser 3 , Hardened 1
		unit		Highland Nobles	exp 4 armour 0 weapon_lvl 1
		unit		Highland Nobles	exp 2 armour 0 weapon_lvl 1
		unit		Highlanders	exp 3 armour 1 weapon_lvl 1
		unit		Highlanders	exp 3 armour 1 weapon_lvl 1
		unit		Highlanders	exp 3 armour 1 weapon_lvl 1
		unit		Scots Pikemen	exp 4 armour 1 weapon_lvl 0
		unit		Scots Pikemen	exp 4 armour 1 weapon_lvl 0
		unit		Scots Spearmen	exp 3 armour 1 weapon_lvl 0
		unit		Scots Spearmen	exp 3 armour 1 weapon_lvl 0
		unit		Thanes		exp 3 armour 0 weapon_lvl 1
		unit		Scots Longbow	exp 1 armour 1 weapon_lvl 0
		unit		Scots Longbow	exp 1 armour 1 weapon_lvl 0
		unit		Scots Skirmisher	exp 3 armour 0 weapon_lvl 0
		unit		Scots Skirmisher	exp 3 armour 0 weapon_lvl 0
		unit		Scots Skirmisher	exp 4 armour 0 weapon_lvl 0
		unit		Border Horse	exp 2 armour 0 weapon_lvl 0
		unit		Border Horse	exp 2 armour 0 weapon_lvl 0
	end	   

	historic_event scotland_wallace event/william_wallace.bik
terminate_monitor
end_monitor

monitor_event FactionTurnStart FactionType scotland
	and IsFactionAIControlled
	and I_CharacterExists scotland4wallace
	and not I_SettlementOwner Edinburgh = scotland

	if I_SettlementUnderSiege Edinburgh
		siege_settlement scotland4wallace, Edinburgh, attack
		terminate_monitor
	end_if
	
	siege_settlement scotland4wallace, Edinburgh, maintain

	if I_SettlementOwner Edinburgh = scotland
		terminate_monitor
	end_if

end_monitor

;============== Teutonic Order Emergent =================

;=============== Golden Horde Emergent ==================
monitor_event EventCounter EventCounterType mongols_invasion_warn
	and EventCounter = 1

	add_events
		event	emergent_faction	mongols
		date	7
		event	counter	mongols_invasion
		date	7
		event	counter	mongols_invasion
		date	11
		event	counter	mongols_invasion
		date	20
		event	counter	mongols_invasion
		date	36
		event	counter	mongols_invasion
		date	56
		event	counter	mongols_invasion
		date	107
	end_add_events
terminate_monitor
end_monitor

;--human part
;--ai part

monitor_event EventCounter EventCounterType mongols_invasion
	and EventCounter = 1
	and I_IsFactionAIControlled mongols

	historic_event the_mongols_emerge event/mongols_invade.bik

	spawn_army ;Urgench
		faction mongols
		character	Genghis, named character, age 48, x 500, y 151, label mongols4genghis, family
		traits Factionleader 3 , MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , GoodCommander 3 , Bloodthirsty 2 , BattleDread 4 , StrategyDread 2 , PublicFaith 1 , GoodCavalryGeneral 2 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
	end	

	spawn_army ;Urgench
		faction mongols
		character	Ogodei, named character, age 22, x 500, y 147, label mongols4aradai, family
		traits Factionleader 2, MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 4 armour 0 weapon_lvl 0
	end

	spawn_army ;support
		faction mongols
		character	Tolui, named character, age 16, x 503, y 152, family
		traits Factionleader 1, MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , GoodCommander 3 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 4 armour 0 weapon_lvl 0
	end

	spawn_army ;support
		faction mongols
		character	Chaghatai, named character, age 19, x 498, y 153, family
		traits Factionleader 1, MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , GoodCommander 3 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 4 armour 0 weapon_lvl 0
	end

	spawn_army ;Merv
		faction mongols
		character	Jochi, named character, age 27, x 508, y 126, label mongols4bayan, family
		traits Factionleader 1, MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
	end

	spawn_army ;Merv
		faction mongols
		character	Jebe, named character, age 25, x 504, y 117, label mongols4jebe
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , GoodCommander 3 , Bloodthirsty 2 , BattleDread 4 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
	end

	spawn_army ;support
		faction mongols
		character	random_name, named character, age 48, x 500, y 147
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , GoodCommander 3 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
	end

	spawn_army ;Konjikala
		faction mongols
		character	Chindu, named character, age 25, x 490, y 125, label mongols4chindu
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Bloodthirsty 2 , BattleDread 4 , StrategyDread 2 , PublicFaith 1 , Loyal 3 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
	end

	spawn_army ;Konjikala
		faction mongols
		character	Nayuk, named character, age 21, x 491, y 126, label mongols4nayuk
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
	end

	spawn_character mongols random_name, priest, age 23, x 480, y 140 
	spawn_character mongols random_name, priest, age 24, x 500, y 98 
	spawn_character mongols random_name, priest, age 27, x 470, y 120 

terminate_monitor
end_monitor


declare_counter attack_urgench
set_counter attack_urgench 0
declare_counter attack_Merv
set_counter attack_Merv 0
declare_counter attack_konjikala
set_counter attack_konjikala 0

monitor_event FactionTurnStart FactionType mongols
	and I_IsFactionAIControlled mongols
	and I_CharacterExists mongols4genghis
	and I_CharacterExists mongols4aradai 

	if I_CompareCounter attack_urgench = 1
		siege_settlement mongols4genghis, Urgench, attack
		set_counter attack_urgench 2
		terminate_monitor
	end_if

	if not I_SettlementUnderSiege Urgench
		if I_CompareCounter attack_urgench = 0
			siege_settlement mongols4genghis, Urgench, maintain
			siege_settlement mongols4aradai, Urgench, maintain
			set_counter attack_urgench 1
		end_if
	end_if

end_monitor

monitor_event FactionTurnStart FactionType mongols
	and IsFactionAIControlled
	and I_CharacterExists mongols4jebe
	and I_CharacterExists mongols4bayan

	if I_CompareCounter attack_Merv = 1
		siege_settlement mongols4jebe, Merv, attack
		set_counter attack_Merv 2
		terminate_monitor
	end_if

	if not I_SettlementUnderSiege Merv
		if I_CompareCounter attack_Merv = 0
			siege_settlement mongols4jebe, Merv, maintain
			siege_settlement mongols4bayan, Merv, maintain
			set_counter attack_Merv 1
		end_if
	end_if

end_monitor

monitor_event FactionTurnStart FactionType mongols
	and IsFactionAIControlled
	and I_CharacterExists mongols4chindu
	and I_CharacterExists mongols4nayuk

	if I_CompareCounter attack_konjikala = 1
		siege_settlement mongols4chindu, Konjikala, attack
		set_counter attack_konjikala 2
		terminate_monitor
	end_if

	if not I_SettlementUnderSiege Konjikala
		if I_CompareCounter attack_konjikala = 0
			siege_settlement mongols4chindu, Konjikala, maintain
			siege_settlement mongols4nayuk, Konjikala, maintain
			set_counter attack_konjikala 1
		end_if
	end_if

end_monitor


monitor_event EventCounter EventCounterType mongols_invasion ;make sure the horde will acquire their first settlement early era
	and I_IsFactionAIControlled mongols
	and EventCounter = 2
	and not I_SettlementOwner Urgench = mongols

	spawn_army
		faction mongols
		character	random_name, named character, age 26, x 500, y 153, label mongols4supportgen1
		traits MilitaryInclination 1 , Military_Edu 4 , NaturalMilitarySkill 4 , GoodCommander 5 , Bloodthirsty 3 , BattleDread 5 , StrategyDread 5 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1 , Drink 4 , Genocide 3
		unit	Keshikten Bodyguard		exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 3 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
	end
	

	spawn_army
		faction mongols
		character	random_name, named character, age 25, x 499, y 154, label mongols4supportgen2
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Anger 3 , BattleDread 3 , StrategyDread 3 , PublicFaith 2 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 6 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
	end
	

	spawn_army
		faction mongols
		character	random_name, named character, age 24, x 499, y 153, label mongols4supportgen3
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 3 , GoodCommander 5 , Bloodthirsty 3 , BattleDread 5 , StrategyDread 5 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1 , Drink 2
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut	exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut	exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
	end
	

	spawn_army
		faction mongols
		character	random_name, named character, age 25, x 501, y 153, label mongols4supportgen4
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers			exp 7 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khorchi Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet	exp 6 armour 0 weapon_lvl 0
	end
	
  spawn_army ;support
		faction mongols
		character	random_name, named character, age 30, x 505, y 95
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , GoodCommander 2 , StrategyDread 1 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
    unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
    unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
    unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
    unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
	end
  
	if not I_SettlementUnderSiege Urgench
		if I_CharacterTypeNearTile mongols, named_character, 0, 501, 153
			siege_settlement mongols4supportgen4, Urgench, maintain
		end_if

		if I_CharacterTypeNearTile mongols, named_character, 0, 499, 154
			siege_settlement mongols4supportgen2, Urgench, maintain
		end_if

		if I_CharacterTypeNearTile mongols, named_character, 0, 499, 153
			siege_settlement mongols4supportgen3, Urgench, maintain
		end_if

		if I_CharacterTypeNearTile mongols, named_character, 0, 500, 153
			siege_settlement mongols4supportgen1, Urgench, attack
		end_if
	end_if

	terminate_monitor
end_monitor


monitor_event FactionTurnEnd FactionType mongols
	and IsFactionAIControlled
	and I_CharacterTypeNearTile mongols, named_character, 10, 440, 194

	historic_event mongols_blue_horde_caucasus
	
terminate_monitor
end_monitor

monitor_event FactionTurnEnd FactionType mongols
	and IsFactionAIControlled
	and I_CharacterTypeNearTile mongols, named_character, 10, 326, 202

	historic_event mongols_blue_horde_kiev
	
terminate_monitor
end_monitor

monitor_event FactionTurnEnd FactionType mongols
	and IsFactionAIControlled
	and I_CharacterTypeNearTile mongols, named_character, 10, 280, 184

	historic_event mongols_blue_horde_hungary
	
terminate_monitor
end_monitor

monitor_event FactionTurnEnd FactionType mongols
	and IsFactionAIControlled
	and I_CharacterTypeNearTile mongols, named_character, 5, 396, 89

	historic_event mongols_horde_baghdad

terminate_monitor
end_monitor


monitor_event EventCounter EventCounterType mongols_invasion
	and I_IsFactionAIControlled mongols
	and EventCounter = 2

	spawn_army
		faction mongols
		character	Chindu, named character, age 26, x 505, y 145
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 3 , Genocide 2 , BattleDread 2 , StrategyDread 1 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
	end
	
	spawn_army
		faction mongols
		character	Subutai, named character, age 25, x 507, y 140
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 3 , BattleDread 3 , StrategyDread 3 , PublicFaith 2 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
	end
	
	spawn_army
		faction mongols
		character	Berkei, named character, age 24, x 500, y 150,
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Anger 2 , BattleDread 2 , StrategyDread 2 , PublicFaith 4, TouchedByTheGods 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Hoshiga Horse Archers	exp 6 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
	end
  
  spawn_army ;support
		faction mongols
		character	random_name, named character, age 30, x 476, y 132
		traits MilitaryInclination 1 , Military_Edu 3 , NaturalMilitarySkill 2 , GoodCommander 2 , StrategyDread 1 , PublicFaith 1 , Loyal 2 , GoodCavalryGeneral 2 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
    unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 5 armour 0 weapon_lvl 0
    unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
    unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
    unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
	end

terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType mongols_invasion
	and I_IsFactionAIControlled mongols
	and EventCounter = 3

	spawn_army
		faction mongols
		character	Batu, named character, age 26, x 505, y 145
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 3 , GoodCommander 3 , Genocide 2 , BattleDread 2 , StrategyDread 3 , PublicFaith 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet		exp 5 armour 0 weapon_lvl 0
	end	

	spawn_army
		faction mongols
		character	random_name, named character, age 26, x 508, y 92
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 3 , GoodCommander 3 , Genocide 2 , BattleDread 2 , StrategyDread 3 , PublicFaith 1 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
	end
  
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType mongols_invasion
	and I_IsFactionAIControlled mongols
	and EventCounter = 4

	spawn_army
		faction mongols
		character	Menglai, named character, age 25, x 490, y 137
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 3 , BattleDread 2 , StrategyDread 3 , PublicFaith 2 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Merguen Archers		exp 5 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 3 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Hoschuchi Lancers		exp 5 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 3 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
		unit	ME Trebuchet			exp 5 armour 0 weapon_lvl 0
	end

	spawn_army
		faction mongols
		character	Jagadai, named character, age 25, x 502, y 144
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 2 , Anger 3 , BattleDread 2 , StrategyDread 2 , PublicFaith 1 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
	end

	spawn_character mongols random_name, priest, age 22, x 480, y 140
	spawn_character mongols random_name, priest, age 27, x 500, y 98
	spawn_character mongols random_name, spy, age 33, x 490, y 150
	spawn_character mongols random_name, spy, age 20, x 500, y 135
	spawn_character mongols random_name, assassin, age 20, x 490, y 135
	spawn_character mongols random_name, assassin, age 21, x 495, y 135
	terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType mongols_invasion
	and I_IsFactionAIControlled mongols
	and EventCounter = 5

	spawn_army 
		faction mongols
		character	Hulegu, named character, age 25, x 498, y 120
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 2 , GoodCommander 2 , Genocide 2 , BattleDread 2 , StrategyDread 3 , PublicFaith 3 , Loyal 2 , ContentGeneral 3 , ReligionStarter 1
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Lubchiten Horse Archers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers		exp 6 armour 0 weapon_lvl 0
	end

	spawn_army 
		faction mongols
		character	Kitbuqa, named character, age 24, x 507, y 92
		traits MilitaryInclination 1 , Military_Edu 2 , NaturalMilitarySkill 1 , GoodCommander 3 , BattleDread 2 , StrategyDread 2 , Loyal 2 , ContentGeneral 3
		unit	Keshikten Bodyguard		exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 6 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Disamounted Turhagut			exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 4 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Khabutu Archers		exp 6 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Nukeri Horse Archers	exp 5 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 4 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
		unit	Turhagut Lancers	exp 6 armour 0 weapon_lvl 0
	end

	spawn_character mongols random_name, priest, age 22, x 480, y 140
	spawn_character mongols random_name, priest, age 27, x 500, y 98
	spawn_character mongols random_name, spy, age 20, x 500, y 135
	spawn_character mongols random_name, spy, age 20, x 490, y 135
	spawn_character mongols random_name, assassin, age 21, x 495, y 135
	terminate_monitor
end_monitor
;===================== PRINTING PRESS EVENT ========================

monitor_event PreFactionTurnStart TrueCondition
  and FactionBuildingExists = printing_press
  
    historic_event first_printing_press
    terminate_monitor
end_monitor 

;===================== ZENGID EVOLUTION ========================

;---------------------- player ---------------------------
monitor_event BuildingCompleted TrueCondition
  and NumBuildingsCompletedFaction p_large_town > 2
  and I_NumberOfSettlements kwarezm > 3
  and I_TurnNumber > 50
  and FactionType kwarezm
  and not IsFactionAIControlled 
  and not I_EventCounter zengids_rise > 0 
    
    historic_event zengids true
    terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType kwarezm
    and I_TurnNumber > 60
    and not IsFactionAIControlled 
    and not I_EventCounter zengids_rise > 0 
    
    historic_event zengids true
    terminate_monitor
end_monitor



monitor_event EventCounter EventCounterType zengids_accepted
	and EventCounter = 1
  
  historic_event zengids_rise

	add_events
		event	counter	first_mamluks_zengid
		date	50
    event	counter	mamluks_established_zengid
		date	100
	end_add_events
  
  set_event_counter zengids_accepted 0
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType zengids_declined
	and EventCounter = 1
  
  add_events
		event	counter	first_mamluks_zengid
		date	80
    event	counter	mamluks_established_zengid
		date	120
	end_add_events
  
  set_event_counter zengids_declined 0
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType first_mamluks_zengid
	and EventCounter = 1
  and I_EventCounter zengids_rise = 0
  
  historic_event zengids_rise
  
terminate_monitor
end_monitor


;---------------------   AI --------------------------

monitor_event PreFactionTurnStart FactionType kwarezm
    and I_TurnNumber > 60
    and I_NumberOfSettlements kwarezm > 2
    and IsFactionAIControlled 
    
    historic_event zengids_rise
    set_event_counter zengid_evolution 1
    
    add_events
  		event	counter	first_mamluks_zengid
  		date	50
      event	counter	mamluks_established_zengid
  		date	100
  	end_add_events
  
    terminate_monitor
end_monitor

;===================== POSSIBLE ZENGID TO MAMLUK TRANSITION ========================

monitor_event BecomesFactionLeader FactionType kwarezm
  and not I_EventCounter mamluks_rise_zengid > 0 

  if I_FactionLeaderTrait kwarezm Royal_Blood_Mamluk = 1 
	 historic_event mamluks_rise_zengid
  end_if
  
  terminate_monitor  
end_monitor

;===================== ABBASID EVOLUTION ========================

;---------------------- player ---------------------------
monitor_event BuildingCompleted TrueCondition
  and NumBuildingsCompletedFaction p_large_town > 2
  and I_NumberOfSettlements milan > 3
  and I_TurnNumber > 60
  and FactionType milan
  and not IsFactionAIControlled 
  and not I_EventCounter abbasids_rise > 0 
    
    historic_event abbasids true
    terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionType milan
    and I_TurnNumber > 70
    and not IsFactionAIControlled 
    and not I_EventCounter abbasids_rise > 0 
    
    historic_event abbasids true
    terminate_monitor
end_monitor



monitor_event EventCounter EventCounterType abbasids_accepted
	and EventCounter = 1
  
  historic_event abbasids_rise

	add_events
		event	counter	first_mamluks_abbasid
		date	60
    event	counter	mamluks_established_abbasid
		date	100
	end_add_events
  
  set_event_counter abbasids_accepted 0
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType abbasids_declined
	and EventCounter = 1
  
  add_events
		event	counter	first_mamluks_abbasid
		date	100
    event	counter	mamluks_established_abbasid
		date	140
	end_add_events
  
  set_event_counter abbasids_declined 0
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType first_mamluks_abbasid
	and EventCounter = 1
  and I_EventCounter abbasids_rise = 0
  
  historic_event abbasids_rise
  
terminate_monitor
end_monitor

;---------------------   AI --------------------------

monitor_event PreFactionTurnStart FactionType milan
    and I_TurnNumber > 70
    and I_NumberOfSettlements milan > 2
    and IsFactionAIControlled 
    
    historic_event abbasids_rise
    
    add_events
  		event	counter	first_mamluks_abbasid
  		date	60
      event	counter	mamluks_established_abbasid
  		date	100
  	end_add_events
  
    terminate_monitor
end_monitor


;===================== FATIMID TO AYYUBID TRANSITION ========================

;---------------------- player ---------------------------

monitor_event BuildingCompleted TrueCondition
  and NumBuildingsCompletedFaction p_large_town > 2
  and I_TurnNumber > 40
  and FactionType egypt
  and not IsFactionAIControlled 
  and not I_EventCounter ayyubids_rise > 0
  and not I_EventCounter mamluks_rise > 0  
    
    historic_event ayyubids true
    terminate_monitor
end_monitor


monitor_event SettlementTurnStart SettlementName Damascus
  and FactionType egypt
  and SettlementIsLocal
  and I_TurnNumber > 50
  and not I_EventCounter ayyubids_rise > 0
  and not I_EventCounter mamluks_rise > 0  

      historic_event ayyubids true
    terminate_monitor  
end_monitor

monitor_event PreFactionTurnStart FactionType egypt
    and I_TurnNumber > 70
    and not IsFactionAIControlled 
    and not I_EventCounter ayyubids_rise > 0
    and not I_EventCounter mamluks_rise > 0  
    
    historic_event ayyubids true
    terminate_monitor
end_monitor


monitor_event EventCounter EventCounterType ayyubids_accepted
	and EventCounter = 1
  
  historic_event ayyubids_rise
  destroy_buildings egypt byzantine_mercenary_barracks false

	add_events
		event	counter	first_mamluks
		date	40
    event	counter	mamluks_established
		date	60
	end_add_events
  
  set_event_counter ayyubids_accepted 0
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType ayyubids_declined
	and EventCounter = 1
  
  add_events
		event	counter	first_mamluks
		date	80
    event	counter	mamluks_established
		date	120
	end_add_events
  
  set_event_counter ayyubids_declined 0
terminate_monitor
end_monitor

monitor_event EventCounter EventCounterType first_mamluks
	and EventCounter = 1
  and I_EventCounter ayyubids_rise = 0
  
  historic_event ayyubids_rise
  
terminate_monitor
end_monitor

;---------------------   AI --------------------------

monitor_event PreFactionTurnStart FactionType egypt
    and I_TurnNumber > 70
    and I_NumberOfSettlements egypt > 2
    and IsFactionAIControlled
    and not I_EventCounter mamluks_rise > 0  
    
    historic_event ayyubids_rise
    set_event_counter fatimid_evolution 1
    destroy_buildings egypt byzantine_mercenary_barracks false
    
    add_events
  		event	counter	first_mamluks
  		date	40
      event	counter	mamluks_established
  		date	60
  	end_add_events
  
    terminate_monitor
end_monitor
;===================== AYYUBID TO MAMLUK TRANSITION ========================

monitor_event SettlementTurnStart SettlementName Damascus
  and FactionType mongols
  and I_EventCounter ayyubids_rise > 0 
  and not I_EventCounter mamluks_rise > 0 

      historic_event mamluks_rise
    terminate_monitor  
end_monitor

monitor_event SettlementTurnStart SettlementName Damascus
  and FactionType mongols
  and I_EventCounter ayyubids_rise = 0 
  and not I_EventCounter mamluks_rise > 0 

      historic_event mamluks_rise
      set_event_counter first_mamluks 1
      set_event_counter mamluks_established 1
    terminate_monitor  
end_monitor

monitor_event SettlementTurnStart SettlementName Aleppo
  and FactionType mongols
  and I_EventCounter ayyubids_rise > 0 
  and not I_EventCounter mamluks_rise > 0 

      historic_event mamluks_rise
    terminate_monitor  
end_monitor

monitor_event SettlementTurnStart SettlementName Aleppo
  and FactionType mongols
  and I_EventCounter ayyubids_rise = 0 
  and not I_EventCounter mamluks_rise > 0 

      historic_event mamluks_rise
      set_event_counter first_mamluks 1
      set_event_counter mamluks_established 1
    terminate_monitor  
end_monitor

monitor_event BecomesFactionLeader FactionType egypt
  and not I_EventCounter mamluks_rise > 0 

  if I_FactionLeaderTrait egypt Royal_Blood_Mamluk = 1 
	 historic_event mamluks_rise
  end_if
  
  terminate_monitor  
end_monitor  
;===================== ORDER RECRUITMENT REQUIREMENTS =======================
declare_counter order_recruitment_enabled
set_counter order_recruitment_enabled 0
declare_counter order_leaves
set_counter order_leaves 0
declare_counter templar_independence
set_counter templar_independence 0

monitor_event PreFactionTurnStart TrueCondition
    set_event_counter order_recruitment_enabled 0  
end_monitor

monitor_event PreFactionTurnStart TrueCondition
  and GlobalStanding > -0.3
  and not FactionExcommunicated
   
    set_event_counter order_recruitment_enabled 1
end_monitor


;monitor_event FactionTurnEnd not IsFactionAIControlled
;  and I_PlayerHasPreferati
;  and GlobalStanding < -0.5
;  and FactionExcommunicated
   
;    destroy_units papal_states, religious_order_unit
;    destroy_buildings papal_states templars_chapter_house true
;    destroy_buildings papal_states st_johns_chapter_house true
;    destroy_buildings papal_states teutonic_knights_chapter_house true
;    destroy_buildings papal_states knights_of_santiago_chapter_house true
;    set_counter order_leaves 1   
;end_monitor

monitor_event BuildingCompleted TrueCondition
  and NumBuildingsCompleted templars_major_ch > 9 
   
    set_event_counter templar_independence 1
    
    historic_event templar_greed
    terminate_monitor
end_monitor

declare_counter templar_destroyed_counter
monitor_event PreFactionTurnStart IsFactionAIControlled
  and I_EventCounter templar_independence = 1
  and RandomPercent > 75
  
  if I_CompareCounter ai_ec_id = 2
		inc_counter templar_destroyed_counter 1
    destroy_buildings venice templars_chapter_house true
    destroy_buildings venice templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 3
		inc_counter templar_destroyed_counter 1
    destroy_buildings sicily templars_chapter_house true
    destroy_buildings sicily templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 5
		inc_counter templar_destroyed_counter 1
    destroy_buildings papal_states templars_chapter_house true
    destroy_buildings papal_states templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 6
		inc_counter templar_destroyed_counter 1
    destroy_buildings denmark templars_chapter_house true
    destroy_buildings denmark templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 8
    inc_counter templar_destroyed_counter 1
    destroy_buildings scotland templars_chapter_house true
    destroy_buildings scotland templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 12
		inc_counter templar_destroyed_counter 1
    destroy_buildings france templars_chapter_house true
    destroy_buildings france templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 13
		inc_counter templar_destroyed_counter 1
    destroy_buildings hre templars_chapter_house true
    destroy_buildings hre templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 14
		inc_counter templar_destroyed_counter 1
    destroy_buildings england templars_chapter_house true
    destroy_buildings england templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 15
		inc_counter templar_destroyed_counter 1
    destroy_buildings portugal templars_chapter_house true
    destroy_buildings portugal templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 16
		inc_counter templar_destroyed_counter 1
    destroy_buildings poland templars_chapter_house true
    destroy_buildings poland templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 20
		inc_counter templar_destroyed_counter 1
    destroy_buildings spain templars_chapter_house true
    destroy_buildings spain templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 21
		inc_counter templar_destroyed_counter 1
    destroy_buildings hungary templars_chapter_house true
    destroy_buildings hungary templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 22
		inc_counter templar_destroyed_counter 1
    destroy_buildings aragon templars_chapter_house true
    destroy_buildings aragon templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 27
		inc_counter templar_destroyed_counter 1
    destroy_buildings norway templars_chapter_house true
    destroy_buildings norway templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 28
		inc_counter templar_destroyed_counter 1
    destroy_buildings jerusalem templars_chapter_house true
    destroy_buildings jerusalem templars_chapter_house_castle true
	end_if
	if I_CompareCounter ai_ec_id = 30
		inc_counter templar_destroyed_counter 1
    destroy_buildings pisa templars_chapter_house true
    destroy_buildings pisa templars_chapter_house_castle true
	end_if
  
  if I_CompareCounter templar_destroyed_counter > 15
    terminate_monitor
	end_if
  
end_monitor

;================= KNIGHTS HOSPITALLER FOUNDED ===================   

monitor_event PreFactionTurnStart not IsFactionAIControlled

  add_events
		  event	counter	knights_hospitaller_emerge
		  date	10
	 end_add_events
  
  
  terminate_monitor
end_monitor 

monitor_event EventCounter EventCounterType knights_hospitaller_emerge
	and EventCounter = 1

  historic_event knights_hospitaller_buildable
  
  terminate_monitor
end_monitor 


monitor_event BuildingCompleted TrueCondition
  and NumBuildingsCompleted st_johns_minor_ch > 3 

  historic_event knights_hospitaller
  
  terminate_monitor
end_monitor 

;================= TEUTONIC ORDER FOUNDED ===================
monitor_event FactionTurnStart FactionType slave
	and I_TurnNumber > 30

	
  if I_NumberOfSettlements jerusalem < 6 
    set_event_counter teutonic_knights_founded 1
	 terminate_monitor
  end_if
  
  if not I_SettlementOwner Jerusalem = jerusalem   
   set_event_counter teutonic_knights_founded 1
	 terminate_monitor
  end_if
  
  if not I_SettlementOwner Antioch = jerusalem   
   set_event_counter teutonic_knights_founded 1
	 terminate_monitor
  end_if
    
end_monitor  


monitor_event EventCounter EventCounterType teutonic_knights_founded
	and EventCounter = 1
  
  historic_event teutonic_knights
  
  add_events
		  event	counter	teutonic_knights_emerge
		  date	10
	 end_add_events
  
  
  terminate_monitor
end_monitor 

monitor_event EventCounter EventCounterType teutonic_knights_emerge
	and EventCounter = 1

  historic_event teutonic_knights_buildable
  
  terminate_monitor
end_monitor 


monitor_event BuildingCompleted TrueCondition
  and NumBuildingsCompleted teutonic_knights_minor_ch > 3 

  historic_event teutonic_order
  
  terminate_monitor
end_monitor 

;================= SANTIAGO ORDER FOUNDED ===================
monitor_event FactionTurnStart FactionType slave
	and I_TurnNumber > 45

	
  if I_NumberOfSettlements spain < 5 
    set_event_counter santiago_knights_founded 1
    historic_event santiago_knights
    
	 terminate_monitor
  end_if
  
  if I_FactionBesieged spain   
   set_event_counter santiago_knights_founded 1
   historic_event santiago_knights
   
	 terminate_monitor
  end_if
  
  if I_CrusadeInProgress
  and RandomPercent > 95 
   set_event_counter santiago_knights_founded 1
   historic_event santiago_knights
   
	 terminate_monitor
  end_if
    
end_monitor  

;================= MONTESA ORDER FOUNDED ===================


;================= BULGARIAN UPRISING ===================
declare_counter bulgarians_emerge
monitor_event SettlementTurnEnd SettlementName Sredets
  and SettlementLoyaltyLevel < loyalty_content 
  and RandomPercent < 5 
    inc_counter bulgarians_emerge 3
end_monitor

monitor_event SettlementTurnEnd SettlementName Nis
  and SettlementLoyaltyLevel < loyalty_content 
  and RandomPercent < 5 
    inc_counter bulgarians_emerge 3
end_monitor

monitor_event SettlementTurnEnd SettlementName Tarnovo
  and SettlementLoyaltyLevel < loyalty_content 
  and RandomPercent < 5 
    inc_counter bulgarians_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter bulgarians_emerge > 10
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building    
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building 
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building 
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building   
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building  
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building  
    
    console_command create_building Sredets hidden_malus_building
    console_command create_building Tarnovo hidden_malus_building
    console_command create_building Nis hidden_malus_building
    
      if not I_SettlementOwner Tarnovo = slave
        spawn_army
          faction slave
      			character Peter, named character, age 30, x 263, y 157, label Peter_of_Bulgaria
      			traits GoodCommander 4 , BattleDread 3 , StrategyDread 2 , PublicFaith 1 , NaturalMilitarySkill 2 , ofBulgariaName 1
      			unit		EE Bodyguard		exp 2 armour 0 weapon_lvl 0
      			unit		Mailed Knights		exp 2 armour 0 weapon_lvl 0
      			unit		Mailed Knights		exp 2 armour 0 weapon_lvl 0
      			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
      			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
      			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0      
      			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
      			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
      			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
      			unit		Balkan Archers		exp 2 armour 0 weapon_lvl 0
      			unit		Balkan Archers		exp 2 armour 0 weapon_lvl 0
      			unit		Balkan Archers		exp 2 armour 0 weapon_lvl 0
      			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
      			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
      			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
      			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0            
        end 
      end_if                                                        
      
      if not I_SettlementOwner Nis = slave
        spawn_army
          faction slave
    			character Kalman, named character, age 30, x 236, y 158, label Kalman_Slave
    			traits GoodCommander 2 , Bloodthirsty 2 , BattleDread 3
    			unit		EE Bodyguard		exp 2 armour 0 weapon_lvl 0
    			unit		Mailed Knights		exp 2 armour 0 weapon_lvl 0
    			unit		Mailed Knights		exp 2 armour 0 weapon_lvl 0
    			unit		Mailed Knights		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0      
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
    			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
    			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
        end
      end_if  
      
      if not I_SettlementOwner Sredets = slave
        spawn_army 
    			faction slave
    			character Ivan, named character, age 30, x 246, y 153, label Ivan_Slave
    			traits GoodCommander 2 , BattleChivalry 3 , StrategyChivalry 2 , PublicFaith 1 , NaturalMilitarySkill 1
    			unit    EE Bodyguard		exp 2 armour 0 weapon_lvl 0
    			unit		Mailed Knights		exp 2 armour 0 weapon_lvl 0
    			unit		Mailed Knights		exp 2 armour 0 weapon_lvl 0
    			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
    			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
    			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0      
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Balkan Archers		exp 2 armour 0 weapon_lvl 0
    			unit		Balkan Archers		exp 2 armour 0 weapon_lvl 0
    			unit		Balkan Archers		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Slav Levies		exp 2 armour 0 weapon_lvl 0
    			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
    			unit		Magyar Cavalry		exp 2 armour 0 weapon_lvl 0
  		  end
    end_if 
      
    
    if I_SettlementOwner Sredets = scotland
      faction_emerge slave scotland 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = denmark
      faction_emerge slave denmark 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = milan
      faction_emerge slave milan 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = norway
      faction_emerge slave norway 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = kievan_rus
      faction_emerge slave kievan_rus 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = rum
      faction_emerge slave rum 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = timurids
      faction_emerge slave timurids 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = aragon
      faction_emerge slave aragon 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = france
      faction_emerge slave france 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = venice
      faction_emerge slave venice 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = england
      faction_emerge slave england 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = sicily
      faction_emerge slave sicily 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = teutonic_order
      faction_emerge slave teutonic_order 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = moors
      faction_emerge slave moors 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = lithuania
      faction_emerge slave lithuania 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = portugal
      faction_emerge slave portugal 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = poland
      faction_emerge slave poland 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = spain
      faction_emerge slave spain 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = hungary
      faction_emerge slave hungary 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = russia
      faction_emerge slave russia 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = hre
      faction_emerge slave hre 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = jerusalem
      faction_emerge slave jerusalem 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = kwarezm
      faction_emerge slave kwarezm 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = turks
      faction_emerge slave turks 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = papal_states
      faction_emerge slave papal_states 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = mongols
      faction_emerge slave mongols 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = cumans
      faction_emerge slave cumans 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = byzantium
      faction_emerge slave byzantium 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = pisa
      faction_emerge slave pisa 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sredets = slave
      faction_emerge slave slave 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    if I_SettlementOwner Nis = scotland
      faction_emerge slave scotland 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = denmark
      faction_emerge slave denmark 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = milan
      faction_emerge slave milan 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = norway
      faction_emerge slave norway 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = kievan_rus
      faction_emerge slave kievan_rus 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = rum
      faction_emerge slave rum 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = timurids
      faction_emerge slave timurids 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = aragon
      faction_emerge slave aragon 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = france
      faction_emerge slave france 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = venice
      faction_emerge slave venice 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = england
      faction_emerge slave england 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = sicily
      faction_emerge slave sicily 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = teutonic_order
      faction_emerge slave teutonic_order 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = moors
      faction_emerge slave moors 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = lithuania
      faction_emerge slave lithuania 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = portugal
      faction_emerge slave portugal 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = poland
      faction_emerge slave poland 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = spain
      faction_emerge slave spain 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = hungary
      faction_emerge slave hungary 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = russia
      faction_emerge slave russia 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = hre
      faction_emerge slave hre 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = jerusalem
      faction_emerge slave jerusalem 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = kwarezm
      faction_emerge slave kwarezm 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = turks
      faction_emerge slave turks 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = papal_states
      faction_emerge slave papal_states 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = mongols
      faction_emerge slave mongols 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = cumans
      faction_emerge slave cumans 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = byzantium
      faction_emerge slave byzantium 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = pisa
      faction_emerge slave pisa 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Nis = slave
      faction_emerge slave slave 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    if I_SettlementOwner Tarnovo = scotland
      faction_emerge slave scotland 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = denmark
      faction_emerge slave denmark 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = milan
      faction_emerge slave milan 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = norway
      faction_emerge slave norway 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = kievan_rus
      faction_emerge slave kievan_rus 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = rum
      faction_emerge slave rum 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = timurids
      faction_emerge slave timurids 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = aragon
      faction_emerge slave aragon 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = france
      faction_emerge slave france 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = venice
      faction_emerge slave venice 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = england
      faction_emerge slave england 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = sicily
      faction_emerge slave sicily 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = teutonic_order
      faction_emerge slave teutonic_order 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = moors
      faction_emerge slave moors 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = lithuania
      faction_emerge slave lithuania 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = portugal
      faction_emerge slave portugal 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = poland
      faction_emerge slave poland 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = spain
      faction_emerge slave spain 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = hungary
      faction_emerge slave hungary 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = russia
      faction_emerge slave russia 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = hre
      faction_emerge slave hre 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = jerusalem
      faction_emerge slave jerusalem 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = kwarezm
      faction_emerge slave kwarezm 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = turks
      faction_emerge slave turks 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = papal_states
      faction_emerge slave papal_states 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = mongols
      faction_emerge slave mongols 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = cumans
      faction_emerge slave cumans 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = byzantium
      faction_emerge slave byzantium 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = pisa
      faction_emerge slave pisa 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tarnovo = slave
      faction_emerge slave slave 5 90.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event bulgarian_uprising
    set_event_counter bulgarians_rebel 1
  set_counter bulgarians_emerge 0
end_monitor

;================== TIMURIDS INVASION ===================

; TIMURIDS REPLACED BY GEORGIA!

;========================================================
;===================== G5 BAI STUFF =====================
;========================================================

;### Germanicu5 ReallyBadAI Battle System Scrips v5.x
;### This file contains manually programmed AI behaviour eliminating previously unfixable, hardcoded bugs and greatly influences battle performance
;### Support available at http://www.twcenter.net/forums/forumdisplay.php?f=1745 , http://www.twcenter.net/forums/showthread.php?t=257970 and http://www.twcenter.net/forums/showthread.php?t=253132
;### Non-private use of code only by permission,
;### coded by Germanicu5

;;;;;;;Print Info
log always Germanicu5 ReallyBadAI v5.7 Running. Please upload log and savegames when reporting battle CTDs for SS.
monitor_event GameReloaded
log always Germanicu5 ReallyBadAI v5.7 Running. Please upload log and savegames when reporting battle CTDs for SS.
end_monitor

;;;;;;;
declare_counter g5_battle_difficulty_high
;;;;;;;
declare_counter fire_labels
declare_counter panel_check
declare_counter player_unit_count
declare_counter enemy_unit_count
declare_counter open_battle
declare_counter labels_only
declare_counter stakes_lock
;;;;;;;
declare_counter pu1_missile
declare_counter pu2_missile
declare_counter pu3_missile
declare_counter pu4_missile
declare_counter pu5_missile
declare_counter pu6_missile
declare_counter pu7_missile
declare_counter pu8_missile
declare_counter pu9_missile
declare_counter pu10_missile
declare_counter pu11_missile
declare_counter pu12_missile
declare_counter pu13_missile
declare_counter pu14_missile
declare_counter pu15_missile
declare_counter pu16_missile
declare_counter pu17_missile
declare_counter pu18_missile
declare_counter pu19_missile
declare_counter pu20_missile
;;;;;;;Checks
declare_counter check_timer
declare_counter elephant_fix_check
declare_counter elephant_fix_check_sally
declare_counter script_delay
declare_counter reinf_check
declare_counter sally_defense_check
declare_counter sally_check
;;;;;;;Stakes
declare_counter label_ready
declare_counter stakes_on
;;;;;;;Reinforcements
declare_counter army4_ready
declare_counter reinf_late

declare_counter distance_trigger1
declare_counter distance_trigger2
declare_counter distance_trigger3
declare_counter distance_trigger4
declare_counter distance_trigger5

declare_counter kill_labelling_reinf_allied
declare_counter army3_reinf_allied
declare_counter army4_reinf_allied
declare_counter army5_reinf_allied
declare_counter army6_reinf_allied
declare_counter army7_reinf_allied
declare_counter army8_reinf_allied
declare_counter army9_reinf_allied
declare_counter army10_reinf_allied
declare_counter army11_reinf_allied
declare_counter army12_reinf_allied
declare_counter army13_reinf_allied
declare_counter army14_reinf_allied
declare_counter army15_reinf_allied
declare_counter army16_reinf_allied
declare_counter launch_alliance_0
declare_counter launch_alliance_1

declare_counter apply_strategy
declare_counter relaunch_movement

declare_counter att_alliance_ready
declare_counter def_alliance_ready
declare_counter def_alliance_ready_siege

declare_counter army3_moving
declare_counter army3_run
declare_counter army3_reinf_late
declare_counter army4_moving
declare_counter army4_run
declare_counter army4_reinf_late
declare_counter army5_moving
declare_counter army5_run
declare_counter army5_reinf_late
declare_counter army6_moving
declare_counter army6_run
declare_counter army6_reinf_late
declare_counter army7_moving
declare_counter army7_run
declare_counter army7_reinf_late
declare_counter army8_moving
declare_counter army8_run
declare_counter army8_reinf_late
declare_counter army9_moving
declare_counter army9_run
declare_counter army9_reinf_late
declare_counter army10_moving
declare_counter army10_run
declare_counter army10_reinf_late
declare_counter army11_moving
declare_counter army11_run
declare_counter army11_reinf_late
declare_counter army12_moving
declare_counter army12_run
declare_counter army12_reinf_late
declare_counter army13_moving
declare_counter army13_run
declare_counter army13_reinf_late
declare_counter army14_moving
declare_counter army14_run
declare_counter army14_reinf_late
declare_counter army15_moving
declare_counter army15_run
declare_counter army15_reinf_late
declare_counter army16_moving
declare_counter army16_run
declare_counter army16_reinf_late

declare_counter army4_ready_siege ; acts as launching counter
declare_counter army4_moving_siege
declare_counter army4_run_siege
declare_counter reinf_check_interval

;;;;;;;HA Fix
declare_counter ha_fix
;;;;;;;Elephant Fix
declare_counter elephant_fix
declare_counter elephant_gate
declare_counter elephant_gate_s
declare_counter elephant_gate_tier2
declare_counter elephant_gate_tier3
declare_counter elephant_gate_tier2s
declare_counter elephant_gate_tier3s
declare_counter rally_walls
declare_counter rally_walls_s
declare_counter second_ring
declare_counter third_ring
declare_counter second_ring_s
declare_counter third_ring_s
declare_counter del_objective
declare_counter del_objective_s
;;;;;;;Sally-out
declare_counter sally-out_fix
declare_counter sally_defense
declare_counter reform_back
declare_counter reform_multi
declare_counter unit_under_fire
declare_counter kill_sally
declare_counter sally_reinf
declare_counter reset_position
declare_counter defend_location
declare_counter reset_army2
declare_counter assign_labels
;;;;;;;Siege
declare_counter siege_fix
declare_counter army_sieging
declare_counter army_south
declare_counter army_north
declare_counter army_east
declare_counter army_west
declare_counter emergency_stop
declare_counter omfg_cannon_tower
declare_counter army2_sally
declare_counter wall_advance_s
;;;;;;;Protect General
declare_counter protect_general
declare_counter general_wait
declare_counter protect_siege
declare_counter g_stop
;;;;;;;Sally-out, AI defending
declare_counter army4_ready_sally
declare_counter army4_location
declare_counter path_n
declare_counter path_ne
declare_counter path_e
declare_counter path_se
declare_counter path_s
declare_counter path_sw
declare_counter path_w
declare_counter path_nw
declare_counter obstacle_check
declare_counter label_army4
declare_counter army4_moving_s
declare_counter army4_idle_s
declare_counter line_passed
declare_counter army2_idle_s
declare_counter army4_idle_r
declare_counter wall_line_passed
declare_counter reset_position_s
declare_counter repeat_test1
declare_counter repeat_test2
declare_counter repeat_test3
declare_counter repeat_test4
declare_counter repeat_test5
declare_counter repeat_test6
;;;;;;;Open Battles
declare_counter ob_defense_launch
declare_counter ob_defend
declare_counter ob_siege_attack
declare_counter ob_under_fire
declare_counter ob_repeat_test
declare_counter ob_engaged
declare_counter player_units_closing
declare_counter player_enveloping
declare_counter player_engaged_reinf
;;;;;;;AI Stuck Fix
declare_counter ai_stuck_launch
declare_counter a2u1_stuck
declare_counter a2u2_stuck
declare_counter a2u3_stuck
declare_counter a2u4_stuck
declare_counter a2u5_stuck
declare_counter a2u6_stuck
declare_counter a2u7_stuck
declare_counter a2u8_stuck
declare_counter a2u9_stuck
declare_counter a2u10_stuck
declare_counter a2u11_stuck
declare_counter a2u12_stuck
declare_counter a2u13_stuck
declare_counter a2u14_stuck
declare_counter a2u15_stuck
declare_counter a2u16_stuck
declare_counter a2u17_stuck
declare_counter a2u18_stuck
declare_counter a2u19_stuck
declare_counter a2u20_stuck
declare_counter a2u1_status
declare_counter a2u2_status
declare_counter a2u3_status
declare_counter a2u4_status
declare_counter a2u5_status
declare_counter a2u6_status
declare_counter a2u7_status
declare_counter a2u8_status
declare_counter a2u9_status
declare_counter a2u10_status
declare_counter a2u11_status
declare_counter a2u12_status
declare_counter a2u13_status
declare_counter a2u14_status
declare_counter a2u15_status
declare_counter a2u16_status
declare_counter a2u17_status
declare_counter a2u18_status
declare_counter a2u19_status
declare_counter a2u20_status
declare_counter a2u1_distance
declare_counter a2u2_distance
declare_counter a2u3_distance
declare_counter a2u4_distance
declare_counter a2u5_distance
declare_counter a2u6_distance
declare_counter a2u7_distance
declare_counter a2u8_distance
declare_counter a2u9_distance
declare_counter a2u10_distance
declare_counter a2u11_distance
declare_counter a2u12_distance
declare_counter a2u13_distance
declare_counter a2u14_distance
declare_counter a2u15_distance
declare_counter a2u16_distance
declare_counter a2u17_distance
declare_counter a2u18_distance
declare_counter a2u19_distance
declare_counter a2u20_distance        
;;;;;;;
set_event_counter no_advice 1 

monitor_event PreFactionTurnStart not IsFactionAIControlled
    and BattleDifficulty > medium

    set_counter g5_battle_difficulty_high 1
    terminate_monitor
end_monitor

monitor_event PreFactionTurnStart not IsFactionAIControlled
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsGeneral TargetFactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsGeneral IsFactionAIControlled
    and ! TargetFactionIsLocal
    and I_CompareCounter panel_check != 2

    set_counter panel_check 2
end_monitor

monitor_event GeneralAssaultsResidence TargetFactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsResidence IsFactionAIControlled
    and ! TargetFactionIsLocal
    and I_CompareCounter panel_check != 2

    set_counter panel_check 2
end_monitor

monitor_event ButtonPressed ButtonPressed prebattle_fight_button
    and I_CompareCounter panel_check = 1

;    suspend_unscripted_advice true
    set_counter fire_labels 10
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    set_counter player_unit_count 0
    set_counter enemy_unit_count 0
    set_counter open_battle 0
    set_counter labels_only 0
    set_counter stakes_lock 0
    ;;;;;;;
    set_counter pu1_missile 0
    set_counter pu2_missile 0
    set_counter pu3_missile 0
    set_counter pu4_missile 0
    set_counter pu5_missile 0
    set_counter pu6_missile 0
    set_counter pu7_missile 0
    set_counter pu8_missile 0
    set_counter pu9_missile 0
    set_counter pu10_missile 0
    set_counter pu11_missile 0
    set_counter pu12_missile 0
    set_counter pu13_missile 0
    set_counter pu14_missile 0
    set_counter pu15_missile 0
    set_counter pu16_missile 0
    set_counter pu17_missile 0
    set_counter pu18_missile 0
    set_counter pu19_missile 0
    set_counter pu20_missile 0
    ;;;;;;;Checks
    set_counter check_timer 0
    set_counter elephant_fix_check 0
    set_counter elephant_fix_check_sally 0
    set_counter reinf_check 0
    set_counter script_delay 0
    set_counter sally_defense_check 0
    set_counter sally_check 0
    ;;;;;;;Stakes
    set_counter label_ready 0
    set_counter stakes_on 0
    ;;;;;;;Reinforcements
    set_counter army4_ready 0
    set_counter reinf_late 0

    set_counter distance_trigger1 0
    set_counter distance_trigger2 0
    set_counter distance_trigger3 0
    set_counter distance_trigger4 0
    set_counter distance_trigger5 0

    set_counter kill_labelling_reinf_allied 0
    set_counter army3_reinf_allied 0
    set_counter army4_reinf_allied 0
    set_counter army5_reinf_allied 0
    set_counter army6_reinf_allied 0
    set_counter army7_reinf_allied 0
    set_counter army8_reinf_allied 0
    set_counter army9_reinf_allied 0
    set_counter army10_reinf_allied 0
    set_counter army11_reinf_allied 0
    set_counter army12_reinf_allied 0
    set_counter army13_reinf_allied 0
    set_counter army14_reinf_allied 0
    set_counter army15_reinf_allied 0
    set_counter army16_reinf_allied 0
    set_counter launch_alliance_0 0
    set_counter launch_alliance_1 0

    set_counter apply_strategy 0
    set_counter relaunch_movement 0

    set_counter att_alliance_ready 0
    set_counter def_alliance_ready 0
    set_counter def_alliance_ready_siege 0

    set_counter army3_moving 0
    set_counter army3_run 0
    set_counter army3_reinf_late 0
    set_counter army4_moving 0
    set_counter army4_run 0
    set_counter army4_reinf_late 0
    set_counter army5_moving 0
    set_counter army5_run 0
    set_counter army5_reinf_late 0
    set_counter army6_moving 0
    set_counter army6_run 0
    set_counter army6_reinf_late 0
    set_counter army7_moving 0
    set_counter army7_run 0
    set_counter army7_reinf_late 0
    set_counter army8_moving 0
    set_counter army8_run 0
    set_counter army8_reinf_late 0
    set_counter army9_moving 0
    set_counter army9_run 0
    set_counter army9_reinf_late 0
    set_counter army10_moving 0
    set_counter army10_run 0
    set_counter army10_reinf_late 0
    set_counter army11_moving 0
    set_counter army11_run 0
    set_counter army11_reinf_late 0
    set_counter army12_moving 0
    set_counter army12_run 0
    set_counter army12_reinf_late 0
    set_counter army13_moving 0
    set_counter army13_run 0
    set_counter army13_reinf_late 0
    set_counter army14_moving 0
    set_counter army14_run 0
    set_counter army14_reinf_late 0
    set_counter army15_moving 0
    set_counter army15_run 0
    set_counter army15_reinf_late 0
    set_counter army16_moving 0
    set_counter army16_run 0
    set_counter army16_reinf_late 0

    set_counter army4_ready_siege 0 ; acts as launching counter
    set_counter army4_moving_siege 0
    set_counter army4_run_siege 0
    set_counter reinf_check_interval 0

    ;;;;;;;HA Fix
    set_counter ha_fix 0
    ;;;;;;;Elephant Fix
    set_counter elephant_fix 0
    set_counter elephant_gate 0
    set_counter elephant_gate_s 0
    set_counter elephant_gate_tier2 0
    set_counter elephant_gate_tier3 0
    set_counter elephant_gate_tier2s 0
    set_counter elephant_gate_tier3s 0
    set_counter rally_walls 0
    set_counter rally_walls_s 0
    set_counter second_ring 0
    set_counter third_ring 0
    set_counter second_ring_s 0
    set_counter third_ring_s 0
    set_counter del_objective 0
    set_counter del_objective_s 0
    ;;;;;;;Sally-out
    set_counter sally-out_fix 0
    set_counter sally_defense 0
    set_counter reform_back 0
    set_counter reform_multi 0
    set_counter unit_under_fire 0
    set_counter kill_sally 0
    set_counter sally_reinf 0
    set_counter reset_position 0
    set_counter defend_location 0
    set_counter reset_army2 0
    set_counter assign_labels 0
    ;;;;;;;Siege
    set_counter siege_fix 0
    set_counter army_sieging 0
    set_counter army_south 0
    set_counter army_north 0
    set_counter army_east 0
    set_counter army_west 0
    set_counter emergency_stop 0
    set_counter omfg_cannon_tower 0
    set_counter army2_sally 0
    set_counter wall_advance_s 0
    ;;;;;;;Protect General
    set_counter protect_general 0
    set_counter general_wait 0
    set_counter protect_siege 0
    set_counter g_stop 0
    ;;;;;;;Sally-out, AI defending
    set_counter army4_ready_sally 0
    set_counter army4_location 0
    set_counter path_n 0
    set_counter path_ne 0
    set_counter path_e 0
    set_counter path_se 0
    set_counter path_s 0
    set_counter path_sw 0
    set_counter path_w 0
    set_counter path_nw 0
    set_counter obstacle_check 0
    set_counter label_army4 0
    set_counter army4_moving_s 0
    set_counter army4_idle_s 0
    set_counter line_passed 0
    set_counter army2_idle_s 0
    set_counter army4_idle_r 0
    set_counter wall_line_passed 0
    set_counter reset_position_s 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    ;;;;;;;Open Battles
    set_counter ob_defense_launch 0
    set_counter ob_defend 0
    set_counter ob_siege_attack 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 0
    set_counter ob_engaged 0
    set_counter player_units_closing 0
    set_counter player_enveloping 0
    set_counter player_engaged_reinf 0
    ;;;;;;;AI Stuck Fix
    set_counter ai_stuck_launch 0
    set_counter a2u1_stuck 0
    set_counter a2u2_stuck 0
    set_counter a2u3_stuck 0
    set_counter a2u4_stuck 0
    set_counter a2u5_stuck 0
    set_counter a2u6_stuck 0
    set_counter a2u7_stuck 0
    set_counter a2u8_stuck 0
    set_counter a2u9_stuck 0
    set_counter a2u10_stuck 0
    set_counter a2u11_stuck 0
    set_counter a2u12_stuck 0
    set_counter a2u13_stuck 0
    set_counter a2u14_stuck 0
    set_counter a2u15_stuck 0
    set_counter a2u16_stuck 0
    set_counter a2u17_stuck 0
    set_counter a2u18_stuck 0
    set_counter a2u19_stuck 0
    set_counter a2u20_stuck 0
    set_counter a2u1_status 0
    set_counter a2u2_status 0
    set_counter a2u3_status 0
    set_counter a2u4_status 0
    set_counter a2u5_status 0
    set_counter a2u6_status 0
    set_counter a2u7_status 0
    set_counter a2u8_status 0
    set_counter a2u9_status 0
    set_counter a2u10_status 0
    set_counter a2u11_status 0
    set_counter a2u12_status 0
    set_counter a2u13_status 0
    set_counter a2u14_status 0
    set_counter a2u15_status 0
    set_counter a2u16_status 0
    set_counter a2u17_status 0
    set_counter a2u18_status 0
    set_counter a2u19_status 0
    set_counter a2u20_status 0
    set_counter a2u1_distance 0
    set_counter a2u2_distance 0
    set_counter a2u3_distance 0
    set_counter a2u4_distance 0
    set_counter a2u5_distance 0
    set_counter a2u6_distance 0
    set_counter a2u7_distance 0
    set_counter a2u8_distance 0
    set_counter a2u9_distance 0
    set_counter a2u10_distance 0
    set_counter a2u11_distance 0
    set_counter a2u12_distance 0
    set_counter a2u13_distance 0
    set_counter a2u14_distance 0
    set_counter a2u15_distance 0
    set_counter a2u16_distance 0
    set_counter a2u17_distance 0
    set_counter a2u18_distance 0
    set_counter a2u19_distance 0
    set_counter a2u20_distance 0
    prepare_for_battle
end_monitor

monitor_conditions I_InBattle
    and I_CompareCounter fire_labels = 10

    set_counter fire_labels 0
    battle_wait 0.1

    if ! I_BattleIsSiegeBattle
    set_counter fire_labels 1
    end_if

    if I_BattleIsSiegeBattle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter fire_labels 1
    end_if

if I_BattlePlayerArmyIsAttacker

    ;;;Army 1
    set_counter player_unit_count 0
    if I_BattlePlayerArmyNumberOfUnits > 0
    label_unit 0 0 0 a1u1
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 1
    label_unit 0 0 1 a1u2
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 2
    label_unit 0 0 2 a1u3
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 3
    label_unit 0 0 3 a1u4
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 4
    label_unit 0 0 4 a1u5
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 5
    label_unit 0 0 5 a1u6
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 6
    label_unit 0 0 6 a1u7
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 7
    label_unit 0 0 7 a1u8
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 8
    label_unit 0 0 8 a1u9
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 9
    label_unit 0 0 9 a1u10
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 10
    label_unit 0 0 10 a1u11
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 11
    label_unit 0 0 11 a1u12
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 12
    label_unit 0 0 12 a1u13
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 13
    label_unit 0 0 13 a1u14
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 14
    label_unit 0 0 14 a1u15
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 15
    label_unit 0 0 15 a1u16
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 16
    label_unit 0 0 16 a1u17
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 17
    label_unit 0 0 17 a1u18
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 18
    label_unit 0 0 18 a1u19
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits = 20
    label_unit 0 0 19 a1u20
    inc_counter player_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if
if I_BattlePlayerArmyIsAttacker
;    and ! I_BattleIsSiegeBattle
    ;;;Army 2
    set_counter enemy_unit_count 0
    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if I_BattlePlayerArmyIsAttacker

    if I_BattlePlayerArmyNumberOfUnits = 1
    define_unit_group army1 a1u1
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 2
    define_unit_group army1 a1u1 a1u2
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 3
    define_unit_group army1 a1u1 a1u2 a1u3
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 4
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 5
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 6
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 7
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 8
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 9
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 10
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 11
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 12
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 13
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 14
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 15
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 16
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 17
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 18
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 19
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 20
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19 a1u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker
;    and ! I_BattleIsSiegeBattle
    if I_BattleEnemyArmyNumberOfUnits = 1
    define_unit_group army2 a2u1
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 2
    define_unit_group army2 a2u1 a2u2
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 3
    define_unit_group army2 a2u1 a2u2 a2u3
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 4
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 5
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 6
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 7
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 8
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 9
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 10
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 11
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 12
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 13
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 14
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 15
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 16
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 17
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 18
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 19
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 20
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19 a2u20
    end_if
end_if
if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 1
    set_counter enemy_unit_count 0
    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 0 0 0 a1u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 0 0 1 a1u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 0 0 2 a1u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 0 0 3 a1u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 0 0 4 a1u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 0 0 5 a1u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 0 0 6 a1u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 0 0 7 a1u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 0 0 8 a1u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 0 0 9 a1u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 0 0 10 a1u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 0 0 11 a1u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 0 0 12 a1u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 0 0 13 a1u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 0 0 14 a1u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 0 0 15 a1u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 0 0 16 a1u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 0 0 17 a1u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 0 0 18 a1u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 0 0 19 a1u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ;;;Army 2
    set_counter player_unit_count 0
    if I_BattlePlayerArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter player_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_BattleEnemyArmyNumberOfUnits = 1
    define_unit_group army1 a1u1
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 2
    define_unit_group army1 a1u1 a1u2
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 3
    define_unit_group army1 a1u1 a1u2 a1u3
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 4
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 5
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 6
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 7
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 8
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 9
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 10
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 11
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 12
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 13
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 14
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 15
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 16
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 17
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 18
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 19
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 20
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19 a1u20
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 1
    define_unit_group army2 a2u1
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 2
    define_unit_group army2 a2u1 a2u2
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 3
    define_unit_group army2 a2u1 a2u2 a2u3
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 4
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 5
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 6
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 7
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 8
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 9
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 10
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 11
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 12
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 13
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 14
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 15
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 16
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 17
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 18
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 19
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 20
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19 a2u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker
    if I_CompareCounter player_unit_count >= 1
    if I_UnitPercentageAmmoLeft a1u1 > 0
    set_counter pu1_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u1 = horde
    set_counter pu1_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 2
    if I_UnitPercentageAmmoLeft a1u2 > 0
    set_counter pu2_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u2 = horde
    set_counter pu2_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 3
    if I_UnitPercentageAmmoLeft a1u3 > 0
    set_counter pu3_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u3 = horde
    set_counter pu3_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 4
    if I_UnitPercentageAmmoLeft a1u4 > 0
    set_counter pu4_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u4 = horde
    set_counter pu4_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 5
    if I_UnitPercentageAmmoLeft a1u5 > 0
    set_counter pu5_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u5 = horde
    set_counter pu5_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 6
    if I_UnitPercentageAmmoLeft a1u6 > 0
    set_counter pu6_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u6 = horde
    set_counter pu6_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 7
    if I_UnitPercentageAmmoLeft a1u7 > 0
    set_counter pu7_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u7 = horde
    set_counter pu7_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 8
    if I_UnitPercentageAmmoLeft a1u8 > 0
    set_counter pu8_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u8 = horde
    set_counter pu8_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 9
    if I_UnitPercentageAmmoLeft a1u9 > 0
    set_counter pu9_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u9 = horde
    set_counter pu9_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 10
    if I_UnitPercentageAmmoLeft a1u10 > 0
    set_counter pu10_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u10 = horde
    set_counter pu10_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 11
    if I_UnitPercentageAmmoLeft a1u11 > 0
    set_counter pu11_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u11 = horde
    set_counter pu11_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 12
    if I_UnitPercentageAmmoLeft a1u12 > 0
    set_counter pu12_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u12 = horde
    set_counter pu12_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 13
    if I_UnitPercentageAmmoLeft a1u13 > 0
    set_counter pu13_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u13 = horde
    set_counter pu13_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 14
    if I_UnitPercentageAmmoLeft a1u14 > 0
    set_counter pu14_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u14 = horde
    set_counter pu14_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 15
    if I_UnitPercentageAmmoLeft a1u15 > 0
    set_counter pu15_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u15 = horde
    set_counter pu15_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 16
    if I_UnitPercentageAmmoLeft a1u16 > 0
    set_counter pu16_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u16 = horde
    set_counter pu16_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 17
    if I_UnitPercentageAmmoLeft a1u17 > 0
    set_counter pu17_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u17 = horde
    set_counter pu17_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 18
    if I_UnitPercentageAmmoLeft a1u18 > 0
    set_counter pu18_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u18 = horde
    set_counter pu18_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 19
    if I_UnitPercentageAmmoLeft a1u19 > 0
    set_counter pu19_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u19 = horde
    set_counter pu19_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count = 20
    if I_UnitPercentageAmmoLeft a1u20 > 0
    set_counter pu20_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u20 = horde
    set_counter pu20_missile 2
    end_if
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if ! I_BattlePlayerArmyIsAttacker
    if I_CompareCounter player_unit_count >= 1
    if I_UnitPercentageAmmoLeft a2u1 > 0
    set_counter pu1_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u1 = horde
    set_counter pu1_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 2
    if I_UnitPercentageAmmoLeft a2u2 > 0
    set_counter pu2_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u2 = horde
    set_counter pu2_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 3
    if I_UnitPercentageAmmoLeft a2u3 > 0
    set_counter pu3_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u3 = horde
    set_counter pu3_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 4
    if I_UnitPercentageAmmoLeft a2u4 > 0
    set_counter pu4_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u4 = horde
    set_counter pu4_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 5
    if I_UnitPercentageAmmoLeft a2u5 > 0
    set_counter pu5_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u5 = horde
    set_counter pu5_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 6
    if I_UnitPercentageAmmoLeft a2u6 > 0
    set_counter pu6_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u6 = horde
    set_counter pu6_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 7
    if I_UnitPercentageAmmoLeft a2u7 > 0
    set_counter pu7_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u7 = horde
    set_counter pu7_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 8
    if I_UnitPercentageAmmoLeft a2u8 > 0
    set_counter pu8_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u8 = horde
    set_counter pu8_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 9
    if I_UnitPercentageAmmoLeft a2u9 > 0
    set_counter pu9_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u9 = horde
    set_counter pu9_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 10
    if I_UnitPercentageAmmoLeft a2u10 > 0
    set_counter pu10_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u10 = horde
    set_counter pu10_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 11
    if I_UnitPercentageAmmoLeft a2u11 > 0
    set_counter pu11_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u11 = horde
    set_counter pu11_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 12
    if I_UnitPercentageAmmoLeft a2u12 > 0
    set_counter pu12_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u12 = horde
    set_counter pu12_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 13
    if I_UnitPercentageAmmoLeft a2u13 > 0
    set_counter pu13_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u13 = horde
    set_counter pu13_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 14
    if I_UnitPercentageAmmoLeft a2u14 > 0
    set_counter pu14_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u14 = horde
    set_counter pu14_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 15
    if I_UnitPercentageAmmoLeft a2u15 > 0
    set_counter pu15_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u15 = horde
    set_counter pu15_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 16
    if I_UnitPercentageAmmoLeft a2u16 > 0
    set_counter pu16_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u16 = horde
    set_counter pu16_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 17
    if I_UnitPercentageAmmoLeft a2u17 > 0
    set_counter pu17_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u17 = horde
    set_counter pu17_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 18
    if I_UnitPercentageAmmoLeft a2u18 > 0
    set_counter pu18_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u18 = horde
    set_counter pu18_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 19
    if I_UnitPercentageAmmoLeft a2u19 > 0
    set_counter pu19_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u19 = horde
    set_counter pu19_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count = 20
    if I_UnitPercentageAmmoLeft a2u20 > 0
    set_counter pu20_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u20 = horde
    set_counter pu20_missile 2
    end_if
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if
;    battle_wait 0.1
;    ai_active_set off
    battle_wait 0.1
    ai_active_set on
    set_counter labels_only 1

    if I_BattleIsSiegeBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter ai_stuck_launch 1
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattlePlayerArmyNumberOfAttribute stakes > 0
    set_counter stakes_lock 1
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
    set_counter protect_siege 1
    end_if

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and ! I_BattleIsRiverBattle
    and ! I_ConflictType SuccessfulAmbush
    set_counter open_battle 1
    end_if

if I_CompareCounter fire_labels = 1
    if I_BattleIsSiegeBattle
    label_location 0, -850, south_side
    label_location 0, 850, north_side
    label_location -850, 0, west_side
    label_location 850, 0, east_side
    end_if

    if I_BattleIsSallyOutBattle
    label_location 0, -850, south_side
    label_location 0, 850, north_side
    label_location -850, 0, west_side
    label_location 850, 0, east_side
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    label_location -470, -470, sw
    label_location 470, -470, se
    label_location -470, 470, nw
    label_location 470, 470, ne
    label_location -400, -400, sw_wall
    label_location 400, -400, se_wall
    label_location -400, 400, nw_wall
    label_location 400, 400, ne_wall
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 west_side east_side > 200
    set_counter army_south 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 west_side east_side < -200
    set_counter army_north 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 south_side north_side > 200
    set_counter army_east 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 south_side north_side < -200
    set_counter army_west 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 west_side east_side > 200
    set_counter army_south 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 west_side east_side < -200
    set_counter army_north 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 south_side north_side > 200
    set_counter army_east 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 south_side north_side < -200
    set_counter army_west 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter sally-out_fix 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter siege_fix 1
    end_if

    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_BattleIsSiegeBattle
    set_counter elephant_fix 1
    end_if

end_if
end_monitor

monitor_event BattleConflictPhaseCommenced not IsFactionAIControlled
    and I_CompareCounter panel_check = 1

    set_counter script_delay 1
    battle_wait 15
    if I_CompareCounter script_delay = 1

    if I_CompareCounter fire_labels = 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_CompareCounter g5_battle_difficulty_high = 1
    and I_BattleIsSiegeBattle
    set_counter label_ready 1
    end_if

    if I_CompareCounter fire_labels = 1
    if I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_CompareCounter g5_battle_difficulty_high = 1
    and ! I_BattleIsSiegeBattle
    set_counter label_ready 1
    end_if

    if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1
    ai_gta_plan_set 1 DEFEND_FEATURE
    battle_wait 1
    ai_active_set on
    set_counter ob_defense_launch 1
    end_if
    end_if

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and ! I_BattleIsRiverBattle
    and ! I_ConflictType SuccessfulAmbush
    and I_BattleEnemyArmyNumberOfUnits > 2
    set_counter g_stop 1
    end_if

    if I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter fire_labels = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter sally_defense 1
    set_counter assign_labels 1
    end_if

    if I_BattleStarted
    and I_CompareCounter fire_labels = 1
    and I_CompareCounter open_battle = 1
    set_counter ha_fix 1
    end_if

    if I_BattleStarted
    and I_CompareCounter fire_labels = 1
    and I_BattleIsRiverBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter ha_fix 1
    end_if
    set_counter script_delay 0
    end_if
end_monitor

monitor_event BattleReinforcementsArrive ! ArmyIsLocal
    and I_CompareCounter panel_check = 1
    and I_CompareCounter fire_labels = 1

    set_counter reinf_check 1
    battle_wait 15
if I_CompareCounter reinf_check = 1
    set_counter reinf_check 2
    battle_wait 15
if I_CompareCounter reinf_check = 2
    set_counter reinf_check 3
    battle_wait 15
if I_CompareCounter reinf_check = 3
 if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 3
    label_unit 0 1 0 a3u1
    define_unit_group army3a a3u1
    if ! I_PercentageUnitGroupKilled army3a = 100
    undefine_unit_group army3a
    ;;;Army 3
    label_unit 0 1 0 a3u1
    label_unit 0 1 1 a3u2
    label_unit 0 1 2 a3u3
    label_unit 0 1 3 a3u4
    label_unit 0 1 4 a3u5
    label_unit 0 1 5 a3u6
    label_unit 0 1 6 a3u7
    label_unit 0 1 7 a3u8
    label_unit 0 1 8 a3u9
    label_unit 0 1 9 a3u10
    label_unit 0 1 10 a3u11
    label_unit 0 1 11 a3u12
    label_unit 0 1 12 a3u13
    label_unit 0 1 13 a3u14
    label_unit 0 1 14 a3u15
    label_unit 0 1 15 a3u16
    label_unit 0 1 16 a3u17
    label_unit 0 1 17 a3u18
    label_unit 0 1 18 a3u19
    label_unit 0 1 19 a3u20

    define_unit_group army3 a3u1 a3u2 a3u3 a3u4 a3u5 a3u6 a3u7 a3u8 a3u9 a3u10 a3u11 a3u12 a3u13 a3u14 a3u15 a3u16 a3u17 a3u18 a3u19 a3u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker

    ;;;Army 4
    label_unit 1 1 0 a4u1
    define_unit_group army4a a4u1
    if ! I_PercentageUnitGroupKilled army4a = 100
    undefine_unit_group army4a
    ;;;Army 4
    label_unit 1 1 0 a4u1
    label_unit 1 1 1 a4u2
    label_unit 1 1 2 a4u3
    label_unit 1 1 3 a4u4
    label_unit 1 1 4 a4u5
    label_unit 1 1 5 a4u6
    label_unit 1 1 6 a4u7
    label_unit 1 1 7 a4u8
    label_unit 1 1 8 a4u9
    label_unit 1 1 9 a4u10
    label_unit 1 1 10 a4u11
    label_unit 1 1 11 a4u12
    label_unit 1 1 12 a4u13
    label_unit 1 1 13 a4u14
    label_unit 1 1 14 a4u15
    label_unit 1 1 15 a4u16
    label_unit 1 1 16 a4u17
    label_unit 1 1 17 a4u18
    label_unit 1 1 18 a4u19
    label_unit 1 1 19 a4u20

    define_unit_group army4 a4u1 a4u2 a4u3 a4u4 a4u5 a4u6 a4u7 a4u8 a4u9 a4u10 a4u11 a4u12 a4u13 a4u14 a4u15 a4u16 a4u17 a4u18 a4u19 a4u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army3 = 100
    set_counter army3_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army4 = 100
    set_counter army4_reinf_allied 1
    end_if

    if I_PercentageUnitGroupKilled army3 = 100
    and I_PercentageUnitGroupKilled army4 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

if ! I_BattleIsSallyOutBattle

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 5
    label_unit 0 2 0 a5u1
    define_unit_group army5a a5u1
    if ! I_PercentageUnitGroupKilled army5a = 100
    undefine_unit_group army5a
    ;;;Army 5
    label_unit 0 2 0 a5u1
    label_unit 0 2 1 a5u2
    label_unit 0 2 2 a5u3
    label_unit 0 2 3 a5u4
    label_unit 0 2 4 a5u5
    label_unit 0 2 5 a5u6
    label_unit 0 2 6 a5u7
    label_unit 0 2 7 a5u8
    label_unit 0 2 8 a5u9
    label_unit 0 2 9 a5u10
    label_unit 0 2 10 a5u11
    label_unit 0 2 11 a5u12
    label_unit 0 2 12 a5u13
    label_unit 0 2 13 a5u14
    label_unit 0 2 14 a5u15
    label_unit 0 2 15 a5u16
    label_unit 0 2 16 a5u17
    label_unit 0 2 17 a5u18
    label_unit 0 2 18 a5u19
    label_unit 0 2 19 a5u20

    define_unit_group army5 a5u1 a5u2 a5u3 a5u4 a5u5 a5u6 a5u7 a5u8 a5u9 a5u10 a5u11 a5u12 a5u13 a5u14 a5u15 a5u16 a5u17 a5u18 a5u19 a5u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker
    ;;;Army 6
    label_unit 1 2 0 a6u1
    define_unit_group army6a a6u1
    if ! I_PercentageUnitGroupKilled army6a = 100
    undefine_unit_group army6a 	
    ;;;Army 6
    label_unit 1 2 0 a6u1
    label_unit 1 2 1 a6u2
    label_unit 1 2 2 a6u3
    label_unit 1 2 3 a6u4
    label_unit 1 2 4 a6u5
    label_unit 1 2 5 a6u6
    label_unit 1 2 6 a6u7
    label_unit 1 2 7 a6u8
    label_unit 1 2 8 a6u9
    label_unit 1 2 9 a6u10
    label_unit 1 2 10 a6u11
    label_unit 1 2 11 a6u12
    label_unit 1 2 12 a6u13
    label_unit 1 2 13 a6u14
    label_unit 1 2 14 a6u15
    label_unit 1 2 15 a6u16
    label_unit 1 2 16 a6u17
    label_unit 1 2 17 a6u18
    label_unit 1 2 18 a6u19
    label_unit 1 2 19 a6u20

    define_unit_group army6 a6u1 a6u2 a6u3 a6u4 a6u5 a6u6 a6u7 a6u8 a6u9 a6u10 a6u11 a6u12 a6u13 a6u14 a6u15 a6u16 a6u17 a6u18 a6u19 a6u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army5 = 100
    set_counter army5_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army6 = 100
    set_counter army6_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army5 = 100
    and I_PercentageUnitGroupKilled army6 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 7
    label_unit 0 3 0 a7u1
    define_unit_group army7a a7u1
    if ! I_PercentageUnitGroupKilled army7a = 100
    undefine_unit_group army7a 	
    ;;;Army 7
    label_unit 0 3 0 a7u1
    label_unit 0 3 1 a7u2
    label_unit 0 3 2 a7u3
    label_unit 0 3 3 a7u4
    label_unit 0 3 4 a7u5
    label_unit 0 3 5 a7u6
    label_unit 0 3 6 a7u7
    label_unit 0 3 7 a7u8
    label_unit 0 3 8 a7u9
    label_unit 0 3 9 a7u10
    label_unit 0 3 10 a7u11
    label_unit 0 3 11 a7u12
    label_unit 0 3 12 a7u13
    label_unit 0 3 13 a7u14
    label_unit 0 3 14 a7u15
    label_unit 0 3 15 a7u16
    label_unit 0 3 16 a7u17
    label_unit 0 3 17 a7u18
    label_unit 0 3 18 a7u19
    label_unit 0 3 19 a7u20

    define_unit_group army7 a7u1 a7u2 a7u3 a7u4 a7u5 a7u6 a7u7 a7u8 a7u9 a7u10 a7u11 a7u12 a7u13 a7u14 a7u15 a7u16 a7u17 a7u18 a7u19 a7u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 8
    label_unit 1 3 0 a8u1
    define_unit_group army8a a8u1
    if ! I_PercentageUnitGroupKilled army8a = 100
    undefine_unit_group army8a 	
    ;;;Army 8
    label_unit 1 3 0 a8u1
    label_unit 1 3 1 a8u2
    label_unit 1 3 2 a8u3
    label_unit 1 3 3 a8u4
    label_unit 1 3 4 a8u5
    label_unit 1 3 5 a8u6
    label_unit 1 3 6 a8u7
    label_unit 1 3 7 a8u8
    label_unit 1 3 8 a8u9
    label_unit 1 3 9 a8u10
    label_unit 1 3 10 a8u11
    label_unit 1 3 11 a8u12
    label_unit 1 3 12 a8u13
    label_unit 1 3 13 a8u14
    label_unit 1 3 14 a8u15
    label_unit 1 3 15 a8u16
    label_unit 1 3 16 a8u17
    label_unit 1 3 17 a8u18
    label_unit 1 3 18 a8u19
    label_unit 1 3 19 a8u20

    define_unit_group army8 a8u1 a8u2 a8u3 a8u4 a8u5 a8u6 a8u7 a8u8 a8u9 a8u10 a8u11 a8u12 a8u13 a8u14 a8u15 a8u16 a8u17 a8u18 a8u19 a8u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army7 = 100
    set_counter army7_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army8 = 100
    set_counter army8_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army7 = 100
    and I_PercentageUnitGroupKilled army8 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 9
    label_unit 0 4 0 a9u1
    define_unit_group army9a a9u1
    if ! I_PercentageUnitGroupKilled army9a = 100
    undefine_unit_group army9a 	
    ;;;Army 9
    label_unit 0 4 0 a9u1
    label_unit 0 4 1 a9u2
    label_unit 0 4 2 a9u3
    label_unit 0 4 3 a9u4
    label_unit 0 4 4 a9u5
    label_unit 0 4 5 a9u6
    label_unit 0 4 6 a9u7
    label_unit 0 4 7 a9u8
    label_unit 0 4 8 a9u9
    label_unit 0 4 9 a9u10
    label_unit 0 4 10 a9u11
    label_unit 0 4 11 a9u12
    label_unit 0 4 12 a9u13
    label_unit 0 4 13 a9u14
    label_unit 0 4 14 a9u15
    label_unit 0 4 15 a9u16
    label_unit 0 4 16 a9u17
    label_unit 0 4 17 a9u18
    label_unit 0 4 18 a9u19
    label_unit 0 4 19 a9u20

    define_unit_group army9 a9u1 a9u2 a9u3 a9u4 a9u5 a9u6 a9u7 a9u8 a9u9 a9u10 a9u11 a9u12 a9u13 a9u14 a9u15 a9u16 a9u17 a9u18 a9u19 a9u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 10
    label_unit 1 4 0 a10u1
    define_unit_group army10a a10u1
    if ! I_PercentageUnitGroupKilled army10a = 100
    undefine_unit_group army10a 	
    ;;;Army 10
    label_unit 1 4 0 a10u1
    label_unit 1 4 1 a10u2
    label_unit 1 4 2 a10u3
    label_unit 1 4 3 a10u4
    label_unit 1 4 4 a10u5
    label_unit 1 4 5 a10u6
    label_unit 1 4 6 a10u7
    label_unit 1 4 7 a10u8
    label_unit 1 4 8 a10u9
    label_unit 1 4 9 a10u10
    label_unit 1 4 10 a10u11
    label_unit 1 4 11 a10u12
    label_unit 1 4 12 a10u13
    label_unit 1 4 13 a10u14
    label_unit 1 4 14 a10u15
    label_unit 1 4 15 a10u16
    label_unit 1 4 16 a10u17
    label_unit 1 4 17 a10u18
    label_unit 1 4 18 a10u19
    label_unit 1 4 19 a10u20

    define_unit_group army10 a10u1 a10u2 a10u3 a10u4 a10u5 a10u6 a10u7 a10u8 a10u9 a10u10 a10u11 a10u12 a10u13 a10u14 a10u15 a10u16 a10u17 a10u18 a10u19 a10u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army9 = 100
    set_counter army9_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army10 = 100
    set_counter army10_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army9 = 100
    and I_PercentageUnitGroupKilled army10 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 11
    label_unit 0 5 0 a11u1
    define_unit_group army11a a11u1
    if ! I_PercentageUnitGroupKilled army11a = 100
    undefine_unit_group army11a 	
    ;;;Army 11
    label_unit 0 5 0 a11u1
    label_unit 0 5 1 a11u2
    label_unit 0 5 2 a11u3
    label_unit 0 5 3 a11u4
    label_unit 0 5 4 a11u5
    label_unit 0 5 5 a11u6
    label_unit 0 5 6 a11u7
    label_unit 0 5 7 a11u8
    label_unit 0 5 8 a11u9
    label_unit 0 5 9 a11u10
    label_unit 0 5 10 a11u11
    label_unit 0 5 11 a11u12
    label_unit 0 5 12 a11u13
    label_unit 0 5 13 a11u14
    label_unit 0 5 14 a11u15
    label_unit 0 5 15 a11u16
    label_unit 0 5 16 a11u17
    label_unit 0 5 17 a11u18
    label_unit 0 5 18 a11u19
    label_unit 0 5 19 a11u20

    define_unit_group army11 a11u1 a11u2 a11u3 a11u4 a11u5 a11u6 a11u7 a11u8 a11u9 a11u10 a11u11 a11u12 a11u13 a11u14 a11u15 a11u16 a11u17 a11u18 a11u19 a11u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 12
    label_unit 1 5 0 a12u1
    define_unit_group army12a a12u1
    if ! I_PercentageUnitGroupKilled army12a = 100
    undefine_unit_group army12a 	
    ;;;Army 12
    label_unit 1 5 0 a12u1
    label_unit 1 5 1 a12u2
    label_unit 1 5 2 a12u3
    label_unit 1 5 3 a12u4
    label_unit 1 5 4 a12u5
    label_unit 1 5 5 a12u6
    label_unit 1 5 6 a12u7
    label_unit 1 5 7 a12u8
    label_unit 1 5 8 a12u9
    label_unit 1 5 9 a12u10
    label_unit 1 5 10 a12u11
    label_unit 1 5 11 a12u12
    label_unit 1 5 12 a12u13
    label_unit 1 5 13 a12u14
    label_unit 1 5 14 a12u15
    label_unit 1 5 15 a12u16
    label_unit 1 5 16 a12u17
    label_unit 1 5 17 a12u18
    label_unit 1 5 18 a12u19
    label_unit 1 5 19 a12u20

    define_unit_group army12 a12u1 a12u2 a12u3 a12u4 a12u5 a12u6 a12u7 a12u8 a12u9 a12u10 a12u11 a12u12 a12u13 a12u14 a12u15 a12u16 a12u17 a12u18 a12u19 a12u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army11 = 100
    set_counter army11_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army12 = 100
    set_counter army12_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army11 = 100
    and I_PercentageUnitGroupKilled army12 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 13
    label_unit 0 6 0 a13u1
    define_unit_group army13a a13u1
    if ! I_PercentageUnitGroupKilled army13a = 100
    undefine_unit_group army13a 	
    ;;;Army 13
    label_unit 0 6 0 a13u1
    label_unit 0 6 1 a13u2
    label_unit 0 6 2 a13u3
    label_unit 0 6 3 a13u4
    label_unit 0 6 4 a13u5
    label_unit 0 6 5 a13u6
    label_unit 0 6 6 a13u7
    label_unit 0 6 7 a13u8
    label_unit 0 6 8 a13u9
    label_unit 0 6 9 a13u10
    label_unit 0 6 10 a13u11
    label_unit 0 6 11 a13u12
    label_unit 0 6 12 a13u13
    label_unit 0 6 13 a13u14
    label_unit 0 6 14 a13u15
    label_unit 0 6 15 a13u16
    label_unit 0 6 16 a13u17
    label_unit 0 6 17 a13u18
    label_unit 0 6 18 a13u19
    label_unit 0 6 19 a13u20

    define_unit_group army13 a13u1 a13u2 a13u3 a13u4 a13u5 a13u6 a13u7 a13u8 a13u9 a13u10 a13u11 a13u12 a13u13 a13u14 a13u15 a13u16 a13u17 a13u18 a13u19 a13u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker	
    ;;;Army 14
    label_unit 1 6 0 a14u1
    define_unit_group army14a a14u1
    if ! I_PercentageUnitGroupKilled army14a = 100
    undefine_unit_group army14a 	
    ;;;Army 14
    label_unit 1 6 0 a14u1
    label_unit 1 6 1 a14u2
    label_unit 1 6 2 a14u3
    label_unit 1 6 3 a14u4
    label_unit 1 6 4 a14u5
    label_unit 1 6 5 a14u6
    label_unit 1 6 6 a14u7
    label_unit 1 6 7 a14u8
    label_unit 1 6 8 a14u9
    label_unit 1 6 9 a14u10
    label_unit 1 6 10 a14u11
    label_unit 1 6 11 a14u12
    label_unit 1 6 12 a14u13
    label_unit 1 6 13 a14u14
    label_unit 1 6 14 a14u15
    label_unit 1 6 15 a14u16
    label_unit 1 6 16 a14u17
    label_unit 1 6 17 a14u18
    label_unit 1 6 18 a14u19
    label_unit 1 6 19 a14u20

    define_unit_group army14 a14u1 a14u2 a14u3 a14u4 a14u5 a14u6 a14u7 a14u8 a14u9 a14u10 a14u11 a14u12 a14u13 a14u14 a14u15 a14u16 a14u17 a14u18 a14u19 a14u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army13 = 100
    set_counter army13_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army14 = 100
    set_counter army14_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army13 = 100
    and I_PercentageUnitGroupKilled army14 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 15
    label_unit 0 7 0 a15u1
    define_unit_group army15a a15u1
    if ! I_PercentageUnitGroupKilled army15a = 100
    undefine_unit_group army15a 	
    ;;;Army 15
    label_unit 0 7 0 a15u1
    label_unit 0 7 1 a15u2
    label_unit 0 7 2 a15u3
    label_unit 0 7 3 a15u4
    label_unit 0 7 4 a15u5
    label_unit 0 7 5 a15u6
    label_unit 0 7 6 a15u7
    label_unit 0 7 7 a15u8
    label_unit 0 7 8 a15u9
    label_unit 0 7 9 a15u10
    label_unit 0 7 10 a15u11
    label_unit 0 7 11 a15u12
    label_unit 0 7 12 a15u13
    label_unit 0 7 13 a15u14
    label_unit 0 7 14 a15u15
    label_unit 0 7 15 a15u16
    label_unit 0 7 16 a15u17
    label_unit 0 7 17 a15u18
    label_unit 0 7 18 a15u19
    label_unit 0 7 19 a15u20

    define_unit_group army15 a15u1 a15u2 a15u3 a15u4 a15u5 a15u6 a15u7 a15u8 a15u9 a15u10 a15u11 a15u12 a15u13 a15u14 a15u15 a15u16 a15u17 a15u18 a15u19 a15u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker	
    ;;;Army 16
    label_unit 1 7 0 a16u1
    define_unit_group army16a a16u1
    if ! I_PercentageUnitGroupKilled army16a = 100
    undefine_unit_group army16a 	
    ;;;Army 16
    label_unit 1 7 0 a16u1
    label_unit 1 7 1 a16u2
    label_unit 1 7 2 a16u3
    label_unit 1 7 3 a16u4
    label_unit 1 7 4 a16u5
    label_unit 1 7 5 a16u6
    label_unit 1 7 6 a16u7
    label_unit 1 7 7 a16u8
    label_unit 1 7 8 a16u9
    label_unit 1 7 9 a16u10
    label_unit 1 7 10 a16u11
    label_unit 1 7 11 a16u12
    label_unit 1 7 12 a16u13
    label_unit 1 7 13 a16u14
    label_unit 1 7 14 a16u15
    label_unit 1 7 15 a16u16
    label_unit 1 7 16 a16u17
    label_unit 1 7 17 a16u18
    label_unit 1 7 18 a16u19
    label_unit 1 7 19 a16u20

    define_unit_group army16 a16u1 a16u2 a16u3 a16u4 a16u5 a16u6 a16u7 a16u8 a16u9 a16u10 a16u11 a16u12 a16u13 a16u14 a16u15 a16u16 a16u17 a16u18 a16u19 a16u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army15 = 100
    set_counter army15_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army16 = 100
    set_counter army16_reinf_allied 1
    end_if
end_if

end_if
battle_wait 0.5
ai_active_set on

;;;;;;;Reinforcements

    ;;;;;;; Attacking
    if ! I_BattlePlayerArmyIsAttacker
    and ! I_ConflictType SuccessfulAmbush
;    and ! I_ConflictType FailedAmbush
    and ! I_BattleIsSiegeBattle
    and I_CompareCounter army3_reinf_allied = 1

    set_counter apply_strategy 1
;    battle_wait 1
;    set_counter att_alliance_ready 1
    end_if

    ;;;;;;; Defending
    if I_BattlePlayerArmyIsAttacker
    and ! I_ConflictType SuccessfulAmbush
;    and ! I_ConflictType FailedAmbush
    and I_CompareCounter army4_reinf_allied = 1

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    set_counter army4_ready 1
    set_counter def_alliance_ready 1
    end_if
    if ! I_BattleIsSiegeBattle
    and I_BattleIsSallyOutBattle
    set_counter army4_ready_sally 1
    set_counter sally_reinf 1
    end_if

    ;;;;;;; Siege
    if I_BattleIsSiegeBattle
    set_counter def_alliance_ready_siege 1
    end_if
    end_if
end_if
end_if
end_if
end_monitor

;Apply Strategy

monitor_conditions I_BattleStarted
    and I_CompareCounter apply_strategy = 1

if ! I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1

;    ai_gta_plan_set 0 ATTACK_ALL
    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
    set_counter launch_alliance_0 1
end_if

if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1

;    ai_gta_plan_set 1 ATTACK_ALL
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999
    set_counter launch_alliance_1 1
end_if

if I_CompareCounter launch_alliance_0 = 1
    and I_CompareCounter army3_reinf_allied = 1

    ;;;Army 1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u20
    ;;;Army 3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u20
if I_CompareCounter army5_reinf_allied = 1
    ;;;Army 5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u20
if I_CompareCounter army7_reinf_allied = 1
    ;;;Army 7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u20
if I_CompareCounter army9_reinf_allied = 1
     ;;;Army 9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u20
if I_CompareCounter army11_reinf_allied = 1
    ;;;Army 11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u20
if I_CompareCounter army13_reinf_allied = 1
    ;;;Army 13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u20
if I_CompareCounter army15_reinf_allied = 1
    ;;;Army 15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u20
end_if
end_if
end_if
end_if
end_if
end_if
end_if

if I_CompareCounter launch_alliance_1 = 1
    and I_CompareCounter army4_reinf_allied = 1

    ;;;Army 2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u20
    ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20
if I_CompareCounter army6_reinf_allied = 1
    ;;;Army 6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u20
if I_CompareCounter army8_reinf_allied = 1
    ;;;Army 8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u20
if I_CompareCounter army10_reinf_allied = 1
     ;;;Army 10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u20
if I_CompareCounter army12_reinf_allied = 1
    ;;;Army 12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u20
if I_CompareCounter army14_reinf_allied = 1
    ;;;Army 14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u20
if I_CompareCounter army16_reinf_allied = 1
    ;;;Army 16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u20
end_if
end_if
end_if
end_if
end_if
end_if
end_if
battle_wait 0.5
ai_active_set on
set_counter apply_strategy 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter relaunch_movement = 1

    ai_active_set on
    battle_wait 0.5
    set_counter army3_moving 0
    set_counter army4_moving 0
    set_counter army5_moving 0
    set_counter army6_moving 0
    set_counter army7_moving 0
    set_counter army8_moving 0
    set_counter army9_moving 0
    set_counter army10_moving 0
    set_counter army11_moving 0
    set_counter army12_moving 0
    set_counter army13_moving 0
    set_counter army14_moving 0
    set_counter army15_moving 0
    set_counter army16_moving 0

    battle_wait 5
    set_counter relaunch_movement 0
end_monitor

;;;;;;; Attacking

monitor_conditions I_BattleStarted
    and I_CompareCounter att_alliance_ready = 1
    and ! I_BattlePlayerArmyIsAttacker
 ;    inc_counter reinf_check_interval 1
 if I_CompareCounter army3_reinf_allied = 1

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 1
    and I_UnitEnemyUnitInRadius a3u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army3_moving 0
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 1
    and ! I_UnitEnemyUnitInRadius a3u1 160
    and I_UnitDistanceFromUnit a1u1 a3u1 > 150
    and I_IsUnitIdle a3u1

    set_counter army3_reinf_late 1
    battle_wait 1
    set_counter army3_moving 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 0
    and ! I_UnitEnemyUnitInRadius a3u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    set_counter army3_run 1
    set_counter army3_moving 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 1000

    set_counter army3_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 750

    set_counter army3_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 500

    set_counter army3_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 300

    set_counter army3_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 200

    set_counter army3_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a3u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    set_counter army3_run 1
    battle_wait 0.5
    set_counter army3_moving 1
    set_counter army3_reinf_late 0
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 100

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitKilled a3u1 > 60

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitGroupKilled army3 > 50

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army3 a1u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a3u1 < 250
    and I_IsUnitIdle a3u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a3u1 < 250
    and I_IsUnitUnderFire a3u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_run = 1

;    unit_group_order_halt army3
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army3 a1u1 run
    battle_wait 0.5
    set_counter army3_run 0
    end_if

end_if

if I_CompareCounter army5_reinf_allied = 1

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 1
    and I_UnitEnemyUnitInRadius a5u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army5_moving 0
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 1
    and ! I_UnitEnemyUnitInRadius a5u1 160
    and I_UnitDistanceFromUnit a1u1 a5u1 > 150
    and I_IsUnitIdle a5u1

    set_counter army5_reinf_late 1
    battle_wait 1
    set_counter army5_moving 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 0
    and ! I_UnitEnemyUnitInRadius a5u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    set_counter army5_run 1
    set_counter army5_moving 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 1000

    set_counter army5_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 750

    set_counter army5_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 500

    set_counter army5_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 300

    set_counter army5_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 200

    set_counter army5_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a5u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    set_counter army5_run 1
    battle_wait 0.5
    set_counter army5_moving 1
    set_counter army5_reinf_late 0
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 100

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitKilled a5u1 > 60

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitGroupKilled army5 > 50

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army5 a1u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a5u1 < 250
    and I_IsUnitIdle a5u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a5u1 < 250
    and I_IsUnitUnderFire a5u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_run = 1

;    unit_group_order_halt army5
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army5 a1u1 run
    battle_wait 0.5
    set_counter army5_run 0
    end_if

end_if

if I_CompareCounter army7_reinf_allied = 1

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 1
    and I_UnitEnemyUnitInRadius a7u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army7_moving 0
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 1
    and ! I_UnitEnemyUnitInRadius a7u1 160
    and I_UnitDistanceFromUnit a1u1 a7u1 > 150
    and I_IsUnitIdle a7u1

    set_counter army7_reinf_late 1
    battle_wait 1
    set_counter army7_moving 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 0
    and ! I_UnitEnemyUnitInRadius a7u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    set_counter army7_run 1
    set_counter army7_moving 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 1000

    set_counter army7_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 750

    set_counter army7_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 500

    set_counter army7_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 300

    set_counter army7_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 200

    set_counter army7_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a7u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    set_counter army7_run 1
    battle_wait 0.5
    set_counter army7_moving 1
    set_counter army7_reinf_late 0
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 100

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitKilled a7u1 > 60

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitGroupKilled army7 > 50

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army7 a1u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a7u1 < 250
    and I_IsUnitIdle a7u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a7u1 < 250
    and I_IsUnitUnderFire a7u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_run = 1

;    unit_group_order_halt army7
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army7 a1u1 run
    battle_wait 0.5
    set_counter army7_run 0
    end_if

end_if

if I_CompareCounter army9_reinf_allied = 1

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 1
    and I_UnitEnemyUnitInRadius a9u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army9_moving 0
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 1
    and ! I_UnitEnemyUnitInRadius a9u1 160
    and I_UnitDistanceFromUnit a1u1 a9u1 > 150
    and I_IsUnitIdle a9u1

    set_counter army9_reinf_late 1
    battle_wait 1
    set_counter army9_moving 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 0
    and ! I_UnitEnemyUnitInRadius a9u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    set_counter army9_run 1
    set_counter army9_moving 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 1000

    set_counter army9_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 750

    set_counter army9_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 500

    set_counter army9_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 300

    set_counter army9_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 200

    set_counter army9_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a9u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    set_counter army9_run 1
    battle_wait 0.5
    set_counter army9_moving 1
    set_counter army9_reinf_late 0
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 100

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitKilled a9u1 > 60

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitGroupKilled army9 > 50

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army9 a1u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a9u1 < 250
    and I_IsUnitIdle a9u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a9u1 < 250
    and I_IsUnitUnderFire a9u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_run = 1

;    unit_group_order_halt army9
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army9 a1u1 run
    battle_wait 0.5
    set_counter army9_run 0
    end_if

end_if

if I_CompareCounter army11_reinf_allied = 1

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 1
    and I_UnitEnemyUnitInRadius a11u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army11_moving 0
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 1
    and ! I_UnitEnemyUnitInRadius a11u1 160
    and I_UnitDistanceFromUnit a1u1 a11u1 > 150
    and I_IsUnitIdle a11u1

    set_counter army11_reinf_late 1
    battle_wait 1
    set_counter army11_moving 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 0
    and ! I_UnitEnemyUnitInRadius a11u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    set_counter army11_run 1
    set_counter army11_moving 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 1000

    set_counter army11_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 750

    set_counter army11_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 500

    set_counter army11_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 300

    set_counter army11_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 200

    set_counter army11_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a11u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    set_counter army11_run 1
    battle_wait 0.5
    set_counter army11_moving 1
    set_counter army11_reinf_late 0
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 100

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitKilled a11u1 > 60

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitGroupKilled army11 > 50

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army11 a1u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a11u1 < 250
    and I_IsUnitIdle a11u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a11u1 < 250
    and I_IsUnitUnderFire a11u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_run = 1

;    unit_group_order_halt army11
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army11 a1u1 run
    battle_wait 0.5
    set_counter army11_run 0
    end_if

end_if

if I_CompareCounter army13_reinf_allied = 1

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 1
    and I_UnitEnemyUnitInRadius a13u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army13_moving 0
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 1
    and ! I_UnitEnemyUnitInRadius a13u1 160
    and I_UnitDistanceFromUnit a1u1 a13u1 > 150
    and I_IsUnitIdle a13u1

    set_counter army13_reinf_late 1
    battle_wait 1
    set_counter army13_moving 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 0
    and ! I_UnitEnemyUnitInRadius a13u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    set_counter army13_run 1
    set_counter army13_moving 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 1000

    set_counter army13_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 750

    set_counter army13_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 500

    set_counter army13_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 300

    set_counter army13_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 200

    set_counter army13_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a13u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    set_counter army13_run 1
    battle_wait 0.5
    set_counter army13_moving 1
    set_counter army13_reinf_late 0
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 100

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitKilled a13u1 > 60

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitGroupKilled army13 > 50

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army13 a1u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a13u1 < 250
    and I_IsUnitIdle a13u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a13u1 < 250
    and I_IsUnitUnderFire a13u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_run = 1

;    unit_group_order_halt army13
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army13 a1u1 run
    battle_wait 0.5
    set_counter army13_run 0
    end_if

end_if

if I_CompareCounter army15_reinf_allied = 1

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 1
    and I_UnitEnemyUnitInRadius a15u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army15_moving 0
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 1
    and ! I_UnitEnemyUnitInRadius a15u1 160
    and I_UnitDistanceFromUnit a1u1 a15u1 > 150
    and I_IsUnitIdle a15u1

    set_counter army15_reinf_late 1
    battle_wait 1
    set_counter army15_moving 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 0
    and ! I_UnitEnemyUnitInRadius a15u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    set_counter army15_run 1
    set_counter army15_moving 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 1000

    set_counter army15_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 750

    set_counter army15_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 500

    set_counter army15_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 300

    set_counter army15_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 200

    set_counter army15_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a15u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    set_counter army15_run 1
    battle_wait 0.5
    set_counter army15_moving 1
    set_counter army15_reinf_late 0
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 100

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitKilled a15u1 > 60

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitGroupKilled army15 > 50

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army15 a1u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a15u1 < 250
    and I_IsUnitIdle a15u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a15u1 < 250
    and I_IsUnitUnderFire a15u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_run = 1

;    unit_group_order_halt army15
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army15 a1u1 run
    battle_wait 0.5
    set_counter army15_run 0
    end_if

end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;; Defending

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_BattlePlayerArmyIsAttacker

;    inc_counter reinf_check_interval 1

if I_CompareCounter army4_reinf_allied = 1

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 1
    and I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army4_moving 0
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and I_UnitDistanceFromUnit a2u1 a4u1 > 150
    and I_IsUnitIdle a4u1

    set_counter army4_reinf_late 1
    battle_wait 1
    set_counter army4_moving 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 0
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run 1
    set_counter army4_moving 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 1000

    set_counter army4_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 750

    set_counter army4_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 500

    set_counter army4_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300

    set_counter army4_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200

    set_counter army4_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run 1
    battle_wait 0.5
    set_counter army4_moving 1
    set_counter army4_reinf_late 0
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 100

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitKilled a4u1 > 60

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitGroupKilled army4 > 50

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army4 a2u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitIdle a4u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitUnderFire a4u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_run = 1

;    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army4 a2u1 run
    battle_wait 0.5
    set_counter army4_run 0
    end_if

end_if

if I_CompareCounter army6_reinf_allied = 1

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 1
    and I_UnitEnemyUnitInRadius a6u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army6_moving 0
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 1
    and ! I_UnitEnemyUnitInRadius a6u1 160
    and I_UnitDistanceFromUnit a2u1 a6u1 > 150
    and I_IsUnitIdle a6u1

    set_counter army6_reinf_late 1
    battle_wait 1
    set_counter army6_moving 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 0
    and ! I_UnitEnemyUnitInRadius a6u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    set_counter army6_run 1
    set_counter army6_moving 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 1000

    set_counter army6_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 750

    set_counter army6_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 500

    set_counter army6_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 300

    set_counter army6_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 200

    set_counter army6_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a6u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    set_counter army6_run 1
    battle_wait 0.5
    set_counter army6_moving 1
    set_counter army6_reinf_late 0
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 100

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitKilled a6u1 > 60

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitGroupKilled army6 > 50

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army6 a2u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a6u1 < 250
    and I_IsUnitIdle a6u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a6u1 < 250
    and I_IsUnitUnderFire a6u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_run = 1

;    unit_group_order_halt army6
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army6 a2u1 run
    battle_wait 0.5
    set_counter army6_run 0
    end_if

end_if

if I_CompareCounter army8_reinf_allied = 1

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 1
    and I_UnitEnemyUnitInRadius a8u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army8_moving 0
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 1
    and ! I_UnitEnemyUnitInRadius a8u1 160
    and I_UnitDistanceFromUnit a2u1 a8u1 > 150
    and I_IsUnitIdle a8u1

    set_counter army8_reinf_late 1
    battle_wait 1
    set_counter army8_moving 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 0
    and ! I_UnitEnemyUnitInRadius a8u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    set_counter army8_run 1
    set_counter army8_moving 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 1000

    set_counter army8_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 750

    set_counter army8_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 500

    set_counter army8_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 300

    set_counter army8_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 200

    set_counter army8_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a8u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    set_counter army8_run 1
    battle_wait 0.5
    set_counter army8_moving 1
    set_counter army8_reinf_late 0
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 100

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitKilled a8u1 > 60

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitGroupKilled army8 > 50

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army8 a2u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a8u1 < 250
    and I_IsUnitIdle a8u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a8u1 < 250
    and I_IsUnitUnderFire a8u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_run = 1

;    unit_group_order_halt army8
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army8 a2u1 run
    battle_wait 0.5
    set_counter army8_run 0
    end_if

end_if

if I_CompareCounter army10_reinf_allied = 1

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 1
    and I_UnitEnemyUnitInRadius a10u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army10_moving 0
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 1
    and ! I_UnitEnemyUnitInRadius a10u1 160
    and I_UnitDistanceFromUnit a2u1 a10u1 > 150
    and I_IsUnitIdle a10u1

    set_counter army10_reinf_late 1
    battle_wait 1
    set_counter army10_moving 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 0
    and ! I_UnitEnemyUnitInRadius a10u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    set_counter army10_run 1
    set_counter army10_moving 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 1000

    set_counter army10_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 750

    set_counter army10_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 500

    set_counter army10_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 300

    set_counter army10_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 200

    set_counter army10_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a10u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    set_counter army10_run 1
    battle_wait 0.5
    set_counter army10_moving 1
    set_counter army10_reinf_late 0
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 100

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitKilled a10u1 > 60

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitGroupKilled army10 > 50

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army10 a2u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a10u1 < 250
    and I_IsUnitIdle a10u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a10u1 < 250
    and I_IsUnitUnderFire a10u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_run = 1

;    unit_group_order_halt army10
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army10 a2u1 run
    battle_wait 0.5
    set_counter army10_run 0
    end_if

end_if

if I_CompareCounter army12_reinf_allied = 1

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 1
    and I_UnitEnemyUnitInRadius a12u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army12_moving 0
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 1
    and ! I_UnitEnemyUnitInRadius a12u1 160
    and I_UnitDistanceFromUnit a2u1 a12u1 > 150
    and I_IsUnitIdle a12u1

    set_counter army12_reinf_late 1
    battle_wait 1
    set_counter army12_moving 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 0
    and ! I_UnitEnemyUnitInRadius a12u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    set_counter army12_run 1
    set_counter army12_moving 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 1000

    set_counter army12_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 750

    set_counter army12_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 500

    set_counter army12_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 300

    set_counter army12_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 200

    set_counter army12_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a12u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    set_counter army12_run 1
    battle_wait 0.5
    set_counter army12_moving 1
    set_counter army12_reinf_late 0
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 100

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitKilled a12u1 > 60

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitGroupKilled army12 > 50

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army12 a2u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a12u1 < 250
    and I_IsUnitIdle a12u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a12u1 < 250
    and I_IsUnitUnderFire a12u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_run = 1

;    unit_group_order_halt army12
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army12 a2u1 run
    battle_wait 0.5
    set_counter army12_run 0
    end_if

end_if

if I_CompareCounter army14_reinf_allied = 1

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 1
    and I_UnitEnemyUnitInRadius a14u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army14_moving 0
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 1
    and ! I_UnitEnemyUnitInRadius a14u1 160
    and I_UnitDistanceFromUnit a2u1 a14u1 > 150
    and I_IsUnitIdle a14u1

    set_counter army14_reinf_late 1
    battle_wait 1
    set_counter army14_moving 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 0
    and ! I_UnitEnemyUnitInRadius a14u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    set_counter army14_run 1
    set_counter army14_moving 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 1000

    set_counter army14_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 750

    set_counter army14_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 500

    set_counter army14_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 300

    set_counter army14_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 200

    set_counter army14_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a14u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    set_counter army14_run 1
    battle_wait 0.5
    set_counter army14_moving 1
    set_counter army14_reinf_late 0
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 100

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitKilled a14u1 > 60

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitGroupKilled army14 > 50

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army14 a2u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a14u1 < 250
    and I_IsUnitIdle a14u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a14u1 < 250
    and I_IsUnitUnderFire a14u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_run = 1

;    unit_group_order_halt army14
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army14 a2u1 run
    battle_wait 0.5
    set_counter army14_run 0
    end_if

end_if

if I_CompareCounter army16_reinf_allied = 1

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 1
    and I_UnitEnemyUnitInRadius a16u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army16_moving 0
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 1
    and ! I_UnitEnemyUnitInRadius a16u1 160
    and I_UnitDistanceFromUnit a2u1 a16u1 > 150
    and I_IsUnitIdle a16u1

    set_counter army16_reinf_late 1
    battle_wait 1
    set_counter army16_moving 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 0
    and ! I_UnitEnemyUnitInRadius a16u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    set_counter army16_run 1
    set_counter army16_moving 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 1000

    set_counter army16_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 750

    set_counter army16_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 500

    set_counter army16_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 300

    set_counter army16_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 200

    set_counter army16_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a16u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    set_counter army16_run 1
    battle_wait 0.5
    set_counter army16_moving 1
    set_counter army16_reinf_late 0
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 100

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitKilled a16u1 > 60

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitGroupKilled army16 > 50

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army16 a2u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a16u1 < 250
    and I_IsUnitIdle a16u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a16u1 < 250
    and I_IsUnitUnderFire a16u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_run = 1

;    unit_group_order_halt army16
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army16 a2u1 run
    battle_wait 0.5
    set_counter army16_run 0
    end_if

end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;; Defending Siege

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready_siege = 1
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter army4_ready_siege = 1

;    inc_counter reinf_check_interval 1

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 1
    and I_UnitEnemyUnitInRadius a4u1 160

    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    set_counter army4_moving_siege 0
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and I_UnitDistanceFromUnit a2u1 a4u1 > 150
    and I_IsUnitIdle a4u1

    set_counter army4_run_siege 1
    battle_wait 2
    set_counter army4_moving_siege 1
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 0
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run_siege 1
    set_counter army4_moving_siege 1
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromPosition a4u1 1 1 < 150

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitIdle a4u1

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitUnderFire a4u1

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_PercentageUnitGroupKilled army4 > 50

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_run_siege = 1

    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_order_move_formed army4 1 1 run
    set_counter army4_run_siege 0
    end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;;;;;;Sally-out, AI defending

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 1

    if I_UnitDistanceFromPosition a4u1 0 850 < 200
    set_counter army4_location 1 ;north
    end_if
    if I_UnitDistanceFromPosition a4u1 0 -850 < 200
    set_counter army4_location 2 ;south
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 0 < 200
    set_counter army4_location 3 ;west
    end_if
    if I_UnitDistanceFromPosition a4u1 850 0 < 200
    set_counter army4_location 4 ;east
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 850 < 200
    set_counter army4_location 5 ;nw
    end_if
    if I_UnitDistanceFromPosition a4u1 850 850 < 200
    set_counter army4_location 6 ;ne
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 850 < 200
    set_counter army4_location 7 ;sw
    end_if
    if I_UnitDistanceFromPosition a4u1 850 -850 < 200
    set_counter army4_location 8 ;se
    end_if

    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    set_counter	path_s 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    set_counter	path_sw 4
    set_counter	path_s 5
    end_if
    end_if
    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_ne 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    set_counter	path_n 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    set_counter	path_nw 4
    set_counter	path_n 5
    end_if
    end_if

    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_se 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    set_counter	path_e 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    set_counter	path_ne 4
    set_counter	path_e 5
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_sw 2
    set_counter	path_s 3
    end_if
    end_if

    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    set_counter	path_w 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    set_counter	path_sw 4
    set_counter	path_w 5
    end_if
    end_if
    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_ne 2
    set_counter	path_n 3
    end_if
    end_if

    if I_CompareCounter army4_location = 5 ;nw
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    end_if
    end_if

    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    end_if
    end_if
    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_sw 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_ne 2
    set_counter	path_e 3
    end_if
    end_if

    if I_CompareCounter army4_location = 6 ;ne
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    end_if
    end_if

    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    end_if
    end_if
    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7 ;sw
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_se 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    end_if
    end_if

    if I_CompareCounter army4_location = 8 ;se
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_ne 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    end_if
    end_if

    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_north = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_south = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_west = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if

    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_east = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_ready_sally = 1
    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_order_change_group_formation army4 ai_infantry_protecting
;	battle_wait 45
    battle_wait 20
    if I_CompareCounter army4_ready_sally = 1
    and I_BattleIsSallyOutBattle
    battle_wait 25
    end_if
    if I_CompareCounter army4_ready_sally = 1
    and I_BattleIsSallyOutBattle
    set_counter army4_ready_sally 2
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter label_army4 = 1

    label_unit 1 1 0 a4u1
    label_unit 1 1 1 a4u2
    label_unit 1 1 2 a4u3
    label_unit 1 1 3 a4u4
    label_unit 1 1 4 a4u5
    label_unit 1 1 5 a4u6
    label_unit 1 1 6 a4u7
    label_unit 1 1 7 a4u8
    label_unit 1 1 8 a4u9
    label_unit 1 1 9 a4u10
    label_unit 1 1 10 a4u11
    label_unit 1 1 11 a4u12
    label_unit 1 1 12 a4u13
    label_unit 1 1 13 a4u14
    label_unit 1 1 14 a4u15
    label_unit 1 1 15 a4u16
    label_unit 1 1 16 a4u17
    label_unit 1 1 17 a4u18
    label_unit 1 1 18 a4u19
    label_unit 1 1 19 a4u20

;    unit_group_order_halt army4
    set_counter label_army4 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter army4_moving_s = 1
    and I_UnitEnemyUnitInRadius a4u1 130
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    unit_group_order_halt army4
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on

    set_counter army4_moving_s 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_n = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 0 700 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 500 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 500 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 700 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 700 < 100
    set_counter path_n 0
    if I_CompareCounter path_nw > 1
    set_counter path_nw 1
    end_if
    if I_CompareCounter path_ne > 1
    set_counter path_ne 1
    end_if
    if I_CompareCounter path_nw = 0
    and I_CompareCounter path_ne = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 500 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 500 < 100
    set_counter path_n 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 30
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_s = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 0 -700 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -500 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 -500 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -700 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 -700 < 100
    set_counter path_s 0
    if I_CompareCounter path_sw > 1
    set_counter path_sw 1
    end_if
    if I_CompareCounter path_se > 1
    set_counter path_se 1
    end_if
    if I_CompareCounter path_sw = 0
    and I_CompareCounter path_se = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -500 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 -500 < 100
    set_counter path_s 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_w = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 0 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -500 0 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -500 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 0 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 0 < 100
    set_counter path_w 0
    if I_CompareCounter path_nw > 1
    set_counter path_nw 1
    end_if
    if I_CompareCounter path_sw > 1
    set_counter path_sw 1
    end_if
    if I_CompareCounter path_nw = 0
    and I_CompareCounter path_sw = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 -500 0 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -500 0 < 100
    set_counter path_w 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_e = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 0 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 500 0 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 500 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 0 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 0 < 100
    set_counter path_e 0
    if I_CompareCounter path_ne > 1
    set_counter path_ne 1
    end_if
    if I_CompareCounter path_se > 1
    set_counter path_se 1
    end_if
    if I_CompareCounter path_ne = 0
    and I_CompareCounter path_se = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 500 0 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 500 0 < 100
    set_counter path_e 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_nw = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 700 < 100
    set_counter path_nw 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_w = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_ne = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 700 < 100
    set_counter path_ne 0
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_e = 0
    and I_CompareCounter path_n = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_sw = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 -700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 -700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 -700 < 100
    set_counter path_sw 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_se = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 -700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 -700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 -700 < 100
    set_counter path_se 0
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_s = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 3

    set_counter army4_ready_sally 0
    unit_group_order_halt army4
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_IsUnitRouting a4u1

    set_counter army4_ready_sally 3
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_PercentageUnitKilled a4u1 > 80

    set_counter army4_ready_sally 3
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2

    if I_IsUnitGroupIdle army4
    inc_counter army4_idle_r 1
    end_if

    if ! I_IsUnitGroupIdle army4
    set_counter army4_idle_r 0
    end_if

    if I_CompareCounter army4_idle_r > 12
    set_counter army4_ready_sally 0
    end_if
    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_n = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_n 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_s = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_s 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_w = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_w 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_e = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_e 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_nw = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_nw 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_ne = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_ne 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_sw = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_sw 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_se = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_se 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

;################## Germanicu5 Integrated Stakes script ###########################

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAttacking
    and ! I_ConflictType SuccessfulAmbush
    and ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel < 3
    and I_IsBattleSettlementCastle
    and I_BattlePlayerAllianceOddsAgainst < 2.0
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel > 2
    and I_IsBattleSettlementCastle
    and I_BattlePlayerAllianceOddsAgainst < 2.5
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 4
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel < 3
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerAllianceOddsAgainst < 1.7
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel > 2
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerAllianceOddsAgainst < 2.2
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter stakes_on = 1
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    and I_UnitEnemyUnitInRadius a2u1 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    and I_UnitEnemyUnitInRadius a2u2 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    and I_UnitEnemyUnitInRadius a2u3 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    and I_UnitEnemyUnitInRadius a2u4 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    and I_UnitEnemyUnitInRadius a2u5 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    and I_UnitEnemyUnitInRadius a2u6 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    and I_UnitEnemyUnitInRadius a2u7 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    and I_UnitEnemyUnitInRadius a2u8 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    and I_UnitEnemyUnitInRadius a2u9 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    and I_UnitEnemyUnitInRadius a2u10 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    and I_UnitEnemyUnitInRadius a2u11 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    and I_UnitEnemyUnitInRadius a2u12 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    and I_UnitEnemyUnitInRadius a2u13 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    and I_UnitEnemyUnitInRadius a2u14 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    and I_UnitEnemyUnitInRadius a2u15 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    and I_UnitEnemyUnitInRadius a2u16 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    and I_UnitEnemyUnitInRadius a2u17 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    and I_UnitEnemyUnitInRadius a2u18 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    and I_UnitEnemyUnitInRadius a2u19 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    and I_UnitEnemyUnitInRadius a2u20 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

if I_CompareCounter stakes_on = 2
;    ai_active_set off
    unit_group_order_halt army2

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    unit_deploy_stakes a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    unit_deploy_stakes a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    unit_deploy_stakes a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    unit_deploy_stakes a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    unit_deploy_stakes a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    unit_deploy_stakes a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    unit_deploy_stakes a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    unit_deploy_stakes a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    unit_deploy_stakes a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    unit_deploy_stakes a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    unit_deploy_stakes a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    unit_deploy_stakes a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    unit_deploy_stakes a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    unit_deploy_stakes a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    unit_deploy_stakes a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    unit_deploy_stakes a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    unit_deploy_stakes a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    unit_deploy_stakes a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    unit_deploy_stakes a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    unit_deploy_stakes a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter stakes_on 0
end_if
    battle_wait 1.5
end_monitor

monitor_event BattleDeploymentPhaseCommenced not IsFactionAIControlled
    and I_BattlePlayerArmyIsAttacker
    and I_BattleIsSiegeBattle
    and I_CompareCounter panel_check = 1
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0

    if I_CompareCounter enemy_unit_count > 0
    unit_deploy_stakes a2u1

    if I_CompareCounter enemy_unit_count > 1
    unit_deploy_stakes a2u2

    if I_CompareCounter enemy_unit_count > 2
    unit_deploy_stakes a2u3

    if I_CompareCounter enemy_unit_count > 3
    unit_deploy_stakes a2u4

    if I_CompareCounter enemy_unit_count > 4
    unit_deploy_stakes a2u5

    if I_CompareCounter enemy_unit_count > 5
    unit_deploy_stakes a2u6

    if I_CompareCounter enemy_unit_count > 6
    unit_deploy_stakes a2u7

    if I_CompareCounter enemy_unit_count > 7
    unit_deploy_stakes a2u8

    if I_CompareCounter enemy_unit_count > 8
    unit_deploy_stakes a2u9

    if I_CompareCounter enemy_unit_count > 9
    unit_deploy_stakes a2u10

    if I_CompareCounter enemy_unit_count > 10
    unit_deploy_stakes a2u11

    if I_CompareCounter enemy_unit_count > 11
    unit_deploy_stakes a2u12

    if I_CompareCounter enemy_unit_count > 12
    unit_deploy_stakes a2u13

    if I_CompareCounter enemy_unit_count > 13
    unit_deploy_stakes a2u14

    if I_CompareCounter enemy_unit_count > 14
    unit_deploy_stakes a2u15

    if I_CompareCounter enemy_unit_count > 15
    unit_deploy_stakes a2u16

    if I_CompareCounter enemy_unit_count > 16
    unit_deploy_stakes a2u17

    if I_CompareCounter enemy_unit_count > 17
    unit_deploy_stakes a2u18

    if I_CompareCounter enemy_unit_count > 18
    unit_deploy_stakes a2u19

    if I_CompareCounter enemy_unit_count = 20
    unit_deploy_stakes a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter label_ready 0
end_monitor

;;;;;;;;HA fix;;;;;;;;;;;;

;monitor_conditions I_BattleStarted
;    and I_CompareCounter ha_fix = 1
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
;    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
;    and I_UnitEnemyUnitInRadius a2u1 250
;    ai_gta_plan_set 1 ATTACK_ALL
;    set_counter ha_fix 0
;    set_counter ob_defense_launch 0
;    set_counter ob_defend 4
;end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ha_fix = 1
    and I_CompareCounter open_battle = 1
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAttacking
;	and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60

    ai_gta_plan_set 0 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ha_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ha_fix = 1
    and I_BattleIsRiverBattle
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAssaultingCrossing
;	and I_BattleEnemyArmyPercentageOfUnitCategory cavalry >= 60

    ai_gta_add_objective 0 ASSAULT_CROSSING 999

;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    ai_gta_add_unit_label 0 0 a1u1

    if I_CompareCounter enemy_unit_count > 1
    ai_gta_add_unit_label 0 0 a1u2

    if I_CompareCounter enemy_unit_count > 2
    ai_gta_add_unit_label 0 0 a1u3

    if I_CompareCounter enemy_unit_count > 3
    ai_gta_add_unit_label 0 0 a1u4

    if I_CompareCounter enemy_unit_count > 4
    ai_gta_add_unit_label 0 0 a1u5

    if I_CompareCounter enemy_unit_count > 5
    ai_gta_add_unit_label 0 0 a1u6

    if I_CompareCounter enemy_unit_count > 6
    ai_gta_add_unit_label 0 0 a1u7

    if I_CompareCounter enemy_unit_count > 7
    ai_gta_add_unit_label 0 0 a1u8

    if I_CompareCounter enemy_unit_count > 8
    ai_gta_add_unit_label 0 0 a1u9

    if I_CompareCounter enemy_unit_count > 9
    ai_gta_add_unit_label 0 0 a1u10

    if I_CompareCounter enemy_unit_count > 10
    ai_gta_add_unit_label 0 0 a1u11

    if I_CompareCounter enemy_unit_count > 11
    ai_gta_add_unit_label 0 0 a1u12

    if I_CompareCounter enemy_unit_count > 12
    ai_gta_add_unit_label 0 0 a1u13

    if I_CompareCounter enemy_unit_count > 13
    ai_gta_add_unit_label 0 0 a1u14

    if I_CompareCounter enemy_unit_count > 14
    ai_gta_add_unit_label 0 0 a1u15

    if I_CompareCounter enemy_unit_count > 15
    ai_gta_add_unit_label 0 0 a1u16

    if I_CompareCounter enemy_unit_count > 16
    ai_gta_add_unit_label 0 0 a1u17

    if I_CompareCounter enemy_unit_count > 17
    ai_gta_add_unit_label 0 0 a1u18

    if I_CompareCounter enemy_unit_count > 18
    ai_gta_add_unit_label 0 0 a1u19

    if I_CompareCounter enemy_unit_count = 20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    battle_wait 0.5
    ai_active_set on

    set_counter ha_fix 0
end_monitor

;;;;;;;;Elephant;;;;;;;;;;;;

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and ! I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and ! I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off
    unit_group_order_halt army1

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    unit_group_order_halt army1
    battle_wait 0.5
    unit_group_order_change_group_formation army1 ai_wall_assault
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 1
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate != 2
    set_counter elephant_gate 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier2 1
    set_counter rally_walls 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 1
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate != 2
    set_counter elephant_gate 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier2 1
    set_counter rally_walls 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter del_objective = 1
    and I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    set_counter del_objective 2
    battle_wait 15
    if I_CompareCounter del_objective = 2
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter del_objective 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier2 = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSiegeBattle
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter second_ring 1
    set_counter elephant_gate_tier2 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 2
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring != 2
    set_counter second_ring 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier3 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 2
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring != 2
    set_counter second_ring 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier3 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier3 = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter third_ring 1
    set_counter elephant_gate_tier3 0
end_monitor

;;;;;;;;Sally-Out Elephant;;;;;;;;;;;;

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

;	set_counter sally-out_fix 1
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter elephant_gate_s 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSallyOutBattle
    and I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

;	set_counter sally-out_fix 1
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter elephant_gate_s 1
    set_counter elephant_fix 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 1
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate_s != 2
    set_counter elephant_gate_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier2s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 1
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate_s != 2
    set_counter elephant_gate_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier2s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter del_objective_s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    set_counter del_objective_s 2
    battle_wait 15
    if I_CompareCounter del_objective_s = 2
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter del_objective_s 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier2s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter second_ring_s 1
    set_counter elephant_gate_tier2s 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 2
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring_s != 2
    set_counter second_ring_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier3s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 2
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring_s != 2
    set_counter second_ring_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier3s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier3s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter third_ring_s 1
    set_counter elephant_gate_tier3s 0
end_monitor

;;;;;;;Elephants Gate and Walls
monitor_event BattleBattleGatesDestroyedByEngine TrueCondition ;wtf
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    set_counter elephant_gate 0
    set_counter rally_walls 1
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring 0
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    set_counter elephant_gate_s 0
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring_s 0
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

monitor_event BattleWallsCaptured TrueCondition
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    set_counter elephant_gate 0
    set_counter rally_walls 1
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring 0
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    set_counter elephant_gate_s 0
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring_s 0
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

monitor_event BattleWallsBreachedByEngine TrueCondition
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 2
    set_counter rally_walls 0
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter second_ring 2
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate_s 2
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter second_ring_s 2
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

;;;;;;;Sally Out Assault
monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel < 3
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 2.0

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel > 2
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 3
    and I_BattlePlayerAllianceOddsAgainst > 2.5

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel < 3
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 1.7

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel > 2
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 2.2

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 1.8

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

;;;;;;;Sally Out Defense

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 1
    and I_CompareCounter kill_sally = 0
;	and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if

    if I_CompareCounter enemy_unit_count > 0
    ai_gta_add_unit_label 1 0 a2u1

    if I_CompareCounter enemy_unit_count > 1
    ai_gta_add_unit_label 1 0 a2u2

    if I_CompareCounter enemy_unit_count > 2
    ai_gta_add_unit_label 1 0 a2u3

    if I_CompareCounter enemy_unit_count > 3
    ai_gta_add_unit_label 1 0 a2u4

    if I_CompareCounter enemy_unit_count > 4
    ai_gta_add_unit_label 1 0 a2u5

    if I_CompareCounter enemy_unit_count > 5
    ai_gta_add_unit_label 1 0 a2u6

    if I_CompareCounter enemy_unit_count > 6
    ai_gta_add_unit_label 1 0 a2u7

    if I_CompareCounter enemy_unit_count > 7
    ai_gta_add_unit_label 1 0 a2u8

    if I_CompareCounter enemy_unit_count > 8
    ai_gta_add_unit_label 1 0 a2u9

    if I_CompareCounter enemy_unit_count > 9
    ai_gta_add_unit_label 1 0 a2u10

    if I_CompareCounter enemy_unit_count > 10
    ai_gta_add_unit_label 1 0 a2u11

    if I_CompareCounter enemy_unit_count > 11
    ai_gta_add_unit_label 1 0 a2u12

    if I_CompareCounter enemy_unit_count > 12
    ai_gta_add_unit_label 1 0 a2u13

    if I_CompareCounter enemy_unit_count > 13
    ai_gta_add_unit_label 1 0 a2u14

    if I_CompareCounter enemy_unit_count > 14
    ai_gta_add_unit_label 1 0 a2u15

    if I_CompareCounter enemy_unit_count > 15
    ai_gta_add_unit_label 1 0 a2u16

    if I_CompareCounter enemy_unit_count > 16
    ai_gta_add_unit_label 1 0 a2u17

    if I_CompareCounter enemy_unit_count > 17
    ai_gta_add_unit_label 1 0 a2u18

    if I_CompareCounter enemy_unit_count > 18
    ai_gta_add_unit_label 1 0 a2u19

    if I_CompareCounter enemy_unit_count = 20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    set_counter sally_defense 2
    set_counter defend_location 1
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 2
;	and I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
    and I_UnitDistanceFromPosition a2u1 1 1 > 630
    and ! I_UnitEnemyUnitInRadius a2u1 160
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_IsUnitUnderFire a4u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter unit_under_fire 0
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_if

    if I_CompareCounter sally_defense = 0
    set_counter sally_defense 2
    end_if
    set_counter reform_back 0
    battle_wait 7
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 2
;	and I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
    and I_UnitDistanceFromPosition a2u1 1 1 > 560
    and I_UnitDistanceFromPosition a2u1 1 1 < 630
    and ! I_UnitEnemyUnitInRadius a2u1 160
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_IsUnitUnderFire a4u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

if I_CompareCounter repeat_test1 = 1
set_counter repeat_test1 2
end_if
if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1
and I_CompareCounter repeat_test1 = 0

set_counter unit_under_fire 0
set_counter repeat_test1 1
;battle_wait 10
end_if

if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1
and I_CompareCounter repeat_test1 = 2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter unit_under_fire 0
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_if

    if I_CompareCounter sally_defense = 0
    set_counter sally_defense 2
    end_if
    set_counter reform_back 0
    battle_wait 7
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 2
    and I_BattleIsSallyOutBattle
    and I_UnitDistanceFromPosition a2u1 1 1 > 630
    and I_UnitEnemyUnitInRadius a2u1 160

    set_counter sally_defense 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 2
    and I_UnitDistanceFromPosition a2u1 1 1 > 560
    and I_UnitDistanceFromPosition a2u1 1 1 < 630
    and I_UnitEnemyUnitInRadius a2u1 160

    set_counter sally_defense 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi < 2
;	and I_UnitDistanceFromPosition a2u1 1 1 < 660
    and I_UnitGroupDistanceFromPosition army2 1 1 < 630
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter repeat_test2 = 1
    set_counter repeat_test2 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test2 = 0

    set_counter repeat_test2 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test2 = 2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reform_multi 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if
set_counter reform_back 0
if I_CompareCounter repeat_test2 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi = 2
;	and I_UnitDistanceFromPosition a2u1 1 1 < 620
    and I_UnitGroupDistanceFromPosition army2 1 1 < 600
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter repeat_test3 = 1
    set_counter repeat_test3 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test3 = 0

    set_counter repeat_test3 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test3 = 2

    if ! I_UnitEnemyUnitInRadius a2u1 150
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, -100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, -100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if
    set_counter reform_multi 1

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    end_if

    if I_UnitEnemyUnitInRadius a2u1 150
    set_counter sally_defense 3
    battle_wait 7
    end_if
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test3 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi = 3
;	and I_UnitDistanceFromPosition a2u1 1 1 < 580
    and I_UnitGroupDistanceFromPosition army2 1 1 < 560
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

    if I_CompareCounter repeat_test4 = 1
    set_counter repeat_test4 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test4 = 0

    set_counter repeat_test4 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test4 = 2

    if I_UnitEnemyUnitInRadius a2u1 180
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -700, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 700, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 700, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -700, 0, 100
    end_if
    set_counter reform_multi 2
    end_if
    if ! I_UnitEnemyUnitInRadius a2u1 180
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    end_if
    set_counter reform_multi 1
    end_if
    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test4 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi > 3
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6
    if I_CompareCounter army_south = 1
    and I_UnitDistanceFromLine a2u1 sw se < 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_north = 1
    and I_UnitDistanceFromLine a2u1 nw ne > 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_west = 1
    and I_UnitDistanceFromLine a2u1 sw nw > 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_east = 1
    and I_UnitDistanceFromLine a2u1 se ne < 0
    set_counter line_passed 1
    end_if

if I_CompareCounter line_passed = 1

    set_counter line_passed 0

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

    if I_CompareCounter repeat_test5 = 1
    set_counter repeat_test5 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test5 = 0

    set_counter repeat_test5 1
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test5 = 2

if ! I_UnitEnemyUnitInRadius a2u1 20

    if ! I_UnitEnemyUnitInRadius a2u1 20
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if ! I_UnitEnemyUnitInRadius a2u1 150
    and I_BattleSettlementFortificationLevel < 3
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if
if I_UnitEnemyUnitInRadius a2u1 20
set_counter sally_defense 3
battle_wait 20
end_if
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test5 = 1
battle_wait 10
end_if
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 0  ;check
    and I_CompareCounter reform_multi > 2
    and ! I_IsUnitGroupEngaged army2
    and I_UnitEnemyUnitInRadius a2u1 160
;	and I_UnitDistanceFromPosition a2u1 1 1 < 560
    and I_UnitGroupDistanceFromPosition army2 1 1 < 560
;	and I_BattleSettlementFortificationLevel > 2

    if I_CompareCounter enemy_unit_count > 0
    and I_IsUnitUnderFire a2u1
    and ! I_IsUnitEngaged a2u1
    and ! I_UnitStatus a2u1 pursuing
    and ! I_UnitStatus a2u1 charging
    and ! I_UnitStatus a2u1 moving
    inc_counter reset_position 2
    end_if

    if I_CompareCounter enemy_unit_count > 1
    and I_IsUnitUnderFire a2u2
    and ! I_IsUnitEngaged a2u2
    and ! I_UnitStatus a2u2 pursuing
    and ! I_UnitStatus a2u2 charging
    and ! I_UnitStatus a2u2 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    and I_IsUnitUnderFire a2u3
    and ! I_IsUnitEngaged a2u3
    and ! I_UnitStatus a2u3 pursuing
    and ! I_UnitStatus a2u3 charging
    and ! I_UnitStatus a2u3 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    and I_IsUnitUnderFire a2u4
    and ! I_IsUnitEngaged a2u4
    and ! I_UnitStatus a2u4 pursuing
    and ! I_UnitStatus a2u4 charging
    and ! I_UnitStatus a2u4 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    and I_IsUnitUnderFire a2u5
    and ! I_IsUnitEngaged a2u5
    and ! I_UnitStatus a2u5 pursuing
    and ! I_UnitStatus a2u5 charging
    and ! I_UnitStatus a2u5 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    and I_IsUnitUnderFire a2u6
    and ! I_IsUnitEngaged a2u6
    and ! I_UnitStatus a2u6 pursuing
    and ! I_UnitStatus a2u6 charging
    and ! I_UnitStatus a2u6 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    and I_IsUnitUnderFire a2u7
    and ! I_IsUnitEngaged a2u7
    and ! I_UnitStatus a2u7 pursuing
    and ! I_UnitStatus a2u7 charging
    and ! I_UnitStatus a2u7 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    and I_IsUnitUnderFire a2u8
    and ! I_IsUnitEngaged a2u8
    and ! I_UnitStatus a2u8 pursuing
    and ! I_UnitStatus a2u8 charging
    and ! I_UnitStatus a2u8 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    and I_IsUnitUnderFire a2u9
    and ! I_IsUnitEngaged a2u9
    and ! I_UnitStatus a2u9 pursuing
    and ! I_UnitStatus a2u9 charging
    and ! I_UnitStatus a2u9 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    and I_IsUnitUnderFire a2u10
    and ! I_IsUnitEngaged a2u10
    and ! I_UnitStatus a2u10 pursuing
    and ! I_UnitStatus a2u10 charging
    and ! I_UnitStatus a2u10 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    and I_IsUnitUnderFire a2u11
    and ! I_IsUnitEngaged a2u11
    and ! I_UnitStatus a2u11 pursuing
    and ! I_UnitStatus a2u11 charging
    and ! I_UnitStatus a2u11 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    and I_IsUnitUnderFire a2u12
    and ! I_IsUnitEngaged a2u12
    and ! I_UnitStatus a2u12 pursuing
    and ! I_UnitStatus a2u12 charging
    and ! I_UnitStatus a2u12 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    and I_IsUnitUnderFire a2u13
    and ! I_IsUnitEngaged a2u13
    and ! I_UnitStatus a2u13 pursuing
    and ! I_UnitStatus a2u13 charging
    and ! I_UnitStatus a2u13 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    and I_IsUnitUnderFire a2u14
    and ! I_IsUnitEngaged a2u14
    and ! I_UnitStatus a2u14 pursuing
    and ! I_UnitStatus a2u14 charging
    and ! I_UnitStatus a2u14 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    and I_IsUnitUnderFire a2u15
    and ! I_IsUnitEngaged a2u15
    and ! I_UnitStatus a2u15 pursuing
    and ! I_UnitStatus a2u15 charging
    and ! I_UnitStatus a2u15 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    and I_IsUnitUnderFire a2u16
    and ! I_IsUnitEngaged a2u16
    and ! I_UnitStatus a2u16 pursuing
    and ! I_UnitStatus a2u16 charging
    and ! I_UnitStatus a2u16 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    and I_IsUnitUnderFire a2u17
    and ! I_IsUnitEngaged a2u17
    and ! I_UnitStatus a2u17 pursuing
    and ! I_UnitStatus a2u17 charging
    and ! I_UnitStatus a2u17 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    and I_IsUnitUnderFire a2u18
    and ! I_IsUnitEngaged a2u18
    and ! I_UnitStatus a2u18 pursuing
    and ! I_UnitStatus a2u18 charging
    and ! I_UnitStatus a2u18 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    and I_IsUnitUnderFire a2u19
    and ! I_IsUnitEngaged a2u19
    and ! I_UnitStatus a2u19 pursuing
    and ! I_UnitStatus a2u19 charging
    and ! I_UnitStatus a2u19 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    and I_IsUnitUnderFire a2u20
    and ! I_IsUnitEngaged a2u20
    and ! I_UnitStatus a2u20 pursuing
    and ! I_UnitStatus a2u20 charging
    and ! I_UnitStatus a2u20 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready = 0
    and I_IsUnitUnderFire a4u1
    and ! I_IsUnitEngaged a4u1
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging
    and ! I_UnitStatus a4u1 moving
    inc_counter reset_position 2
    end_if

if I_CompareCounter reset_position > 3

    if ! I_UnitEnemyUnitInRadius a2u1 20
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 1
    end_if

    if ! I_UnitEnemyUnitInRadius a2u1 150
    and I_BattleSettlementFortificationLevel < 3
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position 0
    set_counter sally_defense 2
    set_counter defend_location 1
end_if

if I_CompareCounter sally_defense != 2
set_counter sally_defense 3
battle_wait 15
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_defense > 0
    and I_UnitEnemyUnitInRadius a2u1 200

    if ! I_IsUnitGroupEngaged army2
    and ! I_IsUnitGroupMoving army2
    and ! I_UnitStatus a2u1 pursuing
    and ! I_UnitStatus a2u1 charging

    inc_counter army2_idle_s 1
    end_if

    if I_CompareCounter army2_idle_s > 5
    set_counter army2_idle_s 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    battle_wait 0.5
;	 unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position 0
    set_counter sally_defense 2
    set_counter defend_location 1
    end_if

    if I_IsUnitGroupEngaged army2
    set_counter army2_idle_s 0
    end_if
    if I_IsUnitGroupMoving army2
    set_counter army2_idle_s 0
    end_if
    if I_UnitStatus a2u1 pursuing
    set_counter army2_idle_s 0
    end_if
    if I_UnitStatus a2u1 charging
    set_counter army2_idle_s 0
    end_if
    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 2
    and I_BattleSettlementFortificationLevel > 2
;	and I_CompareCounter reform_multi > 3
    and ! I_IsUnitGroupEngaged army2
    and ! I_UnitEnemyUnitInRadius a2u1 80

    set_counter sally_defense 6
    set_counter wall_line_passed 0
    set_counter reset_position_s 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitEngaged a2u1
    inc_counter reset_position_s 2
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reset_position_s 2
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reset_position_s 2
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitEngaged a2u2
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitEngaged a2u3
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitEngaged a2u4
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitEngaged a2u5
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitEngaged a2u6
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitEngaged a2u7
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitEngaged a2u8
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitEngaged a2u9
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitEngaged a2u10
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitEngaged a2u11
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitEngaged a2u12
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitEngaged a2u13
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitEngaged a2u14
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitEngaged a2u15
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitEngaged a2u16
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitEngaged a2u17
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitEngaged a2u18
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitEngaged a2u19
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitEngaged a2u20
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reset_position_s 1
    end_if
    end_if

if I_CompareCounter reset_position_s = 0
    if I_CompareCounter army_south = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if
    end_if
end_if

    if I_CompareCounter repeat_test6 = 1
    set_counter repeat_test6 2
    end_if
    if I_CompareCounter wall_line_passed = 0
    and I_CompareCounter reset_position_s = 0
    and I_CompareCounter repeat_test6 = 0

    set_counter repeat_test6 1
    end_if
    if I_CompareCounter wall_line_passed = 0
    and I_CompareCounter reset_position_s = 0
    and I_CompareCounter repeat_test6 = 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    battle_wait 0.5
;	 unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position_s 0
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    end_if

    if I_CompareCounter sally_defense != 2
    set_counter sally_defense 3
    end_if
    if I_CompareCounter wall_line_passed > 0
    battle_wait 15
    end_if
    if I_CompareCounter reset_position_s > 0
    battle_wait 15
    end_if
    if I_CompareCounter repeat_test6 = 1
    battle_wait 20
    end_if
end_monitor

;;;;;Termination
monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 0
    and I_CompareCounter kill_sally = 0
    and I_IsUnitRouting a2u1
    and ! I_IsUnitGroupEngaged army2
    and ! I_IsUnitGroupDestroyed army2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    end_if

    set_counter sally_defense 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter assign_labels = 1
    and I_UnitDestroyed a2u1
    and ! I_IsUnitGroupDestroyed army2

    set_counter reset_army2 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter assign_labels 2
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter assign_labels = 2
    and I_UnitDestroyed a2u1
    and ! I_IsUnitGroupDestroyed army2

    set_counter assign_labels 1
end_monitor

;;;Sally Reinforcements

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_reinf = 1
    and I_CompareCounter kill_sally = 0
;	and ! I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsUnitEngaged a4u1

    if I_CompareCounter sally_defense < 3
    set_counter defend_location 1
    set_counter sally_reinf 2
    end_if

    if I_CompareCounter sally_defense > 2

    set_counter defend_location 2
    set_counter sally_reinf 2
    end_if

end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
    and I_CompareCounter sally_defense < 3
    and I_CompareCounter sally_defense != 1
    and I_CompareCounter defend_location = 1
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and ! I_IsUnitGroupEngaged army4
    and ! I_IsUnitGroupEngaged army2
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging
    and ! I_UnitEnemyUnitInRadius a4u1 20

     ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20

    battle_wait 0.5
    ai_active_set on

    set_counter defend_location 0
;	set_counter army4_idle_s 0
battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
    and I_CompareCounter sally_defense > 2
    and I_CompareCounter defend_location = 2
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0

    ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter defend_location 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
;	and I_CompareCounter sally_defense > 2
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_CompareCounter defend_location = 0
;    and I_UnitEnemyUnitInRadius a4u1 200

    if ! I_IsUnitGroupEngaged army4
    and ! I_IsUnitGroupMoving army4
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging

    inc_counter army4_idle_s 1
    end_if
    if I_CompareCounter army4_idle_s > 5
    set_counter defend_location 1
    set_counter sally_defense 2
    end_if

    if I_IsUnitGroupEngaged army4
    set_counter army4_idle_s 0
    end_if
    if I_IsUnitGroupMoving army4
    set_counter army4_idle_s 0
    end_if
    if I_UnitStatus a4u1 pursuing
    set_counter army4_idle_s 0
    end_if
    if I_UnitStatus a4u1 charging
    set_counter army4_idle_s 0
    end_if
    battle_wait 10
end_monitor

;;;;;Termination
monitor_conditions I_BattleStarted
    and I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_IsUnitGroupDestroyed army4
    and I_BattleIsSallyOutBattle

    set_counter sally_reinf 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_UnitDestroyed a4u1
    and I_BattleIsSallyOutBattle

    set_counter label_army4 1
;    battle_wait 0.5
;    unit_group_enable_automation army4 false
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_reinf 0
end_monitor

;################## Germanicu5 Integrated Protect General script ###########################

monitor_event BattleConflictPhaseCommenced not IsFactionAIControlled
    and I_CompareCounter panel_check = 1
    and I_BattleEnemyArmyNumberOfMountClass elephant = 0
    and I_CompareCounter enemy_unit_count > 4

    battle_wait 10

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
    and I_CompareCounter protect_siege = 1
    set_counter protect_general 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
;    and I_CompareCounter labels_only = 1
    and I_CompareCounter kill_sally = 1
    set_counter protect_general 1
    end_if
end_monitor

monitor_event BattleBattleGatesDestroyedByEngine TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter kill_sally = 1
    set_counter general_wait 1
    end_if
end_monitor

monitor_event BattleWallsCaptured TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if
end_monitor

monitor_event BattleWallsBreachedByEngine TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 1
    and I_IsUnitMoveFastSet a1u1
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry > 0

    battle_wait 0.5
    unit_order_halt a1u1
    if I_CompareCounter enemy_unit_count < 7
    set_counter general_wait 2
    battle_wait 20
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 20
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter enemy_unit_count < 12
    set_counter general_wait 2
    battle_wait 25
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 25
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter enemy_unit_count < 16
    set_counter general_wait 2
    battle_wait 30
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 30
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 15
    set_counter general_wait 2
    battle_wait 35
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 35
    end_if
    end_if
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 3
    release_unit a1u1
    set_counter general_wait 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 1
    and I_IsUnitMoveFastSet a2u1
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry > 0

    battle_wait 0.5
    unit_order_halt a2u1

    if I_CompareCounter enemy_unit_count < 7
    set_counter general_wait 2
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 20
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter enemy_unit_count < 12
    set_counter general_wait 2
    battle_wait 25
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 25
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter enemy_unit_count < 16
    set_counter general_wait 2
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 30
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 15
    set_counter general_wait 2
    battle_wait 35
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 35
    end_if
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 3
    release_unit a2u1
    set_counter general_wait 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter general_wait > 1
    and I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a1u1 60

    set_counter general_wait 0
    release_unit a1u1
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter general_wait > 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 60

    set_counter general_wait 0
    release_unit a2u1
end_monitor

;################## Germanicu5 Integrated Siege script ###########################

monitor_conditions I_BattleStarted
    and ! I_BattleIsFortBattle
    and I_BattleEnemyArmyNumberOfMountClass elephant = 0
    and I_BattleSettlementFortificationLevel > 0
    and I_CompareCounter siege_fix = 1

    set_counter siege_fix 0

    if I_BattleIsSallyOutBattle
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    set_counter army_sieging 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
end_monitor

;;;;;;;Sally Out

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter reset_army2 = 1

    set_counter reset_army2 0
    set_counter enemy_unit_count 0

    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

;;;;;;;Huge City

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 4

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 35

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
    set_counter sally_check 10
    battle_wait 30

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 10
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 14
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 14
    set_counter sally_check 15
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 15
    set_counter sally_check 16
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 16
    set_counter sally_check 17
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 17
    set_counter sally_check 18
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 18
    set_counter sally_check 19
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 19
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 4

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 80

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 60
    set_counter sally_check 20
    battle_wait 30
if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 20
    set_counter sally_check 21
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 21
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 24
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 24
    set_counter sally_check 25
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 25
    set_counter sally_check 26
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 26
    set_counter sally_check 27
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 27
    set_counter sally_check 28
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 28
    set_counter sally_check 29
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 29
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_if
end_monitor

;;;;;;;Large City

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 45

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
    set_counter sally_check 30
    battle_wait 37

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 30
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 34
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 34
    set_counter sally_check 35
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 35
    set_counter sally_check 36
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 36
    set_counter sally_check 37
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 37
    set_counter sally_check 38
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 38
    set_counter sally_check 39
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 39
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 90

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 70
    set_counter sally_check 40
    battle_wait 35
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 40
    set_counter sally_check 41
    battle_wait 35
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 41
    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    if I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 44
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 44
    set_counter sally_check 45
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 45
    set_counter sally_check 46
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 46
    set_counter sally_check 47
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 47
    set_counter sally_check 48
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 48
    set_counter sally_check 49
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 49
    set_counter emergency_stop 0
    if I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

;;;;;;;Castle, Citadel and Fortress

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 100

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 75
    set_counter sally_check 50
    battle_wait 15
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 50
    set_counter sally_check 51
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 51
    set_counter sally_check 52
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 52
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 54
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 54
    set_counter sally_check 55
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 55
    set_counter sally_check 56
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 56
    set_counter sally_check 57
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 57
    set_counter sally_check 58
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 58
    set_counter sally_check 59
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 59
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 170

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 125
    set_counter sally_check 60
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 60
    set_counter sally_check 61
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 61
    set_counter sally_check 62
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 62
    set_counter sally_check 63
    battle_wait 35
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 63
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 64
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 64
    set_counter sally_check 65
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 65
    set_counter sally_check 66
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 66
    set_counter sally_check 67
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 67
    set_counter sally_check 68
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 68
    set_counter sally_check 69
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 69
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

;;;;;;;Wall Advance

monitor_conditions I_BattleStarted
    and I_CompareCounter wall_advance_s = 1
    and I_CompareCounter kill_sally = 1
    and I_BattleIsSallyOutBattle

    battle_wait 2
    if I_BattleSettlementFortificationLevel < 3
     and I_CompareCounter wall_advance_s = 1
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_unformed army2 0 95
    end_if

    if I_BattleSettlementFortificationLevel > 2
     and I_CompareCounter wall_advance_s = 1
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_unformed army2 0 200
    end_if

    set_counter emergency_stop 1
    if I_BattleSettlementFortificationLevel < 3
;	battle_wait 72
    set_counter sally_check 113
    battle_wait 36
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 113
    set_counter sally_check 114
    battle_wait 36
    end_if
    end_if
    if I_BattleSettlementFortificationLevel > 2
;	battle_wait 145
    set_counter sally_check 110
    battle_wait 25
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 110
    set_counter sally_check 111
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 111
    set_counter sally_check 112
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 112
    set_counter sally_check 113
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 113
    set_counter sally_check 114
    battle_wait 30
    end_if
    end_if

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 114
    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1

    set_counter emergency_stop 0
    unit_group_order_halt army2
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    set_counter wall_advance_s 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter omfg_cannon_tower > 0

    set_counter omfg_cannon_tower 2
if I_CompareCounter player_unit_count > 0
    if I_UnitStatus a1u1 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u1 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u2 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u2 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u3 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u3 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u4 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u4 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u5 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u5 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u6 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u6 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u7 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u7 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u8 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u8 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u9 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u9 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u10 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u10 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u11 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u11 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u12 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u12 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u13 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u13 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u14 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u14 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u15 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u15 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u16 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u16 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u17 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u17 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u18 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u18 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u19 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u19 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 19
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u20 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u20 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if I_CompareCounter omfg_cannon_tower = 2

    if I_CompareCounter enemy_unit_count > 0
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u1
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u2
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 2
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u3
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u4
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 4
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u5
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 5
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u6
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u7
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 7
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u8
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 8
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u9
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 9
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u10
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 10
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u11
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u12
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 12
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u13
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 13
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u14
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 14
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u15
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 15
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u16
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 16
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u17
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 17
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u18
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 18
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u19
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count = 20
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u20
    set_counter omfg_cannon_tower 3
    end_if
end_if

    if I_CompareCounter omfg_cannon_tower = 3
    set_counter omfg_cannon_tower 0
    set_counter emergency_stop 0
;    ai_active_set off
;    battle_wait 0.5
    ai_active_set on
    end_if
    battle_wait 7
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter emergency_stop = 1
;    and I_CompareCounter labels_only = 1
    and I_CompareCounter kill_sally = 1

    if I_BattleIsSiegeBattle
    unit_group_order_halt army1
    battle_wait 0.5
    ai_active_set on
    set_counter emergency_stop 0
    end_if
    if I_BattleIsSallyOutBattle
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    set_counter emergency_stop 0
    end_if
end_monitor

;################## Open Battles #################

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter ob_defend = 0
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    set_counter ob_defend 2

    if I_UnitDistanceFromUnit a1u1 a2u1 < 220
    and I_BattleEnemyArmyNumberOfUnitClass missile = 0
    and I_BattleEnemyArmyNumberOfUnitClass skirmish = 0
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    and I_UnitDistanceFromUnit a1u1 a2u1 < 270
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattlePlayerAllianceOddsInFavour > 1.7
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyNumberOfUnitClass missile = 0
    and I_BattleEnemyArmyNumberOfUnitClass skirmish = 0
    set_counter ob_repeat_test 1
    end_if
;    if I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
;    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 200
    and BattleEnemyUnitClass != missile
    and BattleEnemyUnitClass != skirmish
    and BattleDirectionOfAttack != front
    and BattleRangeOfAttack < 200

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker
    and BattleDirectionOfAttack != rear
    and I_UnitEnemyUnitInRadius a2u1 200
    and BattleRangeOfAttack < 200
    and BattlePlayerUnitCategory infantry

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_UnitEnemyUnitInRadius a2u1 100
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    and I_UnitEnemyUnitInRadius a2u1 250
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4

    set_counter player_units_closing 0

    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromUnit a1u1 a2u1 < 180
    and ! I_UnitStatus a1u1 missiles_firing
    and ! I_UnitStatus a1u1 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromUnit a1u2 a2u1 < 180
    and ! I_UnitStatus a1u2 missiles_firing
    and ! I_UnitStatus a1u2 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromUnit a1u3 a2u1 < 180
    and ! I_UnitStatus a1u3 missiles_firing
    and ! I_UnitStatus a1u3 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromUnit a1u4 a2u1 < 180
    and ! I_UnitStatus a1u4 missiles_firing
    and ! I_UnitStatus a1u4 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromUnit a1u5 a2u1 < 180
    and ! I_UnitStatus a1u5 missiles_firing
    and ! I_UnitStatus a1u5 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromUnit a1u6 a2u1 < 180
    and ! I_UnitStatus a1u6 missiles_firing
    and ! I_UnitStatus a1u6 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromUnit a1u7 a2u1 < 180
    and ! I_UnitStatus a1u7 missiles_firing
    and ! I_UnitStatus a1u7 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromUnit a1u8 a2u1 < 180
    and ! I_UnitStatus a1u8 missiles_firing
    and ! I_UnitStatus a1u8 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromUnit a1u9 a2u1 < 180
    and ! I_UnitStatus a1u9 missiles_firing
    and ! I_UnitStatus a1u9 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromUnit a1u10 a2u1 < 180
    and ! I_UnitStatus a1u10 missiles_firing
    and ! I_UnitStatus a1u10 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromUnit a1u11 a2u1 < 180
    and ! I_UnitStatus a1u11 missiles_firing
    and ! I_UnitStatus a1u11 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromUnit a1u12 a2u1 < 180
    and ! I_UnitStatus a1u12 missiles_firing
    and ! I_UnitStatus a1u12 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromUnit a1u13 a2u1 < 180
    and ! I_UnitStatus a1u13 missiles_firing
    and ! I_UnitStatus a1u13 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromUnit a1u14 a2u1 < 180
    and ! I_UnitStatus a1u14 missiles_firing
    and ! I_UnitStatus a1u14 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromUnit a1u15 a2u1 < 180
    and ! I_UnitStatus a1u15 missiles_firing
    and ! I_UnitStatus a1u15 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromUnit a1u16 a2u1 < 180
    and ! I_UnitStatus a1u16 missiles_firing
    and ! I_UnitStatus a1u16 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromUnit a1u17 a2u1 < 180
    and ! I_UnitStatus a1u17 missiles_firing
    and ! I_UnitStatus a1u17 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromUnit a1u18 a2u1 < 180
    and ! I_UnitStatus a1u18 missiles_firing
    and ! I_UnitStatus a1u18 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromUnit a1u19 a2u1 < 180
    and ! I_UnitStatus a1u19 missiles_firing
    and ! I_UnitStatus a1u19 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromUnit a1u20 a2u1 < 180
    and ! I_UnitStatus a1u20 missiles_firing
    and ! I_UnitStatus a1u20 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_units_closing > 1
    inc_counter player_enveloping 1
    end_if
    if I_CompareCounter player_units_closing < 1
    set_counter player_enveloping 0
    end_if
    if I_CompareCounter player_enveloping > 5
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    battle_wait 10
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter ob_defend > 1
    and I_CompareCounter ob_defend != 4
    and BattleIsMeleeAttack
    and BattleEnemyUnitClass heavy
    and BattleEnemyUnitCategory cavalry
    and ! BattlePlayerUnitClass heavy
    and ! BattlePlayerUnitClass heavy
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    inc_counter ob_engaged -1
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defend > 1
    and I_CompareCounter ob_defend != 4
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    if I_PercentageOfArmyKilled 0 0 < 5
    and I_PercentageOfArmyKilled 1 0 > 10
    set_counter ob_repeat_test 4
    end_if

    if I_PercentageOfArmyKilled 0 0 < 10
    and I_PercentageOfArmyKilled 1 0 > 20
    set_counter ob_repeat_test 4
    end_if

    if I_PercentageOfArmyKilled 0 0 < 15
    and I_PercentageOfArmyKilled 1 0 > 25
    set_counter ob_repeat_test 4
    end_if
    battle_wait 30
end_monitor

;monitor_event BattlePlayerUnitAttacksEnemyUnit TrueCondition
;    and I_CompareCounter panel_check = 1
;    and I_CompareCounter ob_defense_launch = 1
;    and ! I_CompareCounter ob_defend > 1
;    and BattlePlayerUnitCategory siege
;    and BattlePlayerUnitClass missile
;    and BattleRangeOfAttack < 400
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    set_counter ob_siege_attack 1
;end_monitor

;monitor_conditions I_BattleStarted
;    and I_CompareCounter ob_defense_launch = 1
;    and I_CompareCounter ob_siege_attack = 1
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    if I_PercentageOfArmyKilled 0 0 < 3
;    and I_PercentageOfArmyKilled 1 0 > 5
;    set_counter ob_defend 2
;    set_counter ob_siege_attack 0
;    end_if
;    if I_PercentageOfArmyKilled 0 0 < 5
;    and I_PercentageOfArmyKilled 1 0 > 10
;    if I_CompareCounter ob_repeat_test < 2
;    set_counter ob_repeat_test 2
;    end_if
;    set_counter ob_defend 2
;    set_counter ob_siege_attack 0
;    end_if
;    battle_wait 30
;end_monitor

;;;;;; Reinf triggers

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker

    if I_CompareCounter player_engaged_reinf = 4
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
    end_if

    if I_IsUnitGroupEngaged army1
    inc_counter player_engaged_reinf 1
    end_if

    if I_CompareCounter player_engaged_reinf > 0
    and ! I_IsUnitGroupEngaged army1
    set_counter player_engaged_reinf 0
    end_if

    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_PercentageUnitGroupKilled army4 > 10
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_UnitEnemyUnitInRadius a4u1 100
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
end_monitor

;;;;;; Main monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter ob_defend = 2
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    set_counter ob_defend 3

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter ob_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u1 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u2 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u3 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u4 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u5 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u6 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u7 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u8 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u9 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u10 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u11 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u12 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u13 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u14 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u15 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u16 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u17 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u18 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u19 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u20 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter ob_under_fire < 1
    if I_CompareCounter ob_engaged > 0

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if

    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_engaged 0
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_repeat_test = 1
    set_counter ob_engaged 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 2
    end_if

    if I_CompareCounter ob_repeat_test = 0
    set_counter ob_engaged 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 1
    end_if
    end_if

    if I_CompareCounter ob_engaged < 1

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 2
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    end_if

    if I_CompareCounter ob_repeat_test < 3
    set_counter ob_repeat_test 1
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    end_if
    end_if

    end_if

    if I_CompareCounter ob_under_fire > 0
    if I_CompareCounter ob_engaged > 0

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if
    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_engaged 0
    set_counter ob_repeat_test 3
    end_if
    if I_CompareCounter ob_repeat_test < 2
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    set_counter ob_repeat_test 2
    end_if
    end_if

    if I_CompareCounter ob_engaged < 1

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if

    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_repeat_test 3
    end_if
    if I_CompareCounter ob_repeat_test = 1
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 2
    end_if

    if I_CompareCounter ob_repeat_test = 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 1
    end_if
    end_if

    end_if
    if I_CompareCounter ob_repeat_test = 4
    if I_CompareCounter ob_under_fire < 1
    and I_CompareCounter ob_engaged < 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 3
        set_counter ob_repeat_test 2
    end_if
    if I_CompareCounter ob_under_fire > 0

        ai_gta_plan_set 1 ATTACK_ALL
        set_counter apply_strategy 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 4
        set_counter ob_repeat_test 0
        set_counter ob_defense_launch 0
    end_if
    if I_CompareCounter ob_engaged > 0

        ai_gta_plan_set 1 ATTACK_ALL
        set_counter apply_strategy 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 4
        set_counter ob_repeat_test 0
        set_counter ob_defense_launch 0
    end_if

    end_if

        if I_CompareCounter ob_defend = 3
        set_counter ob_defend 2
        end_if
        battle_wait 15
end_monitor

;;;;;;;General Stop

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 1
    and I_CompareCounter open_battle = 1
    and I_BattleEnemyArmyNumberOfUnits > 2
    and I_BattlePlayerArmyIsAttacker
    and I_BattleAiAttacking
    and I_UnitEnemyUnitInRadius a2u1 120

    set_counter g_stop 2
    label_unit 1 0 0 a2u1
    battle_wait 0.1
    unit_order_halt a2u1
    if I_BattleEnemyArmyNumberOfUnits > 5
    battle_wait 30
    end_if
    if I_BattleEnemyArmyNumberOfUnits < 6
    battle_wait 15
    end_if
    if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter g_stop = 2
    and I_BattleAiAttacking
    release_unit a2u1
    set_counter g_stop 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 1
    and I_CompareCounter open_battle = 1
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleAiAttacking
    and I_UnitEnemyUnitInRadius a1u1 120

    set_counter g_stop 3
    label_unit 0 0 0 a1u1
    battle_wait 0.1
    unit_order_halt a1u1
    battle_wait 30
    if ! I_BattlePlayerArmyIsAttacker
    and I_CompareCounter g_stop = 3
    and I_BattleAiAttacking
    release_unit a1u1
    set_counter g_stop 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 2
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 60

    release_unit a2u1
    set_counter g_stop 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 3
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a1u1 60

    release_unit a1u1
    set_counter g_stop 0
end_monitor

;;;;;;;AI Stuck Fix

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter ai_stuck_launch = 1
    and BattleIsMeleeAttack
    and I_BattleIsSiegeBattle
    set_counter ai_stuck_launch 2
end_monitor

monitor_conditions I_CompareCounter ai_stuck_launch = 2
    and I_BattleIsSiegeBattle

if I_CompareCounter enemy_unit_count > 0
and ! I_UnitDestroyed a2u1

    if I_UnitStatus a2u1 moving
    if I_CompareCounter a2u1_status = 0
    set_counter a2u1_status 1
    end_if
    if I_CompareCounter a2u1_status != 1
    set_counter a2u1_status 0
    end_if
    end_if

    if I_UnitStatus a2u1 routing
    if I_CompareCounter a2u1_status = 0
    set_counter a2u1_status 2
    end_if
    if I_CompareCounter a2u1_status != 2
    set_counter a2u1_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u1 moving
    and ! I_UnitStatus a2u1 routing
    set_counter a2u1_status 0
    end_if

    if I_CompareCounter a2u1_status > 0

    if I_UnitDistanceFromPosition a2u1 0,0 >= 150
    and I_UnitDistanceFromPosition a2u1 0,0 < 175
    if I_CompareCounter a2u1_distance != 1
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 1
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 175
    and I_UnitDistanceFromPosition a2u1 0,0 < 200
    if I_CompareCounter a2u1_distance != 2
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 2
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 200
    and I_UnitDistanceFromPosition a2u1 0,0 < 225
    if I_CompareCounter a2u1_distance != 3
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 3
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 225
    and I_UnitDistanceFromPosition a2u1 0,0 < 250
    if I_CompareCounter a2u1_distance != 4
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 4
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 250
    and I_UnitDistanceFromPosition a2u1 0,0 < 275
    if I_CompareCounter a2u1_distance != 5
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 5
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 275
    and I_UnitDistanceFromPosition a2u1 0,0 < 300
    if I_CompareCounter a2u1_distance != 6
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 6
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 300
    and I_UnitDistanceFromPosition a2u1 0,0 < 325
    if I_CompareCounter a2u1_distance != 7
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 7
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 325
    and I_UnitDistanceFromPosition a2u1 0,0 < 350
    if I_CompareCounter a2u1_distance != 8
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 8
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 350
    and I_UnitDistanceFromPosition a2u1 0,0 < 375
    if I_CompareCounter a2u1_distance != 9
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 9
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 375
    and I_UnitDistanceFromPosition a2u1 0,0 < 400
    if I_CompareCounter a2u1_distance != 10
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 10
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 400
    and I_UnitDistanceFromPosition a2u1 0,0 < 425
    if I_CompareCounter a2u1_distance != 11
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 11
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 425
    and I_UnitDistanceFromPosition a2u1 0,0 < 450
    if I_CompareCounter a2u1_distance != 12
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 12
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 450
    and I_UnitDistanceFromPosition a2u1 0,0 < 500
    if I_CompareCounter a2u1_distance != 13
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 13
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 500
    and I_UnitDistanceFromPosition a2u1 0,0 < 550
    if I_CompareCounter a2u1_distance != 14
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 14
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 550
    and I_UnitDistanceFromPosition a2u1 0,0 < 600
    if I_CompareCounter a2u1_distance != 15
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 15
    inc_counter a2u1_stuck 1
    end_if

    if I_CompareCounter a2u1_stuck = 4
    unit_order_halt a2u1
    unit_set_morale a2u1 wavering
    battle_wait 0.1
    unit_unset_morale a2u1
    release_unit a2u1
    set_counter a2u1_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 1
and ! I_UnitDestroyed a2u2

    if I_UnitStatus a2u2 moving
    if I_CompareCounter a2u2_status = 0
    set_counter a2u2_status 1
    end_if
    if I_CompareCounter a2u2_status != 1
    set_counter a2u2_status 0
    end_if
    end_if

    if I_UnitStatus a2u2 routing
    if I_CompareCounter a2u2_status = 0
    set_counter a2u2_status 2
    end_if
    if I_CompareCounter a2u2_status != 2
    set_counter a2u2_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u2 moving
    and ! I_UnitStatus a2u2 routing
    set_counter a2u2_status 0
    end_if

    if I_CompareCounter a2u2_status > 0

    if I_UnitDistanceFromPosition a2u2 0,0 >= 150
    and I_UnitDistanceFromPosition a2u2 0,0 < 175
    if I_CompareCounter a2u2_distance != 1
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 1
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 175
    and I_UnitDistanceFromPosition a2u2 0,0 < 200
    if I_CompareCounter a2u2_distance != 2
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 2
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 200
    and I_UnitDistanceFromPosition a2u2 0,0 < 225
    if I_CompareCounter a2u2_distance != 3
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 3
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 225
    and I_UnitDistanceFromPosition a2u2 0,0 < 250
    if I_CompareCounter a2u2_distance != 4
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 4
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 250
    and I_UnitDistanceFromPosition a2u2 0,0 < 275
    if I_CompareCounter a2u2_distance != 5
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 5
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 275
    and I_UnitDistanceFromPosition a2u2 0,0 < 300
    if I_CompareCounter a2u2_distance != 6
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 6
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 300
    and I_UnitDistanceFromPosition a2u2 0,0 < 325
    if I_CompareCounter a2u2_distance != 7
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 7
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 325
    and I_UnitDistanceFromPosition a2u2 0,0 < 350
    if I_CompareCounter a2u2_distance != 8
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 8
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 350
    and I_UnitDistanceFromPosition a2u2 0,0 < 375
    if I_CompareCounter a2u2_distance != 9
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 9
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 375
    and I_UnitDistanceFromPosition a2u2 0,0 < 400
    if I_CompareCounter a2u2_distance != 10
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 10
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 400
    and I_UnitDistanceFromPosition a2u2 0,0 < 425
    if I_CompareCounter a2u2_distance != 11
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 11
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 425
    and I_UnitDistanceFromPosition a2u2 0,0 < 450
    if I_CompareCounter a2u2_distance != 12
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 12
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 450
    and I_UnitDistanceFromPosition a2u2 0,0 < 500
    if I_CompareCounter a2u2_distance != 13
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 13
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 500
    and I_UnitDistanceFromPosition a2u2 0,0 < 550
    if I_CompareCounter a2u2_distance != 14
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 14
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 550
    and I_UnitDistanceFromPosition a2u2 0,0 < 600
    if I_CompareCounter a2u2_distance != 15
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 15
    inc_counter a2u2_stuck 1
    end_if

    if I_CompareCounter a2u2_stuck = 4
    unit_order_halt a2u2
    unit_set_morale a2u2 wavering
    battle_wait 0.1
    unit_unset_morale a2u2
    release_unit a2u2
    set_counter a2u2_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 2
and ! I_UnitDestroyed a2u3

    if I_UnitStatus a2u3 moving
    if I_CompareCounter a2u3_status = 0
    set_counter a2u3_status 1
    end_if
    if I_CompareCounter a2u3_status != 1
    set_counter a2u3_status 0
    end_if
    end_if

    if I_UnitStatus a2u3 routing
    if I_CompareCounter a2u3_status = 0
    set_counter a2u3_status 2
    end_if
    if I_CompareCounter a2u3_status != 2
    set_counter a2u3_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u3 moving
    and ! I_UnitStatus a2u3 routing
    set_counter a2u3_status 0
    end_if

    if I_CompareCounter a2u3_status > 0

    if I_UnitDistanceFromPosition a2u3 0,0 >= 150
    and I_UnitDistanceFromPosition a2u3 0,0 < 175
    if I_CompareCounter a2u3_distance != 1
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 1
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 175
    and I_UnitDistanceFromPosition a2u3 0,0 < 200
    if I_CompareCounter a2u3_distance != 2
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 2
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 200
    and I_UnitDistanceFromPosition a2u3 0,0 < 225
    if I_CompareCounter a2u3_distance != 3
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 3
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 225
    and I_UnitDistanceFromPosition a2u3 0,0 < 250
    if I_CompareCounter a2u3_distance != 4
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 4
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 250
    and I_UnitDistanceFromPosition a2u3 0,0 < 275
    if I_CompareCounter a2u3_distance != 5
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 5
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 275
    and I_UnitDistanceFromPosition a2u3 0,0 < 300
    if I_CompareCounter a2u3_distance != 6
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 6
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 300
    and I_UnitDistanceFromPosition a2u3 0,0 < 325
    if I_CompareCounter a2u3_distance != 7
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 7
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 325
    and I_UnitDistanceFromPosition a2u3 0,0 < 350
    if I_CompareCounter a2u3_distance != 8
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 8
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 350
    and I_UnitDistanceFromPosition a2u3 0,0 < 375
    if I_CompareCounter a2u3_distance != 9
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 9
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 375
    and I_UnitDistanceFromPosition a2u3 0,0 < 400
    if I_CompareCounter a2u3_distance != 10
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 10
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 400
    and I_UnitDistanceFromPosition a2u3 0,0 < 425
    if I_CompareCounter a2u3_distance != 11
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 11
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 425
    and I_UnitDistanceFromPosition a2u3 0,0 < 450
    if I_CompareCounter a2u3_distance != 12
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 12
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 450
    and I_UnitDistanceFromPosition a2u3 0,0 < 500
    if I_CompareCounter a2u3_distance != 13
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 13
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 500
    and I_UnitDistanceFromPosition a2u3 0,0 < 550
    if I_CompareCounter a2u3_distance != 14
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 14
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 550
    and I_UnitDistanceFromPosition a2u3 0,0 < 600
    if I_CompareCounter a2u3_distance != 15
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 15
    inc_counter a2u3_stuck 1
    end_if

    if I_CompareCounter a2u3_stuck = 4
    unit_order_halt a2u3
    unit_set_morale a2u3 wavering
    battle_wait 0.1
    unit_unset_morale a2u3
    release_unit a2u3
    set_counter a2u3_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 3
and ! I_UnitDestroyed a2u4

    if I_UnitStatus a2u4 moving
    if I_CompareCounter a2u4_status = 0
    set_counter a2u4_status 1
    end_if
    if I_CompareCounter a2u4_status != 1
    set_counter a2u4_status 0
    end_if
    end_if

    if I_UnitStatus a2u4 routing
    if I_CompareCounter a2u4_status = 0
    set_counter a2u4_status 2
    end_if
    if I_CompareCounter a2u4_status != 2
    set_counter a2u4_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u4 moving
    and ! I_UnitStatus a2u4 routing
    set_counter a2u4_status 0
    end_if

    if I_CompareCounter a2u4_status > 0

    if I_UnitDistanceFromPosition a2u4 0,0 >= 150
    and I_UnitDistanceFromPosition a2u4 0,0 < 175
    if I_CompareCounter a2u4_distance != 1
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 1
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 175
    and I_UnitDistanceFromPosition a2u4 0,0 < 200
    if I_CompareCounter a2u4_distance != 2
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 2
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 200
    and I_UnitDistanceFromPosition a2u4 0,0 < 225
    if I_CompareCounter a2u4_distance != 3
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 3
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 225
    and I_UnitDistanceFromPosition a2u4 0,0 < 250
    if I_CompareCounter a2u4_distance != 4
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 4
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 250
    and I_UnitDistanceFromPosition a2u4 0,0 < 275
    if I_CompareCounter a2u4_distance != 5
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 5
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 275
    and I_UnitDistanceFromPosition a2u4 0,0 < 300
    if I_CompareCounter a2u4_distance != 6
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 6
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 300
    and I_UnitDistanceFromPosition a2u4 0,0 < 325
    if I_CompareCounter a2u4_distance != 7
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 7
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 325
    and I_UnitDistanceFromPosition a2u4 0,0 < 350
    if I_CompareCounter a2u4_distance != 8
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 8
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 350
    and I_UnitDistanceFromPosition a2u4 0,0 < 375
    if I_CompareCounter a2u4_distance != 9
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 9
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 375
    and I_UnitDistanceFromPosition a2u4 0,0 < 400
    if I_CompareCounter a2u4_distance != 10
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 10
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 400
    and I_UnitDistanceFromPosition a2u4 0,0 < 425
    if I_CompareCounter a2u4_distance != 11
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 11
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 425
    and I_UnitDistanceFromPosition a2u4 0,0 < 450
    if I_CompareCounter a2u4_distance != 12
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 12
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 450
    and I_UnitDistanceFromPosition a2u4 0,0 < 500
    if I_CompareCounter a2u4_distance != 13
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 13
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 500
    and I_UnitDistanceFromPosition a2u4 0,0 < 550
    if I_CompareCounter a2u4_distance != 14
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 14
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 550
    and I_UnitDistanceFromPosition a2u4 0,0 < 600
    if I_CompareCounter a2u4_distance != 15
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 15
    inc_counter a2u4_stuck 1
    end_if

    if I_CompareCounter a2u4_stuck = 4
    unit_order_halt a2u4
    unit_set_morale a2u4 wavering
    battle_wait 0.1
    unit_unset_morale a2u4
    release_unit a2u4
    set_counter a2u4_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 4
and ! I_UnitDestroyed a2u5

    if I_UnitStatus a2u5 moving
    if I_CompareCounter a2u5_status = 0
    set_counter a2u5_status 1
    end_if
    if I_CompareCounter a2u5_status != 1
    set_counter a2u5_status 0
    end_if
    end_if

    if I_UnitStatus a2u5 routing
    if I_CompareCounter a2u5_status = 0
    set_counter a2u5_status 2
    end_if
    if I_CompareCounter a2u5_status != 2
    set_counter a2u5_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u5 moving
    and ! I_UnitStatus a2u5 routing
    set_counter a2u5_status 0
    end_if

    if I_CompareCounter a2u5_status > 0

    if I_UnitDistanceFromPosition a2u5 0,0 >= 150
    and I_UnitDistanceFromPosition a2u5 0,0 < 175
    if I_CompareCounter a2u5_distance != 1
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 1
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 175
    and I_UnitDistanceFromPosition a2u5 0,0 < 200
    if I_CompareCounter a2u5_distance != 2
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 2
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 200
    and I_UnitDistanceFromPosition a2u5 0,0 < 225
    if I_CompareCounter a2u5_distance != 3
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 3
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 225
    and I_UnitDistanceFromPosition a2u5 0,0 < 250
    if I_CompareCounter a2u5_distance != 4
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 4
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 250
    and I_UnitDistanceFromPosition a2u5 0,0 < 275
    if I_CompareCounter a2u5_distance != 5
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 5
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 275
    and I_UnitDistanceFromPosition a2u5 0,0 < 300
    if I_CompareCounter a2u5_distance != 6
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 6
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 300
    and I_UnitDistanceFromPosition a2u5 0,0 < 325
    if I_CompareCounter a2u5_distance != 7
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 7
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 325
    and I_UnitDistanceFromPosition a2u5 0,0 < 350
    if I_CompareCounter a2u5_distance != 8
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 8
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 350
    and I_UnitDistanceFromPosition a2u5 0,0 < 375
    if I_CompareCounter a2u5_distance != 9
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 9
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 375
    and I_UnitDistanceFromPosition a2u5 0,0 < 400
    if I_CompareCounter a2u5_distance != 10
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 10
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 400
    and I_UnitDistanceFromPosition a2u5 0,0 < 425
    if I_CompareCounter a2u5_distance != 11
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 11
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 425
    and I_UnitDistanceFromPosition a2u5 0,0 < 450
    if I_CompareCounter a2u5_distance != 12
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 12
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 450
    and I_UnitDistanceFromPosition a2u5 0,0 < 500
    if I_CompareCounter a2u5_distance != 13
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 13
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 500
    and I_UnitDistanceFromPosition a2u5 0,0 < 550
    if I_CompareCounter a2u5_distance != 14
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 14
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 550
    and I_UnitDistanceFromPosition a2u5 0,0 < 600
    if I_CompareCounter a2u5_distance != 15
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 15
    inc_counter a2u5_stuck 1
    end_if

    if I_CompareCounter a2u5_stuck = 4
    unit_order_halt a2u5
    unit_set_morale a2u5 wavering
    battle_wait 0.1
    unit_unset_morale a2u5
    release_unit a2u5
    set_counter a2u5_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 5
and ! I_UnitDestroyed a2u6

    if I_UnitStatus a2u6 moving
    if I_CompareCounter a2u6_status = 0
    set_counter a2u6_status 1
    end_if
    if I_CompareCounter a2u6_status != 1
    set_counter a2u6_status 0
    end_if
    end_if

    if I_UnitStatus a2u6 routing
    if I_CompareCounter a2u6_status = 0
    set_counter a2u6_status 2
    end_if
    if I_CompareCounter a2u6_status != 2
    set_counter a2u6_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u6 moving
    and ! I_UnitStatus a2u6 routing
    set_counter a2u6_status 0
    end_if

    if I_CompareCounter a2u6_status > 0

    if I_UnitDistanceFromPosition a2u6 0,0 >= 150
    and I_UnitDistanceFromPosition a2u6 0,0 < 175
    if I_CompareCounter a2u6_distance != 1
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 1
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 175
    and I_UnitDistanceFromPosition a2u6 0,0 < 200
    if I_CompareCounter a2u6_distance != 2
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 2
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 200
    and I_UnitDistanceFromPosition a2u6 0,0 < 225
    if I_CompareCounter a2u6_distance != 3
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 3
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 225
    and I_UnitDistanceFromPosition a2u6 0,0 < 250
    if I_CompareCounter a2u6_distance != 4
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 4
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 250
    and I_UnitDistanceFromPosition a2u6 0,0 < 275
    if I_CompareCounter a2u6_distance != 5
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 5
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 275
    and I_UnitDistanceFromPosition a2u6 0,0 < 300
    if I_CompareCounter a2u6_distance != 6
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 6
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 300
    and I_UnitDistanceFromPosition a2u6 0,0 < 325
    if I_CompareCounter a2u6_distance != 7
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 7
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 325
    and I_UnitDistanceFromPosition a2u6 0,0 < 350
    if I_CompareCounter a2u6_distance != 8
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 8
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 350
    and I_UnitDistanceFromPosition a2u6 0,0 < 375
    if I_CompareCounter a2u6_distance != 9
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 9
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 375
    and I_UnitDistanceFromPosition a2u6 0,0 < 400
    if I_CompareCounter a2u6_distance != 10
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 10
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 400
    and I_UnitDistanceFromPosition a2u6 0,0 < 425
    if I_CompareCounter a2u6_distance != 11
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 11
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 425
    and I_UnitDistanceFromPosition a2u6 0,0 < 450
    if I_CompareCounter a2u6_distance != 12
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 12
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 450
    and I_UnitDistanceFromPosition a2u6 0,0 < 500
    if I_CompareCounter a2u6_distance != 13
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 13
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 500
    and I_UnitDistanceFromPosition a2u6 0,0 < 550
    if I_CompareCounter a2u6_distance != 14
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 14
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 550
    and I_UnitDistanceFromPosition a2u6 0,0 < 600
    if I_CompareCounter a2u6_distance != 15
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 15
    inc_counter a2u6_stuck 1
    end_if

    if I_CompareCounter a2u6_stuck = 4
    unit_order_halt a2u6
    unit_set_morale a2u6 wavering
    battle_wait 0.1
    unit_unset_morale a2u6
    release_unit a2u6
    set_counter a2u6_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 6
and ! I_UnitDestroyed a2u7

    if I_UnitStatus a2u7 moving
    if I_CompareCounter a2u7_status = 0
    set_counter a2u7_status 1
    end_if
    if I_CompareCounter a2u7_status != 1
    set_counter a2u7_status 0
    end_if
    end_if

    if I_UnitStatus a2u7 routing
    if I_CompareCounter a2u7_status = 0
    set_counter a2u7_status 2
    end_if
    if I_CompareCounter a2u7_status != 2
    set_counter a2u7_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u7 moving
    and ! I_UnitStatus a2u7 routing
    set_counter a2u7_status 0
    end_if

    if I_CompareCounter a2u7_status > 0

    if I_UnitDistanceFromPosition a2u7 0,0 >= 150
    and I_UnitDistanceFromPosition a2u7 0,0 < 175
    if I_CompareCounter a2u7_distance != 1
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 1
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 175
    and I_UnitDistanceFromPosition a2u7 0,0 < 200
    if I_CompareCounter a2u7_distance != 2
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 2
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 200
    and I_UnitDistanceFromPosition a2u7 0,0 < 225
    if I_CompareCounter a2u7_distance != 3
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 3
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 225
    and I_UnitDistanceFromPosition a2u7 0,0 < 250
    if I_CompareCounter a2u7_distance != 4
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 4
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 250
    and I_UnitDistanceFromPosition a2u7 0,0 < 275
    if I_CompareCounter a2u7_distance != 5
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 5
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 275
    and I_UnitDistanceFromPosition a2u7 0,0 < 300
    if I_CompareCounter a2u7_distance != 6
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 6
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 300
    and I_UnitDistanceFromPosition a2u7 0,0 < 325
    if I_CompareCounter a2u7_distance != 7
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 7
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 325
    and I_UnitDistanceFromPosition a2u7 0,0 < 350
    if I_CompareCounter a2u7_distance != 8
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 8
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 350
    and I_UnitDistanceFromPosition a2u7 0,0 < 375
    if I_CompareCounter a2u7_distance != 9
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 9
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 375
    and I_UnitDistanceFromPosition a2u7 0,0 < 400
    if I_CompareCounter a2u7_distance != 10
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 10
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 400
    and I_UnitDistanceFromPosition a2u7 0,0 < 425
    if I_CompareCounter a2u7_distance != 11
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 11
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 425
    and I_UnitDistanceFromPosition a2u7 0,0 < 450
    if I_CompareCounter a2u7_distance != 12
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 12
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 450
    and I_UnitDistanceFromPosition a2u7 0,0 < 500
    if I_CompareCounter a2u7_distance != 13
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 13
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 500
    and I_UnitDistanceFromPosition a2u7 0,0 < 550
    if I_CompareCounter a2u7_distance != 14
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 14
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 550
    and I_UnitDistanceFromPosition a2u7 0,0 < 600
    if I_CompareCounter a2u7_distance != 15
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 15
    inc_counter a2u7_stuck 1
    end_if

    if I_CompareCounter a2u7_stuck = 4
    unit_order_halt a2u7
    unit_set_morale a2u7 wavering
    battle_wait 0.1
    unit_unset_morale a2u7
    release_unit a2u7
    set_counter a2u7_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 7
and ! I_UnitDestroyed a2u8

    if I_UnitStatus a2u8 moving
    if I_CompareCounter a2u8_status = 0
    set_counter a2u8_status 1
    end_if
    if I_CompareCounter a2u8_status != 1
    set_counter a2u8_status 0
    end_if
    end_if

    if I_UnitStatus a2u8 routing
    if I_CompareCounter a2u8_status = 0
    set_counter a2u8_status 2
    end_if
    if I_CompareCounter a2u8_status != 2
    set_counter a2u8_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u8 moving
    and ! I_UnitStatus a2u8 routing
    set_counter a2u8_status 0
    end_if

    if I_CompareCounter a2u8_status > 0

    if I_UnitDistanceFromPosition a2u8 0,0 >= 150
    and I_UnitDistanceFromPosition a2u8 0,0 < 175
    if I_CompareCounter a2u8_distance != 1
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 1
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 175
    and I_UnitDistanceFromPosition a2u8 0,0 < 200
    if I_CompareCounter a2u8_distance != 2
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 2
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 200
    and I_UnitDistanceFromPosition a2u8 0,0 < 225
    if I_CompareCounter a2u8_distance != 3
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 3
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 225
    and I_UnitDistanceFromPosition a2u8 0,0 < 250
    if I_CompareCounter a2u8_distance != 4
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 4
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 250
    and I_UnitDistanceFromPosition a2u8 0,0 < 275
    if I_CompareCounter a2u8_distance != 5
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 5
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 275
    and I_UnitDistanceFromPosition a2u8 0,0 < 300
    if I_CompareCounter a2u8_distance != 6
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 6
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 300
    and I_UnitDistanceFromPosition a2u8 0,0 < 325
    if I_CompareCounter a2u8_distance != 7
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 7
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 325
    and I_UnitDistanceFromPosition a2u8 0,0 < 350
    if I_CompareCounter a2u8_distance != 8
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 8
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 350
    and I_UnitDistanceFromPosition a2u8 0,0 < 375
    if I_CompareCounter a2u8_distance != 9
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 9
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 375
    and I_UnitDistanceFromPosition a2u8 0,0 < 400
    if I_CompareCounter a2u8_distance != 10
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 10
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 400
    and I_UnitDistanceFromPosition a2u8 0,0 < 425
    if I_CompareCounter a2u8_distance != 11
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 11
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 425
    and I_UnitDistanceFromPosition a2u8 0,0 < 450
    if I_CompareCounter a2u8_distance != 12
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 12
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 450
    and I_UnitDistanceFromPosition a2u8 0,0 < 500
    if I_CompareCounter a2u8_distance != 13
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 13
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 500
    and I_UnitDistanceFromPosition a2u8 0,0 < 550
    if I_CompareCounter a2u8_distance != 14
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 14
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 550
    and I_UnitDistanceFromPosition a2u8 0,0 < 600
    if I_CompareCounter a2u8_distance != 15
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 15
    inc_counter a2u8_stuck 1
    end_if

    if I_CompareCounter a2u8_stuck = 4
    unit_order_halt a2u8
    unit_set_morale a2u8 wavering
    battle_wait 0.1
    unit_unset_morale a2u8
    release_unit a2u8
    set_counter a2u8_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 8
and ! I_UnitDestroyed a2u9

    if I_UnitStatus a2u9 moving
    if I_CompareCounter a2u9_status = 0
    set_counter a2u9_status 1
    end_if
    if I_CompareCounter a2u9_status != 1
    set_counter a2u9_status 0
    end_if
    end_if

    if I_UnitStatus a2u9 routing
    if I_CompareCounter a2u9_status = 0
    set_counter a2u9_status 2
    end_if
    if I_CompareCounter a2u9_status != 2
    set_counter a2u9_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u9 moving
    and ! I_UnitStatus a2u9 routing
    set_counter a2u9_status 0
    end_if

    if I_CompareCounter a2u9_status > 0

    if I_UnitDistanceFromPosition a2u9 0,0 >= 150
    and I_UnitDistanceFromPosition a2u9 0,0 < 175
    if I_CompareCounter a2u9_distance != 1
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 1
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 175
    and I_UnitDistanceFromPosition a2u9 0,0 < 200
    if I_CompareCounter a2u9_distance != 2
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 2
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 200
    and I_UnitDistanceFromPosition a2u9 0,0 < 225
    if I_CompareCounter a2u9_distance != 3
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 3
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 225
    and I_UnitDistanceFromPosition a2u9 0,0 < 250
    if I_CompareCounter a2u9_distance != 4
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 4
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 250
    and I_UnitDistanceFromPosition a2u9 0,0 < 275
    if I_CompareCounter a2u9_distance != 5
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 5
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 275
    and I_UnitDistanceFromPosition a2u9 0,0 < 300
    if I_CompareCounter a2u9_distance != 6
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 6
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 300
    and I_UnitDistanceFromPosition a2u9 0,0 < 325
    if I_CompareCounter a2u9_distance != 7
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 7
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 325
    and I_UnitDistanceFromPosition a2u9 0,0 < 350
    if I_CompareCounter a2u9_distance != 8
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 8
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 350
    and I_UnitDistanceFromPosition a2u9 0,0 < 375
    if I_CompareCounter a2u9_distance != 9
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 9
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 375
    and I_UnitDistanceFromPosition a2u9 0,0 < 400
    if I_CompareCounter a2u9_distance != 10
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 10
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 400
    and I_UnitDistanceFromPosition a2u9 0,0 < 425
    if I_CompareCounter a2u9_distance != 11
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 11
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 425
    and I_UnitDistanceFromPosition a2u9 0,0 < 450
    if I_CompareCounter a2u9_distance != 12
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 12
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 450
    and I_UnitDistanceFromPosition a2u9 0,0 < 500
    if I_CompareCounter a2u9_distance != 13
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 13
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 500
    and I_UnitDistanceFromPosition a2u9 0,0 < 550
    if I_CompareCounter a2u9_distance != 14
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 14
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 550
    and I_UnitDistanceFromPosition a2u9 0,0 < 600
    if I_CompareCounter a2u9_distance != 15
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 15
    inc_counter a2u9_stuck 1
    end_if

    if I_CompareCounter a2u9_stuck = 4
    unit_order_halt a2u9
    unit_set_morale a2u9 wavering
    battle_wait 0.1
    unit_unset_morale a2u9
    release_unit a2u9
    set_counter a2u9_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 9
and ! I_UnitDestroyed a2u10

    if I_UnitStatus a2u10 moving
    if I_CompareCounter a2u10_status = 0
    set_counter a2u10_status 1
    end_if
    if I_CompareCounter a2u10_status != 1
    set_counter a2u10_status 0
    end_if
    end_if

    if I_UnitStatus a2u10 routing
    if I_CompareCounter a2u10_status = 0
    set_counter a2u10_status 2
    end_if
    if I_CompareCounter a2u10_status != 2
    set_counter a2u10_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u10 moving
    and ! I_UnitStatus a2u10 routing
    set_counter a2u10_status 0
    end_if

    if I_CompareCounter a2u10_status > 0

    if I_UnitDistanceFromPosition a2u10 0,0 >= 150
    and I_UnitDistanceFromPosition a2u10 0,0 < 175
    if I_CompareCounter a2u10_distance != 1
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 1
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 175
    and I_UnitDistanceFromPosition a2u10 0,0 < 200
    if I_CompareCounter a2u10_distance != 2
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 2
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 200
    and I_UnitDistanceFromPosition a2u10 0,0 < 225
    if I_CompareCounter a2u10_distance != 3
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 3
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 225
    and I_UnitDistanceFromPosition a2u10 0,0 < 250
    if I_CompareCounter a2u10_distance != 4
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 4
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 250
    and I_UnitDistanceFromPosition a2u10 0,0 < 275
    if I_CompareCounter a2u10_distance != 5
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 5
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 275
    and I_UnitDistanceFromPosition a2u10 0,0 < 300
    if I_CompareCounter a2u10_distance != 6
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 6
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 300
    and I_UnitDistanceFromPosition a2u10 0,0 < 325
    if I_CompareCounter a2u10_distance != 7
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 7
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 325
    and I_UnitDistanceFromPosition a2u10 0,0 < 350
    if I_CompareCounter a2u10_distance != 8
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 8
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 350
    and I_UnitDistanceFromPosition a2u10 0,0 < 375
    if I_CompareCounter a2u10_distance != 9
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 9
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 375
    and I_UnitDistanceFromPosition a2u10 0,0 < 400
    if I_CompareCounter a2u10_distance != 10
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 10
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 400
    and I_UnitDistanceFromPosition a2u10 0,0 < 425
    if I_CompareCounter a2u10_distance != 11
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 11
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 425
    and I_UnitDistanceFromPosition a2u10 0,0 < 450
    if I_CompareCounter a2u10_distance != 12
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 12
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 450
    and I_UnitDistanceFromPosition a2u10 0,0 < 500
    if I_CompareCounter a2u10_distance != 13
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 13
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 500
    and I_UnitDistanceFromPosition a2u10 0,0 < 550
    if I_CompareCounter a2u10_distance != 14
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 14
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 550
    and I_UnitDistanceFromPosition a2u10 0,0 < 600
    if I_CompareCounter a2u10_distance != 15
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 15
    inc_counter a2u10_stuck 1
    end_if

    if I_CompareCounter a2u10_stuck = 4
    unit_order_halt a2u10
    unit_set_morale a2u10 wavering
    battle_wait 0.1
    unit_unset_morale a2u10
    release_unit a2u10
    set_counter a2u10_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 10
and ! I_UnitDestroyed a2u11

    if I_UnitStatus a2u11 moving
    if I_CompareCounter a2u11_status = 0
    set_counter a2u11_status 1
    end_if
    if I_CompareCounter a2u11_status != 1
    set_counter a2u11_status 0
    end_if
    end_if

    if I_UnitStatus a2u11 routing
    if I_CompareCounter a2u11_status = 0
    set_counter a2u11_status 2
    end_if
    if I_CompareCounter a2u11_status != 2
    set_counter a2u11_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u11 moving
    and ! I_UnitStatus a2u11 routing
    set_counter a2u11_status 0
    end_if

    if I_CompareCounter a2u11_status > 0

    if I_UnitDistanceFromPosition a2u11 0,0 >= 150
    and I_UnitDistanceFromPosition a2u11 0,0 < 175
    if I_CompareCounter a2u11_distance != 1
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 1
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 175
    and I_UnitDistanceFromPosition a2u11 0,0 < 200
    if I_CompareCounter a2u11_distance != 2
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 2
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 200
    and I_UnitDistanceFromPosition a2u11 0,0 < 225
    if I_CompareCounter a2u11_distance != 3
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 3
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 225
    and I_UnitDistanceFromPosition a2u11 0,0 < 250
    if I_CompareCounter a2u11_distance != 4
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 4
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 250
    and I_UnitDistanceFromPosition a2u11 0,0 < 275
    if I_CompareCounter a2u11_distance != 5
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 5
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 275
    and I_UnitDistanceFromPosition a2u11 0,0 < 300
    if I_CompareCounter a2u11_distance != 6
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 6
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 300
    and I_UnitDistanceFromPosition a2u11 0,0 < 325
    if I_CompareCounter a2u11_distance != 7
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 7
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 325
    and I_UnitDistanceFromPosition a2u11 0,0 < 350
    if I_CompareCounter a2u11_distance != 8
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 8
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 350
    and I_UnitDistanceFromPosition a2u11 0,0 < 375
    if I_CompareCounter a2u11_distance != 9
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 9
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 375
    and I_UnitDistanceFromPosition a2u11 0,0 < 400
    if I_CompareCounter a2u11_distance != 10
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 10
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 400
    and I_UnitDistanceFromPosition a2u11 0,0 < 425
    if I_CompareCounter a2u11_distance != 11
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 11
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 425
    and I_UnitDistanceFromPosition a2u11 0,0 < 450
    if I_CompareCounter a2u11_distance != 12
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 12
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 450
    and I_UnitDistanceFromPosition a2u11 0,0 < 500
    if I_CompareCounter a2u11_distance != 13
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 13
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 500
    and I_UnitDistanceFromPosition a2u11 0,0 < 550
    if I_CompareCounter a2u11_distance != 14
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 14
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 550
    and I_UnitDistanceFromPosition a2u11 0,0 < 600
    if I_CompareCounter a2u11_distance != 15
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 15
    inc_counter a2u11_stuck 1
    end_if

    if I_CompareCounter a2u11_stuck = 4
    unit_order_halt a2u11
    unit_set_morale a2u11 wavering
    battle_wait 0.1
    unit_unset_morale a2u11
    release_unit a2u11
    set_counter a2u11_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 11
and ! I_UnitDestroyed a2u12

    if I_UnitStatus a2u12 moving
    if I_CompareCounter a2u12_status = 0
    set_counter a2u12_status 1
    end_if
    if I_CompareCounter a2u12_status != 1
    set_counter a2u12_status 0
    end_if
    end_if

    if I_UnitStatus a2u12 routing
    if I_CompareCounter a2u12_status = 0
    set_counter a2u12_status 2
    end_if
    if I_CompareCounter a2u12_status != 2
    set_counter a2u12_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u12 moving
    and ! I_UnitStatus a2u12 routing
    set_counter a2u12_status 0
    end_if

    if I_CompareCounter a2u12_status > 0

    if I_UnitDistanceFromPosition a2u12 0,0 >= 150
    and I_UnitDistanceFromPosition a2u12 0,0 < 175
    if I_CompareCounter a2u12_distance != 1
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 1
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 175
    and I_UnitDistanceFromPosition a2u12 0,0 < 200
    if I_CompareCounter a2u12_distance != 2
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 2
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 200
    and I_UnitDistanceFromPosition a2u12 0,0 < 225
    if I_CompareCounter a2u12_distance != 3
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 3
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 225
    and I_UnitDistanceFromPosition a2u12 0,0 < 250
    if I_CompareCounter a2u12_distance != 4
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 4
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 250
    and I_UnitDistanceFromPosition a2u12 0,0 < 275
    if I_CompareCounter a2u12_distance != 5
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 5
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 275
    and I_UnitDistanceFromPosition a2u12 0,0 < 300
    if I_CompareCounter a2u12_distance != 6
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 6
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 300
    and I_UnitDistanceFromPosition a2u12 0,0 < 325
    if I_CompareCounter a2u12_distance != 7
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 7
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 325
    and I_UnitDistanceFromPosition a2u12 0,0 < 350
    if I_CompareCounter a2u12_distance != 8
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 8
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 350
    and I_UnitDistanceFromPosition a2u12 0,0 < 375
    if I_CompareCounter a2u12_distance != 9
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 9
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 375
    and I_UnitDistanceFromPosition a2u12 0,0 < 400
    if I_CompareCounter a2u12_distance != 10
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 10
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 400
    and I_UnitDistanceFromPosition a2u12 0,0 < 425
    if I_CompareCounter a2u12_distance != 11
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 11
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 425
    and I_UnitDistanceFromPosition a2u12 0,0 < 450
    if I_CompareCounter a2u12_distance != 12
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 12
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 450
    and I_UnitDistanceFromPosition a2u12 0,0 < 500
    if I_CompareCounter a2u12_distance != 13
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 13
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 500
    and I_UnitDistanceFromPosition a2u12 0,0 < 550
    if I_CompareCounter a2u12_distance != 14
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 14
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 550
    and I_UnitDistanceFromPosition a2u12 0,0 < 600
    if I_CompareCounter a2u12_distance != 15
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 15
    inc_counter a2u12_stuck 1
    end_if

    if I_CompareCounter a2u12_stuck = 4
    unit_order_halt a2u12
    unit_set_morale a2u12 wavering
    battle_wait 0.1
    unit_unset_morale a2u12
    release_unit a2u12
    set_counter a2u12_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 12
and ! I_UnitDestroyed a2u13

    if I_UnitStatus a2u13 moving
    if I_CompareCounter a2u13_status = 0
    set_counter a2u13_status 1
    end_if
    if I_CompareCounter a2u13_status != 1
    set_counter a2u13_status 0
    end_if
    end_if

    if I_UnitStatus a2u13 routing
    if I_CompareCounter a2u13_status = 0
    set_counter a2u13_status 2
    end_if
    if I_CompareCounter a2u13_status != 2
    set_counter a2u13_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u13 moving
    and ! I_UnitStatus a2u13 routing
    set_counter a2u13_status 0
    end_if

    if I_CompareCounter a2u13_status > 0

    if I_UnitDistanceFromPosition a2u13 0,0 >= 150
    and I_UnitDistanceFromPosition a2u13 0,0 < 175
    if I_CompareCounter a2u13_distance != 1
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 1
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 175
    and I_UnitDistanceFromPosition a2u13 0,0 < 200
    if I_CompareCounter a2u13_distance != 2
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 2
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 200
    and I_UnitDistanceFromPosition a2u13 0,0 < 225
    if I_CompareCounter a2u13_distance != 3
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 3
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 225
    and I_UnitDistanceFromPosition a2u13 0,0 < 250
    if I_CompareCounter a2u13_distance != 4
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 4
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 250
    and I_UnitDistanceFromPosition a2u13 0,0 < 275
    if I_CompareCounter a2u13_distance != 5
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 5
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 275
    and I_UnitDistanceFromPosition a2u13 0,0 < 300
    if I_CompareCounter a2u13_distance != 6
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 6
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 300
    and I_UnitDistanceFromPosition a2u13 0,0 < 325
    if I_CompareCounter a2u13_distance != 7
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 7
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 325
    and I_UnitDistanceFromPosition a2u13 0,0 < 350
    if I_CompareCounter a2u13_distance != 8
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 8
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 350
    and I_UnitDistanceFromPosition a2u13 0,0 < 375
    if I_CompareCounter a2u13_distance != 9
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 9
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 375
    and I_UnitDistanceFromPosition a2u13 0,0 < 400
    if I_CompareCounter a2u13_distance != 10
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 10
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 400
    and I_UnitDistanceFromPosition a2u13 0,0 < 425
    if I_CompareCounter a2u13_distance != 11
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 11
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 425
    and I_UnitDistanceFromPosition a2u13 0,0 < 450
    if I_CompareCounter a2u13_distance != 12
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 12
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 450
    and I_UnitDistanceFromPosition a2u13 0,0 < 500
    if I_CompareCounter a2u13_distance != 13
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 13
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 500
    and I_UnitDistanceFromPosition a2u13 0,0 < 550
    if I_CompareCounter a2u13_distance != 14
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 14
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 550
    and I_UnitDistanceFromPosition a2u13 0,0 < 600
    if I_CompareCounter a2u13_distance != 15
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 15
    inc_counter a2u13_stuck 1
    end_if

    if I_CompareCounter a2u13_stuck = 4
    unit_order_halt a2u13
    unit_set_morale a2u13 wavering
    battle_wait 0.1
    unit_unset_morale a2u13
    release_unit a2u13
    set_counter a2u13_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 13
and ! I_UnitDestroyed a2u14

    if I_UnitStatus a2u14 moving
    if I_CompareCounter a2u14_status = 0
    set_counter a2u14_status 1
    end_if
    if I_CompareCounter a2u14_status != 1
    set_counter a2u14_status 0
    end_if
    end_if

    if I_UnitStatus a2u14 routing
    if I_CompareCounter a2u14_status = 0
    set_counter a2u14_status 2
    end_if
    if I_CompareCounter a2u14_status != 2
    set_counter a2u14_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u14 moving
    and ! I_UnitStatus a2u14 routing
    set_counter a2u14_status 0
    end_if

    if I_CompareCounter a2u14_status > 0

    if I_UnitDistanceFromPosition a2u14 0,0 >= 150
    and I_UnitDistanceFromPosition a2u14 0,0 < 175
    if I_CompareCounter a2u14_distance != 1
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 1
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 175
    and I_UnitDistanceFromPosition a2u14 0,0 < 200
    if I_CompareCounter a2u14_distance != 2
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 2
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 200
    and I_UnitDistanceFromPosition a2u14 0,0 < 225
    if I_CompareCounter a2u14_distance != 3
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 3
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 225
    and I_UnitDistanceFromPosition a2u14 0,0 < 250
    if I_CompareCounter a2u14_distance != 4
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 4
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 250
    and I_UnitDistanceFromPosition a2u14 0,0 < 275
    if I_CompareCounter a2u14_distance != 5
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 5
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 275
    and I_UnitDistanceFromPosition a2u14 0,0 < 300
    if I_CompareCounter a2u14_distance != 6
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 6
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 300
    and I_UnitDistanceFromPosition a2u14 0,0 < 325
    if I_CompareCounter a2u14_distance != 7
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 7
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 325
    and I_UnitDistanceFromPosition a2u14 0,0 < 350
    if I_CompareCounter a2u14_distance != 8
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 8
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 350
    and I_UnitDistanceFromPosition a2u14 0,0 < 375
    if I_CompareCounter a2u14_distance != 9
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 9
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 375
    and I_UnitDistanceFromPosition a2u14 0,0 < 400
    if I_CompareCounter a2u14_distance != 10
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 10
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 400
    and I_UnitDistanceFromPosition a2u14 0,0 < 425
    if I_CompareCounter a2u14_distance != 11
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 11
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 425
    and I_UnitDistanceFromPosition a2u14 0,0 < 450
    if I_CompareCounter a2u14_distance != 12
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 12
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 450
    and I_UnitDistanceFromPosition a2u14 0,0 < 500
    if I_CompareCounter a2u14_distance != 13
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 13
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 500
    and I_UnitDistanceFromPosition a2u14 0,0 < 550
    if I_CompareCounter a2u14_distance != 14
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 14
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 550
    and I_UnitDistanceFromPosition a2u14 0,0 < 600
    if I_CompareCounter a2u14_distance != 15
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 15
    inc_counter a2u14_stuck 1
    end_if

    if I_CompareCounter a2u14_stuck = 4
    unit_order_halt a2u14
    unit_set_morale a2u14 wavering
    battle_wait 0.1
    unit_unset_morale a2u14
    release_unit a2u14
    set_counter a2u14_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 14
and ! I_UnitDestroyed a2u15

    if I_UnitStatus a2u15 moving
    if I_CompareCounter a2u15_status = 0
    set_counter a2u15_status 1
    end_if
    if I_CompareCounter a2u15_status != 1
    set_counter a2u15_status 0
    end_if
    end_if

    if I_UnitStatus a2u15 routing
    if I_CompareCounter a2u15_status = 0
    set_counter a2u15_status 2
    end_if
    if I_CompareCounter a2u15_status != 2
    set_counter a2u15_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u15 moving
    and ! I_UnitStatus a2u15 routing
    set_counter a2u15_status 0
    end_if

    if I_CompareCounter a2u15_status > 0

    if I_UnitDistanceFromPosition a2u15 0,0 >= 150
    and I_UnitDistanceFromPosition a2u15 0,0 < 175
    if I_CompareCounter a2u15_distance != 1
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 1
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 175
    and I_UnitDistanceFromPosition a2u15 0,0 < 200
    if I_CompareCounter a2u15_distance != 2
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 2
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 200
    and I_UnitDistanceFromPosition a2u15 0,0 < 225
    if I_CompareCounter a2u15_distance != 3
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 3
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 225
    and I_UnitDistanceFromPosition a2u15 0,0 < 250
    if I_CompareCounter a2u15_distance != 4
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 4
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 250
    and I_UnitDistanceFromPosition a2u15 0,0 < 275
    if I_CompareCounter a2u15_distance != 5
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 5
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 275
    and I_UnitDistanceFromPosition a2u15 0,0 < 300
    if I_CompareCounter a2u15_distance != 6
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 6
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 300
    and I_UnitDistanceFromPosition a2u15 0,0 < 325
    if I_CompareCounter a2u15_distance != 7
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 7
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 325
    and I_UnitDistanceFromPosition a2u15 0,0 < 350
    if I_CompareCounter a2u15_distance != 8
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 8
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 350
    and I_UnitDistanceFromPosition a2u15 0,0 < 375
    if I_CompareCounter a2u15_distance != 9
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 9
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 375
    and I_UnitDistanceFromPosition a2u15 0,0 < 400
    if I_CompareCounter a2u15_distance != 10
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 10
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 400
    and I_UnitDistanceFromPosition a2u15 0,0 < 425
    if I_CompareCounter a2u15_distance != 11
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 11
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 425
    and I_UnitDistanceFromPosition a2u15 0,0 < 450
    if I_CompareCounter a2u15_distance != 12
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 12
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 450
    and I_UnitDistanceFromPosition a2u15 0,0 < 500
    if I_CompareCounter a2u15_distance != 13
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 13
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 500
    and I_UnitDistanceFromPosition a2u15 0,0 < 550
    if I_CompareCounter a2u15_distance != 14
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 14
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 550
    and I_UnitDistanceFromPosition a2u15 0,0 < 600
    if I_CompareCounter a2u15_distance != 15
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 15
    inc_counter a2u15_stuck 1
    end_if

    if I_CompareCounter a2u15_stuck = 4
    unit_order_halt a2u15
    unit_set_morale a2u15 wavering
    battle_wait 0.1
    unit_unset_morale a2u15
    release_unit a2u15
    set_counter a2u15_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 15
and ! I_UnitDestroyed a2u16

    if I_UnitStatus a2u16 moving
    if I_CompareCounter a2u16_status = 0
    set_counter a2u16_status 1
    end_if
    if I_CompareCounter a2u16_status != 1
    set_counter a2u16_status 0
    end_if
    end_if

    if I_UnitStatus a2u16 routing
    if I_CompareCounter a2u16_status = 0
    set_counter a2u16_status 2
    end_if
    if I_CompareCounter a2u16_status != 2
    set_counter a2u16_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u16 moving
    and ! I_UnitStatus a2u16 routing
    set_counter a2u16_status 0
    end_if

    if I_CompareCounter a2u16_status > 0

    if I_UnitDistanceFromPosition a2u16 0,0 >= 150
    and I_UnitDistanceFromPosition a2u16 0,0 < 175
    if I_CompareCounter a2u16_distance != 1
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 1
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 175
    and I_UnitDistanceFromPosition a2u16 0,0 < 200
    if I_CompareCounter a2u16_distance != 2
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 2
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 200
    and I_UnitDistanceFromPosition a2u16 0,0 < 225
    if I_CompareCounter a2u16_distance != 3
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 3
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 225
    and I_UnitDistanceFromPosition a2u16 0,0 < 250
    if I_CompareCounter a2u16_distance != 4
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 4
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 250
    and I_UnitDistanceFromPosition a2u16 0,0 < 275
    if I_CompareCounter a2u16_distance != 5
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 5
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 275
    and I_UnitDistanceFromPosition a2u16 0,0 < 300
    if I_CompareCounter a2u16_distance != 6
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 6
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 300
    and I_UnitDistanceFromPosition a2u16 0,0 < 325
    if I_CompareCounter a2u16_distance != 7
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 7
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 325
    and I_UnitDistanceFromPosition a2u16 0,0 < 350
    if I_CompareCounter a2u16_distance != 8
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 8
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 350
    and I_UnitDistanceFromPosition a2u16 0,0 < 375
    if I_CompareCounter a2u16_distance != 9
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 9
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 375
    and I_UnitDistanceFromPosition a2u16 0,0 < 400
    if I_CompareCounter a2u16_distance != 10
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 10
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 400
    and I_UnitDistanceFromPosition a2u16 0,0 < 425
    if I_CompareCounter a2u16_distance != 11
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 11
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 425
    and I_UnitDistanceFromPosition a2u16 0,0 < 450
    if I_CompareCounter a2u16_distance != 12
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 12
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 450
    and I_UnitDistanceFromPosition a2u16 0,0 < 500
    if I_CompareCounter a2u16_distance != 13
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 13
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 500
    and I_UnitDistanceFromPosition a2u16 0,0 < 550
    if I_CompareCounter a2u16_distance != 14
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 14
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 550
    and I_UnitDistanceFromPosition a2u16 0,0 < 600
    if I_CompareCounter a2u16_distance != 15
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 15
    inc_counter a2u16_stuck 1
    end_if

    if I_CompareCounter a2u16_stuck = 4
    unit_order_halt a2u16
    unit_set_morale a2u16 wavering
    battle_wait 0.1
    unit_unset_morale a2u16
    release_unit a2u16
    set_counter a2u16_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 16
and ! I_UnitDestroyed a2u17

    if I_UnitStatus a2u17 moving
    if I_CompareCounter a2u17_status = 0
    set_counter a2u17_status 1
    end_if
    if I_CompareCounter a2u17_status != 1
    set_counter a2u17_status 0
    end_if
    end_if

    if I_UnitStatus a2u17 routing
    if I_CompareCounter a2u17_status = 0
    set_counter a2u17_status 2
    end_if
    if I_CompareCounter a2u17_status != 2
    set_counter a2u17_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u17 moving
    and ! I_UnitStatus a2u17 routing
    set_counter a2u17_status 0
    end_if

    if I_CompareCounter a2u17_status > 0

    if I_UnitDistanceFromPosition a2u17 0,0 >= 150
    and I_UnitDistanceFromPosition a2u17 0,0 < 175
    if I_CompareCounter a2u17_distance != 1
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 1
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 175
    and I_UnitDistanceFromPosition a2u17 0,0 < 200
    if I_CompareCounter a2u17_distance != 2
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 2
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 200
    and I_UnitDistanceFromPosition a2u17 0,0 < 225
    if I_CompareCounter a2u17_distance != 3
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 3
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 225
    and I_UnitDistanceFromPosition a2u17 0,0 < 250
    if I_CompareCounter a2u17_distance != 4
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 4
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 250
    and I_UnitDistanceFromPosition a2u17 0,0 < 275
    if I_CompareCounter a2u17_distance != 5
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 5
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 275
    and I_UnitDistanceFromPosition a2u17 0,0 < 300
    if I_CompareCounter a2u17_distance != 6
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 6
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 300
    and I_UnitDistanceFromPosition a2u17 0,0 < 325
    if I_CompareCounter a2u17_distance != 7
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 7
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 325
    and I_UnitDistanceFromPosition a2u17 0,0 < 350
    if I_CompareCounter a2u17_distance != 8
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 8
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 350
    and I_UnitDistanceFromPosition a2u17 0,0 < 375
    if I_CompareCounter a2u17_distance != 9
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 9
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 375
    and I_UnitDistanceFromPosition a2u17 0,0 < 400
    if I_CompareCounter a2u17_distance != 10
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 10
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 400
    and I_UnitDistanceFromPosition a2u17 0,0 < 425
    if I_CompareCounter a2u17_distance != 11
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 11
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 425
    and I_UnitDistanceFromPosition a2u17 0,0 < 450
    if I_CompareCounter a2u17_distance != 12
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 12
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 450
    and I_UnitDistanceFromPosition a2u17 0,0 < 500
    if I_CompareCounter a2u17_distance != 13
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 13
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 500
    and I_UnitDistanceFromPosition a2u17 0,0 < 550
    if I_CompareCounter a2u17_distance != 14
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 14
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 550
    and I_UnitDistanceFromPosition a2u17 0,0 < 600
    if I_CompareCounter a2u17_distance != 15
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 15
    inc_counter a2u17_stuck 1
    end_if

    if I_CompareCounter a2u17_stuck = 4
    unit_order_halt a2u17
    unit_set_morale a2u17 wavering
    battle_wait 0.1
    unit_unset_morale a2u17
    release_unit a2u17
    set_counter a2u17_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 17
and ! I_UnitDestroyed a2u18

    if I_UnitStatus a2u18 moving
    if I_CompareCounter a2u18_status = 0
    set_counter a2u18_status 1
    end_if
    if I_CompareCounter a2u18_status != 1
    set_counter a2u18_status 0
    end_if
    end_if

    if I_UnitStatus a2u18 routing
    if I_CompareCounter a2u18_status = 0
    set_counter a2u18_status 2
    end_if
    if I_CompareCounter a2u18_status != 2
    set_counter a2u18_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u18 moving
    and ! I_UnitStatus a2u18 routing
    set_counter a2u18_status 0
    end_if

    if I_CompareCounter a2u18_status > 0

    if I_UnitDistanceFromPosition a2u18 0,0 >= 150
    and I_UnitDistanceFromPosition a2u18 0,0 < 175
    if I_CompareCounter a2u18_distance != 1
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 1
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 175
    and I_UnitDistanceFromPosition a2u18 0,0 < 200
    if I_CompareCounter a2u18_distance != 2
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 2
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 200
    and I_UnitDistanceFromPosition a2u18 0,0 < 225
    if I_CompareCounter a2u18_distance != 3
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 3
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 225
    and I_UnitDistanceFromPosition a2u18 0,0 < 250
    if I_CompareCounter a2u18_distance != 4
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 4
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 250
    and I_UnitDistanceFromPosition a2u18 0,0 < 275
    if I_CompareCounter a2u18_distance != 5
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 5
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 275
    and I_UnitDistanceFromPosition a2u18 0,0 < 300
    if I_CompareCounter a2u18_distance != 6
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 6
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 300
    and I_UnitDistanceFromPosition a2u18 0,0 < 325
    if I_CompareCounter a2u18_distance != 7
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 7
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 325
    and I_UnitDistanceFromPosition a2u18 0,0 < 350
    if I_CompareCounter a2u18_distance != 8
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 8
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 350
    and I_UnitDistanceFromPosition a2u18 0,0 < 375
    if I_CompareCounter a2u18_distance != 9
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 9
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 375
    and I_UnitDistanceFromPosition a2u18 0,0 < 400
    if I_CompareCounter a2u18_distance != 10
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 10
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 400
    and I_UnitDistanceFromPosition a2u18 0,0 < 425
    if I_CompareCounter a2u18_distance != 11
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 11
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 425
    and I_UnitDistanceFromPosition a2u18 0,0 < 450
    if I_CompareCounter a2u18_distance != 12
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 12
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 450
    and I_UnitDistanceFromPosition a2u18 0,0 < 500
    if I_CompareCounter a2u18_distance != 13
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 13
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 500
    and I_UnitDistanceFromPosition a2u18 0,0 < 550
    if I_CompareCounter a2u18_distance != 14
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 14
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 550
    and I_UnitDistanceFromPosition a2u18 0,0 < 600
    if I_CompareCounter a2u18_distance != 15
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 15
    inc_counter a2u18_stuck 1
    end_if

    if I_CompareCounter a2u18_stuck = 4
    unit_order_halt a2u18
    unit_set_morale a2u18 wavering
    battle_wait 0.1
    unit_unset_morale a2u18
    release_unit a2u18
    set_counter a2u18_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 18
and ! I_UnitDestroyed a2u19

    if I_UnitStatus a2u19 moving
    if I_CompareCounter a2u19_status = 0
    set_counter a2u19_status 1
    end_if
    if I_CompareCounter a2u19_status != 1
    set_counter a2u19_status 0
    end_if
    end_if

    if I_UnitStatus a2u19 routing
    if I_CompareCounter a2u19_status = 0
    set_counter a2u19_status 2
    end_if
    if I_CompareCounter a2u19_status != 2
    set_counter a2u19_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u19 moving
    and ! I_UnitStatus a2u19 routing
    set_counter a2u19_status 0
    end_if

    if I_CompareCounter a2u19_status > 0

    if I_UnitDistanceFromPosition a2u19 0,0 >= 150
    and I_UnitDistanceFromPosition a2u19 0,0 < 175
    if I_CompareCounter a2u19_distance != 1
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 1
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 175
    and I_UnitDistanceFromPosition a2u19 0,0 < 200
    if I_CompareCounter a2u19_distance != 2
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 2
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 200
    and I_UnitDistanceFromPosition a2u19 0,0 < 225
    if I_CompareCounter a2u19_distance != 3
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 3
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 225
    and I_UnitDistanceFromPosition a2u19 0,0 < 250
    if I_CompareCounter a2u19_distance != 4
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 4
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 250
    and I_UnitDistanceFromPosition a2u19 0,0 < 275
    if I_CompareCounter a2u19_distance != 5
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 5
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 275
    and I_UnitDistanceFromPosition a2u19 0,0 < 300
    if I_CompareCounter a2u19_distance != 6
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 6
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 300
    and I_UnitDistanceFromPosition a2u19 0,0 < 325
    if I_CompareCounter a2u19_distance != 7
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 7
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 325
    and I_UnitDistanceFromPosition a2u19 0,0 < 350
    if I_CompareCounter a2u19_distance != 8
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 8
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 350
    and I_UnitDistanceFromPosition a2u19 0,0 < 375
    if I_CompareCounter a2u19_distance != 9
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 9
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 375
    and I_UnitDistanceFromPosition a2u19 0,0 < 400
    if I_CompareCounter a2u19_distance != 10
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 10
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 400
    and I_UnitDistanceFromPosition a2u19 0,0 < 425
    if I_CompareCounter a2u19_distance != 11
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 11
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 425
    and I_UnitDistanceFromPosition a2u19 0,0 < 450
    if I_CompareCounter a2u19_distance != 12
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 12
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 450
    and I_UnitDistanceFromPosition a2u19 0,0 < 500
    if I_CompareCounter a2u19_distance != 13
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 13
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 500
    and I_UnitDistanceFromPosition a2u19 0,0 < 550
    if I_CompareCounter a2u19_distance != 14
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 14
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 550
    and I_UnitDistanceFromPosition a2u19 0,0 < 600
    if I_CompareCounter a2u19_distance != 15
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 15
    inc_counter a2u19_stuck 1
    end_if

    if I_CompareCounter a2u19_stuck = 4
    unit_order_halt a2u19
    unit_set_morale a2u19 wavering
    battle_wait 0.1
    unit_unset_morale a2u19
    release_unit a2u19
    set_counter a2u19_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count = 20
and ! I_UnitDestroyed a2u20

    if I_UnitStatus a2u20 moving
    if I_CompareCounter a2u20_status = 0
    set_counter a2u20_status 1
    end_if
    if I_CompareCounter a2u20_status != 1
    set_counter a2u20_status 0
    end_if
    end_if

    if I_UnitStatus a2u20 routing
    if I_CompareCounter a2u20_status = 0
    set_counter a2u20_status 2
    end_if
    if I_CompareCounter a2u20_status != 2
    set_counter a2u20_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u20 moving
    and ! I_UnitStatus a2u20 routing
    set_counter a2u20_status 0
    end_if

    if I_CompareCounter a2u20_status > 0

    if I_UnitDistanceFromPosition a2u20 0,0 >= 150
    and I_UnitDistanceFromPosition a2u20 0,0 < 175
    if I_CompareCounter a2u20_distance != 1
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 1
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 175
    and I_UnitDistanceFromPosition a2u20 0,0 < 200
    if I_CompareCounter a2u20_distance != 2
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 2
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 200
    and I_UnitDistanceFromPosition a2u20 0,0 < 225
    if I_CompareCounter a2u20_distance != 3
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 3
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 225
    and I_UnitDistanceFromPosition a2u20 0,0 < 250
    if I_CompareCounter a2u20_distance != 4
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 4
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 250
    and I_UnitDistanceFromPosition a2u20 0,0 < 275
    if I_CompareCounter a2u20_distance != 5
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 5
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 275
    and I_UnitDistanceFromPosition a2u20 0,0 < 300
    if I_CompareCounter a2u20_distance != 6
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 6
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 300
    and I_UnitDistanceFromPosition a2u20 0,0 < 325
    if I_CompareCounter a2u20_distance != 7
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 7
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 325
    and I_UnitDistanceFromPosition a2u20 0,0 < 350
    if I_CompareCounter a2u20_distance != 8
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 8
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 350
    and I_UnitDistanceFromPosition a2u20 0,0 < 375
    if I_CompareCounter a2u20_distance != 9
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 9
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 375
    and I_UnitDistanceFromPosition a2u20 0,0 < 400
    if I_CompareCounter a2u20_distance != 10
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 10
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 400
    and I_UnitDistanceFromPosition a2u20 0,0 < 425
    if I_CompareCounter a2u20_distance != 11
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 11
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 425
    and I_UnitDistanceFromPosition a2u20 0,0 < 450
    if I_CompareCounter a2u20_distance != 12
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 12
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 450
    and I_UnitDistanceFromPosition a2u20 0,0 < 500
    if I_CompareCounter a2u20_distance != 13
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 13
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 500
    and I_UnitDistanceFromPosition a2u20 0,0 < 550
    if I_CompareCounter a2u20_distance != 14
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 14
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 550
    and I_UnitDistanceFromPosition a2u20 0,0 < 600
    if I_CompareCounter a2u20_distance != 15
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 15
    inc_counter a2u20_stuck 1
    end_if

    if I_CompareCounter a2u20_stuck = 4
    unit_order_halt a2u20
    unit_set_morale a2u20 wavering
    battle_wait 0.1
    unit_unset_morale a2u20
    release_unit a2u20
    set_counter a2u20_stuck 0
    end_if

    end_if
end_if

    battle_wait 10
end_monitor

;;;;;;;Anti-CTD
monitor_event BattleDeploymentPhaseCommenced not IsFactionAIControlled
    wait 0.5
    simulate_mouse_click lclick_down
    simulate_mouse_click lclick_up
end_monitor

;################## Cleaning up ##################

monitor_event ScrollOpened ScrollOpened post_battle_scroll

    ;;;;;;;
    set_counter fire_labels 0
;    set_counter panel_check 0
    set_counter player_unit_count 0
    set_counter enemy_unit_count 0
    set_counter open_battle 0
    set_counter labels_only 0
    set_counter stakes_lock 0
    ;;;;;;;
    set_counter pu1_missile 0
    set_counter pu2_missile 0
    set_counter pu3_missile 0
    set_counter pu4_missile 0
    set_counter pu5_missile 0
    set_counter pu6_missile 0
    set_counter pu7_missile 0
    set_counter pu8_missile 0
    set_counter pu9_missile 0
    set_counter pu10_missile 0
    set_counter pu11_missile 0
    set_counter pu12_missile 0
    set_counter pu13_missile 0
    set_counter pu14_missile 0
    set_counter pu15_missile 0
    set_counter pu16_missile 0
    set_counter pu17_missile 0
    set_counter pu18_missile 0
    set_counter pu19_missile 0
    set_counter pu20_missile 0
    ;;;;;;;Checks
    set_counter check_timer 0
    set_counter elephant_fix_check 0
    set_counter elephant_fix_check_sally 0
    set_counter reinf_check 0
    set_counter script_delay 0
    set_counter sally_defense_check 0
    set_counter sally_check 0
    ;;;;;;;Stakes
    set_counter label_ready 0
    set_counter stakes_on 0
    ;;;;;;;Reinforcements
    set_counter army4_ready 0
    set_counter reinf_late 0

    set_counter distance_trigger1 0
    set_counter distance_trigger2 0
    set_counter distance_trigger3 0
    set_counter distance_trigger4 0
    set_counter distance_trigger5 0

    set_counter kill_labelling_reinf_allied 0
    set_counter army3_reinf_allied 0
    set_counter army4_reinf_allied 0
    set_counter army5_reinf_allied 0
    set_counter army6_reinf_allied 0
    set_counter army7_reinf_allied 0
    set_counter army8_reinf_allied 0
    set_counter army9_reinf_allied 0
    set_counter army10_reinf_allied 0
    set_counter army11_reinf_allied 0
    set_counter army12_reinf_allied 0
    set_counter army13_reinf_allied 0
    set_counter army14_reinf_allied 0
    set_counter army15_reinf_allied 0
    set_counter army16_reinf_allied 0
    set_counter launch_alliance_0 0
    set_counter launch_alliance_1 0

    set_counter apply_strategy 0
    set_counter relaunch_movement 0

    set_counter att_alliance_ready 0
    set_counter def_alliance_ready 0
    set_counter def_alliance_ready_siege 0

    set_counter army3_moving 0
    set_counter army3_run 0
    set_counter army3_reinf_late 0
    set_counter army4_moving 0
    set_counter army4_run 0
    set_counter army4_reinf_late 0
    set_counter army5_moving 0
    set_counter army5_run 0
    set_counter army5_reinf_late 0
    set_counter army6_moving 0
    set_counter army6_run 0
    set_counter army6_reinf_late 0
    set_counter army7_moving 0
    set_counter army7_run 0
    set_counter army7_reinf_late 0
    set_counter army8_moving 0
    set_counter army8_run 0
    set_counter army8_reinf_late 0
    set_counter army9_moving 0
    set_counter army9_run 0
    set_counter army9_reinf_late 0
    set_counter army10_moving 0
    set_counter army10_run 0
    set_counter army10_reinf_late 0
    set_counter army11_moving 0
    set_counter army11_run 0
    set_counter army11_reinf_late 0
    set_counter army12_moving 0
    set_counter army12_run 0
    set_counter army12_reinf_late 0
    set_counter army13_moving 0
    set_counter army13_run 0
    set_counter army13_reinf_late 0
    set_counter army14_moving 0
    set_counter army14_run 0
    set_counter army14_reinf_late 0
    set_counter army15_moving 0
    set_counter army15_run 0
    set_counter army15_reinf_late 0
    set_counter army16_moving 0
    set_counter army16_run 0
    set_counter army16_reinf_late 0

    set_counter army4_ready_siege 0 ; acts as launching counter
    set_counter army4_moving_siege 0
    set_counter army4_run_siege 0
    set_counter reinf_check_interval 0

    ;;;;;;;HA Fix
    set_counter ha_fix 0
    ;;;;;;;Elephant Fix
    set_counter elephant_fix 0
    set_counter elephant_gate 0
    set_counter elephant_gate_s 0
    set_counter elephant_gate_tier2 0
    set_counter elephant_gate_tier3 0
    set_counter elephant_gate_tier2s 0
    set_counter elephant_gate_tier3s 0
    set_counter rally_walls 0
    set_counter rally_walls_s 0
    set_counter second_ring 0
    set_counter third_ring 0
    set_counter second_ring_s 0
    set_counter third_ring_s 0
    set_counter del_objective 0
    set_counter del_objective_s 0
    ;;;;;;;Sally-out
    set_counter sally-out_fix 0
    set_counter sally_defense 0
    set_counter reform_back 0
    set_counter reform_multi 0
    set_counter unit_under_fire 0
    set_counter kill_sally 0
    set_counter sally_reinf 0
    set_counter reset_position 0
    set_counter defend_location 0
    set_counter reset_army2 0
    set_counter assign_labels 0
    ;;;;;;;Siege
    set_counter siege_fix 0
    set_counter army_sieging 0
    set_counter army_south 0
    set_counter army_north 0
    set_counter army_east 0
    set_counter army_west 0
    set_counter emergency_stop 0
    set_counter omfg_cannon_tower 0
    set_counter army2_sally 0
    set_counter wall_advance_s 0
    ;;;;;;;Protect General
    set_counter protect_general 0
    set_counter general_wait 0
    set_counter protect_siege 0
    set_counter g_stop 0
    ;;;;;;;Sally-out, AI defending
    set_counter army4_ready_sally 0
    set_counter army4_location 0
    set_counter path_n 0
    set_counter path_ne 0
    set_counter path_e 0
    set_counter path_se 0
    set_counter path_s 0
    set_counter path_sw 0
    set_counter path_w 0
    set_counter path_nw 0
    set_counter obstacle_check 0
    set_counter label_army4 0
    set_counter army4_moving_s 0
    set_counter army4_idle_s 0
    set_counter line_passed 0
    set_counter army2_idle_s 0
    set_counter army4_idle_r 0
    set_counter wall_line_passed 0
    set_counter reset_position_s 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    ;;;;;;;Open Battles
    set_counter ob_defense_launch 0
    set_counter ob_defend 0
    set_counter ob_siege_attack 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 0
    set_counter ob_engaged 0
    set_counter player_units_closing 0
    set_counter player_enveloping 0
    set_counter player_engaged_reinf 0
    ;;;;;;;AI Stuck Fix
    set_counter ai_stuck_launch 0
    set_counter a2u1_stuck 0
    set_counter a2u2_stuck 0
    set_counter a2u3_stuck 0
    set_counter a2u4_stuck 0
    set_counter a2u5_stuck 0
    set_counter a2u6_stuck 0
    set_counter a2u7_stuck 0
    set_counter a2u8_stuck 0
    set_counter a2u9_stuck 0
    set_counter a2u10_stuck 0
    set_counter a2u11_stuck 0
    set_counter a2u12_stuck 0
    set_counter a2u13_stuck 0
    set_counter a2u14_stuck 0
    set_counter a2u15_stuck 0
    set_counter a2u16_stuck 0
    set_counter a2u17_stuck 0
    set_counter a2u18_stuck 0
    set_counter a2u19_stuck 0
    set_counter a2u20_stuck 0
    set_counter a2u1_status 0
    set_counter a2u2_status 0
    set_counter a2u3_status 0
    set_counter a2u4_status 0
    set_counter a2u5_status 0
    set_counter a2u6_status 0
    set_counter a2u7_status 0
    set_counter a2u8_status 0
    set_counter a2u9_status 0
    set_counter a2u10_status 0
    set_counter a2u11_status 0
    set_counter a2u12_status 0
    set_counter a2u13_status 0
    set_counter a2u14_status 0
    set_counter a2u15_status 0
    set_counter a2u16_status 0
    set_counter a2u17_status 0
    set_counter a2u18_status 0
    set_counter a2u19_status 0
    set_counter a2u20_status 0
    set_counter a2u1_distance 0
    set_counter a2u2_distance 0
    set_counter a2u3_distance 0
    set_counter a2u4_distance 0
    set_counter a2u5_distance 0
    set_counter a2u6_distance 0
    set_counter a2u7_distance 0
    set_counter a2u8_distance 0
    set_counter a2u9_distance 0
    set_counter a2u10_distance 0
    set_counter a2u11_distance 0
    set_counter a2u12_distance 0
    set_counter a2u13_distance 0
    set_counter a2u14_distance 0
    set_counter a2u15_distance 0
    set_counter a2u16_distance 0
    set_counter a2u17_distance 0
    set_counter a2u18_distance 0
    set_counter a2u19_distance 0
    set_counter a2u20_distance 0
;    suspend_unscripted_advice false
end_monitor

;=======================================================;
;================= ADDITIONAL SCRIPTS ==================;
;=======================================================;

;----------------- Civil War Resistance ----------------;       


;-------------------------- AI + PLAYER -------------------------;
set_event_counter resistance 0


monitor_event PreFactionTurnStart FactionType slave

    inc_event_counter resistance 1
                        
    if I_EventCounter resistance  > 25
			set_event_counter resistance 0
		end_if

    set_event_counter new_house_spain 0
    set_event_counter new_house_france 0
    set_event_counter new_house_portugal 0
    set_event_counter new_house_aragon 0
    set_event_counter new_house_hre 0
    set_event_counter new_house_england 0
    set_event_counter new_house_scotland 0
    set_event_counter new_house_denmark 0
    set_event_counter new_house_norway 0  
    set_event_counter new_house_poland 0
    set_event_counter new_house_hungary 0
    set_event_counter new_house_venice 0
    set_event_counter new_house_sicily 0
    set_event_counter new_house_pisa 0
    set_event_counter new_house_milan 0
    set_event_counter new_house_byzantium 0
    set_event_counter new_house_kievan_rus 0
    set_event_counter new_house_russia 0
    set_event_counter new_house_teutonic_order 0
    set_event_counter new_house_timurids 0
    set_event_counter new_house_lithuania 0
    set_event_counter new_house_cumans 0
    set_event_counter new_house_moors 0
    set_event_counter new_house_rum 0
    set_event_counter new_house_turks 0
    set_event_counter new_house_egypt 0
    set_event_counter new_house_kwarezm 0
    set_event_counter new_house_jerusalem 0
    set_event_counter new_house_egypt 0
    
    if I_EventCounter resistance  <= 25
    
			  if I_FactionLeaderTrait spain Usurper >= 3
        and I_EventCounter civil_war_spain_going_on = 0  
                
			     set_event_counter civil_war_spain_going_on 1
           historic_event civil_war_spain
           increment_kings_purse spain -1000
           
           
           if I_NumberOfSettlements spain > 2
             faction_emerge slave spain 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements spain > 5
               faction_emerge slave spain 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements spain > 8
                faction_emerge slave spain 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements spain > 11
                  faction_emerge slave spain 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements spain > 14
                faction_emerge slave spain 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if 
           
		    end_if
        
        if I_FactionLeaderTrait france Usurper >= 3
        and I_EventCounter civil_war_france_going_on = 0   
                
            set_event_counter civil_war_france_going_on 1  
            historic_event civil_war_france
            increment_kings_purse france -1000    
            
            
            if I_NumberOfSettlements france > 2
             faction_emerge slave france 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements france > 5
               faction_emerge slave france 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements france > 8
                faction_emerge slave france 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements france > 11
                  faction_emerge slave france 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements france > 14
                faction_emerge slave france 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if 
                   
        end_if
        
        if I_FactionLeaderTrait portugal Usurper >= 3
        and I_EventCounter civil_war_portugal_going_on = 0    
                
            set_event_counter civil_war_portugal_going_on 1   
            historic_event civil_war_portugal
            increment_kings_purse portugal -1000     
            
            
            if I_NumberOfSettlements portugal > 2
             faction_emerge slave portugal 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements portugal > 5
               faction_emerge slave portugal 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements portugal > 8
                faction_emerge slave portugal 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements portugal > 11
                  faction_emerge slave portugal 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements portugal > 14
                faction_emerge slave portugal 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if      
               
        end_if
        
        if I_FactionLeaderTrait aragon Usurper >= 3
        and I_EventCounter civil_war_aragon_going_on = 0
        
            set_event_counter civil_war_aragon_going_on 1   
            historic_event civil_war_aragon
            increment_kings_purse aragon -1000         
            
            
            if I_NumberOfSettlements aragon > 2
             faction_emerge slave aragon 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements aragon > 5
               faction_emerge slave aragon 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements aragon > 8
                faction_emerge slave aragon 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements aragon > 11
                  faction_emerge slave aragon 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements aragon > 14
                faction_emerge slave aragon 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if  
               
        end_if
        
        if I_FactionLeaderTrait hre Usurper >= 3
        and I_EventCounter civil_war_hre_going_on = 0
        
            set_event_counter civil_war_hre_going_on 1   
            historic_event civil_war_hre
            increment_kings_purse hre -1000    
            
            
            if I_NumberOfSettlements hre > 2
             faction_emerge slave hre 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements hre > 5
               faction_emerge slave hre 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements hre > 8
                faction_emerge slave hre 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements hre > 11
                  faction_emerge slave hre 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements hre > 14
                faction_emerge slave hre 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if     
                 
        end_if
        
        if I_FactionLeaderTrait england Usurper >= 3
        and I_EventCounter civil_war_england_going_on = 0
        
            set_event_counter civil_war_england_going_on 1    
            historic_event civil_war_england
            increment_kings_purse england -1000        
            
            
            if I_NumberOfSettlements england > 2
             faction_emerge slave england 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements england > 5
               faction_emerge slave england 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements england > 8
                faction_emerge slave england 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements england > 11
                  faction_emerge slave england 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements england > 14
                faction_emerge slave england 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if
                  
        end_if
        
        if I_FactionLeaderTrait scotland Usurper >= 3
        and I_EventCounter civil_war_scotland_going_on = 0
        
            set_event_counter civil_war_scotland_going_on 1    
            historic_event civil_war_scotland
            increment_kings_purse scotland -1000   
            
            
            if I_NumberOfSettlements scotland > 2
             faction_emerge slave scotland 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements scotland > 5
               faction_emerge slave scotland 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements scotland > 8
                faction_emerge slave scotland 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements scotland > 11
                  faction_emerge slave scotland 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements scotland > 14
                faction_emerge slave scotland 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if    
                   
        end_if
        
        if I_FactionLeaderTrait denmark Usurper >= 3
        and I_EventCounter civil_war_denmark_going_on = 0
        
            set_event_counter civil_war_denmark_going_on 1   
            historic_event civil_war_denmark
            increment_kings_purse denmark -1000     
            
            
            if I_NumberOfSettlements denmark > 2
             faction_emerge slave denmark 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements denmark > 5
               faction_emerge slave denmark 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements denmark > 8
                faction_emerge slave denmark 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements denmark > 11
                  faction_emerge slave denmark 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements denmark > 14
                faction_emerge slave denmark 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if     
                
        end_if
        
        if I_FactionLeaderTrait norway Usurper >= 3
        and I_EventCounter civil_war_norway_going_on = 0
        
            set_event_counter civil_war_norway_going_on 1      
            historic_event civil_war_norway
            increment_kings_purse norway -1000     
            
            
            if I_NumberOfSettlements norway > 2
             faction_emerge slave norway 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements norway > 5
               faction_emerge slave norway 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements norway > 8
                faction_emerge slave norway 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements norway > 11
                  faction_emerge slave norway 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements norway > 14
                faction_emerge slave norway 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                  
        end_if
        
        if I_FactionLeaderTrait poland Usurper >= 3
        and I_EventCounter civil_war_poland_going_on = 0
        
            set_event_counter civil_war_poland_going_on 1     
            historic_event civil_war_poland
            increment_kings_purse poland -1000      
            
            
            if I_NumberOfSettlements poland > 2
             faction_emerge slave poland 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements poland > 5
               faction_emerge slave poland 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements poland > 8
                faction_emerge slave poland 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements poland > 11
                  faction_emerge slave poland 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements poland > 14
                faction_emerge slave poland 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if         
           
        end_if
        
        if I_FactionLeaderTrait hungary Usurper >= 3
        and I_EventCounter civil_war_hungary_going_on = 0
        
            set_event_counter civil_war_hungary_going_on 1    
            historic_event civil_war_hungary
            increment_kings_purse hungary -1000            
            
            
            if I_NumberOfSettlements hungary > 2
             faction_emerge slave hungary 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements hungary > 5
               faction_emerge slave hungary 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements hungary > 8
                faction_emerge slave hungary 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements hungary > 11
                  faction_emerge slave hungary 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements hungary > 14
                faction_emerge slave hungary 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
           
        end_if
        
        if I_FactionLeaderTrait venice Usurper >= 3
        and I_EventCounter civil_war_venice_going_on = 0
        
            set_event_counter civil_war_venice_going_on 1     
            historic_event civil_war_venice
            increment_kings_purse venice -1000          
            
            
            if I_NumberOfSettlements venice > 2
             faction_emerge slave venice 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements venice > 5
               faction_emerge slave venice 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements venice > 8
                faction_emerge slave venice 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements venice > 11
                  faction_emerge slave venice 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements venice > 14
                faction_emerge slave venice 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if      
           end_if   
             
        end_if
        
        if I_FactionLeaderTrait sicily Usurper >= 3
        and I_EventCounter civil_war_sicily_going_on = 0
        
            set_event_counter civil_war_sicily_going_on 1  
            historic_event civil_war_sicily
            increment_kings_purse sicily -1000          
            
            
            if I_NumberOfSettlements sicily > 2
             faction_emerge slave sicily 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements sicily > 5
               faction_emerge slave sicily 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements sicily > 8
                faction_emerge slave sicily 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements sicily > 11
                  faction_emerge slave sicily 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements sicily > 14
                faction_emerge slave sicily 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
             
        end_if
        
        if I_FactionLeaderTrait pisa Usurper >= 3
        and I_EventCounter civil_war_pisa_going_on = 0
        
            set_event_counter civil_war_pisa_going_on 1      
            historic_event civil_war_pisa
            increment_kings_purse pisa -1000    
            
            
            if I_NumberOfSettlements pisa > 2
             faction_emerge slave pisa 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements pisa > 5
               faction_emerge slave pisa 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements pisa > 8
                faction_emerge slave pisa 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements pisa > 11
                  faction_emerge slave pisa 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements pisa > 14
                faction_emerge slave pisa 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                   
        end_if
        
        if I_FactionLeaderTrait milan Usurper >= 3
        and I_EventCounter civil_war_milan_going_on = 0
        
            set_event_counter civil_war_milan_going_on 1     
            historic_event civil_war_milan
            increment_kings_purse milan -1000      
            
            
            if I_NumberOfSettlements milan > 2
             faction_emerge slave milan 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements milan > 5
               faction_emerge slave milan 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements milan > 8
                faction_emerge slave milan 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements milan > 11
                  faction_emerge slave milan 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements milan > 14
                faction_emerge slave milan 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                 
         end_if
        
        if I_FactionLeaderTrait byzantium Usurper >= 3
        and I_EventCounter civil_war_byzantium_going_on = 0
        
            set_event_counter civil_war_byzantium_going_on 1      
            historic_event civil_war_byzantium
            increment_kings_purse byzantium -1000     
            
            
            if I_NumberOfSettlements byzantium > 2
             faction_emerge slave byzantium 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements byzantium > 5
               faction_emerge slave byzantium 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements byzantium > 8
                faction_emerge slave byzantium 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements byzantium > 11
                  faction_emerge slave byzantium 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements byzantium > 14
                faction_emerge slave byzantium 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                  
        end_if
        
        if I_FactionLeaderTrait kievan_rus Usurper >= 3
        and I_EventCounter civil_war_kievan_rus_going_on = 0
        
            set_event_counter civil_war_kievan_rus_going_on 1        
            historic_event civil_war_kievan_rus
            increment_kings_purse kievan_rus -1000    
            
            
            if I_NumberOfSettlements kievan_rus > 2
             faction_emerge slave kievan_rus 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements kievan_rus > 5
               faction_emerge slave kievan_rus 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements kievan_rus > 8
                faction_emerge slave kievan_rus 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements kievan_rus > 11
                  faction_emerge slave kievan_rus 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements kievan_rus > 14
                faction_emerge slave kievan_rus 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                   
        end_if
        
        if I_FactionLeaderTrait russia Usurper >= 3
        and I_EventCounter civil_war_russia_going_on = 0
        
            set_event_counter civil_war_russia_going_on 1         
            historic_event civil_war_russia
            increment_kings_purse russia -1000     
            
            
            if I_NumberOfSettlements russia > 2
             faction_emerge slave russia 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements russia > 5
               faction_emerge slave russia 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements russia > 8
                faction_emerge slave russia 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements russia > 11
                  faction_emerge slave russia 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements russia > 14
                faction_emerge slave russia 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                  
        end_if
        
        if I_FactionLeaderTrait teutonic_order Usurper >= 3
        and I_EventCounter civil_war_teutonic_order_going_on = 0
        
            set_event_counter civil_war_teutonic_order_going_on 1   
            historic_event civil_war_teutonic_order
            increment_kings_purse teutonic_order -1000       
            
            
            if I_NumberOfSettlements teutonic_order > 2
             faction_emerge slave teutonic_order 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements teutonic_order > 5
               faction_emerge slave teutonic_order 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements teutonic_order > 8
                faction_emerge slave teutonic_order 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements teutonic_order > 11
                  faction_emerge slave teutonic_order 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements teutonic_order > 14
                faction_emerge slave teutonic_order 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                
        end_if
        
        if I_FactionLeaderTrait timurids Usurper >= 3
        and I_EventCounter civil_war_timurids_going_on = 0
        
            set_event_counter civil_war_timurids_going_on 1    
            historic_event civil_war_timurids
            increment_kings_purse timurids -1000          
            
            
            if I_NumberOfSettlements timurids > 2
             faction_emerge slave timurids 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements timurids > 5
               faction_emerge slave timurids 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements timurids > 8
                faction_emerge slave timurids 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements timurids > 11
                  faction_emerge slave timurids 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements timurids > 14
                faction_emerge slave timurids 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
             
        end_if
        
        if I_FactionLeaderTrait lithuania Usurper >= 3
        and I_EventCounter civil_war_lithuania_going_on = 0
        
            set_event_counter civil_war_lithuania_going_on 1  
            historic_event civil_war_lithuania
            increment_kings_purse lithuania -1000  
            
            
            if I_NumberOfSettlements lithuania > 2
             faction_emerge slave lithuania 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements lithuania > 5
               faction_emerge slave lithuania 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements lithuania > 8
                faction_emerge slave lithuania 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements lithuania > 11
                  faction_emerge slave lithuania 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements lithuania > 14
                faction_emerge slave lithuania 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                     
        end_if
        
        if I_FactionLeaderTrait cumans Usurper >= 3
        and I_EventCounter civil_war_cumans_going_on = 0
        
            set_event_counter civil_war_cumans_going_on 1       
            historic_event civil_war_cumans
            increment_kings_purse cumans -1000  
            
            
            if I_NumberOfSettlements cumans > 2
             faction_emerge slave cumans 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements cumans > 5
               faction_emerge slave cumans 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements cumans > 8
                faction_emerge slave cumans 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements cumans > 11
                  faction_emerge slave cumans 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements cumans > 14
                faction_emerge slave cumans 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                     
        end_if
        
        if I_FactionLeaderTrait moors Usurper >= 3
        and I_EventCounter civil_war_moors_going_on = 0
        
            set_event_counter civil_war_moors_going_on 1          
            historic_event civil_war_moors
            increment_kings_purse moors -1000         
            
            
            if I_NumberOfSettlements moors > 2
             faction_emerge slave moors 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements moors > 5
               faction_emerge slave moors 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements moors > 8
                faction_emerge slave moors 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements moors > 11
                  faction_emerge slave moors 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements moors > 14
                faction_emerge slave moors 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
              
        end_if
        
        if I_FactionLeaderTrait rum Usurper >= 3
        and I_EventCounter civil_war_rum_going_on = 0
        
            set_event_counter civil_war_rum_going_on 1             
            historic_event civil_war_rum
            increment_kings_purse rum -1000   
            
            
            if I_NumberOfSettlements rum > 2
             faction_emerge slave rum 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements rum > 5
               faction_emerge slave rum 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements rum > 8
                faction_emerge slave rum 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements rum > 11
                  faction_emerge slave rum 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements rum > 14
                faction_emerge slave rum 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
                    
        end_if
        
        if I_FactionLeaderTrait turks Usurper >= 3
        and I_EventCounter civil_war_turks_going_on = 0
        
            set_event_counter civil_war_turks_going_on 1            
            historic_event civil_war_turks
            increment_kings_purse turks -1000         
            
            
            if I_NumberOfSettlements turks > 2
             faction_emerge slave turks 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements turks > 5
               faction_emerge slave turks 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements turks > 8
                faction_emerge slave turks 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements turks > 11
                  faction_emerge slave turks 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements turks > 14
                faction_emerge slave turks 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
              
        end_if
        
        if I_FactionLeaderTrait egypt Usurper >= 3
        and I_EventCounter civil_war_egypt_going_on = 0
        
            set_event_counter civil_war_egypt_going_on 1
            historic_event civil_war_egypt
            increment_kings_purse egypt -1000  
            
            
            if I_NumberOfSettlements egypt > 2
             faction_emerge slave egypt 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements egypt > 5
               faction_emerge slave egypt 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements egypt > 8
                faction_emerge slave egypt 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements egypt > 11
                  faction_emerge slave egypt 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements egypt > 14
                faction_emerge slave egypt 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
           
        end_if
        
        if I_FactionLeaderTrait kwarezm Usurper >= 3
        and I_EventCounter civil_war_kwarezm_going_on = 0
        
            set_event_counter civil_war_kwarezm_going_on 1
            historic_event civil_war_kwarezm
            increment_kings_purse kwarezm -1000  
            
            
            if I_NumberOfSettlements kwarezm > 2
             faction_emerge slave kwarezm 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements kwarezm > 5
               faction_emerge slave kwarezm 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements kwarezm > 8
                faction_emerge slave kwarezm 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements kwarezm > 11
                  faction_emerge slave kwarezm 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements kwarezm > 14
                faction_emerge slave kwarezm 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
           
        end_if
        
        if I_FactionLeaderTrait jerusalem Usurper >= 3
        and I_EventCounter civil_war_jerusalem_going_on = 0
        
            set_event_counter civil_war_jerusalem_going_on 1
            historic_event civil_war_jerusalem
            increment_kings_purse jerusalem -1000  
            
            
            if I_NumberOfSettlements jerusalem > 2
             faction_emerge slave jerusalem 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements jerusalem > 5
               faction_emerge slave jerusalem 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements jerusalem > 8
                faction_emerge slave jerusalem 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements jerusalem > 11
                  faction_emerge slave jerusalem 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements jerusalem > 14
                faction_emerge slave jerusalem 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
           
        end_if 
		end_if
    
    if I_FactionLeaderTrait mongols Usurper >= 3
        and I_EventCounter civil_war_mongols_going_on = 0
        
            set_event_counter civil_war_mongols_going_on 1
            historic_event civil_war_mongols
            increment_kings_purse mongols -1000  
            
            
            if I_NumberOfSettlements mongols > 2
             faction_emerge slave mongols 1 100.0 0.0 1.2 town true
             
             if I_NumberOfSettlements mongols > 5
               faction_emerge slave mongols 1 100.0 0.0 1.2 town true
               
               if I_NumberOfSettlements mongols > 8
                faction_emerge slave mongols 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                
                if I_NumberOfSettlements mongols > 11
                  faction_emerge slave mongols 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
                  
                  if I_NumberOfSettlements mongols > 14
                faction_emerge slave mongols 1 100.0 0.0 1.2 town true unused_label1 unused_name 30
               end_if 
                 end_if 
               end_if 
             end_if   
           end_if   
           
        end_if
    
    
    if I_EventCounter resistance  = 1
			  if I_EventCounter civil_war_spain_going_on = 1
            
            if I_FactionLeaderTrait spain Usurper >= 3
			         set_event_counter new_house_spain 1
            end_if
           
            historic_event end_civil_war_spain
            increment_kings_purse spain 1000
  			    set_event_counter civil_war_spain_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 2
        if I_EventCounter civil_war_france_going_on = 1
            
            if I_FactionLeaderTrait france Usurper >= 3
			         set_event_counter new_house_france 1
            end_if
           
            historic_event end_civil_war_france
            increment_kings_purse france 1000
  			    set_event_counter civil_war_france_going_on 0
		    end_if
    end_if
    
    if I_EventCounter resistance  = 3    
        if I_EventCounter civil_war_portugal_going_on = 1
            
            if I_FactionLeaderTrait portugal Usurper >= 3
			         set_event_counter new_house_portugal 1
            end_if
           
            historic_event end_civil_war_portugal
            increment_kings_purse portugal 1000
  			    set_event_counter civil_war_portugal_going_on 0
		    end_if
    end_if
    
    if I_EventCounter resistance  = 4    
        if I_EventCounter civil_war_aragon_going_on = 1
            
            if I_FactionLeaderTrait aragon Usurper >= 3
			         set_event_counter new_house_aragon 1
            end_if
           
            historic_event end_civil_war_aragon
            increment_kings_purse aragon 1000
  			    set_event_counter civil_war_aragon_going_on 0
		    end_if
    end_if
    
    if I_EventCounter resistance  = 5     
        if I_EventCounter civil_war_hre_going_on = 1
            
            if I_FactionLeaderTrait hre Usurper >= 3
			         set_event_counter new_house_hre 1
            end_if
           
            historic_event end_civil_war_hre
            increment_kings_purse hre 1000
  			    set_event_counter civil_war_hre_going_on 0
		    end_if
    end_if
    
        
    if I_EventCounter resistance  = 6     
        if I_EventCounter civil_war_england_going_on = 1
            
            if I_FactionLeaderTrait england Usurper >= 3
			         set_event_counter new_house_england 1
            end_if
           
            historic_event end_civil_war_england
            increment_kings_purse england 1000
  			    set_event_counter civil_war_england_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 7     
        if I_EventCounter civil_war_scotland_going_on = 1
            
            if I_FactionLeaderTrait scotland Usurper >= 3
			         set_event_counter new_house_scotland 1
            end_if
           
            historic_event end_civil_war_scotland
            increment_kings_purse scotland 1000
  			    set_event_counter civil_war_scotland_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 8     
        if I_EventCounter civil_war_denmark_going_on = 1
            
            if I_FactionLeaderTrait denmark Usurper >= 3
			         set_event_counter new_house_denmark 1
            end_if
           
            historic_event end_civil_war_denmark
            increment_kings_purse denmark 1000
  			    set_event_counter civil_war_denmark_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 9     
        if I_EventCounter civil_war_norway_going_on = 1
            
            if I_FactionLeaderTrait norway Usurper >= 3
			         set_event_counter new_house_norway 1
            end_if
           
            historic_event end_civil_war_norway
            increment_kings_purse norway 1000
  			    set_event_counter civil_war_norway_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 10     
        if I_EventCounter civil_war_poland_going_on = 1
            
            if I_FactionLeaderTrait poland Usurper >= 3
			         set_event_counter new_house_poland 1
            end_if
           
            historic_event end_civil_war_poland
            increment_kings_purse poland 1000
  			    set_event_counter civil_war_poland_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 11     
        if I_EventCounter civil_war_hungary_going_on = 1
            
            if I_FactionLeaderTrait hungary Usurper >= 3
			         set_event_counter new_house_hungary 1
            end_if
           
            historic_event end_civil_war_hungary
            increment_kings_purse hungary 1000
  			    set_event_counter civil_war_hungary_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 12     
        if I_EventCounter civil_war_venice_going_on = 1
            
            if I_FactionLeaderTrait venice Usurper >= 3
			         set_event_counter new_house_venice 1
            end_if
           
            historic_event end_civil_war_venice
            increment_kings_purse venice 1000
  			    set_event_counter civil_war_venice_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 13    
        if I_EventCounter civil_war_sicily_going_on = 1
            
            if I_FactionLeaderTrait sicily Usurper >= 3
			         set_event_counter new_house_sicily 1
            end_if
           
            historic_event end_civil_war_sicily
            increment_kings_purse sicily 1000
  			    set_event_counter civil_war_sicily_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 14     
        if I_EventCounter civil_war_pisa_going_on = 1
            
            if I_FactionLeaderTrait pisa Usurper >= 3
			         set_event_counter new_house_pisa 1
            end_if
           
            historic_event end_civil_war_pisa
            increment_kings_purse pisa 1000
  			    set_event_counter civil_war_pisa_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 15     
        if I_EventCounter civil_war_milan_going_on = 1
            
            if I_FactionLeaderTrait milan Usurper >= 3
			         set_event_counter new_house_milan 1
            end_if
           
            historic_event end_civil_war_milan
            increment_kings_purse milan 1000
  			    set_event_counter civil_war_milan_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 16     
        if I_EventCounter civil_war_byzantium_going_on = 1
            
            if I_FactionLeaderTrait byzantium Usurper >= 3
			         set_event_counter new_house_byzantium 1
            end_if
           
            historic_event end_civil_war_byzantium
            increment_kings_purse byzantium 1000
  			    set_event_counter civil_war_byzantium_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 17     
        if I_EventCounter civil_war_kievan_rus_going_on = 1
            
            if I_FactionLeaderTrait kievan_rus Usurper >= 3
			         set_event_counter new_house_kievan_rus 1
            end_if
           
            historic_event end_civil_war_kievan_rus
            increment_kings_purse kievan_rus 1000
  			    set_event_counter civil_war_kievan_rus_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 18     
        if I_EventCounter civil_war_russia_going_on = 1
            
            if I_FactionLeaderTrait russia Usurper >= 3
			         set_event_counter new_house_russia 1
            end_if
           
            historic_event end_civil_war_russia
            increment_kings_purse russia 1000
  			    set_event_counter civil_war_russia_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 19     
        if I_EventCounter civil_war_teutonic_order_going_on = 1
            
            if I_FactionLeaderTrait teutonic_order Usurper >= 3
			         set_event_counter new_house_teutonic_order 1
            end_if
           
            historic_event end_civil_war_teutonic_order
            increment_kings_purse teutonic_order 1000
  			    set_event_counter civil_war_teutonic_order_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 20     
        if I_EventCounter civil_war_timurids_going_on = 1
            
            if I_FactionLeaderTrait timurids Usurper >= 3
			         set_event_counter new_house_timurids 1
            end_if
           
            historic_event end_civil_war_timurids
            increment_kings_purse timurids 1000
  			    set_event_counter civil_war_timurids_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 21     
        if I_EventCounter civil_war_lithuania_going_on = 1
            
            if I_FactionLeaderTrait lithuania Usurper >= 3
			         set_event_counter new_house_lithuania 1
            end_if
           
            historic_event end_civil_war_lithuania
            increment_kings_purse lithuania 1000
  			    set_event_counter civil_war_lithuania_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 22     
        if I_EventCounter civil_war_cumans_going_on = 1
            
            if I_FactionLeaderTrait cumans Usurper >= 3
			         set_event_counter new_house_cumans 1
            end_if
           
            historic_event end_civil_war_cumans
            increment_kings_purse cumans 1000
  			    set_event_counter civil_war_cumans_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 23     
        if I_EventCounter civil_war_moors_going_on = 1
            
            if I_FactionLeaderTrait moors Usurper >= 3
			         set_event_counter new_house_moors 1
            end_if
           
            historic_event end_civil_war_moors
            increment_kings_purse moors 1000
  			    set_event_counter civil_war_moors_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 24     
        if I_EventCounter civil_war_rum_going_on = 1
            
            if I_FactionLeaderTrait rum Usurper >= 3
			         set_event_counter new_house_rum 1
            end_if
           
            historic_event end_civil_war_rum
            increment_kings_purse rum 1000
  			    set_event_counter civil_war_rum_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 25     
        if I_EventCounter civil_war_turks_going_on = 1
            
            if I_FactionLeaderTrait turks Usurper >= 3
			         set_event_counter new_house_turks 1
            end_if
           
            historic_event end_civil_war_turks
            increment_kings_purse turks 1000
  			    set_event_counter civil_war_turks_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 26     
        if I_EventCounter civil_war_egypt_going_on = 1
            
            if I_FactionLeaderTrait egypt Usurper >= 3
			         set_event_counter new_house_egypt 1
            end_if
           
            historic_event end_civil_war_egypt
            increment_kings_purse egypt 1000
  			    set_event_counter civil_war_egypt_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 27     
        if I_EventCounter civil_war_kwarezm_going_on = 1
            
            if I_FactionLeaderTrait kwarezm Usurper >= 3
			         set_event_counter new_house_kwarezm 1
            end_if
           
            historic_event end_civil_war_kwarezm
            increment_kings_purse kwarezm 1000
  			    set_event_counter civil_war_kwarezm_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 28     
        if I_EventCounter civil_war_jerusalem_going_on = 1
            
            if I_FactionLeaderTrait jerusalem Usurper >= 3
			         set_event_counter new_house_jerusalem 1
            end_if
           
            historic_event end_civil_war_jerusalem
            increment_kings_purse jerusalem 1000
  			    set_event_counter civil_war_jerusalem_going_on 0
		    end_if
    end_if
        
    if I_EventCounter resistance  = 29     
        if I_EventCounter civil_war_mongols_going_on = 1
            
            if I_FactionLeaderTrait mongols Usurper >= 3
			         set_event_counter new_house_mongols 1
            end_if
           
            historic_event end_civil_war_mongols
            increment_kings_purse mongols 1000
  			    set_event_counter civil_war_mongols_going_on 0
		    end_if
    end_if   
    
end_monitor

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;  NEW LEADER UNREST SCRIPT  ;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;monitor_event BecomesFactionLeader Attribute Authority < 1
;	and not IsFactionAIControlled

;	set_event_counter Anarchy 3
;	historic_event civil_unrest
;end_monitor

;monitor_event SettlementTurnStart not IsFactionAIControlled
;  and I_NumberOfSettlements scotland = 0
;  and I_IsFactionAIControlled scotland
;  and not I_SettlementOwner Edinburgh = scotland
;    inc_counter scotland_emerge 1
;end_monitor


;monitor_event BecomesFactionLeader Attribute Authority < 1
;	and IsFactionAIControlled

;	set_event_counter Anarchy 3
;	historic_event civil_unrest
;end_monitor

;monitor_event SettlementTurnStart IsFactionAIControlled
;  and I_NumberOfSettlements scotland = 0
;  and I_IsFactionAIControlled scotland
;  and not I_SettlementOwner Edinburgh = scotland
;    inc_counter scotland_emerge 1
;end_monitor

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;  FACTION REEMERGENCE SCRIPT  ;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

                                                         
declare_counter faction_emerged
set_counter faction_emerged 0
          
monitor_event PreFactionTurnStart FactionType slave
  set_counter faction_emerged 0
end_monitor     


;--- Special Script For Factions to Respawn From Slave-owned capitals after some time ---;

monitor_event FactionTurnStart FactionType slave
    
    if I_SettlementOwner Edinburgh = slave
        inc_counter scotland_emerge 1
    end_if
    if I_SettlementOwner London = slave
        inc_counter england_emerge 1
    end_if
    if I_SettlementOwner Coimbra = slave
        inc_counter portugal_emerge 1
    end_if
    if I_SettlementOwner Leon = slave
        inc_counter spain_emerge 1
    end_if
    if I_SettlementOwner Zaragoza = slave
        inc_counter aragon_emerge 1
    end_if
    if I_SettlementOwner Paris = slave
        inc_counter france_emerge 1
    end_if
    if I_SettlementOwner Frankfurt = slave
        inc_counter hre_emerge 1
    end_if
    if I_SettlementOwner Bergen = slave
        inc_counter norway_emerge 1
    end_if
    if I_SettlementOwner Lund = slave
        inc_counter denmark_emerge 1
    end_if
    if I_SettlementOwner Palermo = slave
        inc_counter sicily_emerge 1
    end_if
    if I_SettlementOwner Venice = slave
        inc_counter venice_emerge 1
    end_if
    if I_SettlementOwner Pisa = slave
        inc_counter pisa_emerge 1
    end_if
    if I_SettlementOwner Krakow = slave
        inc_counter poland_emerge 1
    end_if
    if I_SettlementOwner Esztergom = slave
        inc_counter hungary_emerge 1
    end_if
    if I_SettlementOwner Kernave = slave
        inc_counter lithuania_emerge 1
    end_if
    if I_SettlementOwner Novgorod = slave
        inc_counter russia_emerge 1
    end_if
    if I_SettlementOwner Kiev = slave
        inc_counter kievan_rus_emerge 1
    end_if
    if I_SettlementOwner Sarkel = slave
        inc_counter cumans_emerge 1
    end_if
    if I_SettlementOwner Ras = slave
        inc_counter teutonic_order_emerge 1
    end_if
    if I_SettlementOwner Constantinople = slave
        inc_counter byzantium_emerge 1
    end_if
    if I_SettlementOwner Tbilisi = slave
        inc_counter timurids_emerge 1
    end_if
    if I_SettlementOwner Konya = slave
        inc_counter rum_emerge 1
    end_if
    if I_SettlementOwner Isfahan = slave
        inc_counter turks_emerge 1
    end_if
    if I_SettlementOwner Cairo = slave
        inc_counter egypt_emerge 1
    end_if
    if I_SettlementOwner Marrakesh = slave
        inc_counter moors_emerge 1
    end_if
    if I_SettlementOwner Baghdad = slave
        inc_counter milan_emerge 1
    end_if

end_monitor     
          
                                                         
declare_counter scotland_emerge
set_counter scotland_emerge 0

monitor_event CityRiots SettlementName Edinburgh  
;  and I_NumberOfSettlements scotland = 0
  and I_IsFactionAIControlled scotland
  and not I_SettlementOwner Edinburgh = scotland
    inc_counter scotland_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter scotland_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Roskilde hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building London hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Prague hidden_bonus_building
    console_command create_building Paris hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Leon hidden_bonus_building
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Lund hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building
    console_command create_building Coimbra hidden_bonus_building
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
  
    console_command create_building Edinburgh hidden_malus_building
    console_command create_building Aberdeen hidden_malus_building
    
    if I_NumberOfSettlements scotland = 0
      spawn_army
        faction scotland
        character random_name, named character, age 26, x 44, y 248, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit   NE Bodyguard	exp 2 armour 0 weapon_lvl 0
          unit		Thanes						exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Scots Skirmisher			exp 0 armour 0 weapon_lvl 0
          unit		Scots Skirmisher			exp 0 armour 0 weapon_lvl 0
          unit		Scots Skirmisher			exp 0 armour 0 weapon_lvl 0
          unit		Scots Skirmisher			exp 0 armour 0 weapon_lvl 0
      end
      
      spawn_army
        faction scotland
        character random_name, named character, age 30, x 53, y 253, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit   NE Bodyguard	exp 2 armour 0 weapon_lvl 0
          unit		Thanes						exp 1 armour 0 weapon_lvl 0
          unit		Highlanders				exp 1 armour 0 weapon_lvl 0
          unit		Highlanders				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Scots Skirmisher			exp 0 armour 0 weapon_lvl 0
          unit		Scots Skirmisher			exp 0 armour 0 weapon_lvl 0
          unit		Scots Skirmisher			exp 0 armour 0 weapon_lvl 0
          unit		Scots Skirmisher			exp 0 armour 0 weapon_lvl 0
      end
      
      add_money scotland 2147483647
      add_money scotland 2147483647
      add_money scotland -2147483647 
      add_money scotland 15000
       
    end_if
    
    if I_SettlementOwner Edinburgh = venice
      faction_emerge scotland venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = sicily
      faction_emerge scotland sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = milan
      faction_emerge scotland milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = denmark
      faction_emerge scotland denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = cumans
      faction_emerge scotland cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = turks
      faction_emerge scotland turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if  
    if I_SettlementOwner Edinburgh = rum
      faction_emerge scotland rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if  
    if I_SettlementOwner Edinburgh = france
      faction_emerge scotland france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = hre
      faction_emerge scotland hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = england
      faction_emerge scotland england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = portugal
      faction_emerge scotland portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = poland
      faction_emerge scotland poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = byzantium
      faction_emerge scotland byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = moors
      faction_emerge scotland moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = russia
      faction_emerge scotland russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = spain
      faction_emerge scotland spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = hungary
      faction_emerge scotland hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = aragon
      faction_emerge scotland aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = lithuania
      faction_emerge scotland lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = kievan_rus
      faction_emerge scotland kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = norway
      faction_emerge scotland norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = jerusalem
      faction_emerge scotland jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = kwarezm
      faction_emerge scotland kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = egypt
      faction_emerge scotland egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = papal_states
      faction_emerge scotland papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = mongols
      faction_emerge scotland mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = teutonic_order
      faction_emerge scotland teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = timurids
      faction_emerge scotland timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = pisa
      faction_emerge scotland pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Edinburgh = slave
      faction_emerge scotland slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event scotland_emerged
  set_counter scotland_emerge 0
end_monitor


declare_counter england_emerge
set_counter england_emerge 0

monitor_event CityRiots SettlementName London
;  and I_NumberOfSettlements england = 0
  and I_IsFactionAIControlled england
  and not I_SettlementOwner London = england
    inc_counter england_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter england_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Roskilde hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Prague hidden_bonus_building
    console_command create_building Paris hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building
    console_command create_building Leon hidden_bonus_building
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Lund hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building
    console_command create_building Coimbra hidden_bonus_building
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_bonus_building
  
    console_command create_building London hidden_malus_building
    console_command create_building Bristol hidden_malus_building
    console_command create_building Lincoln hidden_malus_building
    
    if I_NumberOfSettlements england = 0
      spawn_army
        faction england
        character random_name, named character, age 26, x 81, y 213, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		NE Bodyguard				exp 2 armour 0 weapon_lvl 0
          unit		Norman Cavalry				exp 2 armour 0 weapon_lvl 0
          unit		Norman Cavalry				exp 2 armour 0 weapon_lvl 0
          unit		Dismounted Norman Cavalry				exp 2 armour 0 weapon_lvl 0
          unit		Dismounted Norman Cavalry				exp 2 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Fyrd Spearmen				exp 0 armour 0 weapon_lvl 0
          unit		Fyrd Spearmen				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
      end
      
      spawn_army
        faction england
        character random_name, named character, age 30, x 67, y 214, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		NE Bodyguard				exp 2 armour 0 weapon_lvl 0
          unit		Norman Cavalry				exp 2 armour 0 weapon_lvl 0
          unit		Norman Cavalry				exp 2 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Fyrd Spearmen				exp 0 armour 0 weapon_lvl 0
          unit		Fyrd Spearmen				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
      end
      
      add_money england 2147483647
      add_money england 2147483647
      add_money england -2147483647 
      add_money england 15000
      
    end_if
  
    if I_SettlementOwner London = scotland
      faction_emerge england scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = sicily
      faction_emerge england sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = milan
      faction_emerge england milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = denmark
      faction_emerge england denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = cumans
      faction_emerge england cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = turks
      faction_emerge england turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = rum
      faction_emerge england rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = france
      faction_emerge england france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = hre
      faction_emerge england hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = venice
      faction_emerge england venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = portugal
      faction_emerge england portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = poland
      faction_emerge england poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = byzantium
      faction_emerge england byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = moors
      faction_emerge england moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = russia
      faction_emerge england russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = spain
      faction_emerge england spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = hungary
      faction_emerge england hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = aragon
      faction_emerge england aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = lithuania
      faction_emerge england lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = kievan_rus
      faction_emerge england kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = norway
      faction_emerge england norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = jerusalem
      faction_emerge england jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = kwarezm
      faction_emerge england kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = egypt
      faction_emerge england egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = papal_states
      faction_emerge england papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = mongols
      faction_emerge england mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = teutonic_order
      faction_emerge england teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = timurids
      faction_emerge england timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = pisa
      faction_emerge england pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner London = slave
      faction_emerge england slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event england_emerged
  set_counter england_emerge 0
end_monitor


declare_counter portugal_emerge
set_counter portugal_emerge 0

monitor_event CityRiots SettlementName Coimbra
;  and I_NumberOfSettlements portugal = 0
  and I_IsFactionAIControlled portugal
  and not I_SettlementOwner Coimbra = portugal
    inc_counter portugal_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter portugal_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Roskilde hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Prague hidden_bonus_building
    console_command create_building Paris hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building
    console_command create_building Leon hidden_bonus_building
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Lund hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_bonus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building 
    
    console_command create_building Coimbra hidden_malus_building
    
    if I_NumberOfSettlements portugal = 0
      spawn_army
        faction portugal
        character random_name, named character, age 26, x 27, y 139, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 1 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 1 armour 0 weapon_lvl 0
          unit		Jinetes					exp 0 armour 0 weapon_lvl 0
          unit		Jinetes					exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
      end
      
      spawn_army
        faction portugal
        character random_name, named character, age 30, x 17, y 135, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Jinetes					exp 0 armour 0 weapon_lvl 0
          unit		Jinetes					exp 0 armour 0 weapon_lvl 0
          unit		Jinetes					exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
      end
      
      add_money portugal 2147483647
      add_money portugal 2147483647
      add_money portugal -2147483647 
      add_money portugal 15000
      
    end_if
    
    if I_SettlementOwner Coimbra = scotland
      faction_emerge portugal scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = sicily
      faction_emerge portugal sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = milan
      faction_emerge portugal milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = denmark
      faction_emerge portugal denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = cumans
      faction_emerge portugal cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = turks
      faction_emerge portugal turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = rum
      faction_emerge portugal rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = france
      faction_emerge portugal france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = hre
      faction_emerge portugal hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = venice
      faction_emerge portugal venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = england
      faction_emerge portugal england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = poland
      faction_emerge portugal poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = byzantium
      faction_emerge portugal byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = moors
      faction_emerge portugal moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = russia
      faction_emerge portugal russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = spain
      faction_emerge portugal spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = hungary
      faction_emerge portugal hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = aragon
      faction_emerge portugal aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = lithuania
      faction_emerge portugal lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = kievan_rus
      faction_emerge portugal kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = norway
      faction_emerge portugal norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = jerusalem
      faction_emerge portugal jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = kwarezm
      faction_emerge portugal kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = egypt
      faction_emerge portugal egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = papal_states
      faction_emerge portugal papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = mongols
      faction_emerge portugal mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = teutonic_order
      faction_emerge portugal teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = timurids
      faction_emerge portugal timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = pisa
      faction_emerge portugal pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Coimbra = slave
      faction_emerge portugal slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event portugal_emerged
  set_counter portugal_emerge 0
end_monitor


declare_counter spain_emerge
set_counter spain_emerge 0

monitor_event CityRiots SettlementName Leon
;  and I_NumberOfSettlements spain = 0
  and I_IsFactionAIControlled spain
  and not I_SettlementOwner Leon = spain
    inc_counter spain_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter spain_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Roskilde hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Prague hidden_bonus_building
    console_command create_building Paris hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Lund hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_bonus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building
    
    console_command create_building Leon hidden_malus_building
    console_command create_building Santiago hidden_malus_building
    console_command create_building Burgos hidden_malus_building
    console_command create_building Toledo hidden_malus_building
    
    if I_NumberOfSettlements spain = 0
      spawn_army
        faction spain
        character random_name, named character, age 26, x 31, y 147, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Javelinmen				exp 1 armour 0 weapon_lvl 0
          unit		Javelinmen				exp 1 armour 0 weapon_lvl 0
      end
      
      spawn_army
        faction spain
        character random_name, named character, age 30, x 42, y 146, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Jinetes					exp 2 armour 0 weapon_lvl 0
          unit		Jinetes					exp 2 armour 0 weapon_lvl 0
          unit		Jinetes					exp 2 armour 0 weapon_lvl 0
          unit		Jinetes					exp 2 armour 0 weapon_lvl 0
          unit		Jinetes					exp 2 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Javelinmen				exp 1 armour 0 weapon_lvl 0
          unit		Javelinmen				exp 0 armour 0 weapon_lvl 0
          unit		Javelinmen				exp 1 armour 0 weapon_lvl 0
          unit		Javelinmen				exp 0 armour 0 weapon_lvl 0
      end
      
      add_money spain 2147483647
      add_money spain 2147483647
      add_money spain -2147483647 
      add_money spain 15000
      
    end_if
    
    if I_SettlementOwner Leon = scotland
      faction_emerge spain scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = sicily
      faction_emerge spain sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = milan
      faction_emerge spain milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = denmark
      faction_emerge spain denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = cumans
      faction_emerge spain cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = turks
      faction_emerge spain turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = rum
      faction_emerge spain rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = france
      faction_emerge spain france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = hre
      faction_emerge spain hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = venice
      faction_emerge spain venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = england
      faction_emerge spain england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = poland
      faction_emerge spain poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = byzantium
      faction_emerge spain byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = moors
      faction_emerge spain moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = russia
      faction_emerge spain russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = portugal
      faction_emerge spain portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = hungary
      faction_emerge spain hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = aragon
      faction_emerge spain aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = lithuania
      faction_emerge spain lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = kievan_rus
      faction_emerge spain kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = norway
      faction_emerge spain norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = jerusalem
      faction_emerge spain jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = kwarezm
      faction_emerge spain kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = egypt
      faction_emerge spain egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = papal_states
      faction_emerge spain papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = mongols
      faction_emerge spain mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = teutonic_order
      faction_emerge spain teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = timurids
      faction_emerge spain timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = pisa
      faction_emerge spain pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Leon = slave
      faction_emerge spain slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event spain_emerged
  set_counter spain_emerge 0
end_monitor


declare_counter aragon_emerge
set_counter aragon_emerge 0

monitor_event CityRiots SettlementName Zaragoza
;  and I_NumberOfSettlements aragon = 0
  and I_IsFactionAIControlled aragon
  and not I_SettlementOwner Zaragoza = aragon
    inc_counter aragon_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter aragon_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Roskilde hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Prague hidden_bonus_building
    console_command create_building Paris hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Lund hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_bonus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    
    console_command create_building Zaragoza hidden_malus_building
    console_command create_building Barcelona hidden_malus_building
    console_command create_building Pamplona hidden_malus_building
    
    if I_NumberOfSettlements aragon = 0
      spawn_army
        faction aragon
        character random_name, named character, age 26, x 80, y 148, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Alforrats				exp 0 armour 0 weapon_lvl 0
          unit		Alforrats				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 1 armour 0 weapon_lvl 0
      end
      
      spawn_army
        faction aragon
        character random_name, named character, age 30, x 65, y 142, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Alforrats				exp 0 armour 0 weapon_lvl 0
          unit		Alforrats				exp 0 armour 0 weapon_lvl 0
          unit		Alforrats				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 1 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 0 armour 0 weapon_lvl 0
          unit		Peasant Archers				exp 1 armour 0 weapon_lvl 0
      end
      
      add_money aragon 2147483647
      add_money aragon 2147483647
      add_money aragon -2147483647 
      add_money aragon 15000
      
    end_if
    
    if I_SettlementOwner Zaragoza = scotland
      faction_emerge aragon scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = sicily
      faction_emerge aragon sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = milan
      faction_emerge aragon milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = denmark
      faction_emerge aragon denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = cumans
      faction_emerge aragon cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = turks
      faction_emerge aragon turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = rum
      faction_emerge aragon rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = france
      faction_emerge aragon france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = hre
      faction_emerge aragon hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = venice
      faction_emerge aragon venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = england
      faction_emerge aragon england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = poland
      faction_emerge aragon poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = byzantium
      faction_emerge aragon byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = moors
      faction_emerge aragon moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = russia
      faction_emerge aragon russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = portugal
      faction_emerge aragon portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = hungary
      faction_emerge aragon hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = spain
      faction_emerge aragon spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = lithuania
      faction_emerge aragon lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = kievan_rus
      faction_emerge aragon kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = norway
      faction_emerge aragon norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = jerusalem
      faction_emerge aragon jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = kwarezm
      faction_emerge aragon kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = egypt
      faction_emerge aragon egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = papal_states
      faction_emerge aragon papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = mongols
      faction_emerge aragon mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = teutonic_order
      faction_emerge aragon teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = timurids
      faction_emerge aragon timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = pisa
      faction_emerge aragon pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Zaragoza = slave
      faction_emerge aragon slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event aragon_emerged
  set_counter aragon_emerge 0
end_monitor


declare_counter france_emerge
set_counter france_emerge 0

monitor_event CityRiots SettlementName Paris
;  and I_NumberOfSettlements france = 0
  and I_IsFactionAIControlled france
  and not I_SettlementOwner Paris = france
    inc_counter france_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter france_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Roskilde hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Prague hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Lund hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_bonus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building
    
    console_command create_building Paris hidden_malus_building
    console_command create_building Troyes hidden_malus_building
    console_command create_building Rheims hidden_malus_building
    console_command create_building Lyon hidden_malus_building
    
    
    if I_NumberOfSettlements france = 0
      spawn_army
        faction france
        character random_name, named character, age 26, x 88, y 194, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      end
      
      spawn_army
        faction france
        character random_name, named character, age 30, x 95, y 192, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      end
      
      add_money france 2147483647
      add_money france 2147483647
      add_money france -2147483647 
      add_money france 15000
      
    end_if
    
    if I_SettlementOwner Paris = scotland
      faction_emerge france scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = sicily
      faction_emerge france sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = milan
      faction_emerge france milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = denmark
      faction_emerge france denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = cumans
      faction_emerge france cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = turks
      faction_emerge france turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = rum
      faction_emerge france rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = aragon
      faction_emerge france aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = hre
      faction_emerge france hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = venice
      faction_emerge france venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = england
      faction_emerge france england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = poland
      faction_emerge france poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = byzantium
      faction_emerge france byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = moors
      faction_emerge france moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = russia
      faction_emerge france russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = portugal
      faction_emerge france portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = hungary
      faction_emerge france hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = spain
      faction_emerge france spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = lithuania
      faction_emerge france lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = kievan_rus
      faction_emerge france kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = norway
      faction_emerge france norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = jerusalem
      faction_emerge france jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = kwarezm
      faction_emerge france kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = egypt
      faction_emerge france egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = papal_states
      faction_emerge france papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = mongols
      faction_emerge france mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = teutonic_order
      faction_emerge france teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = timurids
      faction_emerge france timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = pisa
      faction_emerge france pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Paris = slave
      faction_emerge france slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event france_emerged
  set_counter france_emerge 0
end_monitor


declare_counter hre_emerge
set_counter hre_emerge 0

monitor_event CityRiots SettlementName Frankfurt
;  and I_NumberOfSettlements hre = 0
  and I_IsFactionAIControlled hre
  and not I_SettlementOwner Frankfurt = hre
    inc_counter hre_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter hre_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Roskilde hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Lund hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building
    
    console_command create_building Frankfurt hidden_malus_building
    console_command create_building Hamburg hidden_malus_building
    console_command create_building Speyer hidden_malus_building
    console_command create_building Cologne hidden_malus_building
    console_command create_building Prague hidden_malus_building
    console_command create_building Nuremburg hidden_malus_building
    console_command create_building Basel hidden_malus_building    
    
    if I_NumberOfSettlements hre = 0
      spawn_army
        faction hre
        character random_name, named character, age 26, x 135, y 205, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      end
      
      spawn_army
        faction hre
        character random_name, named character, age 30, x 146, y 207, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Mailed Knights				exp 0 armour 0 weapon_lvl 0
          unit		Sergeant Spearmen			exp 0 armour 0 weapon_lvl 0
          unit		Sergeant Spearmen			exp 0 armour 0 weapon_lvl 0
          unit		Macemen				exp 0 armour 0 weapon_lvl 0
          unit		Macemen				exp 0 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
      end
      
      add_money hre 2147483647
      add_money hre 2147483647
      add_money hre -2147483647 
      add_money hre 15000
      
    end_if
    
    if I_SettlementOwner Frankfurt = scotland
      faction_emerge hre scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = sicily
      faction_emerge hre sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = milan
      faction_emerge hre milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = denmark
      faction_emerge hre denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = cumans
      faction_emerge hre cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = turks
      faction_emerge hre turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = rum
      faction_emerge hre rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = aragon
      faction_emerge hre aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = france
      faction_emerge hre france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = venice
      faction_emerge hre venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = england
      faction_emerge hre england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = poland
      faction_emerge hre poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = byzantium
      faction_emerge hre byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = moors
      faction_emerge hre moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = russia
      faction_emerge hre russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = portugal
      faction_emerge hre portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = hungary
      faction_emerge hre hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = spain
      faction_emerge hre spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = lithuania
      faction_emerge hre lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = kievan_rus
      faction_emerge hre kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = norway
      faction_emerge hre norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = jerusalem
      faction_emerge hre jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = kwarezm
      faction_emerge hre kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = egypt
      faction_emerge hre egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = papal_states
      faction_emerge hre papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = mongols
      faction_emerge hre mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = teutonic_order
      faction_emerge hre teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = timurids
      faction_emerge hre timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = pisa
      faction_emerge hre pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Frankfurt = slave
      faction_emerge hre slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event hre_emerged
  set_counter hre_emerge 0
end_monitor


declare_counter norway_emerge
set_counter norway_emerge 0

monitor_event CityRiots SettlementName Bergen
;  and I_NumberOfSettlements norway = 0
  and I_IsFactionAIControlled norway
  and not I_SettlementOwner Bergen = norway
    inc_counter norway_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter norway_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Roskilde hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Lund hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building  
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    
    console_command create_building Bergen hidden_malus_building  
    console_command create_building Oslo hidden_malus_building
    console_command create_building Sijilmasa hidden_bonus_building 
    
    if I_NumberOfSettlements norway = 0
      spawn_army
        faction norway
        character random_name, named character, age 26, x 118, y 274, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		Royal Hirdsmen				exp 1 armour 0 weapon_lvl 0
          unit		Geitir					exp 0 armour 0 weapon_lvl 0
          unit		Geitir					exp 0 armour 0 weapon_lvl 0
          unit		Drengjar				exp 0 armour 0 weapon_lvl 0
          unit		Drengjar				exp 0 armour 0 weapon_lvl 0
          unit		Drengjar				exp 0 armour 0 weapon_lvl 0
          unit		Drengjar				exp 0 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
      end
      
      spawn_army
        faction norway
        character random_name, named character, age 30, x 154, y 279, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		Royal Hirdsmen				exp 1 armour 0 weapon_lvl 0
          unit		Svenner					exp 1 armour 0 weapon_lvl 0
          unit		Svenner					exp 1 armour 0 weapon_lvl 0
          unit		Svenner					exp 1 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 1 armour 0 weapon_lvl 0
          unit		Drengjar				exp 0 armour 0 weapon_lvl 0
          unit		Drengjar				exp 0 armour 0 weapon_lvl 0
          unit		Drengjar				exp 0 armour 0 weapon_lvl 0
          unit		Bondir					exp 1 armour 0 weapon_lvl 0
          unit		Bondir					exp 1 armour 0 weapon_lvl 0
          unit		Bondir					exp 1 armour 0 weapon_lvl 0
      end
      
      add_money norway 2147483647
      add_money norway 2147483647
      add_money norway -2147483647 
      add_money norway 15000
      
    end_if
    
    if I_SettlementOwner Bergen = scotland
      faction_emerge norway scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = sicily
      faction_emerge norway sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = milan
      faction_emerge norway milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = denmark
      faction_emerge norway denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = cumans
      faction_emerge norway cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = turks
      faction_emerge norway turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = rum
      faction_emerge norway rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = aragon
      faction_emerge norway aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = france
      faction_emerge norway france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = venice
      faction_emerge norway venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = england
      faction_emerge norway england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = poland
      faction_emerge norway poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = byzantium
      faction_emerge norway byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = moors
      faction_emerge norway moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = russia
      faction_emerge norway russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = portugal
      faction_emerge norway portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = hungary
      faction_emerge norway hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = spain
      faction_emerge norway spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = lithuania
      faction_emerge norway lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = kievan_rus
      faction_emerge norway kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = hre
      faction_emerge norway hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = jerusalem
      faction_emerge norway jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = kwarezm
      faction_emerge norway kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = egypt
      faction_emerge norway egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = papal_states
      faction_emerge norway papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = mongols
      faction_emerge norway mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = teutonic_order
      faction_emerge norway teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = timurids
      faction_emerge norway timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = pisa
      faction_emerge norway pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Bergen = slave
      faction_emerge norway slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event norway_emerged
  set_counter norway_emerge 0
end_monitor


declare_counter denmark_emerge
set_counter denmark_emerge 0

monitor_event CityRiots SettlementName Lund
;  and I_NumberOfSettlements denmark = 0
  and I_IsFactionAIControlled denmark
  and not I_SettlementOwner Lund = denmark
    inc_counter denmark_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter denmark_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building 
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    
    console_command create_building Lund hidden_malus_building 
    console_command create_building Roskilde hidden_malus_building 
    
    if I_NumberOfSettlements denmark = 0
      spawn_army
        faction denmark
        character random_name, named character, age 26, x 159, y 244, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
          unit		Norse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Norse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Norse Archers				exp 1 armour 0 weapon_lvl 0
      end
      
      spawn_army
        faction denmark
        character random_name, named character, age 30, x 178, y 250, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Spear Militia				exp 0 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
          unit		Viking Raiders				exp 0 armour 0 weapon_lvl 0
          unit		Norse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Norse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Norse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Bondir					exp 1 armour 0 weapon_lvl 0
          unit		Bondir					exp 1 armour 0 weapon_lvl 0
          unit		Bondir					exp 1 armour 0 weapon_lvl 0
      end
      
      add_money denmark 2147483647
      add_money denmark 2147483647
      add_money denmark -2147483647 
      add_money denmark 15000
      
    end_if
    
    if I_SettlementOwner Lund = scotland
      faction_emerge denmark scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = sicily
      faction_emerge denmark sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = milan
      faction_emerge denmark milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = norway
      faction_emerge denmark norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = cumans
      faction_emerge denmark cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = turks
      faction_emerge denmark turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = rum
      faction_emerge denmark rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = aragon
      faction_emerge denmark aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = france
      faction_emerge denmark france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = venice
      faction_emerge denmark venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = england
      faction_emerge denmark england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = poland
      faction_emerge denmark poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = byzantium
      faction_emerge denmark byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = moors
      faction_emerge denmark moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = russia
      faction_emerge denmark russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = portugal
      faction_emerge denmark portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = hungary
      faction_emerge denmark hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = spain
      faction_emerge denmark spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = lithuania
      faction_emerge denmark lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = kievan_rus
      faction_emerge denmark kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = hre
      faction_emerge denmark hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = jerusalem
      faction_emerge denmark jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = kwarezm
      faction_emerge denmark kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = egypt
      faction_emerge denmark egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = papal_states
      faction_emerge denmark papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = mongols
      faction_emerge denmark mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = teutonic_order
      faction_emerge denmark teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = timurids
      faction_emerge denmark timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = pisa
      faction_emerge denmark pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Lund = slave
      faction_emerge denmark slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event denmark_emerged
  set_counter denmark_emerge 0
end_monitor


declare_counter sicily_emerge
set_counter sicily_emerge 0

monitor_event CityRiots SettlementName Palermo
;  and I_NumberOfSettlements sicily = 0
  and I_IsFactionAIControlled sicily
  and not I_SettlementOwner Palermo = sicily
    inc_counter sicily_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter sicily_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building  
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building
     
    console_command create_building Palermo hidden_malus_building
    console_command create_building Reggio hidden_malus_building
    
    if I_NumberOfSettlements sicily = 0
      spawn_army
        faction sicily
        character random_name, named character, age 26, x 183, y 112, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Norman Knights				exp 1 armour 0 weapon_lvl 0
          unit		Norman Knights				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Norman Knights		exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Norman Knights		exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Norman Cavalry			exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Norman Cavalry			exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Norman Cavalry			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		Berber Archers			exp 0 armour 0 weapon_lvl 0
          unit		Berber Archers			exp 0 armour 0 weapon_lvl 0
          unit		Berber Archers			exp 1 armour 0 weapon_lvl 0     
      end
      
      spawn_army
        faction sicily
        character random_name, named character, age 30, x 168, y 119, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Norman Cavalry			exp 1 armour 0 weapon_lvl 0
          unit		Norman Cavalry			exp 1 armour 0 weapon_lvl 0
          unit		Berber Archers			exp 0 armour 0 weapon_lvl 0
          unit		Berber Archers			exp 1 armour 0 weapon_lvl 0
          unit		Berber Archers			exp 0 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
      end
      
      add_money sicily 2147483647
      add_money sicily 2147483647
      add_money sicily -2147483647 
      add_money sicily 15000
      
    end_if
    
    if I_SettlementOwner Palermo = scotland
      faction_emerge sicily scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = denmark
      faction_emerge sicily denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = milan
      faction_emerge sicily milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = norway
      faction_emerge sicily norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = cumans
      faction_emerge sicily cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = turks
      faction_emerge sicily turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = rum
      faction_emerge sicily rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = aragon
      faction_emerge sicily aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = france
      faction_emerge sicily france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = venice
      faction_emerge sicily venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = england
      faction_emerge sicily england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = poland
      faction_emerge sicily poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = byzantium
      faction_emerge sicily byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = moors
      faction_emerge sicily moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = russia
      faction_emerge sicily russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = portugal
      faction_emerge sicily portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = hungary
      faction_emerge sicily hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = spain
      faction_emerge sicily spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = lithuania
      faction_emerge sicily lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = kievan_rus
      faction_emerge sicily kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = hre
      faction_emerge sicily hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = jerusalem
      faction_emerge sicily jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = kwarezm
      faction_emerge sicily kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = egypt
      faction_emerge sicily egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = papal_states
      faction_emerge sicily papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = mongols
      faction_emerge sicily mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = teutonic_order
      faction_emerge sicily teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = timurids
      faction_emerge sicily timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = pisa
      faction_emerge sicily pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Palermo = slave
      faction_emerge sicily slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event sicily_emerged
  set_counter sicily_emerge 0
end_monitor


declare_counter venice_emerge
set_counter venice_emerge 0

monitor_event CityRiots SettlementName Venice
;  and I_NumberOfSettlements venice = 0
  and I_IsFactionAIControlled venice
  and not I_SettlementOwner Venice = venice
    inc_counter venice_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter venice_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building 
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
      
    console_command create_building Venice hidden_malus_building   
    
    if I_NumberOfSettlements venice = 0
      spawn_army
        faction venice
        character random_name, named character, age 26, x 160, y 173, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Italian Cavalry Militia			exp 0 armour 0 weapon_lvl 0
          unit		Italian Cavalry Militia			exp 0 armour 0 weapon_lvl 0
          unit		Armored Sergeants			exp 1 armour 0 weapon_lvl 0
          unit		Armored Sergeants			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0 
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0            
      end
      
      spawn_army
        faction venice
        character random_name, named character, age 30, x 153, y 173, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		SE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Armored Sergeants			exp 1 armour 0 weapon_lvl 0
          unit		Armored Sergeants			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0 
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0        
      end
      
      add_money venice 2147483647
      add_money venice 2147483647
      add_money venice -2147483647 
      add_money venice 15000
      
    end_if
    
    if I_SettlementOwner Venice = scotland
      faction_emerge venice scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = denmark
      faction_emerge venice denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = milan
      faction_emerge venice milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = norway
      faction_emerge venice norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = cumans
      faction_emerge venice cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = turks
      faction_emerge venice turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = rum
      faction_emerge venice rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = aragon
      faction_emerge venice aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = france
      faction_emerge venice france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = sicily
      faction_emerge venice sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = england
      faction_emerge venice england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = poland
      faction_emerge venice poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = byzantium
      faction_emerge venice byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = moors
      faction_emerge venice moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = russia
      faction_emerge venice russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = portugal
      faction_emerge venice portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = hungary
      faction_emerge venice hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = spain
      faction_emerge venice spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = lithuania
      faction_emerge venice lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = kievan_rus
      faction_emerge venice kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = hre
      faction_emerge venice hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = jerusalem
      faction_emerge venice jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = kwarezm
      faction_emerge venice kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = egypt
      faction_emerge venice egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = papal_states
      faction_emerge venice papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = mongols
      faction_emerge venice mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = teutonic_order
      faction_emerge venice teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = timurids
      faction_emerge venice timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = pisa
      faction_emerge venice pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Venice = slave
      faction_emerge venice slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event venice_emerged
  set_counter venice_emerge 0
end_monitor


declare_counter pisa_emerge
set_counter pisa_emerge 0

monitor_event CityRiots SettlementName Pisa
;  and I_NumberOfSettlements pisa = 0
  and I_IsFactionAIControlled pisa
  and not I_SettlementOwner Pisa = pisa
    inc_counter pisa_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter pisa_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building 
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building   
    
    console_command create_building Pisa hidden_malus_building
    console_command create_building Florence hidden_malus_building    
    
    if I_NumberOfSettlements pisa = 0
      spawn_army
        faction pisa
        character random_name, named character, age 26, x 161, y 152, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		SE Bodyguard				exp 0 armour 0 weapon_lvl 0
          unit		Italian Cavalry Militia			exp 0 armour 0 weapon_lvl 0
          unit		Italian Cavalry Militia			exp 0 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0 
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0 
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0           
      end
      
      spawn_army
        faction pisa
        character random_name, named character, age 30, x 153, y 162, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		SE Bodyguard				exp 0 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Crossbow Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 1 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0 
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0 
          unit		Urban Spear Militia			exp 0 armour 0 weapon_lvl 0       
      end
      
      add_money pisa 2147483647
      add_money pisa 2147483647
      add_money pisa -2147483647 
      add_money pisa 15000
      
    end_if
    
    if I_SettlementOwner Pisa = scotland
      faction_emerge pisa scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = denmark
      faction_emerge pisa denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = milan
      faction_emerge pisa milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = norway
      faction_emerge pisa norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = cumans
      faction_emerge pisa cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = turks
      faction_emerge pisa turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = rum
      faction_emerge pisa rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = aragon
      faction_emerge pisa aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = france
      faction_emerge pisa france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = venice
      faction_emerge pisa venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = england
      faction_emerge pisa england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = poland
      faction_emerge pisa poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = byzantium
      faction_emerge pisa byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = moors
      faction_emerge pisa moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = russia
      faction_emerge pisa russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = portugal
      faction_emerge pisa portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = hungary
      faction_emerge pisa hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = spain
      faction_emerge pisa spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = lithuania
      faction_emerge pisa lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = kievan_rus
      faction_emerge pisa kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = hre
      faction_emerge pisa hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = jerusalem
      faction_emerge pisa jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = kwarezm
      faction_emerge pisa kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = egypt
      faction_emerge pisa egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = papal_states
      faction_emerge pisa papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = mongols
      faction_emerge pisa mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = teutonic_order
      faction_emerge pisa teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = timurids
      faction_emerge pisa timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = sicily
      faction_emerge pisa sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Pisa = slave
      faction_emerge pisa slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event pisa_emerged
  set_counter pisa_emerge 0
end_monitor


declare_counter poland_emerge
set_counter poland_emerge 0

monitor_event CityRiots SettlementName Krakow
;  and I_NumberOfSettlements poland = 0
  and I_IsFactionAIControlled poland
  and not I_SettlementOwner Krakow = poland
    inc_counter poland_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter poland_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Gyulafehervar hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Varad hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building 
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    
    console_command create_building Krakow hidden_malus_building
    console_command create_building Plock hidden_malus_building
    console_command create_building Poznan hidden_malus_building     
    
    if I_NumberOfSettlements poland = 0
      spawn_army
        faction poland
        character random_name, named character, age 26, x 221, y 213, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Polish Nobles				exp 0 armour 0 weapon_lvl 0    
          unit		Polish Nobles				exp 0 armour 0 weapon_lvl 0      
          unit		Dismounted Polish Nobles		exp 0 armour 0 weapon_lvl 0  
          unit		Dismounted Polish Nobles		exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0 
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0             
      end
      
      spawn_army
        faction poland
        character random_name, named character, age 30, x 216, y 221, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Polish Nobles		exp 0 armour 0 weapon_lvl 0
          unit		Smolensk Infantry			exp 0 armour 0 weapon_lvl 0
          unit		Smolensk Infantry			exp 0 armour 0 weapon_lvl 0
          unit		Smolensk Infantry			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0      
      end
      
      add_money poland 2147483647
      add_money poland 2147483647
      add_money poland -2147483647 
      add_money poland 15000
      
    end_if
    
    if I_SettlementOwner Krakow = scotland
      faction_emerge poland scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = denmark
      faction_emerge poland denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = milan
      faction_emerge poland milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = norway
      faction_emerge poland norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = cumans
      faction_emerge poland cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = turks
      faction_emerge poland turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = rum
      faction_emerge poland rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = aragon
      faction_emerge poland aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = france
      faction_emerge poland france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = venice
      faction_emerge poland venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = england
      faction_emerge poland england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = sicily
      faction_emerge poland sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = byzantium
      faction_emerge poland byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = moors
      faction_emerge poland moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = russia
      faction_emerge poland russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = portugal
      faction_emerge poland portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = hungary
      faction_emerge poland hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = spain
      faction_emerge poland spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = lithuania
      faction_emerge poland lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = kievan_rus
      faction_emerge poland kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = hre
      faction_emerge poland hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = jerusalem
      faction_emerge poland jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = kwarezm
      faction_emerge poland kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = egypt
      faction_emerge poland egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = papal_states
      faction_emerge poland papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = mongols
      faction_emerge poland mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = teutonic_order
      faction_emerge poland teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = timurids
      faction_emerge poland timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = pisa
      faction_emerge poland pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Krakow = slave
      faction_emerge poland slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event poland_emerged
  set_counter poland_emerge 0
end_monitor


declare_counter hungary_emerge
set_counter hungary_emerge 0

monitor_event CityRiots SettlementName Esztergom
;  and I_NumberOfSettlements hungary = 0
  and I_IsFactionAIControlled hungary
  and not I_SettlementOwner Esztergom = hungary
    inc_counter hungary_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter hungary_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Gdansk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Kernave hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building 
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building
    
    console_command create_building Esztergom hidden_malus_building
    console_command create_building Varad hidden_malus_building 
    console_command create_building Gyulafehervar hidden_malus_building    
    
    if I_NumberOfSettlements hungary = 0
      spawn_army
        faction hungary
        character random_name, named character, age 26, x 221, y 183, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Hungarian Nobles				exp 0 armour 0 weapon_lvl 0
          unit		Hungarian Nobles				exp 0 armour 0 weapon_lvl 0  
          unit		Vlach Axemen					exp 0 armour 0 weapon_lvl 0
          unit		Vlach Axemen					exp 0 armour 0 weapon_lvl 0
          unit		Vlach Archers				exp 0 armour 0 weapon_lvl 0
          unit		Vlach Archers				exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0 
          unit		S Peasant Archers			exp 0 armour 0 weapon_lvl 0 
          unit		S Peasant Archers			exp 0 armour 0 weapon_lvl 0            
      end
      
      spawn_army
        faction hungary
        character random_name, named character, age 30, x 207, y 181, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		NE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Magyar Cavalry				exp 0 armour 0 weapon_lvl 0
          unit		Magyar Cavalry				exp 0 armour 0 weapon_lvl 0
          unit		Magyar Cavalry				exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Spear Militia			exp 0 armour 0 weapon_lvl 0
          unit		S Peasant Archers			exp 0 armour 0 weapon_lvl 0 
          unit		S Peasant Archers			exp 0 armour 0 weapon_lvl 0 
          unit		S Peasant Archers			exp 0 armour 0 weapon_lvl 0      
      end
      
      add_money hungary 2147483647
      add_money hungary 2147483647
      add_money hungary -2147483647 
      add_money hungary 15000
      
    end_if
    
    if I_SettlementOwner Esztergom = scotland
      faction_emerge hungary scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = denmark
      faction_emerge hungary denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = milan
      faction_emerge hungary milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = norway
      faction_emerge hungary norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = cumans
      faction_emerge hungary cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = turks
      faction_emerge hungary turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = rum
      faction_emerge hungary rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = aragon
      faction_emerge hungary aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = france
      faction_emerge hungary france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = venice
      faction_emerge hungary venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = england
      faction_emerge hungary england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = sicily
      faction_emerge hungary sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = byzantium
      faction_emerge hungary byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = moors
      faction_emerge hungary moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = russia
      faction_emerge hungary russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = portugal
      faction_emerge hungary portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = poland
      faction_emerge hungary poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = spain
      faction_emerge hungary spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = lithuania
      faction_emerge hungary lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = kievan_rus
      faction_emerge hungary kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = hre
      faction_emerge hungary hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = jerusalem
      faction_emerge hungary jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = kwarezm
      faction_emerge hungary kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = egypt
      faction_emerge hungary egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = papal_states
      faction_emerge hungary papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = mongols
      faction_emerge hungary mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = teutonic_order
      faction_emerge hungary teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = timurids
      faction_emerge hungary timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = pisa
      faction_emerge hungary pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Esztergom = slave
      faction_emerge hungary slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event hungary_emerged
  set_counter hungary_emerge 0
end_monitor


declare_counter lithuania_emerge
set_counter lithuania_emerge 0

monitor_event CityRiots SettlementName Kernave
;  and I_NumberOfSettlements lithuania = 0
  and I_IsFactionAIControlled lithuania
  and not I_SettlementOwner Kernave = lithuania
    inc_counter lithuania_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter lithuania_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building
     
    console_command create_building Kernave hidden_malus_building 
    console_command create_building Gdansk hidden_malus_building  
    
    if I_NumberOfSettlements lithuania = 0
      spawn_army
        faction lithuania
        character random_name, named character, age 26, x 242, y 248, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		Lith Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Ducal Spearmen			exp 0 armour 0 weapon_lvl 0
          unit		Ducal Spearmen			exp 0 armour 0 weapon_lvl 0
          unit		Lithuanian Axemen			exp 0 armour 0 weapon_lvl 0
          unit		Lithuanian Axemen			exp 0 armour 0 weapon_lvl 0
          unit		Lithuanian Axemen			exp 0 armour 0 weapon_lvl 0
          unit		Lithuanian Axemen			exp 0 armour 0 weapon_lvl 0
          unit		Lithuanian Axemen			exp 0 armour 0 weapon_lvl 0
          unit		Baltic Spearmen				exp 0 armour 0 weapon_lvl 0 
          unit		EE Peasant Archers			exp 1 armour 0 weapon_lvl 0          
      end
      
      spawn_army
        faction lithuania
        character random_name, named character, age 30, x 244, y 244, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		Lith Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Ducal Spearmen			exp 0 armour 0 weapon_lvl 0
          unit		Ducal Spearmen			exp 0 armour 0 weapon_lvl 0
          unit		Ducal Spearmen			exp 0 armour 0 weapon_lvl 0
          unit		Lithuanian Axemen			exp 0 armour 0 weapon_lvl 0
          unit		Lithuanian Axemen			exp 0 armour 0 weapon_lvl 0
          unit		Baltic Spearmen				exp 0 armour 0 weapon_lvl 0
          unit		Baltic Spearmen				exp 0 armour 0 weapon_lvl 0
          unit		Baltic Spearmen				exp 0 armour 0 weapon_lvl 0
          unit		EE Peasant Archers			exp 1 armour 0 weapon_lvl 0 
          unit		EE Peasant Archers			exp 1 armour 0 weapon_lvl 0   
          unit		EE Peasant Archers			exp 1 armour 0 weapon_lvl 0      
      end
      
      add_money lithuania 2147483647
      add_money lithuania 2147483647
      add_money lithuania -2147483647 
      add_money lithuania 15000
      
    end_if
    
    if I_SettlementOwner Kernave = scotland
      faction_emerge lithuania scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = denmark
      faction_emerge lithuania denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = milan
      faction_emerge lithuania milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = norway
      faction_emerge lithuania norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = cumans
      faction_emerge lithuania cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = turks
      faction_emerge lithuania turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = rum
      faction_emerge lithuania rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = aragon
      faction_emerge lithuania aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = france
      faction_emerge lithuania france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = venice
      faction_emerge lithuania venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = england
      faction_emerge lithuania england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = sicily
      faction_emerge lithuania sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = byzantium
      faction_emerge lithuania byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = moors
      faction_emerge lithuania moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = russia
      faction_emerge lithuania russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = portugal
      faction_emerge lithuania portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = poland
      faction_emerge lithuania poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = spain
      faction_emerge lithuania spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = hungary
      faction_emerge lithuania hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = kievan_rus
      faction_emerge lithuania kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = hre
      faction_emerge lithuania hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = jerusalem
      faction_emerge lithuania jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = kwarezm
      faction_emerge lithuania kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = egypt
      faction_emerge lithuania egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = papal_states
      faction_emerge lithuania papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = mongols
      faction_emerge lithuania mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = teutonic_order
      faction_emerge lithuania teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = timurids
      faction_emerge lithuania timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = pisa
      faction_emerge lithuania pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kernave = slave
      faction_emerge lithuania slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event lithuania_emerged
  set_counter lithuania_emerge 0
end_monitor


declare_counter russia_emerge
set_counter russia_emerge 0

monitor_event CityRiots SettlementName Novgorod
;  and I_NumberOfSettlements russia = 0
  and I_IsFactionAIControlled russia
  and not I_SettlementOwner Novgorod = russia
    inc_counter russia_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter russia_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building    
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Turov hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building  
    
    console_command create_building Novgorod hidden_malus_building
    console_command create_building Pskov hidden_malus_building
    console_command create_building Polotsk hidden_malus_building
    
    if I_NumberOfSettlements russia = 0
      spawn_army
        faction russia
        character random_name, named character, age 26, x 297, y 273, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		EE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Druzhina				exp 0 armour 0 weapon_lvl 0
          unit		Druzhina				exp 0 armour 0 weapon_lvl 0
          unit		Pechenegs				exp 0 armour 0 weapon_lvl 0
          unit		Rus Senior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Woodsmen				exp 2 armour 0 weapon_lvl 0
          unit		Woodsmen				exp 2 armour 0 weapon_lvl 0 
          unit		Woodsmen				exp 2 armour 0 weapon_lvl 0 
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0   
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0        
      end
      
      spawn_army
        faction russia
        character random_name, named character, age 30, x 302, y 261, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		EE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Druzhina				exp 0 armour 0 weapon_lvl 0
          unit		Druzhina				exp 0 armour 0 weapon_lvl 0
          unit		Pechenegs				exp 0 armour 0 weapon_lvl 0
          unit		Rus Senior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Rus Senior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Rus Senior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Woodsmen				exp 2 armour 0 weapon_lvl 0
          unit		Woodsmen				exp 2 armour 0 weapon_lvl 0 
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0   
          unit		EE Crossbow Militia			exp 0 armour 0 weapon_lvl 0 
          unit		EE Crossbow Militia			exp 0 armour 0 weapon_lvl 0               
      end
      
      add_money russia 2147483647
      add_money russia 2147483647
      add_money russia -2147483647 
      add_money russia 15000
      
    end_if
    
    if I_SettlementOwner Novgorod = scotland
      faction_emerge russia scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = denmark
      faction_emerge russia denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = milan
      faction_emerge russia milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = norway
      faction_emerge russia norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = cumans
      faction_emerge russia cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = turks
      faction_emerge russia turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = rum
      faction_emerge russia rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = aragon
      faction_emerge russia aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = france
      faction_emerge russia france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = venice
      faction_emerge russia venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = england
      faction_emerge russia england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = sicily
      faction_emerge russia sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = byzantium
      faction_emerge russia byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = moors
      faction_emerge russia moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = lithuania
      faction_emerge russia lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = portugal
      faction_emerge russia portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = poland
      faction_emerge russia poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = spain
      faction_emerge russia spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = hungary
      faction_emerge russia hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = kievan_rus
      faction_emerge russia kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = hre
      faction_emerge russia hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = jerusalem
      faction_emerge russia jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = kwarezm
      faction_emerge russia kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = egypt
      faction_emerge russia egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = papal_states
      faction_emerge russia papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = mongols
      faction_emerge russia mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = teutonic_order
      faction_emerge russia teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = timurids
      faction_emerge russia timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = pisa
      faction_emerge russia pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Novgorod = slave
      faction_emerge russia slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event russia_emerged
  set_counter russia_emerge 0
end_monitor


declare_counter kievan_rus_emerge
set_counter kievan_rus_emerge 0

monitor_event CityRiots SettlementName Kiev
;  and I_NumberOfSettlements kievan_rus = 0
  and I_IsFactionAIControlled kievan_rus
  and not I_SettlementOwner Kiev = kievan_rus
    inc_counter kievan_rus_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter kievan_rus_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building   
    console_command create_building Saqsin hidden_bonus_building
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Sarkel hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building
    
    console_command create_building Kiev hidden_malus_building
    console_command create_building Chernigov hidden_malus_building
    console_command create_building Turov hidden_malus_building 
    console_command create_building Smolensk hidden_malus_building
    
    if I_NumberOfSettlements kievan_rus = 0
      spawn_army
        faction kievan_rus
        character random_name, named character, age 26, x 298, y 219, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		EE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Druzhina				exp 0 armour 0 weapon_lvl 0
          unit		Druzhina				exp 0 armour 0 weapon_lvl 0
          unit		Druzhina				exp 0 armour 0 weapon_lvl 0
          unit		Pechenegs				exp 0 armour 0 weapon_lvl 0
          unit		EE Crossbow Militia			exp 0 armour 0 weapon_lvl 0 
          unit		EE Crossbow Militia			exp 0 armour 0 weapon_lvl 0
          unit		EE Crossbow Militia			exp 0 armour 0 weapon_lvl 0 
          unit		EE Crossbow Militia			exp 0 armour 0 weapon_lvl 0
          unit		Rus Senior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Rus Senior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Rus Senior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 1 armour 0 weapon_lvl 0       
      end
      
      spawn_army
        faction kievan_rus
        character random_name, named character, age 30, x 288, y 213, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		EE Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Druzhina				exp 0 armour 0 weapon_lvl 0
          unit		Pechenegs				exp 0 armour 0 weapon_lvl 0
          unit		Pechenegs				exp 0 armour 0 weapon_lvl 0
          unit		Pechenegs				exp 0 armour 0 weapon_lvl 0
          unit		Rus Senior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Junior Militia				exp 0 armour 0 weapon_lvl 0
          unit		Woodsmen				exp 2 armour 0 weapon_lvl 0
          unit		Woodsmen				exp 2 armour 0 weapon_lvl 0 
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0   
          unit		EE Peasant Archers			exp 0 armour 0 weapon_lvl 0 
          unit		EE Crossbow Militia			exp 0 armour 0 weapon_lvl 0 
          unit		EE Crossbow Militia			exp 0 armour 0 weapon_lvl 0 
          unit		EE Crossbow Militia			exp 0 armour 0 weapon_lvl 0               
      end
      
      add_money kievan_rus 2147483647
      add_money kievan_rus 2147483647
      add_money kievan_rus -2147483647 
      add_money kievan_rus 15000
      
    end_if
    
    if I_SettlementOwner Kiev = scotland
      faction_emerge kievan_rus scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = denmark
      faction_emerge kievan_rus denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = milan
      faction_emerge kievan_rus milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = norway
      faction_emerge kievan_rus norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = cumans
      faction_emerge kievan_rus cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = turks
      faction_emerge kievan_rus turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = rum
      faction_emerge kievan_rus rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = aragon
      faction_emerge kievan_rus aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = france
      faction_emerge kievan_rus france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = venice
      faction_emerge kievan_rus venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = england
      faction_emerge kievan_rus england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = sicily
      faction_emerge kievan_rus sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = byzantium
      faction_emerge kievan_rus byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = moors
      faction_emerge kievan_rus moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = lithuania
      faction_emerge kievan_rus lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = portugal
      faction_emerge kievan_rus portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = poland
      faction_emerge kievan_rus poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = spain
      faction_emerge kievan_rus spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = hungary
      faction_emerge kievan_rus hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = russia
      faction_emerge kievan_rus russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = hre
      faction_emerge kievan_rus hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = jerusalem
      faction_emerge kievan_rus jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = kwarezm
      faction_emerge kievan_rus kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = egypt
      faction_emerge kievan_rus egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = papal_states
      faction_emerge kievan_rus papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = mongols
      faction_emerge kievan_rus mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = teutonic_order
      faction_emerge kievan_rus teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = timurids
      faction_emerge kievan_rus timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = pisa
      faction_emerge kievan_rus pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Kiev = slave
      faction_emerge kievan_rus slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event kievan_rus_emerged
  set_counter kievan_rus_emerge 0
end_monitor


declare_counter cumans_emerge
set_counter cumans_emerge 0

monitor_event CityRiots SettlementName Sarkel
;  and I_NumberOfSettlements cumans = 0
  and I_IsFactionAIControlled cumans
  and not I_SettlementOwner Sarkel = cumans
    inc_counter cumans_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter cumans_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building
    
    console_command create_building Sarkel hidden_malus_building
    console_command create_building Azaq hidden_malus_building
    console_command create_building Saqsin hidden_malus_building
    
    if I_NumberOfSettlements cumans = 0
      spawn_army
        faction cumans
        character random_name, named character, age 26, x 389, y 181, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		Cuman Bodyguard				exp 2 armour 0 weapon_lvl 0
          unit		Behk Druzhina			exp 1 armour 0 weapon_lvl 0
          unit		Behk Druzhina			exp 1 armour 0 weapon_lvl 0
          unit		Cuman Horse Militia		exp 1 armour 0 weapon_lvl 0
          unit		Cuman Horse Militia		exp 1 armour 0 weapon_lvl 0
          unit		Cuman Horse Militia		exp 1 armour 0 weapon_lvl 0
          unit		Steppe Alans		exp 1 armour 0 weapon_lvl 0
          unit		Steppe Alans		exp 1 armour 0 weapon_lvl 0
          unit		Steppe Alans		exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Cuman Militia					exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Cuman Militia					exp 0 armour 0 weapon_lvl 0                
      end
      
      spawn_army
        faction cumans
        character random_name, named character, age 30, x 391, y 192, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		Cuman Bodyguard				exp 2 armour 0 weapon_lvl 0
          unit		Behk Druzhina			exp 1 armour 0 weapon_lvl 0
          unit		Behk Druzhina			exp 1 armour 0 weapon_lvl 0
          unit		Behk Druzhina			exp 1 armour 0 weapon_lvl 0
          unit		Kasogi					exp 1 armour 0 weapon_lvl 0
          unit		Kasogi					exp 1 armour 0 weapon_lvl 0
          unit		Cuman Horse Militia		exp 1 armour 0 weapon_lvl 0
          unit		Cuman Horse Militia		exp 1 armour 0 weapon_lvl 0
          unit		Cuman Horse Militia		exp 1 armour 0 weapon_lvl 0
          unit		Steppe Alans		exp 1 armour 0 weapon_lvl 0
          unit		Steppe Alans		exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Cuman Militia					exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Cuman Militia					exp 0 armour 0 weapon_lvl 0      
          unit		Kasogi Senior Militia		exp 1 armour 0 weapon_lvl 0
          unit		Kasogi Senior Militia		exp 1 armour 0 weapon_lvl 0
          unit		Kasogi Senior Militia		exp 1 armour 0 weapon_lvl 0               
      end
      
      add_money cumans 2147483647
      add_money cumans 2147483647
      add_money cumans -2147483647 
      add_money cumans 15000
      
    end_if
    
    if I_SettlementOwner Sarkel = scotland
      faction_emerge cumans scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = denmark
      faction_emerge cumans denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = milan
      faction_emerge cumans milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = norway
      faction_emerge cumans norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = kievan_rus
      faction_emerge cumans kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = turks
      faction_emerge cumans turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = rum
      faction_emerge cumans rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = aragon
      faction_emerge cumans aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = france
      faction_emerge cumans france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = venice
      faction_emerge cumans venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = england
      faction_emerge cumans england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = sicily
      faction_emerge cumans sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = byzantium
      faction_emerge cumans byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = moors
      faction_emerge cumans moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = lithuania
      faction_emerge cumans lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = portugal
      faction_emerge cumans portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = poland
      faction_emerge cumans poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = spain
      faction_emerge cumans spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = hungary
      faction_emerge cumans hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = russia
      faction_emerge cumans russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = hre
      faction_emerge cumans hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = jerusalem
      faction_emerge cumans jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = kwarezm
      faction_emerge cumans kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = egypt
      faction_emerge cumans egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = papal_states
      faction_emerge cumans papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = mongols
      faction_emerge cumans mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = teutonic_order
      faction_emerge cumans teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = timurids
      faction_emerge cumans timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = pisa
      faction_emerge cumans pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Sarkel = slave
      faction_emerge cumans slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event cumans_emerged
  set_counter cumans_emerge 0
end_monitor


declare_counter teutonic_order_emerge
set_counter teutonic_order_emerge 0

monitor_event CityRiots SettlementName Ras
;  and I_NumberOfSettlements teutonic_order = 0
  and I_IsFactionAIControlled teutonic_order
  and not I_SettlementOwner Ras = teutonic_order
    inc_counter teutonic_order_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter teutonic_order_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building
    
    console_command create_building Ras hidden_malus_building
    
    if I_NumberOfSettlements teutonic_order = 0
      spawn_army
        faction teutonic_order
        character random_name, named character, age 26, x 220, y 156, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		EE Bodyguard 		exp 2 armour 0 weapon_lvl 0
          unit		Vlastelcici 	exp 1 armour 0 weapon_lvl 0
          unit		Vlastelcici 	exp 1 armour 0 weapon_lvl 0
          unit	Dismounted Vlastelcici 		exp 1 armour 0 weapon_lvl 0
          unit	Dismounted Vlastelcici 		exp 1 armour 0 weapon_lvl 0
          unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0
          unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0
          unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0               
      end
      
      spawn_army
        faction teutonic_order
        character random_name, named character, age 30, x 227, y 163, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		EE Bodyguard 		exp 2 armour 0 weapon_lvl 0
          unit		Vlastelcici 	exp 1 armour 0 weapon_lvl 0
          unit	Dismounted Vlastelcici 		exp 3 armour 0 weapon_lvl 0
          unit	Dismounted Vlastelcici 		exp 3 armour 0 weapon_lvl 0
          unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0
          unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0
          unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0
          unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0    
          unit	Slav Levies 		exp 1 armour 0 weapon_lvl 0           
      end
      
      add_money teutonic_order 2147483647
      add_money teutonic_order 2147483647
      add_money teutonic_order -2147483647 
      add_money teutonic_order 15000
      
    end_if
    
    if I_SettlementOwner Ras = scotland
      faction_emerge teutonic_order scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = denmark
      faction_emerge teutonic_order denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = milan
      faction_emerge teutonic_order milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = norway
      faction_emerge teutonic_order norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = kievan_rus
      faction_emerge teutonic_order kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = turks
      faction_emerge teutonic_order turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = rum
      faction_emerge teutonic_order rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = aragon
      faction_emerge teutonic_order aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = france
      faction_emerge teutonic_order france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = venice
      faction_emerge teutonic_order venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = england
      faction_emerge teutonic_order england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = sicily
      faction_emerge teutonic_order sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = byzantium
      faction_emerge teutonic_order byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = moors
      faction_emerge teutonic_order moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = lithuania
      faction_emerge teutonic_order lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = portugal
      faction_emerge teutonic_order portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = poland
      faction_emerge teutonic_order poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = spain
      faction_emerge teutonic_order spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = hungary
      faction_emerge teutonic_order hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = russia
      faction_emerge teutonic_order russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = hre
      faction_emerge teutonic_order hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = jerusalem
      faction_emerge teutonic_order jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = kwarezm
      faction_emerge teutonic_order kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = egypt
      faction_emerge teutonic_order egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = papal_states
      faction_emerge teutonic_order papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = mongols
      faction_emerge teutonic_order mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = cumans
      faction_emerge teutonic_order cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = timurids
      faction_emerge teutonic_order timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = pisa
      faction_emerge teutonic_order pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Ras = slave
      faction_emerge teutonic_order slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event teutonic_order_emerged
  set_counter teutonic_order_emerge 0
end_monitor


declare_counter byzantium_emerge
set_counter byzantium_emerge 0

monitor_event CityRiots SettlementName Constantinople
;  and I_NumberOfSettlements byzantium = 0
  and not IsCrusadeTarget
  and I_IsFactionAIControlled byzantium
  and not I_SettlementOwner Constantinople = byzantium
    inc_counter byzantium_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter byzantium_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building    
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building
    
    console_command create_building Constantinople hidden_malus_building
    console_command create_building Corinth hidden_malus_building
    console_command create_building Adrianople hidden_malus_building
    console_command create_building Thessalonica hidden_malus_building
    
    if I_NumberOfSettlements byzantium = 0
      spawn_army
        faction byzantium
        character random_name, named character, age 26, x 269, y 140, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		Greek Bodyguard				exp 2 armour 0 weapon_lvl 0
          unit		Stratiotae				exp 0 armour 0 weapon_lvl 0
          unit		Stratiotae				exp 0 armour 0 weapon_lvl 0
          unit		Stratiotae				exp 0 armour 0 weapon_lvl 0
          unit		Toxotae					exp 1 armour 0 weapon_lvl 0
          unit		Toxotae					exp 1 armour 0 weapon_lvl 0
          unit		Toxotae					exp 1 armour 0 weapon_lvl 0
          unit		Scoutatoi				exp 0 armour 0 weapon_lvl 0
          unit		Scoutatoi				exp 0 armour 0 weapon_lvl 0
          unit		Scoutatoi				exp 0 armour 0 weapon_lvl 0
          unit		Scoutatoi				exp 0 armour 0 weapon_lvl 0
          unit		Contaratoi				exp 0 armour 0 weapon_lvl 0
          unit		Contaratoi				exp 0 armour 0 weapon_lvl 0
          unit		Contaratoi				exp 0 armour 0 weapon_lvl 0               
      end
      
      spawn_army
        faction byzantium
        character random_name, named character, age 30, x 242, y 130, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		Greek Bodyguard				exp 2 armour 0 weapon_lvl 0
          unit		Stratiotae				exp 0 armour 0 weapon_lvl 0
          unit		Stratiotae				exp 0 armour 0 weapon_lvl 0
          unit		Stratiotae				exp 0 armour 0 weapon_lvl 0
          unit		Scoutatoi				exp 0 armour 0 weapon_lvl 0
          unit		Scoutatoi				exp 0 armour 0 weapon_lvl 0
          unit		Scoutatoi				exp 0 armour 0 weapon_lvl 0
          unit		Scoutatoi				exp 0 armour 0 weapon_lvl 0
          unit		Contaratoi				exp 0 armour 0 weapon_lvl 0
          unit		Contaratoi				exp 0 armour 0 weapon_lvl 0
          unit		Contaratoi				exp 0 armour 0 weapon_lvl 0 
          unit		Acritae					exp 1 armour 0 weapon_lvl 0
          unit		Acritae					exp 1 armour 0 weapon_lvl 0            
      end
      
      add_money byzantium 2147483647
      add_money byzantium 2147483647
      add_money byzantium -2147483647 
      add_money byzantium 15000
      
    end_if
    
    if I_SettlementOwner Constantinople = scotland
      faction_emerge byzantium scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = denmark
      faction_emerge byzantium denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = milan
      faction_emerge byzantium milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = norway
      faction_emerge byzantium norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = kievan_rus
      faction_emerge byzantium kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = turks
      faction_emerge byzantium turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = rum
      faction_emerge byzantium rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = aragon
      faction_emerge byzantium aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = france
      faction_emerge byzantium france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = venice
      faction_emerge byzantium venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = england
      faction_emerge byzantium england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = sicily
      faction_emerge byzantium sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = teutonic_order
      faction_emerge byzantium teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = moors
      faction_emerge byzantium moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = lithuania
      faction_emerge byzantium lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = portugal
      faction_emerge byzantium portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = poland
      faction_emerge byzantium poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = spain
      faction_emerge byzantium spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = hungary
      faction_emerge byzantium hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = russia
      faction_emerge byzantium russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = hre
      faction_emerge byzantium hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = jerusalem
      faction_emerge byzantium jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = kwarezm
      faction_emerge byzantium kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = egypt
      faction_emerge byzantium egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = papal_states
      faction_emerge byzantium papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = mongols
      faction_emerge byzantium mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = cumans
      faction_emerge byzantium cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = timurids
      faction_emerge byzantium timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = pisa
      faction_emerge byzantium pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Constantinople = slave
      faction_emerge byzantium slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event byzantium_emerged
  set_counter byzantium_emerge 0
end_monitor


declare_counter timurids_emerge
set_counter timurids_emerge 0

monitor_event CityRiots SettlementName Tbilisi
;  and I_NumberOfSettlements timurids = 0
  and I_IsFactionAIControlled timurids
  and not I_SettlementOwner Tbilisi = timurids
    inc_counter timurids_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter timurids_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building    
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Angora hidden_bonus_building
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building 
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building
    
    console_command create_building Tbilisi hidden_malus_building
    console_command create_building Kutaisi hidden_malus_building
    
    if I_NumberOfSettlements timurids = 0
      spawn_army
        faction timurids
        character random_name, named character, age 26, x 390, y 146, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		bodyguard georgia		exp 1 armour 0 weapon_lvl 0
          unit		georgian medium lancers	exp 1 armour 0 weapon_lvl 0
          unit		georgian medium lancers	exp 1 armour 0 weapon_lvl 0
          unit		georgian medium lancers	exp 1 armour 0 weapon_lvl 0
          unit		georgian medium swordsmen	exp 0 armour 0 weapon_lvl 0
          unit		georgian medium swordsmen	exp 0 armour 0 weapon_lvl 0
          unit		georgian medium swordsmen	exp 0 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 1 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 1 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 0 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 1 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 1 armour 0 weapon_lvl 0
          unit		aor trasc javelin	exp 0 armour 0 weapon_lvl 0
                        
      end                                                         
      
      spawn_army
        faction timurids
        character random_name, named character, age 30, x 397, y 158, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		bodyguard georgia		exp 1 armour 0 weapon_lvl 0
          unit		georgian heavy horse archers	exp 1 armour 0 weapon_lvl 0
          unit		georgian heavy horse archers	exp 1 armour 0 weapon_lvl 0
          unit		georgian light horse archers	exp 1 armour 0 weapon_lvl 0    
          unit		georgian light horse archers	exp 1 armour 0 weapon_lvl 0 
          unit		georgian light horse archers	exp 1 armour 0 weapon_lvl 0
          unit		aor trasc javelin	exp 0 armour 0 weapon_lvl 0
          unit		aor trasc javelin	exp 0 armour 0 weapon_lvl 0
          unit		aor trasc javelin	exp 0 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 0 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 1 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 1 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 0 armour 0 weapon_lvl 0
          unit		georgian light spearmen	exp 1 armour 0 weapon_lvl 0  
      end
      
      add_money timurids 2147483647
      add_money timurids 2147483647
      add_money timurids -2147483647 
      add_money timurids 15000
      
    end_if
    
    if I_SettlementOwner Tbilisi = scotland
      faction_emerge timurids scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = denmark
      faction_emerge timurids denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = milan
      faction_emerge timurids milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = norway
      faction_emerge timurids norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = kievan_rus
      faction_emerge timurids kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = turks
      faction_emerge timurids turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = rum
      faction_emerge timurids rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = aragon
      faction_emerge timurids aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = france
      faction_emerge timurids france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = venice
      faction_emerge timurids venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = england
      faction_emerge timurids england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = sicily
      faction_emerge timurids sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = teutonic_order
      faction_emerge timurids teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = moors
      faction_emerge timurids moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = lithuania
      faction_emerge timurids lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = portugal
      faction_emerge timurids portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = poland
      faction_emerge timurids poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = spain
      faction_emerge timurids spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = hungary
      faction_emerge timurids hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = russia
      faction_emerge timurids russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = hre
      faction_emerge timurids hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = jerusalem
      faction_emerge timurids jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = kwarezm
      faction_emerge timurids kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = egypt
      faction_emerge timurids egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = papal_states
      faction_emerge timurids papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = mongols
      faction_emerge timurids mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = cumans
      faction_emerge timurids cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = byzantium
      faction_emerge timurids byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = pisa
      faction_emerge timurids pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Tbilisi = slave
      faction_emerge timurids slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event timurids_emerged
  set_counter timurids_emerge 0
end_monitor


declare_counter rum_emerge
set_counter rum_emerge 0

monitor_event CityRiots SettlementName Konya
;  and I_NumberOfSettlements rum = 0
  and I_IsFactionAIControlled rum
  and not I_SettlementOwner Konya = rum
    inc_counter rum_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter rum_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building    
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building 
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building   
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    
    console_command create_building Konya hidden_malus_building
    console_command create_building Angora hidden_malus_building
    
    if I_NumberOfSettlements rum = 0
      spawn_army
        faction rum
        character random_name, named character, age 26, x 316, y 113, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Fari Lancers			exp 1 armour 0 weapon_lvl 0
          unit		Fari Lancers			exp 1 armour 0 weapon_lvl 0
          unit		Fari Lancers			exp 1 armour 0 weapon_lvl 0
          unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0                      
      end                                                         
      
      spawn_army
        faction rum
        character random_name, named character, age 30, x 309, y 125, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0  
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0   
      end
      
      add_money rum 2147483647
      add_money rum 2147483647
      add_money rum -2147483647 
      add_money rum 15000
      
    end_if
    
    if I_SettlementOwner Konya = scotland
      faction_emerge rum scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = denmark
      faction_emerge rum denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = milan
      faction_emerge rum milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = norway
      faction_emerge rum norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = kievan_rus
      faction_emerge rum kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = turks
      faction_emerge rum turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = timurids
      faction_emerge rum timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = aragon
      faction_emerge rum aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = france
      faction_emerge rum france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = venice
      faction_emerge rum venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = england
      faction_emerge rum england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = sicily
      faction_emerge rum sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = teutonic_order
      faction_emerge rum teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = moors
      faction_emerge rum moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = lithuania
      faction_emerge rum lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = portugal
      faction_emerge rum portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = poland
      faction_emerge rum poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = spain
      faction_emerge rum spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = hungary
      faction_emerge rum hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = russia
      faction_emerge rum russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = hre
      faction_emerge rum hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = jerusalem
      faction_emerge rum jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = kwarezm
      faction_emerge rum kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = egypt
      faction_emerge rum egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = papal_states
      faction_emerge rum papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = mongols
      faction_emerge rum mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = cumans
      faction_emerge rum cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = byzantium
      faction_emerge rum byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = pisa
      faction_emerge rum pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Konya = slave
      faction_emerge rum slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event rum_emerged
  set_counter rum_emerge 0
end_monitor


declare_counter turks_emerge
set_counter turks_emerge 0

monitor_event CityRiots SettlementName Isfahan
;  and I_NumberOfSettlements turks = 0
  and I_IsFactionAIControlled turks
  and not I_SettlementOwner Isfahan = turks
    inc_counter turks_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter turks_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building    
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building 
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building 
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building   
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    
    console_command create_building Neyshabur hidden_malus_building

    console_command create_building Isfahan hidden_malus_building
    console_command create_building Ray hidden_malus_building
    console_command create_building Yazd hidden_malus_building
    
    if I_NumberOfSettlements turks = 0
      spawn_army
        faction turks
        character random_name, named character, age 26, x 445, y 85, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Fari Lancers			exp 1 armour 0 weapon_lvl 0
          unit		Fari Lancers			exp 1 armour 0 weapon_lvl 0
          unit		Fari Lancers			exp 1 armour 0 weapon_lvl 0
          unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0                      
      end                                                         
      
      spawn_army
        faction turks
        character random_name, named character, age 30, x 461, y 84, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Horse Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkomans				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Turkish Archers				exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0  
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0   
      end
      
      add_money turks 2147483647
      add_money turks 2147483647
      add_money turks -2147483647 
      add_money turks 15000
      
    end_if
    
    if I_SettlementOwner Isfahan = scotland
      faction_emerge turks scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = denmark
      faction_emerge turks denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = milan
      faction_emerge turks milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = norway
      faction_emerge turks norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = kievan_rus
      faction_emerge turks kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = rum
      faction_emerge turks rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = timurids
      faction_emerge turks timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = aragon
      faction_emerge turks aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = france
      faction_emerge turks france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = venice
      faction_emerge turks venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = england
      faction_emerge turks england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = sicily
      faction_emerge turks sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = teutonic_order
      faction_emerge turks teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = moors
      faction_emerge turks moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = lithuania
      faction_emerge turks lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = portugal
      faction_emerge turks portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = poland
      faction_emerge turks poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = spain
      faction_emerge turks spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = hungary
      faction_emerge turks hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = russia
      faction_emerge turks russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = hre
      faction_emerge turks hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = jerusalem
      faction_emerge turks jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = kwarezm
      faction_emerge turks kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = egypt
      faction_emerge turks egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = papal_states
      faction_emerge turks papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = mongols
      faction_emerge turks mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = cumans
      faction_emerge turks cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = byzantium
      faction_emerge turks byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = pisa
      faction_emerge turks pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Isfahan = slave
      faction_emerge turks slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event turks_emerged
  set_counter turks_emerge 0
end_monitor


declare_counter egypt_emerge
set_counter egypt_emerge 0

monitor_event CityRiots SettlementName Cairo
;  and I_NumberOfSettlements egypt = 0
  and I_IsFactionAIControlled egypt
  and not I_SettlementOwner Cairo = egypt
    inc_counter egypt_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter egypt_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building    
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building 
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building 
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building   
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building  
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building
    
    console_command create_building Cairo hidden_malus_building  
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Alexandria hidden_malus_building
    console_command create_building Damietta hidden_malus_building  
    
    if I_NumberOfSettlements egypt = 0
      spawn_army
        faction egypt
        character random_name, named character, age 26, x 296, y 63, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0                    
      end                                                         
      
      spawn_army
        faction egypt
        character random_name, named character, age 30, x 307, y 52, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		African Spearmen			exp 1 armour 0 weapon_lvl 0
          unit		African Spearmen			exp 1 armour 0 weapon_lvl 0
          unit		African Archers				exp 1 armour 0 weapon_lvl 0
          unit		African Archers				exp 1 armour 0 weapon_lvl 0
          unit		Berber Archers				exp 1 armour 0 weapon_lvl 0 
      end
      
      add_money egypt 2147483647
      add_money egypt 2147483647
      add_money egypt -2147483647 
      add_money egypt 15000
      
    end_if
    
    if I_SettlementOwner Cairo = scotland
      faction_emerge egypt scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = denmark
      faction_emerge egypt denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = milan
      faction_emerge egypt milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = norway
      faction_emerge egypt norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = kievan_rus
      faction_emerge egypt kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = rum
      faction_emerge egypt rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = timurids
      faction_emerge egypt timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = aragon
      faction_emerge egypt aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = france
      faction_emerge egypt france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = venice
      faction_emerge egypt venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = england
      faction_emerge egypt england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = sicily
      faction_emerge egypt sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = teutonic_order
      faction_emerge egypt teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = moors
      faction_emerge egypt moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = lithuania
      faction_emerge egypt lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = portugal
      faction_emerge egypt portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = poland
      faction_emerge egypt poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = spain
      faction_emerge egypt spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = hungary
      faction_emerge egypt hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = russia
      faction_emerge egypt russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = hre
      faction_emerge egypt hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = jerusalem
      faction_emerge egypt jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = kwarezm
      faction_emerge egypt kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = turks
      faction_emerge egypt turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = papal_states
      faction_emerge egypt papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = mongols
      faction_emerge egypt mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = cumans
      faction_emerge egypt cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = byzantium
      faction_emerge egypt byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = pisa
      faction_emerge egypt pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Cairo = slave
      faction_emerge egypt slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event egypt_emerged
  set_counter egypt_emerge 0
end_monitor


declare_counter kwarezm_emerge
set_counter kwarezm_emerge 0

monitor_event CityRiots SettlementName Mosul
;  and I_NumberOfSettlements kwarezm = 0
  and I_IsFactionAIControlled kwarezm
  and not I_SettlementOwner Mosul = kwarezm
    inc_counter kwarezm_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter kwarezm_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building    
    console_command create_building Tunis hidden_bonus_building
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building 
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building 
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building   
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building 
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building    
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building
    
    console_command create_building Mosul hidden_malus_building
    console_command create_building Ar_Raqqah hidden_malus_building
       
    if I_NumberOfSettlements kwarezm = 0
      spawn_army
        faction kwarezm
        character random_name, named character, age 26, x 381, y 99, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		ME Bodyguard				exp 2 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		ME Peasant Archers			exp 2 armour 0 weapon_lvl 0
          unit		ME Peasant Archers			exp 2 armour 0 weapon_lvl 0  
          unit		ME Peasant Archers			exp 2 armour 0 weapon_lvl 0
          unit		ME Peasant Archers			exp 2 armour 0 weapon_lvl 0                    
      end                                                         
      
      spawn_army
        faction kwarezm
        character random_name, named character, age 30, x 384, y 114, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		ME Bodyguard				exp 2 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 1 weapon_lvl 0
          unit		Ghulams				exp 0 armour 1 weapon_lvl 0
          unit		Dismounted Ghulams				exp 0 armour 1 weapon_lvl 0
          unit		Dismounted Ghulams				exp 0 armour 1 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		ME Peasant Archers			exp 2 armour 0 weapon_lvl 0
          unit		ME Peasant Archers			exp 2 armour 0 weapon_lvl 0 
      end
      
      add_money kwarezm 2147483647
      add_money kwarezm 2147483647
      add_money kwarezm -2147483647 
      add_money kwarezm 15000
      
    end_if
    
    if I_SettlementOwner Mosul = scotland
      faction_emerge kwarezm scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = denmark
      faction_emerge kwarezm denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = milan
      faction_emerge kwarezm milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = norway
      faction_emerge kwarezm norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = kievan_rus
      faction_emerge kwarezm kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = rum
      faction_emerge kwarezm rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = timurids
      faction_emerge kwarezm timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = aragon
      faction_emerge kwarezm aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = france
      faction_emerge kwarezm france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = venice
      faction_emerge kwarezm venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = england
      faction_emerge kwarezm england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = sicily
      faction_emerge kwarezm sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = teutonic_order
      faction_emerge kwarezm teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = moors
      faction_emerge kwarezm moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = lithuania
      faction_emerge kwarezm lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = portugal
      faction_emerge kwarezm portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = poland
      faction_emerge kwarezm poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = spain
      faction_emerge kwarezm spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = hungary
      faction_emerge kwarezm hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = russia
      faction_emerge kwarezm russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = hre
      faction_emerge kwarezm hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = jerusalem
      faction_emerge kwarezm jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = egypt
      faction_emerge kwarezm egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = turks
      faction_emerge kwarezm turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = papal_states
      faction_emerge kwarezm papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = mongols
      faction_emerge kwarezm mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = cumans
      faction_emerge kwarezm cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = byzantium
      faction_emerge kwarezm byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = pisa
      faction_emerge kwarezm pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Mosul = slave
      faction_emerge kwarezm slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event kwarezm_emerged
  set_counter kwarezm_emerge 0
end_monitor


declare_counter moors_emerge
set_counter moors_emerge 0

monitor_event CityRiots SettlementName Marrakesh
;  and I_NumberOfSettlements moors = 0
  and I_IsFactionAIControlled moors
  and not I_SettlementOwner Marrakesh = moors
    inc_counter moors_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter moors_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building    
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building    
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building 
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building   
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building 
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building    
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building  
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building 
    
    console_command create_building Fes hidden_malus_building
    console_command create_building Marrakesh hidden_malus_building
    console_command create_building Tunis hidden_malus_building
       
    if I_NumberOfSettlements moors = 0
      spawn_army
        faction moors
        character random_name, named character, age 26, x 30, y 81, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Arab Cavalry			exp 1 armour 0 weapon_lvl 0
          unit		Arab Cavalry			exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Arab Cavalry			exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Arab Cavalry			exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Arab Cavalry			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0                   
      end                                                         
      
      spawn_army
        faction moors
        character random_name, named character, age 30, x 17, y 73, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Arab Cavalry			exp 1 armour 0 weapon_lvl 0
          unit		Berber Light Cavalry				exp 0 armour 0 weapon_lvl 0
          unit		Berber Light Cavalry				exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Arab Cavalry			exp 0 armour 0 weapon_lvl 0
          unit		Dismounted Arab Cavalry			exp 0 armour 0 weapon_lvl 0
          unit		Lamtuna Spearmen			exp 1 armour 0 weapon_lvl 0
          unit		Lamtuna Spearmen			exp 1 armour 0 weapon_lvl 0
          unit		Lamtuna Spearmen			exp 1 armour 0 weapon_lvl 0
          unit		Lamtuna Spearmen			exp 1 armour 0 weapon_lvl 0
          unit		Lamtuna Spearmen			exp 1 armour 0 weapon_lvl 0    
          unit		Berber Archers				exp 0 armour 0 weapon_lvl 0
          unit		Berber Archers				exp 0 armour 0 weapon_lvl 0 
          unit		Berber Archers				exp 0 armour 0 weapon_lvl 0  
      end
      
      add_money moors 2147483647
      add_money moors 2147483647
      add_money moors -2147483647 
      add_money moors 15000
      
    end_if
    
    if I_SettlementOwner Marrakesh = scotland
      faction_emerge moors scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = denmark
      faction_emerge moors denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = milan
      faction_emerge moors milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = norway
      faction_emerge moors norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = kievan_rus
      faction_emerge moors kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = rum
      faction_emerge moors rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = timurids
      faction_emerge moors timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = aragon
      faction_emerge moors aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = france
      faction_emerge moors france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = venice
      faction_emerge moors venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = england
      faction_emerge moors england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = sicily
      faction_emerge moors sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = teutonic_order
      faction_emerge moors teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = kwarezm
      faction_emerge moors kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = lithuania
      faction_emerge moors lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = portugal
      faction_emerge moors portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = poland
      faction_emerge moors poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = spain
      faction_emerge moors spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = hungary
      faction_emerge moors hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = russia
      faction_emerge moors russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = hre
      faction_emerge moors hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = jerusalem
      faction_emerge moors jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = egypt
      faction_emerge moors egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = turks
      faction_emerge moors turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = papal_states
      faction_emerge moors papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = mongols
      faction_emerge moors mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = cumans
      faction_emerge moors cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = byzantium
      faction_emerge moors byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = pisa
      faction_emerge moors pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = slave
      faction_emerge moors slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event moors_emerged
  set_counter moors_emerge 0
end_monitor


declare_counter milan_emerge
set_counter milan_emerge 0

monitor_event CityRiots SettlementName Baghdad
;  and I_NumberOfSettlements milan = 0
  and I_IsFactionAIControlled milan
  and not I_SettlementOwner Baghdad = milan
    inc_counter milan_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter milan_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building  
    console_command create_building Acre hidden_bonus_building
    console_command create_building Chandax hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building    
    console_command create_building Sis hidden_bonus_building
    console_command create_building Jerusalem hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building  
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building 
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building   
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building 
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building    
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building  
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building 
    console_command create_building Tunis hidden_bonus_building
    
    console_command create_building Baghdad hidden_malus_building
    console_command create_building Al_Wasit hidden_malus_building 
       
    if I_NumberOfSettlements milan = 0
      spawn_army
        faction milan
        character random_name, named character, age 26, x 391, y 88, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0               
      end                                                         
      
      spawn_army
        faction milan
        character random_name, named character, age 30, x 402, y 86, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		ME Bodyguard				exp 1 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Dismounted Ghulams				exp 1 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia				exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0
          unit		Ahdath Militia			exp 0 armour 0 weapon_lvl 0 
      end
      
      add_money milan 2147483647
      add_money milan 2147483647
      add_money milan -2147483647 
      add_money milan 15000
      
    end_if
    
    if I_SettlementOwner Baghdad = scotland
      faction_emerge milan scotland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = denmark
      faction_emerge milan denmark 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = moors
      faction_emerge milan moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = norway
      faction_emerge milan norway 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = kievan_rus
      faction_emerge milan kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = rum
      faction_emerge milan rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = timurids
      faction_emerge milan timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = aragon
      faction_emerge milan aragon 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = france
      faction_emerge milan france 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = venice
      faction_emerge milan venice 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = england
      faction_emerge milan england 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = sicily
      faction_emerge milan sicily 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = teutonic_order
      faction_emerge milan teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = kwarezm
      faction_emerge milan kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = lithuania
      faction_emerge milan lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = portugal
      faction_emerge milan portugal 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = poland
      faction_emerge milan poland 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = spain
      faction_emerge milan spain 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = hungary
      faction_emerge milan hungary 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = russia
      faction_emerge milan russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = hre
      faction_emerge milan hre 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = jerusalem
      faction_emerge milan jerusalem 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = egypt
      faction_emerge milan egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = turks
      faction_emerge milan turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = papal_states
      faction_emerge milan papal_states 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = mongols
      faction_emerge milan mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = cumans
      faction_emerge milan cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = byzantium
      faction_emerge milan byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = pisa
      faction_emerge milan pisa 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Baghdad = slave
      faction_emerge milan slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event milan_emerged
  set_counter milan_emerge 0
end_monitor


declare_counter jerusalem_emerge
set_counter jerusalem_emerge 0

monitor_event CityRiots SettlementName Jerusalem
;  and I_NumberOfSettlements jerusalem = 0
  and I_CrusadeInProgress
  and not IsCrusadeTarget
  and not IsJihadTarget
  and I_IsFactionAIControlled jerusalem
  and not I_SettlementOwner Jerusalem = jerusalem
    inc_counter jerusalem_emerge 3
end_monitor

monitor_event FactionTurnEnd FactionType slave
  and I_CompareCounter jerusalem_emerge > 5
  and I_CompareCounter faction_emerged = 0
  
    set_counter faction_emerged 1
  
    console_command create_building Oslo hidden_bonus_building 
    console_command create_building Sijilmasa hidden_bonus_building 
    console_command create_building Rouen hidden_bonus_building
    console_command create_building Norwich hidden_bonus_building
    console_command create_building Ratisbon hidden_bonus_building
    console_command create_building Florence hidden_bonus_building
    console_command create_building Trebizond hidden_bonus_building   
    console_command create_building Arta hidden_bonus_building
    console_command create_building Ani hidden_bonus_building
    console_command create_building Granada hidden_bonus_building
    console_command create_building Al_Wasit hidden_bonus_building    
    console_command create_building Chandax hidden_bonus_building   
    console_command create_building Tlemcen hidden_bonus_building    
    console_command create_building Sigtuna hidden_bonus_building
    console_command create_building Sredets hidden_bonus_building
    console_command create_building Sharukan hidden_bonus_building
    console_command create_building Visby hidden_bonus_building
    console_command create_building Orleans hidden_bonus_building
    console_command create_building Ragusa hidden_bonus_building    
    console_command create_building Attaleia hidden_bonus_building    
    console_command create_building Venice hidden_bonus_building
    console_command create_building Edinburgh hidden_bonus_building   
    console_command create_building Genoa hidden_bonus_building   
    console_command create_building Rome hidden_bonus_building
    console_command create_building Baghdad hidden_bonus_building
    console_command create_building Sis hidden_bonus_building
    console_command create_building Pisa hidden_bonus_building
    console_command create_building Bergen hidden_bonus_building
    console_command create_building Al-Mahdiya hidden_bonus_building  
    console_command create_building Kalmar hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building
    console_command create_building Aberdeen hidden_malus_building 
    console_command create_building London hidden_bonus_building
    console_command create_building Bristol hidden_bonus_building
    console_command create_building Sevilla hidden_bonus_building
    console_command create_building Baku hidden_bonus_building
    console_command create_building Urgench hidden_bonus_building
    console_command create_building Shiraz hidden_bonus_building
    console_command create_building Verona hidden_bonus_building
    console_command create_building Lincoln hidden_bonus_building   
    
    console_command create_building Coimbra hidden_bonus_building    
    console_command create_building Leon hidden_bonus_building
    console_command create_building Santiago hidden_bonus_building
    console_command create_building Burgos hidden_bonus_building
    console_command create_building Toledo hidden_bonus_building
    console_command create_building Zaragoza hidden_bonus_building
    console_command create_building Barcelona hidden_bonus_building
    console_command create_building Pamplona hidden_bonus_building    
    console_command create_building Paris hidden_bonus_building
    console_command create_building Troyes hidden_bonus_building
    console_command create_building Rheims hidden_bonus_building
    console_command create_building Lyon hidden_bonus_building       
    console_command create_building Frankfurt hidden_bonus_building
    console_command create_building Hamburg hidden_bonus_building
    console_command create_building Speyer hidden_bonus_building
    console_command create_building Cologne hidden_bonus_building 
    console_command create_building Prague hidden_bonus_building
    console_command create_building Nuremburg hidden_bonus_building
    console_command create_building Basel hidden_bonus_building  
    console_command create_building Lund hidden_bonus_building 
    console_command create_building Roskilde hidden_bonus_building    
    console_command create_building Palermo hidden_bonus_building   
    console_command create_building Reggio hidden_bonus_building  
    console_command create_building Milan hidden_bonus_building
    console_command create_building Dublin hidden_bonus_building
    console_command create_building Bulgar hidden_bonus_building    
    console_command create_building Tarabulus hidden_bonus_building
    console_command create_building Krakow hidden_bonus_building
    console_command create_building Plock hidden_bonus_building
    console_command create_building Poznan hidden_bonus_building 
    console_command create_building Esztergom hidden_bonus_building
    console_command create_building Varad hidden_bonus_building 
    console_command create_building Gyulafehervar hidden_bonus_building    
    console_command create_building Kernave hidden_bonus_building 
    console_command create_building Gdansk hidden_bonus_building    
    console_command create_building Novgorod hidden_bonus_building
    console_command create_building Pskov hidden_bonus_building
    console_command create_building Polotsk hidden_bonus_building   
    console_command create_building Kiev hidden_bonus_building
    console_command create_building Chernigov hidden_bonus_building
    console_command create_building Turov hidden_bonus_building 
    console_command create_building Smolensk hidden_bonus_building   
    console_command create_building Sarkel hidden_bonus_building
    console_command create_building Azaq hidden_bonus_building
    console_command create_building Saqsin hidden_bonus_building  
    console_command create_building Ras hidden_bonus_building 
    console_command create_building Constantinople hidden_bonus_building
    console_command create_building Corinth hidden_bonus_building
    console_command create_building Adrianople hidden_bonus_building
    console_command create_building Thessalonica hidden_bonus_building   
    console_command create_building Tbilisi hidden_bonus_building
    console_command create_building Kutaisi hidden_bonus_building
    console_command create_building Konya hidden_bonus_building
    console_command create_building Angora hidden_bonus_building
    console_command create_building Isfahan hidden_bonus_building
    console_command create_building Neyshabur hidden_bonus_building
    console_command create_building Merv hidden_bonus_building
    console_command create_building Mecca hidden_bonus_building
    console_command create_building Ray hidden_bonus_building
    console_command create_building Yazd hidden_bonus_building 
    console_command create_building Cairo hidden_bonus_building
    console_command create_building Damascus hidden_bonus_building  
    console_command create_building Alexandria hidden_bonus_building
    console_command create_building Damietta hidden_bonus_building  
    console_command create_building Mosul hidden_bonus_building
    console_command create_building Ar_Raqqah hidden_bonus_building
    console_command create_building Fes hidden_bonus_building
    console_command create_building Marrakesh hidden_bonus_building
    console_command create_building Derbent hidden_bonus_building 
    console_command create_building Tunis hidden_bonus_building
    
    console_command create_building Jerusalem hidden_malus_building
    console_command create_building Acre hidden_malus_building
       
    if I_NumberOfSettlements jerusalem = 0
      spawn_army
        faction jerusalem
        character random_name, named character, age 26, x 335, y 78, family
        traits Factionleader 3, GoodCommander 4 , Energetic 1 , StrategyChivalry 3, Intelligent 1
          unit		NE Bodyguard				exp 3 armour 0 weapon_lvl 0
          unit		Crusader Knights			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Knights			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Knights			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Knights			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Pisan and Geonese sailors		exp 0 armour 0 weapon_lvl 0
          unit		Pisan and Geonese sailors		exp 0 armour 0 weapon_lvl 0
          unit		Pisan and Geonese sailors		exp 0 armour 0 weapon_lvl 0              
      end                                                         
      
      spawn_army
        faction jerusalem
        character random_name, named character, age 30, x 330, y 68, family
        traits Factionleader 2, GoodCommander 2 , Energetic 1 , StrategyChivalry 1, Intelligent 1
          unit		NE Bodyguard				exp 3 armour 0 weapon_lvl 0
          unit		Crusader Knights			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Crusader Sergeants			exp 3 armour 0 weapon_lvl 0
          unit		Pisan and Geonese sailors		exp 0 armour 0 weapon_lvl 0
          unit		Pisan and Geonese sailors		exp 0 armour 0 weapon_lvl 0
          unit		Pisan and Geonese sailors		exp 0 armour 0 weapon_lvl 0
          unit		Syrian Auxilliaries			exp 1 armour 0 weapon_lvl 0  
          unit		Syrian Auxilliaries			exp 1 armour 0 weapon_lvl 0
          unit		Syrian Auxilliaries			exp 1 armour 0 weapon_lvl 0  
      end
      
      add_money jerusalem 2147483647
      add_money jerusalem 2147483647
      add_money jerusalem -2147483647 
      add_money jerusalem 15000
      
    end_if
    
    if I_SettlementOwner Marrakesh = milan
      faction_emerge jerusalem milan 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = kievan_rus
      faction_emerge jerusalem kievan_rus 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = rum
      faction_emerge jerusalem rum 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = timurids
      faction_emerge jerusalem timurids 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = teutonic_order
      faction_emerge jerusalem teutonic_order 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = kwarezm
      faction_emerge jerusalem kwarezm 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = lithuania
      faction_emerge jerusalem lithuania 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = russia
      faction_emerge jerusalem russia 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = moors
      faction_emerge jerusalem moors 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = egypt
      faction_emerge jerusalem egypt 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = turks
      faction_emerge jerusalem turks 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = mongols
      faction_emerge jerusalem mongols 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = cumans
      faction_emerge jerusalem cumans 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = byzantium
      faction_emerge jerusalem byzantium 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    if I_SettlementOwner Marrakesh = slave
      faction_emerge jerusalem slave 5 400.0 0.0 1.2 town true unused_label1 unused_name 30
    end_if
    
    destroy_buildings scotland hidden_temporary_buildings false
    destroy_buildings sicily hidden_temporary_buildings false
    destroy_buildings milan hidden_temporary_buildings false
    destroy_buildings denmark hidden_temporary_buildings false
    destroy_buildings turks hidden_temporary_buildings false
    destroy_buildings venice hidden_temporary_buildings false
    destroy_buildings pisa hidden_temporary_buildings false
    destroy_buildings kievan_rus hidden_temporary_buildings false
    destroy_buildings rum hidden_temporary_buildings false
    destroy_buildings timurids hidden_temporary_buildings false
    destroy_buildings france hidden_temporary_buildings false
    destroy_buildings hre hidden_temporary_buildings false
    destroy_buildings aragon hidden_temporary_buildings false
    destroy_buildings england hidden_temporary_buildings false
    destroy_buildings poland hidden_temporary_buildings false
    destroy_buildings teutonic_order hidden_temporary_buildings false
    destroy_buildings kwarezm hidden_temporary_buildings false
    destroy_buildings russia hidden_temporary_buildings false
    destroy_buildings portugal hidden_temporary_buildings false
    destroy_buildings lithuania hidden_temporary_buildings false
    destroy_buildings spain hidden_temporary_buildings false
    destroy_buildings hungary hidden_temporary_buildings false
    destroy_buildings cumans hidden_temporary_buildings false
    destroy_buildings norway hidden_temporary_buildings false
    destroy_buildings moors hidden_temporary_buildings false
    destroy_buildings egypt hidden_temporary_buildings false
    destroy_buildings papal_states hidden_temporary_buildings false
    destroy_buildings mongols hidden_temporary_buildings false
    destroy_buildings byzantium hidden_temporary_buildings false
    destroy_buildings jerusalem hidden_temporary_buildings false
    destroy_buildings slave hidden_temporary_buildings false
    
    historic_event jerusalem_emerged
  set_counter jerusalem_emerge 0
end_monitor


;monitor_event FactionTurnEnd FactionType pisa
;
;  faction_emerge venice pisa 1 65.0 0.0 1.2 town true unused_label1 unused_name 30  
;  historic_event city_betrayal    
;end_monitor

wait_monitors
end_script